var s$=Object.defineProperty,S2=Object.getOwnPropertySymbols,a$=Object.prototype.hasOwnProperty,l$=Object.prototype.propertyIsEnumerable,A2=(Yo,_i,Li)=>_i in Yo?s$(Yo,_i,{enumerable:!0,configurable:!0,writable:!0,value:Li}):Yo[_i]=Li,om=(Yo,_i)=>{for(var Li in _i||(_i={}))a$.call(_i,Li)&&A2(Yo,Li,_i[Li]);if(S2)for(var Li of S2(_i))l$.call(_i,Li)&&A2(Yo,Li,_i[Li]);return Yo};(self.webpackChunkespacios_publicos=self.webpackChunkespacios_publicos||[]).push([[179],{255:Yo=>{function _i(Li){return Promise.resolve().then(()=>{var gs=new Error("Cannot find module '"+Li+"'");throw gs.code="MODULE_NOT_FOUND",gs})}_i.keys=()=>[],_i.resolve=_i,_i.id=255,Yo.exports=_i},958:function(Yo){Yo.exports=function(){"use strict";var _i,Li,gs;function Td(p,$r){if(_i)if(Li){var Cr="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+_i+")(sharedChunk); ("+Li+")(sharedChunk); self.onerror = null;",Dr={};_i(Dr),gs=$r(Dr),"undefined"!=typeof window&&(gs.workerUrl=window.URL.createObjectURL(new Blob([Cr],{type:"text/javascript"})))}else Li=$r;else _i=$r}return Td(0,function(p){var Cr=Dr;function Dr(a,r,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=l,this.p2y=u}Dr.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},Dr.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},Dr.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},Dr.prototype.solveCurveX=function(a,r){var l,u,h,g,v;for(void 0===r&&(r=1e-6),h=a,v=0;v<8;v++){if(g=this.sampleCurveX(h)-a,Math.abs(g)<r)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=g/w}if((h=a)<(l=0))return l;if(h>(u=1))return u;for(;l<u;){if(g=this.sampleCurveX(h),Math.abs(g-a)<r)return h;a>g?l=h:u=h,h=.5*(u-l)+l}return h},Dr.prototype.solve=function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))};var $e=je;function je(a,r){this.x=a,this.y=r}je.prototype={clone:function(){return new je(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,l=a.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),l=Math.sin(a),u=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,r){var l=Math.cos(a),u=Math.sin(a),h=r.y+u*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-u*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},je.convert=function(a){return a instanceof je?a:Array.isArray(a)?new je(a[0],a[1]):a};var ut="undefined"!=typeof self?self:{};const Ko=Math.pow(2,53)-1,aa=Math.PI/180,wc=180/Math.PI;function Mt(a){return a*aa}function Er(a){return a*wc}const vu=[[0,0],[1,0],[1,1],[0,1]];function Ol(a){if(a<=0)return 0;if(a>=1)return 1;const r=a*a,l=r*a;return 4*(a<.5?l:3*(a-r)+l-.75)}function To(a,r,l,u){const h=new Cr(a,r,l,u);return function(g){return h.solve(g)}}const Mo=To(.25,.1,.25,1);function Sn(a,r,l){return Math.min(l,Math.max(r,a))}function la(a,r,l){const u=l-r,h=((a-r)%u+u)%u+r;return h===r?l:h}function dn(a,r,l){if(!a.length)return l(null,[]);let u=a.length;const h=new Array(a.length);let g=null;a.forEach((v,w)=>{r(v,(D,T)=>{D&&(g=D),h[w]=T,0==--u&&l(g,h)})})}function La(a){const r=[];for(const l in a)r.push(a[l]);return r}function Qi(a,...r){for(const l of r)for(const u in l)a[u]=l[u];return a}let ca=1;function Ba(){return ca++}function Ll(){return function a(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Rn(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Bl(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Io(a,r){a.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function Ut(a,r){return-1!==a.indexOf(r,a.length-r.length)}function js(a,r,l){const u={};for(const h in a)u[h]=r.call(l||this,a[h],h,a);return u}function _s(a,r,l){const u={};for(const h in a)r.call(l||this,a[h],h,a)&&(u[h]=a[h]);return u}function Bi(a){return Array.isArray(a)?a.map(Bi):"object"==typeof a&&a?js(a,Bi):a}const Vl={};function ri(a){Vl[a]||("undefined"!=typeof console&&console.warn(a),Vl[a]=!0)}function Vi(a,r,l){return(l.y-a.y)*(r.x-a.x)>(r.y-a.y)*(l.x-a.x)}function Md(a){let r=0;for(let l,u,h=0,g=a.length,v=g-1;h<g;v=h++)l=a[h],u=a[v],r+=(u.x-l.x)*(l.y+u.y);return r}function Jo(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Va(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,h,g)=>{const v=h||g;return r[u]=!v||v.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let za,sn,ua,zl=null;function Cc(a){if(null==zl){const r=a.navigator?a.navigator.userAgent:null;zl=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return zl}function $s(a){try{const r=ut[a];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const to={now:()=>void 0!==ua?ua:ut.performance.now(),setNow(a){ua=a},restoreNow(){ua=void 0},frame(a){const r=ut.requestAnimationFrame(a);return{cancel:()=>ut.cancelAnimationFrame(r)}},getImageData(a,r=0){const l=ut.document.createElement("canvas"),u=l.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,u.drawImage(a,0,0,a.width,a.height),u.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(za||(za=ut.document.createElement("a")),za.href=a,za.href),get devicePixelRatio(){return ut.devicePixelRatio},get prefersReducedMotion(){return!!ut.matchMedia&&(null==sn&&(sn=ut.matchMedia("(prefers-reduced-motion: reduce)")),sn.matches)}};let Ul;const on={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ul){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ul=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(r){Ul=a}}return Ul},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ua={supported:!1,testSupport:function(a){!bu&&Hr&&(So?Dc(a):oi=a)}};let oi,Hr,bu=!1,So=!1;function Dc(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Hr),a.isContextLost())return;Ua.supported=!0}catch(l){}a.deleteTexture(r),bu=!0}ut.document&&(Hr=ut.document.createElement("img"),Hr.onload=function(){oi&&Dc(oi),oi=null,So=!0},Hr.onerror=function(){bu=!0,oi=null},Hr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ys="01",ai="NO_ACCESS_TOKEN";function Ao(a){return 0===a.indexOf("mapbox:")}function da(a){return on.API_URL_REGEX.test(a)}const Id=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fr(a){const r=a.match(Id);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function zi(a){const r=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${r}`}function jl(a){if(!a)return null;const r=a.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(ut.atob(r[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class ha{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=jl(on.ACCESS_TOKEN);let u="";return u=l&&l.u?ut.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(h,g)=>String.fromCharCode(Number("0x"+g)))):on.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const r=$s("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{const h=ut.localStorage.getItem(l);h&&(this.eventData=JSON.parse(h));const g=ut.localStorage.getItem(u);g&&(this.anonId=g)}catch(h){ri("Unable to read from LocalStorage")}}saveEventData(){const r=$s("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{ut.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ut.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(h){ri("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,u,h){if(!on.EVENTS_URL)return;const g=fr(on.EVENTS_URL);g.params.push(`access_token=${h||on.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.0",skuId:ys,userId:this.anonId},w=l?Qi(v,l):v,D={url:zi(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=Q(D,T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(h)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Ec=new class extends ha{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,r){on.EVENTS_URL&&on.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Ao(l)||da(l))&&this.queueRequest(Date.now(),r)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=jl(on.ACCESS_TOKEN),l=r?r.u:on.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;Bl(this.anonId)||(this.anonId=Ll(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(h),w=(h-this.eventData.lastSuccess)/864e5;u=u||w>=1||w<-1||g.getDate()!==v.getDate()}else u=!0;if(!u)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=h,this.eventData.tokenU=l)},a)}},Tc=Ec.postTurnstileEvent.bind(Ec),ja=new class extends ha{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,r,l,u){this.skuToken=r,this.errorCb=u,on.EVENTS_URL&&(l||on.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ai)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Bl(this.anonId)||(this.anonId=Ll()),this.postEvent(l,{skuToken:this.skuToken},u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},a))}},Sd=ja.postMapLoadEvent.bind(ja),xu=new class extends ha{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,r,l,u){if(!on.API_URL||!on.SESSION_PATH)return;const h=fr(on.API_URL+on.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${u||on.ACCESS_TOKEN||""}`);const g={url:zi(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=oe(g,v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)})}getSessionAPI(a,r,l,u){this.skuToken=r,this.errorCb=u,on.SESSION_PATH&&on.API_URL&&(l||on.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ai)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},a)}},Ad=xu.getSessionAPI.bind(xu),fa=new Set,Mc="mapbox-tiles";let ko,$a,Ic=500,an=50;function Qo(){ut.caches&&!ko&&(ko=ut.caches.open(Mc))}function jt(a){const r=a.indexOf("?");return r<0?a:a.slice(0,r)}let Ha=1/0;const Ga={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ga);class $t extends Error{constructor(r,l,u){401===l&&da(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const G=Jo()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ut.location.protocol?ut.parent:ut).location.href,V=function(a,r){if(!(/^file:/.test(l=a.url)||/^file:/.test(G())&&!/^\w+:/.test(l))){if(ut.fetch&&ut.Request&&ut.AbortController&&ut.Request.prototype.hasOwnProperty("signal"))return function(u,h){const g=new ut.AbortController,v=new ut.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:G(),signal:g.signal});let w=!1,D=!1;const T=(S=v.url).indexOf("sku=")>0&&da(S);var S;"json"===u.type&&v.headers.set("Accept","application/json");const N=(z,j,W)=>{if(D)return;if(z&&"SecurityError"!==z.message&&ri(z),j&&W)return R(j);const te=Date.now();ut.fetch(v).then(re=>{if(re.ok){const ce=T?re.clone():null;return R(re,ce,te)}return h(new $t(re.statusText,re.status,u.url))}).catch(re=>{20!==re.code&&h(new Error(re.message))})},R=(z,j,W)=>{("arrayBuffer"===u.type?z.arrayBuffer():"json"===u.type?z.json():z.text()).then(te=>{D||(j&&W&&function(re,ce,me){if(Qo(),!ko)return;const ve={status:ce.status,statusText:ce.statusText,headers:new ut.Headers};ce.headers.forEach((we,Fe)=>ve.headers.set(Fe,we));const ye=Va(ce.headers.get("Cache-Control")||"");ye["no-store"]||(ye["max-age"]&&ve.headers.set("Expires",new Date(me+1e3*ye["max-age"]).toUTCString()),new Date(ve.headers.get("Expires")).getTime()-me<42e4||function(we,Fe){if(void 0===$a)try{new Response(new ReadableStream),$a=!0}catch(ke){$a=!1}$a?Fe(we.body):we.blob().then(Fe)}(ce,we=>{const Fe=new ut.Response(we,ve);Qo(),ko&&ko.then(ke=>ke.put(jt(re.url),Fe)).catch(ke=>ri(ke.message))}))}(v,j,W),w=!0,h(null,te,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(te=>{D||h(new Error(te.message))})};return T?function(z,j){if(Qo(),!ko)return j(null);const W=jt(z.url);ko.then(te=>{te.match(W).then(re=>{const ce=function(me){if(!me)return!1;const ve=new Date(me.headers.get("Expires")||0),ye=Va(me.headers.get("Cache-Control")||"");return ve>Date.now()&&!ye["no-cache"]}(re);te.delete(W),ce&&te.put(W,re.clone()),j(null,re,ce)}).catch(j)}).catch(j)}(v,N):N(null,null),{cancel:()=>{D=!0,w||g.abort()}}}(a,r);if(Jo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var l;return function(u,h){const g=new ut.XMLHttpRequest;g.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(g.responseType="arraybuffer");for(const v in u.headers)g.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===u.credentials,g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let v=g.response;if("json"===u.type)try{v=JSON.parse(g.response)}catch(w){return h(w)}h(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new $t(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,r)},$=function(a,r){return V(Qi(a,{type:"arrayBuffer"}),r)},Q=function(a,r){return V(Qi(a,{method:"POST"}),r)},oe=function(a,r){return V(Qi(a,{method:"GET"}),r)};function he(a){const r=ut.document.createElement("a");return r.href=a,r.protocol===ut.document.location.protocol&&r.host===ut.document.location.host}const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _e,pe;_e=[],pe=0;const Ce=function(a,r){if(Ua.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),pe>=on.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return _e.push(g),g}pe++;let l=!1;const u=()=>{if(!l)for(l=!0,pe--;_e.length&&pe<on.MAX_PARALLEL_IMAGE_REQUESTS;){const g=_e.shift(),{requestParameters:v,callback:w,cancelled:D}=g;D||(g.cancel=Ce(v,w).cancel)}},h=$(a,(g,v,w,D)=>{u(),g?r(g):v&&(ut.createImageBitmap?function(T,S){const N=new ut.Blob([new Uint8Array(T)],{type:"image/png"});ut.createImageBitmap(N).then(R=>{S(null,R)}).catch(R=>{S(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(T,S)=>r(T,S,w,D)):function(T,S){const N=new ut.Image,R=ut.URL;N.onload=()=>{S(null,N),R.revokeObjectURL(N.src),N.onload=null,ut.requestAnimationFrame(()=>{N.src=de})},N.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new ut.Blob([new Uint8Array(T)],{type:"image/png"});N.src=T.byteLength?R.createObjectURL(z):de}(v,(T,S)=>r(T,S,w,D)))});return{cancel:()=>{h.cancel(),u()}}};function Ve(a,r,l){l[a]&&-1!==l[a].indexOf(r)||(l[a]=l[a]||[],l[a].push(r))}function Qe(a,r,l){if(l&&l[a]){const u=l[a].indexOf(r);-1!==u&&l[a].splice(u,1)}}class Le{constructor(r,l={}){Qi(this,l),this.type=r}}class vt extends Le{constructor(r,l={}){super("error",Qi({error:r},l))}}class Je{on(r,l){return this._listeners=this._listeners||{},Ve(r,l,this._listeners),this}off(r,l){return Qe(r,l,this._listeners),Qe(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ve(r,l,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,l){"string"==typeof r&&(r=new Le(r,l||{}));const u=r.type;if(this.listens(u)){r.target=this;const h=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const w of h)w.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const w of g)Qe(u,w,this._oneTimeListeners),w.call(this,r);const v=this._eventedParent;v&&(Qi(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(r))}else r instanceof vt&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ae{constructor(r,l,u,h){this.message=(r?`${r}: `:"")+u,h&&(this.identifier=h),null!=l&&l.__line__&&(this.line=l.__line__)}}function tn(a){const r=a.value;return r?[new Ae(a.key,r,"constants have been deprecated as of v8")]:[]}function Tn(a,...r){for(const l of r)for(const u in l)a[u]=l[u];return a}function Ot(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function hn(a){if(Array.isArray(a))return a.map(hn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const l in a)r[l]=hn(a[l]);return r}return Ot(a)}class pn extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class $l{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[u,h]of l)this.bindings[u]=h}concat(r){return new $l(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const vs={kind:"null"},rt={kind:"number"},It={kind:"string"},_t={kind:"boolean"},Si={kind:"color"},Hl={kind:"object"},Yt={kind:"value"},ct={kind:"collator"},Sc={kind:"formatted"},nn={kind:"resolvedImage"};function yi(a,r){return{kind:"array",itemType:a,N:r}}function Xn(a){if("array"===a.kind){const r=Xn(a.itemType);return"number"==typeof a.N?`array<${r}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${r}>`}return a.kind}const Zh=[vs,rt,It,_t,Si,Sc,Hl,yi(Yt),nn];function pa(a,r){if("error"===r.kind)return null;if("array"===a.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!pa(a.itemType,r.itemType))&&("number"!=typeof a.N||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if("value"===a.kind)for(const l of Zh)if(!pa(l,r))return null}return`Expected ${Xn(a)} but found ${Xn(r)} instead.`}function wu(a,r){return r.some(l=>l.kind===a.kind)}function Gr(a,r){return r.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}function Gl(a){var r={exports:{}};return a(r,r.exports),r.exports}var No=Gl(function(a,r){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(w){return(w=Math.round(w))<0?0:w>255?255:w}function h(w){return u("%"===w[w.length-1]?parseFloat(w)/100*255:parseInt(w))}function g(w){return(D="%"===w[w.length-1]?parseFloat(w)/100:parseFloat(w))<0?0:D>1?1:D;var D}function v(w,D,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?w+(D-w)*T*6:2*T<1?D:3*T<2?w+(D-w)*(2/3-T)*6:w}try{r.parseCSSColor=function(w){var D,T=w.replace(/ /g,"").toLowerCase();if(T in l)return l[T].slice();if("#"===T[0])return 4===T.length?(D=parseInt(T.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:7===T.length&&(D=parseInt(T.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var S=T.indexOf("("),N=T.indexOf(")");if(-1!==S&&N+1===T.length){var R=T.substr(0,S),z=T.substr(S+1,N-(S+1)).split(","),j=1;switch(R){case"rgba":if(4!==z.length)return null;j=g(z.pop());case"rgb":return 3!==z.length?null:[h(z[0]),h(z[1]),h(z[2]),j];case"hsla":if(4!==z.length)return null;j=g(z.pop());case"hsl":if(3!==z.length)return null;var W=(parseFloat(z[0])%360+360)%360/360,te=g(z[1]),re=g(z[2]),ce=re<=.5?re*(te+1):re+te-re*te,me=2*re-ce;return[u(255*v(me,ce,W+1/3)),u(255*v(me,ce,W)),u(255*v(me,ce,W-1/3)),j];default:return null}}return null}}catch(w){}});class mn{constructor(r,l,u,h=1){this.r=r,this.g=l,this.b=u,this.a=h}static parse(r){if(!r)return;if(r instanceof mn)return r;if("string"!=typeof r)return;const l=No.parseCSSColor(r);return l?new mn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,u,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(u)},${h})`}toArray(){const{r,g:l,b:u,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*l/h,255*u/h,h]}}mn.black=new mn(0,0,0,1),mn.white=new mn(1,1,1,1),mn.transparent=new mn(0,0,0,0),mn.red=new mn(1,0,0,1),mn.blue=new mn(0,0,1,1);class Tt{constructor(r,l,u){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hs{constructor(r,l,u,h,g){this.text=r,this.image=l,this.scale=u,this.fontStack=h,this.textColor=g}}class pr{constructor(r){this.sections=r}static fromString(r){return new pr([new Hs(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof pr?r:pr.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(u)}return r}}class Ui{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ui({name:r,available:!1}):null}serialize(){return["image",this.name]}}function kd(a,r,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,r,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,r,l,u]:[a,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nd(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof mn||a instanceof Tt||a instanceof pr||a instanceof Ui)return!0;if(Array.isArray(a)){for(const r of a)if(!Nd(r))return!1;return!0}if("object"==typeof a){for(const r in a)if(!Nd(a[r]))return!1;return!0}return!1}function Vn(a){if(null===a)return vs;if("string"==typeof a)return It;if("boolean"==typeof a)return _t;if("number"==typeof a)return rt;if(a instanceof mn)return Si;if(a instanceof Tt)return ct;if(a instanceof pr)return Sc;if(a instanceof Ui)return nn;if(Array.isArray(a)){const r=a.length;let l;for(const u of a){const h=Vn(u);if(l){if(l===h)continue;l=Yt;break}l=h}return yi(l||Yt,r)}return Hl}function er(a){const r=typeof a;return null===a?"":"string"===r||"number"===r||"boolean"===r?String(a):a instanceof mn||a instanceof pr||a instanceof Ui?a.toString():JSON.stringify(a)}class ql{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(2!==r.length)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Nd(r[1]))return l.error("invalid value");const u=r[1];let h=Vn(u);const g=l.expectedType;return"array"!==h.kind||0!==h.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(h=g),new ql(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof mn?["rgba"].concat(this.value.toArray()):this.value instanceof pr?this.value.serialize():this.value}}class ji{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const vi={string:It,number:rt,boolean:_t,object:Hl};class es{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let u,h=1;const g=r[0];if("array"===g){let w,D;if(r.length>2){const T=r[1];if("string"!=typeof T||!(T in vi)||"object"===T)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=vi[T],h++}else w=Yt;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=r[2],h++}u=yi(w,D)}else u=vi[g];const v=[];for(;h<r.length;h++){const w=l.parse(r[h],h,Yt);if(!w)return null;v.push(w)}return new es(u,v)}evaluate(r){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(r);if(!pa(this.type,Vn(u)))return u;if(l===this.args.length-1)throw new ji(`Expected value to be of type ${Xn(this.type)}, but found ${Xn(Vn(u))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if("array"===r.kind){const u=r.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&l.push(h)}}return l.concat(this.args.map(u=>u.serialize()))}}class Ac{constructor(r){this.type=Sc,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const h=[];let g=!1;for(let v=1;v<=r.length-1;++v){const w=r[v];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let D=null;if(w["font-scale"]&&(D=l.parse(w["font-scale"],1,rt),!D))return null;let T=null;if(w["text-font"]&&(T=l.parse(w["text-font"],1,yi(It)),!T))return null;let S=null;if(w["text-color"]&&(S=l.parse(w["text-color"],1,Si),!S))return null;const N=h[h.length-1];N.scale=D,N.font=T,N.textColor=S}else{const D=l.parse(r[v],1,Yt);if(!D)return null;const T=D.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:D,scale:null,font:null,textColor:null})}}return new Ac(h)}evaluate(r){return new pr(this.sections.map(l=>{const u=l.content.evaluate(r);return Vn(u)===nn?new Hs("",u,null,null,null):new Hs(er(u),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),r.push(u)}return r}}class Cu{constructor(r){this.type=nn,this.input=r}static parse(r,l){if(2!==r.length)return l.error("Expected two arguments.");const u=l.parse(r[1],1,It);return u?new Cu(u):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),u=Ui.fromString(l);return u&&r.availableImages&&(u.available=r.availableImages.indexOf(l)>-1),u}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const E_={"to-boolean":_t,"to-color":Si,"to-number":rt,"to-string":It};class ln{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[0];if(("to-boolean"===u||"to-string"===u)&&2!==r.length)return l.error("Expected one argument.");const h=E_[u],g=[];for(let v=1;v<r.length;v++){const w=l.parse(r[v],v,Yt);if(!w)return null;g.push(w)}return new ln(h,g)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let l,u;for(const h of this.args){if(l=h.evaluate(r),u=null,l instanceof mn)return l;if("string"==typeof l){const g=r.parseColor(l);if(g)return g}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:kd(l[0],l[1],l[2],l[3]),!u))return new mn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ji(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(r),null===l)return 0;const h=Number(l);if(!isNaN(h))return h}throw new ji(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?pr.fromString(er(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Ui.fromString(er(this.args[0].evaluate(r))):er(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ac([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Cu(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}const T_=["Unknown","Point","LineString","Polygon"];class Xh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?T_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*l-r[0])+this.featureDistanceData.bearing[1]*(h*l-r[1])}return 0}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=mn.parse(r)),l}}class bi{constructor(r,l,u,h){this.name=r,this.type=l,this._evaluate=u,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const u=r[0],h=bi.definitions[u];if(!h)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,v=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=v.filter(([T])=>!Array.isArray(T)||T.length===r.length-1);let D=null;for(const[T,S]of w){D=new Tr(l.registry,l.path,null,l.scope);const N=[];let R=!1;for(let z=1;z<r.length;z++){const j=r[z],W=Array.isArray(T)?T[z-1]:T.type,te=D.parse(j,1+N.length,W);if(!te){R=!0;break}N.push(te)}if(!R)if(Array.isArray(T)&&T.length!==N.length)D.error(`Expected ${T.length} arguments, but found ${N.length} instead.`);else{for(let z=0;z<N.length;z++){const j=Array.isArray(T)?T[z]:T.type,W=N[z];D.concat(z+1).checkSubtype(j,W.type)}if(0===D.errors.length)return new bi(u,g,S,N)}}if(1===w.length)l.errors.push(...D.errors);else{const T=(w.length?w:v).map(([N])=>{return R=N,Array.isArray(R)?`(${R.map(Xn).join(", ")})`:`(${Xn(R.type)}...)`;var R}).join(" | "),S=[];for(let N=1;N<r.length;N++){const R=l.parse(r[N],1+S.length);if(!R)return null;S.push(Xn(R.type))}l.error(`Expected arguments of type ${T}, but found (${S.join(", ")}) instead.`)}return null}static register(r,l){bi.definitions=l;for(const u in l)r[u]=bi}}class An{constructor(r,l,u){this.type=ct,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(2!==r.length)return l.error("Expected one argument.");const u=r[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const h=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,_t);if(!h)return null;const g=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,_t);if(!g)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,It),!v)?null:new An(h,g,v)}evaluate(r){return new Tt(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const ts=8192;function kc(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Wl(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Yh(a,r){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(l*h*ts),Math.round(u*h*ts)]}function sm(a,r,l){const u=a[0]-r[0],h=a[1]-r[1],g=a[0]-l[0],v=a[1]-l[1];return u*v-g*h==0&&u*g<=0&&h*v<=0}function Po(a,r){let l=!1;for(let v=0,w=r.length;v<w;v++){const D=r[v];for(let T=0,S=D.length;T<S-1;T++){if(sm(a,D[T],D[T+1]))return!1;(h=D[T])[1]>(u=a)[1]!=(g=D[T+1])[1]>u[1]&&u[0]<(g[0]-h[0])*(u[1]-h[1])/(g[1]-h[1])+h[0]&&(l=!l)}}var u,h,g;return l}function ma(a,r){for(let l=0;l<r.length;l++)if(Po(a,r[l]))return!0;return!1}function Kh(a,r,l,u){const h=u[0]-l[0],g=u[1]-l[1],v=(a[0]-l[0])*g-h*(a[1]-l[1]),w=(r[0]-l[0])*g-h*(r[1]-l[1]);return v>0&&w<0||v<0&&w>0}function kn(a,r,l){for(const T of l)for(let S=0;S<T.length-1;++S)if((w=[(v=T[S+1])[0]-(g=T[S])[0],v[1]-g[1]])[0]*(D=[(h=r)[0]-(u=a)[0],h[1]-u[1]])[1]-w[1]*D[0]!=0&&Kh(u,h,g,v)&&Kh(g,v,u,h))return!0;var u,h,g,v,w,D;return!1}function Jh(a,r){for(let l=0;l<a.length;++l)if(!Po(a[l],r))return!1;for(let l=0;l<a.length-1;++l)if(kn(a[l],a[l+1],r))return!1;return!0}function Qh(a,r){for(let l=0;l<r.length;l++)if(Jh(a,r[l]))return!0;return!1}function no(a,r,l){const u=[];for(let h=0;h<a.length;h++){const g=[];for(let v=0;v<a[h].length;v++){const w=Yh(a[h][v],l);kc(r,w),g.push(w)}u.push(g)}return u}function Du(a,r,l){const u=[];for(let h=0;h<a.length;h++){const g=no(a[h],r,l);u.push(g)}return u}function vn(a,r,l,u){if(a[0]<l[0]||a[0]>l[2]){const h=.5*u;let g=a[0]-l[0]>h?-u:l[0]-a[0]>h?u:0;0===g&&(g=a[0]-l[2]>h?-u:l[2]-a[0]>h?u:0),a[0]+=g}kc(r,a)}function Nc(a,r,l,u){const h=Math.pow(2,u.z)*ts,g=[u.x*ts,u.y*ts],v=[];for(const w of a)for(const D of w){const T=[D.x+g[0],D.y+g[1]];vn(T,r,l,h),v.push(T)}return v}function qa(a,r,l,u){const h=Math.pow(2,u.z)*ts,g=[u.x*ts,u.y*ts],v=[];for(const D of a){const T=[];for(const S of D){const N=[S.x+g[0],S.y+g[1]];kc(r,N),T.push(N)}v.push(T)}if(r[2]-r[0]<=h/2){(w=r)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const D of v)for(const T of D)vn(T,r,l,h)}var w;return v}class et{constructor(r,l){this.type=_t,this.geojson=r,this.geometries=l}static parse(r,l){if(2!==r.length)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Nd(r[1])){const u=r[1];if("FeatureCollection"===u.type)for(let h=0;h<u.features.length;++h){const g=u.features[h].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new et(u,u.features[h].geometry)}else if("Feature"===u.type){const h=u.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new et(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new et(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(l,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if("Polygon"===u.type){const w=no(u.coordinates,g,v),D=Nc(l.geometry(),h,g,v);if(!Wl(h,g))return!1;for(const T of D)if(!Po(T,w))return!1}if("MultiPolygon"===u.type){const w=Du(u.coordinates,g,v),D=Nc(l.geometry(),h,g,v);if(!Wl(h,g))return!1;for(const T of D)if(!ma(T,w))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(l,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if("Polygon"===u.type){const w=no(u.coordinates,g,v),D=qa(l.geometry(),h,g,v);if(!Wl(h,g))return!1;for(const T of D)if(!Jh(T,w))return!1}if("MultiPolygon"===u.type){const w=Du(u.coordinates,g,v),D=qa(l.geometry(),h,g,v);if(!Wl(h,g))return!1;for(const T of D)if(!Qh(T,w))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function $i(a){if(a instanceof bi&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof et)return!1;let r=!0;return a.eachChild(l=>{r&&!$i(l)&&(r=!1)}),r}function tr(a){if(a instanceof bi&&"feature-state"===a.name)return!1;let r=!0;return a.eachChild(l=>{r&&!tr(l)&&(r=!1)}),r}function qt(a,r){if(a instanceof bi&&r.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!qt(u,r)&&(l=!1)}),l}class bs{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(2!==r.length||"string"!=typeof r[1])return l.error("'var' expression requires exactly one string literal argument.");const u=r[1];return l.scope.has(u)?new bs(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tr{constructor(r,l=[],u,h=new $l,g=[]){this.registry=r,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=h,this.errors=g,this.expectedType=u}parse(r,l,u,h,g={}){return l?this.concat(l,u,h)._parse(r,g):this._parse(r,g)}_parse(r,l){function u(h,g,v){return"assert"===v?new es(g,[h]):"coerce"===v?new ln(g,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let v=g.parse(r,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,D=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==D.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(w,D))return null}else v=u(v,w,l.typeAnnotation||"coerce");else v=u(v,w,l.typeAnnotation||"assert")}if(!(v instanceof ql)&&"resolvedImage"!==v.type.kind&&Pd(v)){const w=new Xh;try{v=new ql(v.type,v.evaluate(w))}catch(D){return this.error(D.message),null}}return v}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,u){const h="number"==typeof r?this.path.concat(r):this.path,g=u?this.scope.concat(u):this.scope;return new Tr(this.registry,h,l||null,g,this.errors)}error(r,...l){const u=`${this.key}${l.map(h=>`[${h}]`).join("")}`;this.errors.push(new pn(u,r))}checkSubtype(r,l){const u=pa(r,l);return u&&this.error(u),u}}function Pd(a){if(a instanceof bs)return Pd(a.boundExpression);if(a instanceof bi&&"error"===a.name||a instanceof An||a instanceof et)return!1;const r=a instanceof ln||a instanceof es;let l=!0;return a.eachChild(u=>{l=r?l&&Pd(u):l&&u instanceof ql}),!!l&&$i(a)&&qt(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function mr(a,r){const l=a.length-1;let u,h,g=0,v=l,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),u=a[w],h=a[w+1],u<=r){if(w===l||r<h)return w;g=w+1}else{if(!(u>r))throw new ji("Input is not a number.");v=w-1}return 0}class ht{constructor(r,l,u){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(r[1],1,rt);if(!u)return null;const h=[];let g=null;l.expectedType&&"value"!==l.expectedType.kind&&(g=l.expectedType);for(let v=1;v<r.length;v+=2){const w=1===v?-1/0:r[v],D=r[v+1],T=v,S=v+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const N=l.parse(D,S,g);if(!N)return null;g=g||N.type,h.push([w,N])}return new ht(g,u,h)}evaluate(r){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=l[0])return u[0].evaluate(r);const g=l.length;return h>=l[g-1]?u[g-1].evaluate(r):u[mr(l,h)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}function pt(a,r,l){return a*(1-l)+r*l}var zn=Object.freeze({__proto__:null,number:pt,color:function(a,r,l){return new mn(pt(a.r,r.r,l),pt(a.g,r.g,l),pt(a.b,r.b,l),pt(a.a,r.a,l))},array:function(a,r,l){return a.map((u,h)=>pt(u,r[h],l))}});const Hi=4/29,ns=6/29,li=3*ns*ns,Pc=Math.PI/180,Wa=180/Math.PI;function Zt(a){return a>.008856451679035631?Math.pow(a,1/3):a/li+Hi}function Za(a){return a>ns?a*a*a:li*(a-Hi)}function qs(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Zl(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ga(a){const r=Zl(a.r),l=Zl(a.g),u=Zl(a.b),h=Zt((.4124564*r+.3575761*l+.1804375*u)/.95047),g=Zt((.2126729*r+.7151522*l+.072175*u)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Zt((.0193339*r+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function Mr(a){let r=(a.l+16)/116,l=isNaN(a.a)?r:r+a.a/500,u=isNaN(a.b)?r:r-a.b/200;return r=1*Za(r),l=.95047*Za(l),u=1.08883*Za(u),new mn(qs(3.2404542*l-1.5371385*r-.4985314*u),qs(-.969266*l+1.8760108*r+.041556*u),qs(.0556434*l-.2040259*r+1.0572252*u),a.alpha)}function Xl(a,r,l){const u=r-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const is={forward:ga,reverse:Mr,interpolate:function(a,r,l){return{l:pt(a.l,r.l,l),a:pt(a.a,r.a,l),b:pt(a.b,r.b,l),alpha:pt(a.alpha,r.alpha,l)}}},Ir={forward:function(a){const{l:r,a:l,b:u}=ga(a),h=Math.atan2(u,l)*Wa;return{h:h<0?h+360:h,c:Math.sqrt(l*l+u*u),l:r,alpha:a.a}},reverse:function(a){const r=a.h*Pc,l=a.c;return Mr({l:a.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:a.alpha})},interpolate:function(a,r,l){return{h:Xl(a.h,r.h,l),c:pt(a.c,r.c,l),l:pt(a.l,r.l,l),alpha:pt(a.alpha,r.alpha,l)}}};var qn=Object.freeze({__proto__:null,lab:is,hcl:Ir});class io{constructor(r,l,u,h,g){this.type=r,this.operator=l,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(r,l,u,h){let g=0;if("exponential"===r.name)g=Rd(l,r.base,u,h);else if("linear"===r.name)g=Rd(l,1,u,h);else if("cubic-bezier"===r.name){const v=r.controlPoints;g=new Cr(v[0],v[1],v[2],v[3]).solve(Rd(l,1,u,h))}return g}static parse(r,l){let[u,h,g,...v]=r;if(!Array.isArray(h)||0===h.length)return l.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return l.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return l.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(S=>"number"!=typeof S||S<0||S>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(g=l.parse(g,2,rt),!g)return null;const w=[];let D=null;"interpolate-hcl"===u||"interpolate-lab"===u?D=Si:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let T=0;T<v.length;T+=2){const S=v[T],N=v[T+1],R=T+3,z=T+4;if("number"!=typeof S)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(w.length&&w[w.length-1][0]>=S)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const j=l.parse(N,z,D);if(!j)return null;D=D||j.type,w.push([S,j])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new io(D,u,h,g,w):l.error(`Type ${Xn(D)} is not interpolatable.`)}evaluate(r){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=l[0])return u[0].evaluate(r);const g=l.length;if(h>=l[g-1])return u[g-1].evaluate(r);const v=mr(l,h),w=io.interpolationFactor(this.interpolation,h,l[v],l[v+1]),D=u[v].evaluate(r),T=u[v+1].evaluate(r);return"interpolate"===this.operator?zn[this.type.kind.toLowerCase()](D,T,w):"interpolate-hcl"===this.operator?Ir.reverse(Ir.interpolate(Ir.forward(D),Ir.forward(T),w)):is.reverse(is.interpolate(is.forward(D),is.forward(T),w))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Rd(a,r,l,u){const h=u-l,g=a-l;return 0===h?0:1===r?g/h:(Math.pow(r,g)-1)/(Math.pow(r,h)-1)}class Xa{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let u=null;const h=l.expectedType;h&&"value"!==h.kind&&(u=h);const g=[];for(const w of r.slice(1)){const D=l.parse(w,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!D)return null;u=u||D.type,g.push(D)}const v=h&&g.some(w=>pa(h,w.type));return new Xa(v?Yt:u,g)}evaluate(r){let l,u=null,h=0;for(const g of this.args)if(h++,u=g.evaluate(r),u&&u instanceof Ui&&!u.available&&(l||(l=u.name),u=null,h===this.args.length&&(u=l)),null!==u)break;return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class Ya{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const v=r[g];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=l.parse(r[g+1],g+1);if(!w)return null;u.push([v,w])}const h=l.parse(r[r.length-1],r.length-1,l.expectedType,u);return h?new Ya(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,u]of this.bindings)r.push(l,u.serialize());return r.push(this.result.serialize()),r}}class Ka{constructor(r,l,u){this.type=r,this.index=l,this.input=u}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,rt),h=l.parse(r[2],2,yi(l.expectedType||Yt));return u&&h?new Ka(h.type.itemType,u,h):null}evaluate(r){const l=this.index.evaluate(r),u=this.input.evaluate(r);if(l<0)throw new ji(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new ji(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new ji(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Yl{constructor(r,l){this.type=_t,this.needle=r,this.haystack=l}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Yt),h=l.parse(r[2],2,Yt);return u&&h?wu(u.type,[_t,It,rt,vs,Yt])?new Yl(u,h):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(u.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!u)return!1;if(!Gr(l,["boolean","string","number","null"]))throw new ji(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(Vn(l))} instead.`);if(!Gr(u,["string","array"]))throw new ji(`Expected second argument to be of type array or string, but found ${Xn(Vn(u))} instead.`);return u.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class xs{constructor(r,l,u){this.type=rt,this.needle=r,this.haystack=l,this.fromIndex=u}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Yt),h=l.parse(r[2],2,Yt);if(!u||!h)return null;if(!wu(u.type,[_t,It,rt,vs,Yt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(u.type)} instead`);if(4===r.length){const g=l.parse(r[3],3,rt);return g?new xs(u,h,g):null}return new xs(u,h)}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!Gr(l,["boolean","string","number","null"]))throw new ji(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(Vn(l))} instead.`);if(!Gr(u,["string","array"]))throw new ji(`Expected second argument to be of type array or string, but found ${Xn(Vn(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return u.indexOf(l,h)}return u.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gi{constructor(r,l,u,h,g,v){this.inputType=r,this.type=l,this.input=u,this.cases=h,this.outputs=g,this.otherwise=v}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let u,h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const g={},v=[];for(let T=2;T<r.length-1;T+=2){let S=r[T];const N=r[T+1];Array.isArray(S)||(S=[S]);const R=l.concat(T);if(0===S.length)return R.error("Expected at least one branch label.");for(const j of S){if("number"!=typeof j&&"string"!=typeof j)return R.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,Vn(j)))return null}else u=Vn(j);if(void 0!==g[String(j)])return R.error("Branch labels must be unique.");g[String(j)]=v.length}const z=l.parse(N,T,h);if(!z)return null;h=h||z.type,v.push(z)}const w=l.parse(r[1],1,Yt);if(!w)return null;const D=l.parse(r[r.length-1],r.length-1,h);return D?"value"!==w.type.kind&&l.concat(1).checkSubtype(u,w.type)?null:new Gi(u,h,w,g,v,D):null}evaluate(r){const l=this.input.evaluate(r);return(Vn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],h={};for(const v of l){const w=h[this.cases[v]];void 0===w?(h[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[w][1].push(v)}const g=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of u)r.push(1===w.length?g(w[0]):w.map(g)),r.push(this.outputs[v].serialize());return r.push(this.otherwise.serialize()),r}}class Eu{constructor(r,l,u){this.type=r,this.branches=l,this.otherwise=u}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const h=[];for(let v=1;v<r.length-1;v+=2){const w=l.parse(r[v],v,_t);if(!w)return null;const D=l.parse(r[v+1],v+1,u);if(!D)return null;h.push([w,D]),u=u||D.type}const g=l.parse(r[r.length-1],r.length-1,u);return g?new Eu(u,h,g):null}evaluate(r){for(const[l,u]of this.branches)if(l.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,u]of this.branches)r(l),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class ro{constructor(r,l,u,h){this.type=r,this.input=l,this.beginIndex=u,this.endIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Yt),h=l.parse(r[2],2,rt);if(!u||!h)return null;if(!wu(u.type,[yi(Yt),It,Yt]))return l.error(`Expected first argument to be of type array or string, but found ${Xn(u.type)} instead`);if(4===r.length){const g=l.parse(r[3],3,rt);return g?new ro(u.type,u,h,g):null}return new ro(u.type,u,h)}evaluate(r){const l=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!Gr(l,["string","array"]))throw new ji(`Expected first argument to be of type array or string, but found ${Xn(Vn(l))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return l.slice(u,h)}return l.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function oo(a,r){return"=="===a||"!="===a?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Tu(a,r,l,u){return 0===u.compare(r,l)}function Ws(a,r,l){const u="=="!==a&&"!="!==a;return class k2{constructor(g,v,w){this.type=_t,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}static parse(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");const w=g[0];let D=v.parse(g[1],1,Yt);if(!D)return null;if(!oo(w,D.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Xn(D.type)}'.`);let T=v.parse(g[2],2,Yt);if(!T)return null;if(!oo(w,T.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Xn(T.type)}'.`);if(D.type.kind!==T.type.kind&&"value"!==D.type.kind&&"value"!==T.type.kind)return v.error(`Cannot compare types '${Xn(D.type)}' and '${Xn(T.type)}'.`);u&&("value"===D.type.kind&&"value"!==T.type.kind?D=new es(T.type,[D]):"value"!==D.type.kind&&"value"===T.type.kind&&(T=new es(D.type,[T])));let S=null;if(4===g.length){if("string"!==D.type.kind&&"string"!==T.type.kind&&"value"!==D.type.kind&&"value"!==T.type.kind)return v.error("Cannot use collator to compare non-string types.");if(S=v.parse(g[3],3,ct),!S)return null}return new k2(D,T,S)}evaluate(g){const v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const D=Vn(v),T=Vn(w);if(D.kind!==T.kind||"string"!==D.kind&&"number"!==D.kind)throw new ji(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${D.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const D=Vn(v),T=Vn(w);if("string"!==D.kind||"string"!==T.kind)return r(g,v,w)}return this.collator?l(g,v,w,this.collator.evaluate(g)):r(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(v=>{g.push(v.serialize())}),g}}}const Rc=Ws("==",function(a,r,l){return r===l},Tu),Ro=Ws("!=",function(a,r,l){return r!==l},function(a,r,l,u){return!Tu(0,r,l,u)}),am=Ws("<",function(a,r,l){return r<l},function(a,r,l,u){return u.compare(r,l)<0}),M_=Ws(">",function(a,r,l){return r>l},function(a,r,l,u){return u.compare(r,l)>0}),lm=Ws("<=",function(a,r,l){return r<=l},function(a,r,l,u){return u.compare(r,l)<=0}),cm=Ws(">=",function(a,r,l){return r>=l},function(a,r,l,u){return u.compare(r,l)>=0});class Fc{constructor(r,l,u,h,g){this.type=It,this.number=r,this.locale=l,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(r,l){if(3!==r.length)return l.error("Expected two arguments.");const u=l.parse(r[1],1,rt);if(!u)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return l.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=l.parse(h.locale,1,It),!g))return null;let v=null;if(h.currency&&(v=l.parse(h.currency,1,It),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=l.parse(h["min-fraction-digits"],1,rt),!w))return null;let D=null;return h["max-fraction-digits"]&&(D=l.parse(h["max-fraction-digits"],1,rt),!D)?null:new Fc(u,g,v,w,D)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Fd{constructor(r){this.type=rt,this.input=r}static parse(r,l){if(2!==r.length)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=l.parse(r[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Xn(u.type)} instead.`):new Fd(u):null}evaluate(r){const l=this.input.evaluate(r);if("string"==typeof l||Array.isArray(l))return l.length;throw new ji(`Expected value to be of type string or array, but found ${Xn(Vn(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const Kl={"==":Rc,"!=":Ro,">":M_,"<":am,">=":cm,"<=":lm,array:es,at:Ka,boolean:es,case:Eu,coalesce:Xa,collator:An,format:Ac,image:Cu,in:Yl,"index-of":xs,interpolate:io,"interpolate-hcl":io,"interpolate-lab":io,length:Fd,let:Ya,literal:ql,match:Gi,number:es,"number-format":Fc,object:es,slice:ro,step:ht,string:es,"to-boolean":ln,"to-color":ln,"to-number":ln,"to-string":ln,var:bs,within:et};function um(a,[r,l,u,h]){r=r.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,v=kd(r,l,u,g);if(v)throw new ji(v);return new mn(r/255*g,l/255*g,u/255*g,g)}function dm(a,r){return a in r}function ef(a,r){const l=r[a];return void 0===l?null:l}function Ja(a){return{type:a}}function tf(a){return{result:"success",value:a}}function Jl(a){return{result:"error",value:a}}function Qa(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function hm(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function nf(a){return!!a.expression&&a.expression.interpolated}function wn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Od(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function rf(a){return a}function Mu(a,r){const l="color"===r.type,u=a.stops&&"object"==typeof a.stops[0][0],h=u||!(u||void 0!==a.property),g=a.type||(nf(r)?"exponential":"interval");if(l&&((a=Tn({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],mn.parse(T[1])])),a.default=mn.parse(a.default?a.default:r.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!qn[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,w,D;if("exponential"===g)v=_a;else if("interval"===g)v=Ld;else if("categorical"===g){v=fm,w=Object.create(null);for(const T of a.stops)w[T[0]]=T[1];D=typeof a.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);v=sf}if(u){const T={},S=[];for(let z=0;z<a.stops.length;z++){const j=a.stops[z],W=j[0].zoom;void 0===T[W]&&(T[W]={zoom:W,type:a.type,property:a.property,default:a.default,stops:[]},S.push(W)),T[W].stops.push([j[0].value,j[1]])}const N=[];for(const z of S)N.push([T[z].zoom,Mu(T[z],r)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:io.interpolationFactor.bind(void 0,R),zoomStops:N.map(z=>z[0]),evaluate:({zoom:z},j)=>_a({stops:N,base:a.base},r,z).evaluate(z,j)}}if(h){const T="exponential"===g?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:io.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(S=>S[0]),evaluate:({zoom:S})=>v(a,r,S,w,D)}}return{kind:"source",evaluate(T,S){const N=S&&S.properties?S.properties[a.property]:void 0;return void 0===N?Oc(a.default,r.default):v(a,r,N,w,D)}}}function Oc(a,r,l){return void 0!==a?a:void 0!==r?r:void 0!==l?l:void 0}function fm(a,r,l,u,h){return Oc(typeof l===h?u[l]:void 0,a.default,r.default)}function Ld(a,r,l){if("number"!==wn(l))return Oc(a.default,r.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const h=mr(a.stops.map(g=>g[0]),l);return a.stops[h][1]}function _a(a,r,l){const u=void 0!==a.base?a.base:1;if("number"!==wn(l))return Oc(a.default,r.default);const h=a.stops.length;if(1===h||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];const g=mr(a.stops.map(S=>S[0]),l),v=function(S,N,R,z){const j=z-R,W=S-R;return 0===j?0:1===N?W/j:(Math.pow(N,W)-1)/(Math.pow(N,j)-1)}(l,u,a.stops[g][0],a.stops[g+1][0]),w=a.stops[g][1],D=a.stops[g+1][1];let T=zn[r.type]||rf;if(a.colorSpace&&"rgb"!==a.colorSpace){const S=qn[a.colorSpace];T=(N,R)=>S.reverse(S.interpolate(S.forward(N),S.forward(R),v))}return"function"==typeof w.evaluate?{evaluate(...S){const N=w.evaluate.apply(void 0,S),R=D.evaluate.apply(void 0,S);if(void 0!==N&&void 0!==R)return T(N,R,v)}}:T(w,D,v)}function sf(a,r,l){return"color"===r.type?l=mn.parse(l):"formatted"===r.type?l=pr.fromString(l.toString()):"resolvedImage"===r.type?l=Ui.fromString(l.toString()):wn(l)===r.type||"enum"===r.type&&r.values[l]||(l=void 0),Oc(l,a.default,r.default)}bi.register(Kl,{error:[{kind:"error"},[It],(a,[r])=>{throw new ji(r.evaluate(a))}],typeof:[It,[Yt],(a,[r])=>Xn(Vn(r.evaluate(a)))],"to-rgba":[yi(rt,4),[Si],(a,[r])=>r.evaluate(a).toArray()],rgb:[Si,[rt,rt,rt],um],rgba:[Si,[rt,rt,rt,rt],um],has:{type:_t,overloads:[[[It],(a,[r])=>dm(r.evaluate(a),a.properties())],[[It,Hl],(a,[r,l])=>dm(r.evaluate(a),l.evaluate(a))]]},get:{type:Yt,overloads:[[[It],(a,[r])=>ef(r.evaluate(a),a.properties())],[[It,Hl],(a,[r,l])=>ef(r.evaluate(a),l.evaluate(a))]]},"feature-state":[Yt,[It],(a,[r])=>ef(r.evaluate(a),a.featureState||{})],properties:[Hl,[],a=>a.properties()],"geometry-type":[It,[],a=>a.geometryType()],id:[Yt,[],a=>a.id()],zoom:[rt,[],a=>a.globals.zoom],pitch:[rt,[],a=>a.globals.pitch||0],"distance-from-center":[rt,[],a=>a.distanceFromCenter()],"heatmap-density":[rt,[],a=>a.globals.heatmapDensity||0],"line-progress":[rt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[rt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Yt,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[rt,Ja(rt),(a,r)=>{let l=0;for(const u of r)l+=u.evaluate(a);return l}],"*":[rt,Ja(rt),(a,r)=>{let l=1;for(const u of r)l*=u.evaluate(a);return l}],"-":{type:rt,overloads:[[[rt,rt],(a,[r,l])=>r.evaluate(a)-l.evaluate(a)],[[rt],(a,[r])=>-r.evaluate(a)]]},"/":[rt,[rt,rt],(a,[r,l])=>r.evaluate(a)/l.evaluate(a)],"%":[rt,[rt,rt],(a,[r,l])=>r.evaluate(a)%l.evaluate(a)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(a,[r,l])=>Math.pow(r.evaluate(a),l.evaluate(a))],sqrt:[rt,[rt],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[rt,[rt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[rt,[rt],(a,[r])=>Math.log(r.evaluate(a))],log2:[rt,[rt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[rt,[rt],(a,[r])=>Math.sin(r.evaluate(a))],cos:[rt,[rt],(a,[r])=>Math.cos(r.evaluate(a))],tan:[rt,[rt],(a,[r])=>Math.tan(r.evaluate(a))],asin:[rt,[rt],(a,[r])=>Math.asin(r.evaluate(a))],acos:[rt,[rt],(a,[r])=>Math.acos(r.evaluate(a))],atan:[rt,[rt],(a,[r])=>Math.atan(r.evaluate(a))],min:[rt,Ja(rt),(a,r)=>Math.min(...r.map(l=>l.evaluate(a)))],max:[rt,Ja(rt),(a,r)=>Math.max(...r.map(l=>l.evaluate(a)))],abs:[rt,[rt],(a,[r])=>Math.abs(r.evaluate(a))],round:[rt,[rt],(a,[r])=>{const l=r.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[rt,[rt],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[rt,[rt],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[_t,[It,Yt],(a,[r,l])=>a.properties()[r.value]===l.value],"filter-id-==":[_t,[Yt],(a,[r])=>a.id()===r.value],"filter-type-==":[_t,[It],(a,[r])=>a.geometryType()===r.value],"filter-<":[_t,[It,Yt],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u<h}],"filter-id-<":[_t,[Yt],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l<u}],"filter->":[_t,[It,Yt],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u>h}],"filter-id->":[_t,[Yt],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l>u}],"filter-<=":[_t,[It,Yt],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[_t,[Yt],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l<=u}],"filter->=":[_t,[It,Yt],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[_t,[Yt],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l>=u}],"filter-has":[_t,[Yt],(a,[r])=>r.value in a.properties()],"filter-has-id":[_t,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[_t,[yi(It)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[_t,[yi(Yt)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[_t,[It,yi(Yt)],(a,[r,l])=>l.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[_t,[It,yi(Yt)],(a,[r,l])=>function(u,h,g,v){for(;g<=v;){const w=g+v>>1;if(h[w]===u)return!0;h[w]>u?v=w-1:g=w+1}return!1}(a.properties()[r.value],l.value,0,l.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(a,[r,l])=>r.evaluate(a)&&l.evaluate(a)],[Ja(_t),(a,r)=>{for(const l of r)if(!l.evaluate(a))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(a,[r,l])=>r.evaluate(a)||l.evaluate(a)],[Ja(_t),(a,r)=>{for(const l of r)if(l.evaluate(a))return!0;return!1}]]},"!":[_t,[_t],(a,[r])=>!r.evaluate(a)],"is-supported-script":[_t,[It],(a,[r])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(r.evaluate(a))}],upcase:[It,[It],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[It,[It],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[It,Ja(Yt),(a,r)=>r.map(l=>er(l.evaluate(a))).join("")],"resolved-locale":[It,[ct],(a,[r])=>r.evaluate(a).resolvedLocale()]});class Mn{constructor(r,l){var u;this.expression=r,this._warningHistory={},this._evaluator=new Xh,this._defaultValue=l?"color"===(u=l).type&&Od(u.default)?new mn(0,0,0,0):"color"===u.type?mn.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(r,l,u,h,g,v,w,D){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,u,h,g,v,w,D){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ji(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,"undefined"!=typeof console&&console.warn(T.message)),this._defaultValue}}}function Fo(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Kl}function Ql(a,r){const l=new Tr(Kl,[],r?function(h){const g={color:Si,string:It,number:rt,enum:It,boolean:_t,formatted:Sc,resolvedImage:nn};return"array"===h.type?yi(g[h.value]||Yt,h.length):g[h.type]}(r):void 0),u=l.parse(a,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return u?tf(new Mn(u,r)):Jl(l.errors)}class ya{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent="constant"!==r&&!tr(l.expression)}evaluateWithoutErrorHandling(r,l,u,h,g,v){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,h,g,v)}evaluate(r,l,u,h,g,v){return this._styleExpression.evaluate(r,l,u,h,g,v)}}class Lc{constructor(r,l,u,h){this.kind=r,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==r&&!tr(l.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,l,u,h,g,v){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,h,g,v)}evaluate(r,l,u,h,g,v){return this._styleExpression.evaluate(r,l,u,h,g,v)}interpolationFactor(r,l,u){return this.interpolationType?io.interpolationFactor(this.interpolationType,r,l,u):0}}function Bd(a,r){if("error"===(a=Ql(a,r)).result)return a;const l=a.value.expression,u=$i(l);if(!u&&!Qa(r))return Jl([new pn("","data expressions not supported")]);const h=qt(l,["zoom","pitch","distance-from-center"]);if(!h&&!hm(r))return Jl([new pn("","zoom expressions not supported")]);const g=ws(l);return g||h?g instanceof pn?Jl([g]):g instanceof io&&!nf(r)?Jl([new pn("",'"interpolate" expressions cannot be used with this property')]):tf(g?new Lc(u?"camera":"composite",a.value,g.labels,g instanceof io?g.interpolation:void 0):new ya(u?"constant":"source",a.value)):Jl([new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ec{constructor(r,l){this._parameters=r,this._specification=l,Tn(this,Mu(this._parameters,this._specification))}static deserialize(r){return new ec(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ws(a){let r=null;if(a instanceof Ya)r=ws(a.result);else if(a instanceof Xa){for(const l of a.args)if(r=ws(l),r)break}else(a instanceof ht||a instanceof io)&&a.input instanceof bi&&"zoom"===a.input.name&&(r=a);return r instanceof pn||a.eachChild(l=>{const u=ws(l);u instanceof pn?r=u:!r&&u?r=new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&u&&r!==u&&(r=new pn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Oo(a){const r=a.key,l=a.value,u=a.valueSpec||{},h=a.objectElementValidators||{},g=a.style,v=a.styleSpec;let w=[];const D=wn(l);if("object"!==D)return[new Ae(r,l,`object expected, ${D} found`)];for(const T in l){const S=T.split(".")[0],N=u[S]||u["*"];let R;if(h[S])R=h[S];else if(u[S])R=_r;else if(h["*"])R=h["*"];else{if(!u["*"]){w.push(new Ae(r,l[T],`unknown property "${T}"`));continue}R=_r}w=w.concat(R({key:(r&&`${r}.`)+T,value:l[T],valueSpec:N,style:g,styleSpec:v,object:l,objectKey:T},l))}for(const T in u)h[T]||u[T].required&&void 0===u[T].default&&void 0===l[T]&&w.push(new Ae(r,l,`missing required property "${T}"`));return w}function Sr(a){const r=a.value,l=a.valueSpec,u=a.style,h=a.styleSpec,g=a.key,v=a.arrayElementValidator||_r;if("array"!==wn(r))return[new Ae(g,r,`array expected, ${wn(r)} found`)];if(l.length&&r.length!==l.length)return[new Ae(g,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new Ae(g,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let w={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum};h.$version<7&&(w.function=l.function),"object"===wn(l.value)&&(w=l.value);let D=[];for(let T=0;T<r.length;T++)D=D.concat(v({array:r,arrayIndex:T,value:r[T],valueSpec:w,style:u,styleSpec:h,key:`${g}[${T}]`}));return D}function Iu(a){const r=a.key,l=a.value,u=a.valueSpec;let h=wn(l);if("number"===h&&l!=l&&(h="NaN"),"number"!==h)return[new Ae(r,l,`number expected, ${h} found`)];if("minimum"in u){let g=u.minimum;if("array"===wn(u.minimum)&&(g=u.minimum[a.arrayIndex]),l<g)return[new Ae(r,l,`${l} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if("array"===wn(u.maximum)&&(g=u.maximum[a.arrayIndex]),l>g)return[new Ae(r,l,`${l} is greater than the maximum value ${g}`)]}return[]}function Bc(a){const r=a.valueSpec,l=Ot(a.value.type);let u,h,g,v={};const w="categorical"!==l&&void 0===a.value.property,D=!w,T="array"===wn(a.value.stops)&&"array"===wn(a.value.stops[0])&&"object"===wn(a.value.stops[0][0]),S=Oo({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(z){if("identity"===l)return[new Ae(z.key,z.value,'identity function may not have a "stops" property')];let j=[];const W=z.value;return j=j.concat(Sr({key:z.key,value:W,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:N})),"array"===wn(W)&&0===W.length&&j.push(new Ae(z.key,W,"array must have at least one stop")),j},default:function(z){return _r({key:z.key,value:z.value,valueSpec:r,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===l&&w&&S.push(new Ae(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||S.push(new Ae(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!nf(a.valueSpec)&&S.push(new Ae(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!Qa(a.valueSpec)?S.push(new Ae(a.key,a.value,"property functions not supported")):w&&!hm(a.valueSpec)&&S.push(new Ae(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!T||void 0!==a.value.property||S.push(new Ae(a.key,a.value,'"property" property is required')),S;function N(z){let j=[];const W=z.value,te=z.key;if("array"!==wn(W))return[new Ae(te,W,`array expected, ${wn(W)} found`)];if(2!==W.length)return[new Ae(te,W,`array length 2 expected, length ${W.length} found`)];if(T){if("object"!==wn(W[0]))return[new Ae(te,W,`object expected, ${wn(W[0])} found`)];if(void 0===W[0].zoom)return[new Ae(te,W,"object stop key must have zoom")];if(void 0===W[0].value)return[new Ae(te,W,"object stop key must have value")];if(g&&g>Ot(W[0].zoom))return[new Ae(te,W[0].zoom,"stop zoom values must appear in ascending order")];Ot(W[0].zoom)!==g&&(g=Ot(W[0].zoom),h=void 0,v={}),j=j.concat(Oo({key:`${te}[0]`,value:W[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Iu,value:R}}))}else j=j.concat(R({key:`${te}[0]`,value:W[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},W));return Fo(hn(W[1]))?j.concat([new Ae(`${te}[1]`,W[1],"expressions are not allowed in function stops.")]):j.concat(_r({key:`${te}[1]`,value:W[1],valueSpec:r,style:z.style,styleSpec:z.styleSpec}))}function R(z,j){const W=wn(z.value),te=Ot(z.value),re=null!==z.value?z.value:j;if(u){if(W!==u)return[new Ae(z.key,re,`${W} stop domain type must match previous stop domain type ${u}`)]}else u=W;if("number"!==W&&"string"!==W&&"boolean"!==W)return[new Ae(z.key,re,"stop domain value must be a number, string, or boolean")];if("number"!==W&&"categorical"!==l){let ce=`number expected, ${W} found`;return Qa(r)&&void 0===l&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(z.key,re,ce)]}return"categorical"!==l||"number"!==W||isFinite(te)&&Math.floor(te)===te?"categorical"!==l&&"number"===W&&void 0!==h&&te<h?[new Ae(z.key,re,"stop domain values must appear in ascending order")]:(h=te,"categorical"===l&&te in v?[new Ae(z.key,re,"stop domain values must be unique")]:(v[te]=!0,[])):[new Ae(z.key,re,`integer expected, found ${te}`)]}}function Cs(a){const r=("property"===a.expressionContext?Bd:Ql)(hn(a.value),a.valueSpec);if("error"===r.result)return r.value.map(u=>new Ae(`${a.key}${u.key}`,a.value,u.message));const l=r.value.expression||r.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Ae(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!tr(l))return[new Ae(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Vd(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!qt(l,["zoom","feature-state"]))return[new Ae(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!$i(l))return[new Ae(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vd(a,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of r.valueSpec.expression.parameters)l.delete(h);if(0===l.size)return[];const u=[];return a instanceof bi&&l.has(a.name)?[new Ae(r.key,r.value,`["${a.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(a.eachChild(h=>{u.push(...Vd(h,r))}),u)}function va(a){const r=a.key,l=a.value,u=a.valueSpec,h=[];return Array.isArray(u.values)?-1===u.values.indexOf(Ot(l))&&h.push(new Ae(r,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(Ot(l))&&h.push(new Ae(r,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),h}function zd(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!zd(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Yn(a,r="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zd(a)||(a=tl(a));const l=a;let u=!0;try{u=function(T){if(!el(T))return T;let S=hn(T);return ba(S),S=af(S),S}(l)}catch(T){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const h=be[`filter_${r}`],g=Ql(u,h);let v=null;if("error"===g.result)throw new Error(g.value.map(T=>`${T.key}: ${T.message}`).join(", "));v=(T,S,N)=>g.value.evaluate(T,S,{},N);let w=null,D=null;if(u!==l){const T=Ql(l,h);if("error"===T.result)throw new Error(T.value.map(S=>`${S.key}: ${S.message}`).join(", "));w=(S,N,R,z,j)=>T.value.evaluate(S,N,{},R,void 0,void 0,z,j),D=!$i(T.value.expression)}return v=v,{filter:v,dynamicFilter:w||void 0,needGeometry:lf(u),needFeature:!!D}}function af(a){if(!Array.isArray(a))return a;const r=function(l){if(xi.has(l[0]))for(let u=1;u<l.length;u++)if(el(l[u]))return!0;return l}(a);return!0===r?r:r.map(l=>af(l))}function ba(a){let r=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)r=r||el(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){r=r||el(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){r=r||el(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}r&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)ba(a[u])}function el(a){if(!Array.isArray(a))return!1;if("pitch"===(r=a[0])||"distance-from-center"===r)return!0;var r;for(let l=1;l<a.length;l++)if(el(a[l]))return!0;return!1}const xi=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ud(a,r){return a<r?-1:a>r?1:0}function lf(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let r=1;r<a.length;r++)if(lf(a[r]))return!0;return!1}function tl(a){if(!a)return!0;const r=a[0];return a.length<=1?"any"!==r:"=="===r?cr(a[1],a[2],"=="):"!="===r?Zs(cr(a[1],a[2],"==")):"<"===r||">"===r||"<="===r||">="===r?cr(a[1],a[2],r):"any"===r?(l=a.slice(1),["any"].concat(l.map(tl))):"all"===r?["all"].concat(a.slice(1).map(tl)):"none"===r?["all"].concat(a.slice(1).map(tl).map(Zs)):"in"===r?cf(a[1],a.slice(2)):"!in"===r?Zs(cf(a[1],a.slice(2))):"has"===r?Su(a[1]):"!has"===r?Zs(Su(a[1])):"within"!==r||a;var l}function cr(a,r,l){switch(a){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,a,r]}}function cf(a,r){if(0===r.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Ud)]]:["filter-in-small",a,["literal",r]]}}function Su(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Zs(a){return["!",a]}function Ar(a){if(zd(hn(a.value))){const r=hn(a.layerType);return Cs(Tn({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${r||"fill"}`]}))}return jd(a)}function jd(a){const r=a.value,l=a.key;if("array"!==wn(r))return[new Ae(l,r,`array expected, ${wn(r)} found`)];const u=a.styleSpec;let h,g=[];if(r.length<1)return[new Ae(l,r,"filter array must have at least 1 element")];switch(g=g.concat(va({key:`${l}[0]`,value:r[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ot(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Ot(r[1])&&g.push(new Ae(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&g.push(new Ae(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=wn(r[1]),"string"!==h&&g.push(new Ae(`${l}[1]`,r[1],`string expected, ${h} found`)));for(let v=2;v<r.length;v++)h=wn(r[v]),"$type"===Ot(r[1])?g=g.concat(va({key:`${l}[${v}]`,value:r[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&g.push(new Ae(`${l}[${v}]`,r[v],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let v=1;v<r.length;v++)g=g.concat(jd({key:`${l}[${v}]`,value:r[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":h=wn(r[1]),2!==r.length?g.push(new Ae(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&g.push(new Ae(`${l}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=wn(r[1]),2!==r.length?g.push(new Ae(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&g.push(new Ae(`${l}[1]`,r[1],`object expected, ${h} found`))}return g}function nl(a,r){const l=a.key,u=a.style,h=a.styleSpec,g=a.value,v=a.objectKey,w=h[`${r}_${a.layerType}`];if(!w)return[];const D=v.match(/^(.*)-transition$/);if("paint"===r&&D&&w[D[1]]&&w[D[1]].transition)return _r({key:l,value:g,valueSpec:h.transition,style:u,styleSpec:h});const T=a.valueSpec||w[v];if(!T)return[new Ae(l,g,`unknown property "${v}"`)];let S;if("string"===wn(g)&&Qa(T)&&!T.tokens&&(S=/^{([^}]+)}$/.exec(g)))return[new Ae(l,g,`"${v}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const N=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&N.push(new Ae(l,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Od(hn(g))&&"identity"===Ot(g.type)&&N.push(new Ae(l,g,'"text-font" does not support identity functions'))),N.concat(_r({key:a.key,value:g,valueSpec:T,style:u,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:v}))}function Vc(a){return nl(a,"paint")}function wi(a){return nl(a,"layout")}function tc(a){let r=[];const l=a.value,u=a.key,h=a.style,g=a.styleSpec;l.type||l.ref||r.push(new Ae(u,l,'either "type" or "ref" is required'));let v=Ot(l.type);const w=Ot(l.ref);if(l.id){const D=Ot(l.id);for(let T=0;T<a.arrayIndex;T++){const S=h.layers[T];Ot(S.id)===D&&r.push(new Ae(u,l.id,`duplicate layer id "${l.id}", previously used at line ${S.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(T=>{T in l&&r.push(new Ae(u,l[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{Ot(T.id)===w&&(D=T)}),D?D.ref?r.push(new Ae(u,l.ref,"ref cannot reference another ref layer")):v=Ot(D.type):r.push(new Ae(u,l.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const D=h.sources&&h.sources[l.source],T=D&&Ot(D.type);D?"vector"===T&&"raster"===v?r.push(new Ae(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===T&&"raster"!==v?r.push(new Ae(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==T||l["source-layer"]?"raster-dem"===T&&"hillshade"!==v?r.push(new Ae(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]||"geojson"===T&&D.lineMetrics||r.push(new Ae(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ae(u,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new Ae(u,l.source,`source "${l.source}" not found`))}else r.push(new Ae(u,l,'missing required property "source"'));return r=r.concat(Oo({key:u,value:l,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_r({key:`${u}.type`,value:l.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:D=>Ar(Tn({layerType:v},D)),layout:D=>Oo({layer:l,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":T=>wi(Tn({layerType:v},T))}}),paint:D=>Oo({layer:l,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":T=>Vc(Tn({layerType:v},T))}})}})),r}function xa(a){const r=a.value,l=a.key,u=wn(r);return"string"!==u?[new Ae(l,r,`string expected, ${u} found`)]:[]}const Lt={promoteId:function({key:a,value:r}){if("string"===wn(r))return xa({key:a,value:r});{const l=[];for(const u in r)l.push(...xa({key:`${a}.${u}`,value:r[u]}));return l}}};function pm(a){const r=a.value,l=a.key,u=a.styleSpec,h=a.style;if(!r.type)return[new Ae(l,r,'"type" is required')];const g=Ot(r.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=Oo({key:l,value:r,valueSpec:u[`source_${g.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Lt}),v;case"geojson":if(v=Oo({key:l,value:r,valueSpec:u.source_geojson,style:h,styleSpec:u,objectElementValidators:Lt}),r.cluster)for(const w in r.clusterProperties){const[D,T]=r.clusterProperties[w],S="string"==typeof D?[D,["accumulated"],["get",w]]:D;v.push(...Cs({key:`${l}.${w}.map`,value:T,expressionContext:"cluster-map"})),v.push(...Cs({key:`${l}.${w}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return v;case"video":return Oo({key:l,value:r,valueSpec:u.source_video,style:h,styleSpec:u});case"image":return Oo({key:l,value:r,valueSpec:u.source_image,style:h,styleSpec:u});case"canvas":return[new Ae(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return va({key:`${l}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:u})}}function uf(a){const r=a.value,l=a.styleSpec,u=l.light,h=a.style;let g=[];const v=wn(r);if(void 0===r)return g;if("object"!==v)return g=g.concat([new Ae("light",r,`object expected, ${v} found`)]),g;for(const w in r){const D=w.match(/^(.*)-transition$/);g=g.concat(D&&u[D[1]]&&u[D[1]].transition?_r({key:w,value:r[w],valueSpec:l.transition,style:h,styleSpec:l}):u[w]?_r({key:w,value:r[w],valueSpec:u[w],style:h,styleSpec:l}):[new Ae(w,r[w],`unknown property "${w}"`)])}return g}function Au(a){const r=a.value,l=a.key,u=a.style,h=a.styleSpec,g=h.terrain;let v=[];const w=wn(r);if(void 0===r)return v;if("object"!==w)return v=v.concat([new Ae("terrain",r,`object expected, ${w} found`)]),v;for(const D in r){const T=D.match(/^(.*)-transition$/);v=v.concat(T&&g[T[1]]&&g[T[1]].transition?_r({key:D,value:r[D],valueSpec:h.transition,style:u,styleSpec:h}):g[D]?_r({key:D,value:r[D],valueSpec:g[D],style:u,styleSpec:h}):[new Ae(D,r[D],`unknown property "${D}"`)])}if(r.source){const D=u.sources&&u.sources[r.source],T=D&&Ot(D.type);D?"raster-dem"!==T&&v.push(new Ae(l,r.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):v.push(new Ae(l,r.source,`source "${r.source}" not found`))}else v.push(new Ae(l,r,'terrain is missing required property "source"'));return v}function df(a){const r=a.value,l=a.style,u=a.styleSpec,h=u.fog;let g=[];const v=wn(r);if(void 0===r)return g;if("object"!==v)return g=g.concat([new Ae("fog",r,`object expected, ${v} found`)]),g;for(const w in r){const D=w.match(/^(.*)-transition$/);g=g.concat(D&&h[D[1]]&&h[D[1]].transition?_r({key:w,value:r[w],valueSpec:u.transition,style:l,styleSpec:u}):h[w]?_r({key:w,value:r[w],valueSpec:h[w],style:l,styleSpec:u}):[new Ae(w,r[w],`unknown property "${w}"`)])}return g}const zc={"*":()=>[],array:Sr,boolean:function(a){const r=a.value,l=a.key,u=wn(r);return"boolean"!==u?[new Ae(l,r,`boolean expected, ${u} found`)]:[]},number:Iu,color:function(a){const r=a.key,l=a.value,u=wn(l);return"string"!==u?[new Ae(r,l,`color expected, ${u} found`)]:null===No.parseCSSColor(l)?[new Ae(r,l,`color expected, "${l}" found`)]:[]},constants:tn,enum:va,filter:Ar,function:Bc,layer:tc,object:Oo,source:pm,light:uf,terrain:Au,fog:df,string:xa,formatted:function(a){return 0===xa(a).length?[]:Cs(a)},resolvedImage:function(a){return 0===xa(a).length?[]:Cs(a)},projection:function(a){const r=a.value,l=a.styleSpec,u=l.projection,h=a.style;let g=[];const v=wn(r);if("object"===v)for(const w in r)g=g.concat(_r({key:w,value:r[w],valueSpec:u[w],style:h,styleSpec:l}));else"string"!==v&&(g=g.concat([new Ae("projection",r,`object or string expected, ${v} found`)]));return g}};function _r(a){const r=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Od(Ot(r))?Bc(a):l.expression&&Fo(hn(r))?Cs(a):l.type&&zc[l.type]?zc[l.type](a):Oo(Tn({},a,{valueSpec:l.type?u[l.type]:l}))}function mm(a){const r=a.value,l=a.key,u=xa(a);return u.length||(-1===r.indexOf("{fontstack}")&&u.push(new Ae(l,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&u.push(new Ae(l,r,'"glyphs" url must include a "{range}" token'))),u}function He(a,r=be){let l=[];return l=l.concat(_r({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:mm,"*":()=>[]}})),a.constants&&(l=l.concat(tn({key:"constants",value:a.constants,style:a,styleSpec:r}))),gn(l)}function gn(a){return[].concat(a).sort((r,l)=>r.line-l.line)}function rn(a){return function(...r){return gn(a.apply(this,r))}}He.source=rn(pm),He.light=rn(uf),He.terrain=rn(Au),He.fog=rn(df),He.layer=rn(tc),He.filter=rn(Ar),He.paintProperty=rn(Vc),He.layoutProperty=rn(wi);const ti=He,hf=ti.light,il=ti.fog,so=ti.paintProperty,ku=ti.layoutProperty;function Nu(a,r){let l=!1;if(r&&r.length)for(const u of r)a.fire(new vt(new Error(u.message))),l=!0;return l}var Uc=Ds;function Ds(a,r,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var h=new Int32Array(this.arrayBuffer);a=h[0],this.d=(r=h[1])+2*(l=h[2]);for(var g=0;g<this.d*this.d;g++){var v=h[3+g],w=h[3+g+1];u.push(v===w?null:h.subarray(v,w))}var D=h[3+u.length+1];this.keys=h.subarray(h[3+u.length],D),this.bboxes=h.subarray(D),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var T=0;T<this.d*this.d;T++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=a,this.padding=l,this.scale=r/a,this.uid=0;var S=l/r*a;this.min=-S,this.max=a+S}Ds.prototype.insert=function(a,r,l,u,h){this._forEachCell(r,l,u,h,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(h)},Ds.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ds.prototype._insertCell=function(a,r,l,u,h,g){this.cells[h].push(g)},Ds.prototype.query=function(a,r,l,u,h){var g=this.min,v=this.max;if(a<=g&&r<=g&&v<=l&&v<=u&&!h)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(a,r,l,u,this._queryCell,w,{},h),w},Ds.prototype._queryCell=function(a,r,l,u,h,g,v,w){var D=this.cells[h];if(null!==D)for(var T=this.keys,S=this.bboxes,N=0;N<D.length;N++){var R=D[N];if(void 0===v[R]){var z=4*R;(w?w(S[z+0],S[z+1],S[z+2],S[z+3]):a<=S[z+2]&&r<=S[z+3]&&l>=S[z+0]&&u>=S[z+1])?(v[R]=!0,g.push(T[R])):v[R]=!1}}},Ds.prototype._forEachCell=function(a,r,l,u,h,g,v,w){for(var D=this._convertToCellCoord(a),T=this._convertToCellCoord(r),S=this._convertToCellCoord(l),N=this._convertToCellCoord(u),R=D;R<=S;R++)for(var z=T;z<=N;z++){var j=this.d*z+R;if((!w||w(this._convertFromCellCoord(R),this._convertFromCellCoord(z),this._convertFromCellCoord(R+1),this._convertFromCellCoord(z+1)))&&h.call(this,a,r,l,u,j,g,v,w))return}},Ds.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ds.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ds.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,r=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var h=new Int32Array(r+l+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=r,v=0;v<a.length;v++){var w=a[v];h[3+v]=g,h.set(w,g),g+=w.length}return h[3+a.length]=g,h.set(this.keys,g),h[3+a.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer};const{ImageData:rl,ImageBitmap:jc}=ut,qi={};function st(a,r,l={}){Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),qi[a]={klass:r,omit:l.omit||[],shallow:l.shallow||[]}}st("Object",Object),Uc.serialize=function(a,r){const l=a.toArrayBuffer();return r&&r.push(l),{buffer:l}},Uc.deserialize=function(a){return new Uc(a.buffer)},st("Grid",Uc),st("Color",mn),st("Error",Error),st("ResolvedImage",Ui),st("StylePropertyFunction",ec),st("StyleExpression",Mn,{omit:["_evaluator"]}),st("ZoomDependentExpression",Lc),st("ZoomConstantExpression",ya),st("CompoundExpression",bi,{omit:["_evaluate"]});for(const a in Kl)Kl[a]._classRegistryKey||st(`Expression_${a}`,Kl[a]);function $d(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function wa(a){return jc&&a instanceof jc}function ao(a,r){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if($d(a)||wa(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return r&&r.push(l.buffer),l}if(a instanceof rl)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(ao(u,r));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");const h=l.serialize?l.serialize(a,r):{};if(!l.serialize){for(const g in a){if(!a.hasOwnProperty(g)||qi[u].omit.indexOf(g)>=0)continue;const v=a[g];h[g]=qi[u].shallow.indexOf(g)>=0?v:ao(v,r)}a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof a)}function $c(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||$d(a)||wa(a)||ArrayBuffer.isView(a)||a instanceof rl)return a;if(Array.isArray(a))return a.map($c);if("object"==typeof a){const r=a.$name||"Object",{klass:l}=qi[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const h of Object.keys(a)){if("$name"===h)continue;const g=a[h];u[h]=qi[r].shallow.indexOf(h)>=0?g:$c(g)}return u}throw new Error("can't deserialize object of type "+typeof a)}class Hd{constructor(){this.first=!0}update(r,l){const u=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=l),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=u,!0))}}const ff=a=>a>=1536&&a<=1791,pf=a=>a>=1872&&a<=1919,Pu=a=>a>=2208&&a<=2303,Ru=a=>a>=11904&&a<=12031,nc=a=>a>=12032&&a<=12255,Fu=a=>a>=12272&&a<=12287,Ou=a=>a>=12288&&a<=12351,ol=a=>a>=12352&&a<=12447,sl=a=>a>=12448&&a<=12543,Lu=a=>a>=12544&&a<=12591,Gd=a=>a>=12704&&a<=12735,Bu=a=>a>=12736&&a<=12783,Vu=a=>a>=12784&&a<=12799,ic=a=>a>=12800&&a<=13055,qd=a=>a>=13056&&a<=13311,zu=a=>a>=13312&&a<=19903,Wi=a=>a>=19968&&a<=40959,Xs=a=>a>=40960&&a<=42127,ci=a=>a>=42128&&a<=42191,Ys=a=>a>=44032&&a<=55215,mf=a=>a>=63744&&a<=64255,Lo=a=>a>=64336&&a<=65023,gf=a=>a>=65040&&a<=65055,Hc=a=>a>=65072&&a<=65103,_f=a=>a>=65104&&a<=65135,rc=a=>a>=65136&&a<=65279,oc=a=>a>=65280&&a<=65519;function rs(a){for(const r of a)if(Wd(r.charCodeAt(0)))return!0;return!1}function sc(a){for(const r of a)if(!ac(r.charCodeAt(0)))return!1;return!0}function ac(a){return!(ff(a)||pf(a)||Pu(a)||Lo(a)||rc(a))}function Wd(a){return!(746!==a&&747!==a&&(a<4352||!(Gd(a)||Lu(a)||Hc(a)&&!(a>=65097&&a<=65103)||mf(a)||qd(a)||Ru(a)||Bu(a)||!(!Ou(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||zu(a)||Wi(a)||ic(a)||(r=a,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(a)||(r=>r>=55216&&r<=55295)(a)||(r=>r>=4352&&r<=4607)(a)||Ys(a)||ol(a)||Fu(a)||(r=>r>=12688&&r<=12703)(a)||nc(a)||Vu(a)||sl(a)&&12540!==a||!(!oc(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!_f(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(r=>r>=5120&&r<=5759)(a)||(r=>r>=6320&&r<=6399)(a)||gf(a)||(r=>r>=19904&&r<=19967)(a)||Xs(a)||ci(a))));var r}function Es(a){return!(Wd(a)||(r=a,(l=r)>=128&&l<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(l=>l>=8192&&l<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(l=>l>=8448&&l<=8527)(r)||(l=>l>=8528&&l<=8591)(r)||(l=>l>=8960&&l<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(l=>l>=9216&&l<=9279)(r)&&9251!==r||(l=>l>=9280&&l<=9311)(r)||(l=>l>=9312&&l<=9471)(r)||(l=>l>=9632&&l<=9727)(r)||(l=>l>=9728&&l<=9983)(r)&&!(r>=9754&&r<=9759)||(l=>l>=11008&&l<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ou(r)||sl(r)||(l=>l>=57344&&l<=63743)(r)||Hc(r)||_f(r)||oc(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,l}function Ts(a){return a>=1424&&a<=2303||Lo(a)||rc(a)}function gm(a,r){return!(!r&&Ts(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function _m(a){for(const r of a)if(Ts(r.charCodeAt(0)))return!0;return!1}const Ms="deferred",m="loading",s="loaded";let d=null,_="unavailable",b=null;const x=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(_="error"),d&&d(a)};function E(){I.fire(new Le("pluginStateChange",{pluginStatus:_,pluginURL:b}))}const I=new Je,P=function(){return _},F=function(){if(_!==Ms||!b)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=m,E(),b&&$({url:b},a=>{a?x(a):(_=s,E())})},O={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===s||null!=O.applyArabicShaping,isLoading:()=>_===m,setState(a){_=a.pluginStatus,b=a.pluginURL},isParsed:()=>null!=O.applyArabicShaping&&null!=O.processBidirectionalText&&null!=O.processStyledBidirectionalText,getPluginURL:()=>b};class B{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hd,this.transition={},this.pitch=0)}isSupportedScript(r){return function(l,u){for(const h of l)if(!gm(h.charCodeAt(0),u))return!1;return!0}(r,O.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,l=r-Math.floor(r),u=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*l}}}class H{constructor(r,l){this.property=r,this.value=l,this.expression=function(u,h){if(Od(u))return new ec(u,h);if(Fo(u)){const g=Bd(u,h);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=u;return"string"==typeof u&&"color"===h.type&&(g=mn.parse(u)),{kind:"constant",evaluate:()=>g}}}(void 0===l?r.specification.default:l,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,l,u){return this.property.possiblyEvaluate(this,r,l,u)}}class Y{constructor(r){this.property=r,this.value=new H(r,void 0)}transitioned(r,l){return new X(this.property,this.value,l,Qi({},r.transition,this.transition),r.now)}untransitioned(){return new X(this.property,this.value,null,{},0)}}class ee{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Bi(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Y(this._values[r].property)),this._values[r].value=new H(this._values[r].property,null===l?void 0:Bi(l))}getTransition(r){return Bi(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Y(this._values[r].property)),this._values[r].transition=Bi(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(r[l]=u);const h=this.getTransition(l);void 0!==h&&(r[`${l}-transition`]=h)}return r}transitioned(r,l){const u=new ie(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(r,l._values[h]);return u}untransitioned(){const r=new ie(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class X{constructor(r,l,u,h,g){const v=h.delay||0,w=h.duration||0;g=g||0,this.property=r,this.value=l,this.begin=g+v,this.end=this.begin+w,r.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(r,l,u){const h=r.now||0,g=this.value.possiblyEvaluate(r,l,u),v=this.prior;if(v){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return v.possiblyEvaluate(r,l,u);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(r,l,u),g,Ol(w))}}return g}}class ie{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,u){const h=new se(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(r,l,u);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class K{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Bi(this._values[r].value)}setValue(r,l){this._values[r]=new H(this._values[r].property,null===l?void 0:Bi(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(r[l]=u)}return r}possiblyEvaluate(r,l,u){const h=new se(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(r,l,u);return h}}class ne{constructor(r,l,u){this.property=r,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,l,u,h){return this.property.evaluate(this.value,this.parameters,r,l,u,h)}}class se{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class J{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,u){const h=zn[this.specification.type];return h?h(r,l,u):r}}class le{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,u,h){return new ne(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(l,null,{},u,h)}:r.expression,l)}interpolate(r,l,u){if("constant"!==r.value.kind||"constant"!==l.value.kind)return r;if(void 0===r.value.value||void 0===l.value.value)return new ne(this,{kind:"constant",value:void 0},r.parameters);const h=zn[this.specification.type];return h?new ne(this,{kind:"constant",value:h(r.value.value,l.value.value,u)},r.parameters):r}evaluate(r,l,u,h,g,v){return"constant"===r.kind?r.value:r.evaluate(l,u,h,g,v)}}class fe extends le{possiblyEvaluate(r,l,u,h){if(void 0===r.value)return new ne(this,{kind:"constant",value:void 0},l);if("constant"===r.expression.kind){const g=r.expression.evaluate(l,null,{},u,h),v="resolvedImage"===r.property.specification.type&&"string"!=typeof g?g.name:g,w=this._calculate(v,v,v,l);return new ne(this,{kind:"constant",value:w},l)}if("camera"===r.expression.kind){const g=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new ne(this,{kind:"constant",value:g},l)}return new ne(this,r.expression,l)}evaluate(r,l,u,h,g,v){if("source"===r.kind){const w=r.evaluate(l,u,h,g,v);return this._calculate(w,w,w,l)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},u,h),r.evaluate({zoom:Math.floor(l.zoom)},u,h),r.evaluate({zoom:Math.floor(l.zoom)+1},u,h),l):r.value}_calculate(r,l,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:l,other:u}:{from:u,to:l,other:r}}interpolate(r){return r}}class Se{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,h){if(void 0!==r.value){if("constant"===r.expression.kind){const g=r.expression.evaluate(l,null,{},u,h);return this._calculate(g,g,g,l)}return this._calculate(r.expression.evaluate(new B(Math.floor(l.zoom-1),l)),r.expression.evaluate(new B(Math.floor(l.zoom),l)),r.expression.evaluate(new B(Math.floor(l.zoom+1),l)),l)}}_calculate(r,l,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:u,to:l}}interpolate(r){return r}}class Me{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,h){return!!r.expression.evaluate(l,null,{},u,h)}interpolate(){return!1}}class Ne{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in r){const u=r[l];u.specification.overridable&&this.overridableProperties.push(l);const h=this.defaultPropertyValues[l]=new H(u,void 0),g=this.defaultTransitionablePropertyValues[l]=new Y(u);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=h.possiblyEvaluate({})}}}function Re(a,r){return 256*(a=Sn(Math.floor(a),0,255))+Sn(Math.floor(r),0,255)}st("DataDrivenProperty",le),st("DataConstantProperty",J),st("CrossFadedDataDrivenProperty",fe),st("CrossFadedProperty",Se),st("ColorRampProperty",Me);const Ze={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pe{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Te(a,r=1){let l=0,u=0;return{members:a.map(h=>{const g=Ze[h.type].BYTES_PER_ELEMENT,v=l=Ke(l,Math.max(r,g)),w=h.components||1;return u=Math.max(u,g),l+=g*w,{name:h.name,type:h.type,components:w,offset:v}}),size:Ke(l,Math.max(u,r)),alignment:r}}function Ke(a,r){return Math.ceil(a/r)*r}class ft extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const h=2*r;return this.int16[h+0]=l,this.int16[h+1]=u,r}}ft.prototype.bytesPerElement=4,st("StructArrayLayout2i4",ft);class wt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const v=4*r;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=g,r}}wt.prototype.bytesPerElement=8,st("StructArrayLayout4i8",wt);class Dt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,u,h,g,v,w)}emplace(r,l,u,h,g,v,w,D){const T=6*r,S=12*r,N=3*r;return this.int16[T+0]=l,this.int16[T+1]=u,this.uint8[S+4]=h,this.uint8[S+5]=g,this.uint8[S+6]=v,this.uint8[S+7]=w,this.float32[N+2]=D,r}}Dt.prototype.bytesPerElement=12,st("StructArrayLayout2i4ub1f12",Dt);class Pt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,l,u)}emplace(r,l,u,h){const g=3*r;return this.float32[g+0]=l,this.float32[g+1]=u,this.float32[g+2]=h,r}}Pt.prototype.bytesPerElement=12,st("StructArrayLayout3f12",Pt);class St extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w,D,T,S){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,u,h,g,v,w,D,T,S)}emplace(r,l,u,h,g,v,w,D,T,S,N){const R=10*r;return this.uint16[R+0]=l,this.uint16[R+1]=u,this.uint16[R+2]=h,this.uint16[R+3]=g,this.uint16[R+4]=v,this.uint16[R+5]=w,this.uint16[R+6]=D,this.uint16[R+7]=T,this.uint16[R+8]=S,this.uint16[R+9]=N,r}}St.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",St);class xt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w,D){const T=this.length;return this.resize(T+1),this.emplace(T,r,l,u,h,g,v,w,D)}emplace(r,l,u,h,g,v,w,D,T){const S=8*r;return this.uint16[S+0]=l,this.uint16[S+1]=u,this.uint16[S+2]=h,this.uint16[S+3]=g,this.uint16[S+4]=v,this.uint16[S+5]=w,this.uint16[S+6]=D,this.uint16[S+7]=T,r}}xt.prototype.bytesPerElement=16,st("StructArrayLayout8ui16",xt);class At extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te){const re=this.length;return this.resize(re+1),this.emplace(re,r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te)}emplace(r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re){const ce=16*r;return this.int16[ce+0]=l,this.int16[ce+1]=u,this.int16[ce+2]=h,this.int16[ce+3]=g,this.uint16[ce+4]=v,this.uint16[ce+5]=w,this.uint16[ce+6]=D,this.uint16[ce+7]=T,this.int16[ce+8]=S,this.int16[ce+9]=N,this.int16[ce+10]=R,this.int16[ce+11]=z,this.int16[ce+12]=j,this.int16[ce+13]=W,this.int16[ce+14]=te,this.int16[ce+15]=re,r}}At.prototype.bytesPerElement=32,st("StructArrayLayout4i4ui4i4i32",At);class Ft extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}Ft.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",Ft);class hi extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w,D,T,S,N,R,z){const j=this.length;return this.resize(j+1),this.emplace(j,r,l,u,h,g,v,w,D,T,S,N,R,z)}emplace(r,l,u,h,g,v,w,D,T,S,N,R,z,j){const W=20*r,te=10*r;return this.int16[W+0]=l,this.int16[W+1]=u,this.int16[W+2]=h,this.int16[W+3]=g,this.int16[W+4]=v,this.float32[te+3]=w,this.float32[te+4]=D,this.float32[te+5]=T,this.float32[te+6]=S,this.int16[W+14]=N,this.uint32[te+8]=R,this.uint16[W+18]=z,this.uint16[W+19]=j,r}}hi.prototype.bytesPerElement=40,st("StructArrayLayout5i4f1i1ul2ui40",hi);class si extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,u,h,g,v,w)}emplace(r,l,u,h,g,v,w,D){const T=8*r;return this.int16[T+0]=l,this.int16[T+1]=u,this.int16[T+2]=h,this.int16[T+4]=g,this.int16[T+5]=v,this.int16[T+6]=w,this.int16[T+7]=D,r}}si.prototype.bytesPerElement=16,st("StructArrayLayout3i2i2i16",si);class Ci extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,l,u,h,g)}emplace(r,l,u,h,g,v){const w=4*r,D=8*r;return this.float32[w+0]=l,this.float32[w+1]=u,this.float32[w+2]=h,this.int16[D+6]=g,this.int16[D+7]=v,r}}Ci.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",Ci);class Ai extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const v=12*r,w=3*r;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[w+1]=h,this.float32[w+2]=g,r}}Ai.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",Ai);class ni extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,l,u)}emplace(r,l,u,h){const g=3*r;return this.uint16[g+0]=l,this.uint16[g+1]=u,this.uint16[g+2]=h,r}}ni.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",ni);class lo extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re,ce,me,ve,ye){const we=this.length;return this.resize(we+1),this.emplace(we,r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re,ce,me,ve,ye)}emplace(r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re,ce,me,ve,ye,we){const Fe=30*r,ke=15*r,it=60*r;return this.int16[Fe+0]=l,this.int16[Fe+1]=u,this.int16[Fe+2]=h,this.float32[ke+2]=g,this.float32[ke+3]=v,this.uint16[Fe+8]=w,this.uint16[Fe+9]=D,this.uint32[ke+5]=T,this.uint32[ke+6]=S,this.uint32[ke+7]=N,this.uint16[Fe+16]=R,this.uint16[Fe+17]=z,this.uint16[Fe+18]=j,this.float32[ke+10]=W,this.float32[ke+11]=te,this.uint8[it+48]=re,this.uint8[it+49]=ce,this.uint8[it+50]=me,this.uint32[ke+13]=ve,this.int16[Fe+28]=ye,this.uint8[it+58]=we,r}}lo.prototype.bytesPerElement=60,st("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",lo);class Bo extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re,ce,me,ve,ye,we,Fe,ke,it,Ge,Oe,qe,We,ze){const ot=this.length;return this.resize(ot+1),this.emplace(ot,r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re,ce,me,ve,ye,we,Fe,ke,it,Ge,Oe,qe,We,ze)}emplace(r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te,re,ce,me,ve,ye,we,Fe,ke,it,Ge,Oe,qe,We,ze,ot){const dt=38*r,kt=19*r;return this.int16[dt+0]=l,this.int16[dt+1]=u,this.int16[dt+2]=h,this.float32[kt+2]=g,this.float32[kt+3]=v,this.int16[dt+8]=w,this.int16[dt+9]=D,this.int16[dt+10]=T,this.int16[dt+11]=S,this.int16[dt+12]=N,this.int16[dt+13]=R,this.uint16[dt+14]=z,this.uint16[dt+15]=j,this.uint16[dt+16]=W,this.uint16[dt+17]=te,this.uint16[dt+18]=re,this.uint16[dt+19]=ce,this.uint16[dt+20]=me,this.uint16[dt+21]=ve,this.uint16[dt+22]=ye,this.uint16[dt+23]=we,this.uint16[dt+24]=Fe,this.uint16[dt+25]=ke,this.uint16[dt+26]=it,this.uint16[dt+27]=Ge,this.uint16[dt+28]=Oe,this.uint32[kt+15]=qe,this.float32[kt+16]=We,this.float32[kt+17]=ze,this.float32[kt+18]=ot,r}}Bo.prototype.bytesPerElement=76,st("StructArrayLayout3i2f6i15ui1ul3f76",Bo);class Cn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}Cn.prototype.bytesPerElement=4,st("StructArrayLayout1f4",Cn);class Di extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,l,u)}emplace(r,l,u,h){const g=3*r;return this.int16[g+0]=l,this.int16[g+1]=u,this.int16[g+2]=h,r}}Di.prototype.bytesPerElement=6,st("StructArrayLayout3i6",Di);class _n extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const v=6*r;return this.uint32[3*r+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=h,this.uint16[v+4]=g,r}}_n.prototype.bytesPerElement=12,st("StructArrayLayout1ul3ui12",_n);class Kn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const h=2*r;return this.uint16[h+0]=l,this.uint16[h+1]=u,r}}Kn.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",Kn);class yr extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}yr.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",yr);class Wn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const h=2*r;return this.float32[h+0]=l,this.float32[h+1]=u,r}}Wn.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Wn);class bt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const v=4*r;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=g,r}}bt.prototype.bytesPerElement=16,st("StructArrayLayout4f16",bt);class Gc extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gc.prototype.size=40;class kr extends hi{get(r){return new Gc(this,r)}}st("CollisionBoxArray",kr);class al extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}al.prototype.size=60;class ym extends lo{get(r){return new al(this,r)}}st("PlacedSymbolArray",ym);class Zd extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Zd.prototype.size=76;class qc extends Bo{get(r){return new Zd(this,r)}}st("SymbolInstanceArray",qc);class vm extends Cn{getoffsetX(r){return this.float32[1*r+0]}}st("GlyphOffsetArray",vm);class Uu extends Di{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}st("SymbolLineVertexArray",Uu);class Xd extends Pe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xd.prototype.size=12;class Uv extends _n{get(r){return new Xd(this,r)}}st("FeatureIndexArray",Uv);class jv extends Pe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}jv.prototype.size=4;class ju extends Kn{get(r){return new jv(this,r)}}st("FillExtrusionCentroidArray",ju);const eC=Te([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ur=Te([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Yd=Gl(function(a){a.exports=function(r,l){var u,h,g,v,w,D,T,S;for(h=r.length-(u=3&r.length),g=l,w=3432918353,D=461845907,S=0;S<h;)T=255&r.charCodeAt(S)|(255&r.charCodeAt(++S))<<8|(255&r.charCodeAt(++S))<<16|(255&r.charCodeAt(++S))<<24,++S,g=27492+(65535&(v=5*(65535&(g=(g^=T=(65535&(T=(T=(65535&T)*w+(((T>>>16)*w&65535)<<16)&4294967295)<<15|T>>>17))*D+(((T>>>16)*D&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,u){case 3:T^=(255&r.charCodeAt(S+2))<<16;case 2:T^=(255&r.charCodeAt(S+1))<<8;case 1:g^=T=(65535&(T=(T=(65535&(T^=255&r.charCodeAt(S)))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<15|T>>>17))*D+(((T>>>16)*D&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),yf=Gl(function(a){a.exports=function(r,l){for(var u,h=r.length,g=l^h,v=0;h>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),h-=4,++v;switch(h){case 3:g^=(255&r.charCodeAt(v+2))<<16;case 2:g^=(255&r.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),vf=Yd,$v=yf;vf.murmur3=Yd,vf.murmur2=$v;class co{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,u,h){this.ids.push(Ks(r)),this.positions.push(l,u,h)}getPositions(r){const l=Ks(r);let u=0,h=this.ids.length-1;for(;u<h;){const v=u+h>>1;this.ids[v]>=l?h=v:u=v+1}const g=[];for(;this.ids[u]===l;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(r,l){const u=new Float64Array(r.ids),h=new Uint32Array(r.positions);return $u(u,h,0,u.length-1),l&&l.push(u.buffer,h.buffer),{ids:u,positions:h}}static deserialize(r){const l=new co;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function Ks(a){const r=+a;return!isNaN(r)&&r<=Ko?r:vf(String(a))}function $u(a,r,l,u){for(;l<u;){const h=a[l+u>>1];let g=l-1,v=u+1;for(;;){do{g++}while(a[g]<h);do{v--}while(a[v]>h);if(g>=v)break;Ca(a,g,v),Ca(r,3*g,3*v),Ca(r,3*g+1,3*v+1),Ca(r,3*g+2,3*v+2)}v-l<u-v?($u(a,r,l,v),l=v+1):($u(a,r,v+1,u),u=v)}}function Ca(a,r,l){const u=a[r];a[r]=a[l],a[l]=u}st("FeaturePositionMap",co);class qr{constructor(r,l){this.gl=r.gl,this.location=l}}class Kd extends qr{constructor(r,l){super(r,l),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class I_ extends qr{constructor(r,l){super(r,l),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class S_ extends qr{constructor(r,l){super(r,l),this.current=mn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const tC=new Float32Array(16),nC=new Float32Array(9),A_=new Float32Array(4);function uo(a){return[Re(255*a.r,255*a.g),Re(255*a.b,255*a.a)]}class Wc{constructor(r,l,u){this.value=r,this.uniformNames=l.map(h=>`u_${h}`),this.type=u}setUniform(r,l,u){r.set(u.constantOr(this.value))}getBinding(r,l,u){return"color"===this.type?new S_(r,l):new Kd(r,l)}}class Js{constructor(r,l){this.uniformNames=l.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=l.tl.concat(l.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,l,u,h){const g="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;g&&r.set(g)}getBinding(r,l,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new I_(r,l):new Kd(r,l)}}class lc{constructor(r,l,u,h){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,l,u,h,g,v){const w=this.paintVertexArray.length,D=this.expression.evaluate(new B(0),l,{},g,h,v);this.paintVertexArray.resize(r),this._setPaintValue(w,r,D)}updatePaintArray(r,l,u,h,g){const v=this.expression.evaluate({zoom:0},u,h,void 0,g);this._setPaintValue(r,l,v)}_setPaintValue(r,l,u){if("color"===this.type){const h=uo(u);for(let g=r;g<l;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=r;h<l;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Is{constructor(r,l,u,h,g,v){this.expression=r,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(r,l,u,h,g,v){const w=this.expression.evaluate(new B(this.zoom),l,{},g,h,v),D=this.expression.evaluate(new B(this.zoom+1),l,{},g,h,v),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,w,D)}updatePaintArray(r,l,u,h,g){const v=this.expression.evaluate({zoom:this.zoom},u,h,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},u,h,void 0,g);this._setPaintValue(r,l,v,w)}_setPaintValue(r,l,u,h){if("color"===this.type){const g=uo(u),v=uo(h);for(let w=r;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=r;g<l;g++)this.paintVertexArray.emplace(g,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l){const u=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,h=Sn(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,l,u){return new Kd(r,l)}}class cc{constructor(r,l,u,h,g,v,w){this.expression=r,this.type=u,this.useIntegerZoom=h,this.zoom=g,this.layerId=w,this.paintVertexAttributes=("array"===u?ur:eC).members;for(let D=0;D<l.length;++D);this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,l,u){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(r,l,u,h,g,v){this._setPaintValues(r,l,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(r,l,u,h){if(!h||!u)return;const{min:g,mid:v,max:w}=u,D=h[g],T=h[v],S=h[w];if(D&&T&&S)for(let N=r;N<l;N++)this._setPaintValue(this.zoomInPaintVertexArray,N,T,D),this._setPaintValue(this.zoomOutPaintVertexArray,N,T,S)}_setPaintValue(r,l,u,h){r.emplace(l,u.tl[0],u.tl[1],u.br[0],u.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],u.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ll{constructor(r,l,u=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const g in r.paint._values){if(!u(g))continue;const v=r.paint.get(g);if(!(v instanceof ne&&Qa(v.property.specification)))continue;const w=Gv(g,r.type),D=v.value,T=v.property.specification.type,S=v.property.useIntegerZoom,N=v.property.specification["property-type"],R="cross-faded"===N||"cross-faded-data-driven"===N,z="line-dasharray"===String(g)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==D.kind||z)if("source"===D.kind||z||R){const j=Qd(g,T,"source");this.binders[g]=R?new cc(D,w,T,S,l,j,r.id):new lc(D,w,T,j),h.push(`/a_${g}`)}else{const j=Qd(g,T,"composite");this.binders[g]=new Is(D,w,T,S,l,j),h.push(`/z_${g}`)}else this.binders[g]=R?new Js(D.value,w):new Wc(D.value,w,T),h.push(`/u_${g}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof lc||l instanceof Is?l.maxValue:0}populatePaintArrays(r,l,u,h,g,v){for(const w in this.binders){const D=this.binders[w];(D instanceof lc||D instanceof Is||D instanceof cc)&&D.populatePaintArray(r,l,u,h,g,v)}}setConstantPatternPositions(r,l){for(const u in this.binders){const h=this.binders[u];h instanceof Js&&h.setConstantPatternPositions(r,l)}}updatePaintArrays(r,l,u,h,g,v){let w=!1;for(const D in r){const T=l.getPositions(D);for(const S of T){const N=u.feature(S.index);for(const R in this.binders){const z=this.binders[R];if((z instanceof lc||z instanceof Is||z instanceof cc)&&!0===z.expression.isStateDependent){const j=h.paint.get(R);z.expression=j.value,z.updatePaintArray(S.start,S.end,N,r[D],g,v),w=!0}}}}return w}defines(){const r=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Wc||u instanceof Js)&&r.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof lc||u instanceof Is||u instanceof cc)for(let h=0;h<u.paintVertexAttributes.length;h++)r.push(u.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Wc||u instanceof Js||u instanceof Is)for(const h of u.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,l){const u=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof Wc||g instanceof Js||g instanceof Is)for(const v of g.uniformNames)if(l[v]){const w=g.getBinding(r,l[v],v);u.push({name:v,property:h,binding:w})}}return u}setUniforms(r,l,u,h){for(const{name:g,property:v,binding:w}of l)this.binders[v].setUniform(w,h,u.get(v),g)}updatePaintBuffers(r){this._buffers=[];for(const l in this.binders){const u=this.binders[l];if(r&&u instanceof cc){const h=2===r.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof lc||u instanceof Is)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(r){for(const l in this.binders){const u=this.binders[l];(u instanceof lc||u instanceof Is||u instanceof cc)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof lc||l instanceof Is||l instanceof cc)&&l.destroy()}}}class Zc{constructor(r,l,u=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new ll(h,l,u);this.needsUpload=!1,this._featureMap=new co,this._bufferOffset=0}populatePaintArrays(r,l,u,h,g,v,w){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(r,l,h,g,v,w);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,u,h,g){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,l,v,h,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Hv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Gv(a,r){return Hv[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}const Jd={"line-pattern":{source:St,composite:St},"fill-pattern":{source:St,composite:St},"fill-extrusion-pattern":{source:St,composite:St},"line-dasharray":{source:xt,composite:xt}},bm={color:{source:Wn,composite:bt},number:{source:Cn,composite:Wn}};function Qd(a,r,l){const u=Jd[a];return u&&u[l]||bm[r][l]}st("ConstantBinder",Wc),st("CrossFadedConstantBinder",Js),st("SourceExpressionBinder",lc),st("CrossFadedCompositeBinder",cc),st("CompositeExpressionBinder",Is),st("ProgramConfiguration",ll,{omit:["_buffers"]}),st("ProgramConfigurationSet",Zc);const xm="-transition";class ho extends Je{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new K(l.layout)),l.paint)){this._transitionablePaint=new ee(l.paint);for(const u in r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(const u in r.layout)this.setLayoutProperty(u,r.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,u={}){null!=l&&this._validate(ku,`layers.${this.id}.layout.${r}`,r,l,u)||("visibility"!==r?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return Ut(r,xm)?this._transitionablePaint.getTransition(r.slice(0,-xm.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,u={}){if(null!=l&&this._validate(so,`layers.${this.id}.paint.${r}`,r,l,u))return!1;if(Ut(r,xm))return this._transitionablePaint.setTransition(r.slice(0,-xm.length),l||void 0),!1;{const h=this._transitionablePaint._values[r],g="cross-faded-data-driven"===h.property.specification["property-type"],v=h.value.isDataDriven(),w=h.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const D=this._transitionablePaint._values[r].value;return D.isDataDriven()||v||g||this._handleOverridablePaintPropertyUpdate(r,w,D)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),_s(r,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(r,l,u,h,g={}){return(!g||!1!==g.validate)&&Nu(this,r.call(ti,{key:l,layerType:this.type,objectKey:u,value:h,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof ne&&Qa(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const wm=Te([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hu}=wm;class dr{constructor(r=[]){this.segments=r}prepareSegment(r,l,u,h){let g=this.segments[this.segments.length-1];return r>dr.MAX_VERTEX_ARRAY_LENGTH&&ri(`Max vertices per segment is ${dr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>dr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==h&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,u,h){return new dr([{vertexOffset:r,primitiveOffset:l,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}dr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",dr);var fn=8192;class Xc{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof On?new On(r.lng,r.lat):On.convert(r),this}setSouthWest(r){return this._sw=r instanceof On?new On(r.lng,r.lat):On.convert(r),this}extend(r){const l=this._sw,u=this._ne;let h,g;if(r instanceof On)h=r,g=r;else{if(!(r instanceof Xc))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Xc.convert(r)):this.extend(On.convert(r)):this;if(h=r._sw,g=r._ne,!h||!g)return this}return l||u?(l.lng=Math.min(h.lng,l.lng),l.lat=Math.min(h.lat,l.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new On(h.lng,h.lat),this._ne=new On(g.lng,g.lat)),this}getCenter(){return new On((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new On(this.getWest(),this.getNorth())}getSouthEast(){return new On(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:u}=On.convert(r);let h=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(r){return!r||r instanceof Xc?r:new Xc(r)}}const bf=6371008.8;class On{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new On(la(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,u=this.lat*l,h=r.lat*l,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((r.lng-this.lng)*l);return bf*Math.acos(Math.min(g,1))}toBounds(r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Xc(new On(this.lng-u,this.lat-l),new On(this.lng+u,this.lat+l))}static convert(r){if(r instanceof On)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new On(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new On(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xf=2*Math.PI*bf;function Gu(a){return xf*Math.cos(a*Math.PI/180)}function uc(a){return(180+a)/360}function Cm(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Be(a,r){return a/Gu(r)}function dc(a){return 360*a-180}function Qs(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function cl(a,r){return a*Gu(Qs(r))}const Ss=85.051129;class wf{constructor(r,l,u=0){this.x=+r,this.y=+l,this.z=+u}static fromLngLat(r,l=0){const u=On.convert(r);return new wf(uc(u.lng),Cm(u.lat),Be(l,u.lat))}toLngLat(){return new On(dc(this.x),Qs(this.y))}toAltitude(){return cl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xf*(r=Qs(this.y),1/Math.cos(r*Math.PI/180));var r}}function Cf(a,r,l,u,h,g,v,w,D){const T=(r+u)/2,S=(l+h)/2,N=new $e(T,S);w(N),function(R,z,j,W,te,re){const ce=j-te,me=W-re;return Math.abs((W-z)*ce-(j-R)*me)/Math.hypot(ce,me)}(N.x,N.y,g.x,g.y,v.x,v.y)>=D?(Cf(a,r,l,T,S,g,N,w,D),Cf(a,T,S,u,h,N,v,w,D)):a.push(v)}function k_(a,r,l){const u=[];let h,g,v;for(const w of a){const{x:D,y:T}=w;r(w),v?Cf(u,h,g,D,T,v,w,r,l):u.push(w),h=D,g=T,v=w}return u}const N_=Math.pow(2,14)-1,Yc=-N_-1;function Vo(a,r){const l=Math.round(a.x*r),u=Math.round(a.y*r);return a.x=Sn(l,Yc,N_),a.y=Sn(u,Yc,N_),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&ri("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function As(a,r,l){const u=a.loadGeometry(),h=a.extent,g=fn/h;if(r&&l&&"mercator"!==l.projection.name){const v=1<<r.z,{scale:w,x:D,y:T,projection:S}=l,N=R=>{const z=dc((r.x+R.x/h)/v),j=Qs((r.y+R.y/h)/v),W=S.project(z,j);R.x=(W.x*w-D)*h,R.y=(W.y*w-T)*h};for(let R=0;R<u.length;R++)if(1!==a.type)u[R]=k_(u[R],N,1);else{const z=[];for(const j of u[R])j.x<0||j.x>=h||j.y<0||j.y>=h||(N(j),z.push(j));u[R]=z}}for(const v of u)for(const w of v)Vo(w,g);return u}function zo(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?As(a):[]}}function Df(a,r,l,u,h){a.emplaceBack(2*r+(u+1)/2,2*l+(h+1)/2)}class Ef{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new ft,this.indexArray=new ni,this.segments=new dr,this.programConfigurations=new Zc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u,h){const g=this.layers[0],v=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:D,id:T,index:S,sourceLayerIndex:N}of r){const R=this.layers[0]._featureFilter.needGeometry,z=zo(D,R);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),z,u))continue;const j=w?w.evaluate(z,{},u):void 0,W={id:T,properties:D.properties,type:D.type,sourceLayerIndex:N,index:S,geometry:R?z.geometry:As(D,u,h),patterns:{},sortKey:j};v.push(W)}w&&v.sort((D,T)=>D.sortKey-T.sortKey);for(const D of v){const{geometry:T,index:S,sourceLayerIndex:N}=D,R=r[S].feature;this.addFeature(D,T,S,l.availableImages,u),l.featureIndex.insert(R,T,S,N,this.index)}}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Hu),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,u,h,g){for(const v of l)for(const w of v){const D=w.x,T=w.y;if(D<0||D>=fn||T<0||T>=fn)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),N=S.vertexLength;Df(this.layoutVertexArray,D,T,-1,-1),Df(this.layoutVertexArray,D,T,1,-1),Df(this.layoutVertexArray,D,T,1,1),Df(this.layoutVertexArray,D,T,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},h,g)}}function Tf(a,r){for(let l=0;l<a.length;l++)if(Jc(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(Jc(a,r[l]))return!0;return!!Em(a,r)}function Mf(a,r,l){return!!Jc(a,r)||!!Kc(r,a,l)}function Dm(a,r){if(1===a.length)return Wv(r,a[0]);for(let l=0;l<r.length;l++){const u=r[l];for(let h=0;h<u.length;h++)if(Jc(a,u[h]))return!0}for(let l=0;l<a.length;l++)if(Wv(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(Em(a,r[l]))return!0;return!1}function qv(a,r,l){if(a.length>1){if(Em(a,r))return!0;for(let u=0;u<r.length;u++)if(Kc(r[u],a,l))return!0}for(let u=0;u<a.length;u++)if(Kc(a[u],r,l))return!0;return!1}function Em(a,r){if(0===a.length||0===r.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],h=a[l+1];for(let g=0;g<r.length-1;g++)if(qu(u,h,r[g],r[g+1]))return!0}return!1}function qu(a,r,l,u){return Vi(a,l,u)!==Vi(r,l,u)&&Vi(a,r,l)!==Vi(a,r,u)}function Kc(a,r,l){const u=l*l;if(1===r.length)return a.distSqr(r[0])<u;for(let h=1;h<r.length;h++)if(P_(a,r[h-1],r[h])<u)return!0;return!1}function P_(a,r,l){const u=r.distSqr(l);if(0===u)return a.distSqr(r);const h=((a.x-r.x)*(l.x-r.x)+(a.y-r.y)*(l.y-r.y))/u;return a.distSqr(h<0?r:h>1?l:l.sub(r)._mult(h)._add(r))}function Wv(a,r){let l,u,h,g=!1;for(let v=0;v<a.length;v++){l=a[v];for(let w=0,D=l.length-1;w<l.length;D=w++)u=l[w],h=l[D],u.y>r.y!=h.y>r.y&&r.x<(h.x-u.x)*(r.y-u.y)/(h.y-u.y)+u.x&&(g=!g)}return g}function Jc(a,r){let l=!1;for(let u=0,h=a.length-1;u<a.length;h=u++){const g=a[u],v=a[h];g.y>r.y!=v.y>r.y&&r.x<(v.x-g.x)*(r.y-g.y)/(v.y-g.y)+g.x&&(l=!l)}return l}function R_(a,r,l,u,h){for(const v of a)if(r<=v.x&&l<=v.y&&u>=v.x&&h>=v.y)return!0;const g=[new $e(r,l),new $e(r,h),new $e(u,h),new $e(u,l)];if(a.length>2)for(const v of g)if(Jc(a,v))return!0;for(let v=0;v<a.length-1;v++)if(iC(a[v],a[v+1],g))return!0;return!1}function iC(a,r,l){const u=l[0],h=l[2];if(a.x<u.x&&r.x<u.x||a.x>h.x&&r.x>h.x||a.y<u.y&&r.y<u.y||a.y>h.y&&r.y>h.y)return!1;const g=Vi(a,r,l[0]);return g!==Vi(a,r,l[1])||g!==Vi(a,r,l[2])||g!==Vi(a,r,l[3])}function Wu(a,r,l){const u=r.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(r.id).getMaxValue(a)}function If(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function F_(a,r,l,u,h){if(!r[0]&&!r[1])return a;const g=$e.convert(r)._mult(h);"viewport"===l&&g._rotate(-u);const v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(g));return v}function eh(a,r,l,u){const h=$e.convert(a)._mult(u);return"viewport"===r&&h._rotate(-l),h}st("CircleBucket",Ef,{omit:["layers"]});const Tm=new Ne({"circle-sort-key":new le(be.layout_circle["circle-sort-key"])});var Zu={paint:new Ne({"circle-radius":new le(be.paint_circle["circle-radius"]),"circle-color":new le(be.paint_circle["circle-color"]),"circle-blur":new le(be.paint_circle["circle-blur"]),"circle-opacity":new le(be.paint_circle["circle-opacity"]),"circle-translate":new J(be.paint_circle["circle-translate"]),"circle-translate-anchor":new J(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new J(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new J(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new le(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new le(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new le(be.paint_circle["circle-stroke-opacity"])}),layout:Tm},Wr="undefined"!=typeof Float32Array?Float32Array:Array;function O_(){var a=new Wr(9);return Wr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function L_(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function th(a,r,l){var u=r[0],h=r[1],g=r[2],v=r[3],w=r[4],D=r[5],T=r[6],S=r[7],N=r[8],R=r[9],z=r[10],j=r[11],W=r[12],te=r[13],re=r[14],ce=r[15],me=l[0],ve=l[1],ye=l[2],we=l[3];return a[0]=me*u+ve*w+ye*N+we*W,a[1]=me*h+ve*D+ye*R+we*te,a[2]=me*g+ve*T+ye*z+we*re,a[3]=me*v+ve*S+ye*j+we*ce,a[4]=(me=l[4])*u+(ve=l[5])*w+(ye=l[6])*N+(we=l[7])*W,a[5]=me*h+ve*D+ye*R+we*te,a[6]=me*g+ve*T+ye*z+we*re,a[7]=me*v+ve*S+ye*j+we*ce,a[8]=(me=l[8])*u+(ve=l[9])*w+(ye=l[10])*N+(we=l[11])*W,a[9]=me*h+ve*D+ye*R+we*te,a[10]=me*g+ve*T+ye*z+we*re,a[11]=me*v+ve*S+ye*j+we*ce,a[12]=(me=l[12])*u+(ve=l[13])*w+(ye=l[14])*N+(we=l[15])*W,a[13]=me*h+ve*D+ye*R+we*te,a[14]=me*g+ve*T+ye*z+we*re,a[15]=me*v+ve*S+ye*j+we*ce,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var Mm=th;function nh(){var a=new Wr(3);return Wr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Im(a){return Math.hypot(a[0],a[1],a[2])}function Qc(a,r,l){var u=new Wr(3);return u[0]=a,u[1]=r,u[2]=l,u}function hc(a,r,l){return a[0]=r[0]-l[0],a[1]=r[1]-l[1],a[2]=r[2]-l[2],a}function B_(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a}function V_(a,r,l,u){return a[0]=r[0]+l[0]*u,a[1]=r[1]+l[1]*u,a[2]=r[2]+l[2]*u,a}function z_(a,r){var l=r[0],u=r[1],h=r[2],g=l*l+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),a[0]=r[0]*g,a[1]=r[1]*g,a[2]=r[2]*g,a}function U_(a,r,l){var u=l[0],h=l[1],g=l[2],v=r[0],w=r[1],D=r[2],T=h*D-g*w,S=g*v-u*D,N=u*w-h*v,R=h*N-g*S,z=g*T-u*N,j=u*S-h*T,W=2*l[3];return S*=W,N*=W,z*=2,j*=2,a[0]=v+(T*=W)+(R*=2),a[1]=w+S+z,a[2]=D+N+j,a}var ih,a,os=hc,Da=B_,j_=Im;function rh(a,r,l){var u=r[0],h=r[1],g=r[2],v=r[3];return a[0]=l[0]*u+l[4]*h+l[8]*g+l[12]*v,a[1]=l[1]*u+l[5]*h+l[9]*g+l[13]*v,a[2]=l[2]*u+l[6]*h+l[10]*g+l[14]*v,a[3]=l[3]*u+l[7]*h+l[11]*g+l[15]*v,a}function Sm(){var a=new Wr(4);return Wr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function $_(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function H_(a,r,l){l*=.5;var u=r[0],h=r[1],g=r[2],v=r[3],w=Math.sin(l),D=Math.cos(l);return a[0]=u*D+v*w,a[1]=h*D+g*w,a[2]=g*D-h*w,a[3]=v*D-u*w,a}function G_(a,r){return a[0]===r[0]&&a[1]===r[1]}function Am(a,r,l,u,h,g,v,w,D){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(D*=a.pixelToTileUnitsFactor);for(const T of r)for(const S of T){const N=S.add(w),R=h&&l.elevation?l.elevation.exaggeration()*h.getElevationAt(N.x,N.y,!0):0,z=g?N:Zv(N,R,u),j=g?a.tilespaceRays.map(te=>Yv(te,R)):a.queryGeometry.screenGeometry,W=rh([],[S.x,S.y,R,1],u);if(!v&&g?D*=W[3]/l.cameraToCenterDistance:v&&!g&&(D*=l.cameraToCenterDistance/W[3]),Mf(j,z,D))return!0}return!1}function Zv(a,r,l){const u=rh([],[a.x,a.y,r,1],l);return new $e(u[0]/u[3],u[1]/u[3])}nh(),ih=new Wr(4),Wr!=Float32Array&&(ih[0]=0,ih[1]=0,ih[2]=0,ih[3]=0),nh(),Qc(1,0,0),Qc(0,1,0),Sm(),Sm(),O_(),a=new Wr(2),Wr!=Float32Array&&(a[0]=0,a[1]=0);const q_=Qc(0,0,0),Xv=Qc(0,0,1);function Yv(a,r){const l=nh();return q_[2]=r,a.intersectsPlane(q_,Xv,l),new $e(l[0],l[1])}class Kv extends Ef{}function km(a,{width:r,height:l},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*l*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*l*u);return a.width=r,a.height=l,a.data=h,a}function Xu(a,{width:r,height:l},u){if(r===a.width&&l===a.height)return;const h=km({},{width:r,height:l},u);Sf(a,h,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,l)},u),a.width=r,a.height=l,a.data=h.data}function Sf(a,r,l,u,h,g){if(0===h.width||0===h.height)return r;if(h.width>a.width||h.height>a.height||l.x>a.width-h.width||l.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||u.x>r.width-h.width||u.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,w=r.data;for(let D=0;D<h.height;D++){const T=((l.y+D)*a.width+l.x)*g,S=((u.y+D)*r.width+u.x)*g;for(let N=0;N<h.width*g;N++)w[S+N]=v[T+N]}return r}st("HeatmapBucket",Kv,{omit:["layers"]});class Nr{constructor(r,l){km(this,r,1,l)}resize(r){Xu(this,r,1)}clone(){return new Nr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,h,g){Sf(r,l,u,h,g,1)}}class Pr{constructor(r,l){km(this,r,4,l)}resize(r){Xu(this,r,4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,h,g){Sf(r,l,u,h,g,4)}}st("AlphaImage",Nr),st("RGBAImage",Pr);var W_={paint:new Ne({"heatmap-radius":new le(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new le(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new J(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Me(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new J(be.paint_heatmap["heatmap-opacity"])})};function Af(a){const r={},l=a.resolution||256,u=a.clips?a.clips.length:1,h=a.image||new Pr({width:l,height:u}),g=(v,w,D)=>{r[a.evaluationKey]=D;const T=a.expression.evaluate(r);h.data[v+w+0]=Math.floor(255*T.r/T.a),h.data[v+w+1]=Math.floor(255*T.g/T.a),h.data[v+w+2]=Math.floor(255*T.b/T.a),h.data[v+w+3]=Math.floor(255*T.a)};if(a.clips)for(let v=0,w=0;v<u;++v,w+=4*l)for(let D=0,T=0;D<l;D++,T+=4){const S=D/(l-1),{start:N,end:R}=a.clips[v];g(w,T,N*(1-S)+R*S)}else for(let v=0,w=0;v<l;v++,w+=4)g(0,w,v/(l-1));return h}var Z_={paint:new Ne({"hillshade-illumination-direction":new J(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new J(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new J(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new J(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new J(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new J(be.paint_hillshade["hillshade-accent-color"])})};const rC=Te([{name:"a_pos",components:2,type:"Int16"}],4),{members:oC}=rC;var Nm=Yu,Pm=Yu;function Yu(a,r,l){l=l||2;var u,h,g,v,w,D,T,S=r&&r.length,N=S?r[0]*l:a.length,R=kf(a,0,N,l,!0),z=[];if(!R||R.next===R.prev)return z;if(S&&(R=function(W,te,re,ce){var me,ve,ye,we=[];for(me=0,ve=te.length;me<ve;me++)(ye=kf(W,te[me]*ce,me<ve-1?te[me+1]*ce:W.length,ce,!1))===ye.next&&(ye.steiner=!0),we.push(Rm(ye));for(we.sort(t1),me=0;me<we.length;me++)re=eu(re=Y_(we[me],re),re.next);return re}(a,r,R,l)),a.length>80*l){u=g=a[0],h=v=a[1];for(var j=l;j<N;j+=l)(w=a[j])<u&&(u=w),(D=a[j+1])<h&&(h=D),w>g&&(g=w),D>v&&(v=D);T=0!==(T=Math.max(g-u,v-h))?1/T:0}return Nf(R,z,l,u,h,T),z}function kf(a,r,l,u,h){var g,v;if(h===ey(a,r,l,u)>0)for(g=r;g<l;g+=u)v=J_(g,a[g],a[g+1],v);else for(g=l-u;g>=r;g-=u)v=J_(g,a[g],a[g+1],v);return v&&Ff(v,v.next)&&(ah(v),v=v.next),v}function eu(a,r){if(!a)return a;r||(r=a);var l,u=a;do{if(l=!1,u.steiner||!Ff(u,u.next)&&0!==Ei(u.prev,u,u.next))u=u.next;else{if(ah(u),(u=r=u.prev)===u.next)break;l=!0}}while(l||u!==r);return r}function Nf(a,r,l,u,h,g,v){if(a){!v&&g&&function(S,N,R,z){var j=S;do{null===j.z&&(j.z=Rf(j.x,j.y,N,R,z)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==S);j.prevZ.nextZ=null,j.prevZ=null,function(W){var te,re,ce,me,ve,ye,we,Fe,ke=1;do{for(re=W,W=null,ve=null,ye=0;re;){for(ye++,ce=re,we=0,te=0;te<ke&&(we++,ce=ce.nextZ);te++);for(Fe=ke;we>0||Fe>0&&ce;)0!==we&&(0===Fe||!ce||re.z<=ce.z)?(me=re,re=re.nextZ,we--):(me=ce,ce=ce.nextZ,Fe--),ve?ve.nextZ=me:W=me,me.prevZ=ve,ve=me;re=ce}ve.nextZ=null,ke*=2}while(ye>1)}(j)}(a,u,h,g);for(var w,D,T=a;a.prev!==a.next;)if(w=a.prev,D=a.next,g?Jv(a,u,h,g):X_(a))r.push(w.i/l),r.push(a.i/l),r.push(D.i/l),ah(a),a=D.next,T=D.next;else if((a=D)===T){v?1===v?Nf(a=Qv(eu(a),r,l),r,l,u,h,g,2):2===v&&e1(a,r,l,u,h,g):Nf(eu(a),r,l,u,h,g,1);break}}}function X_(a){var r=a.prev,l=a,u=a.next;if(Ei(r,l,u)>=0)return!1;for(var h=a.next.next;h!==a.prev;){if(Ku(r.x,r.y,l.x,l.y,u.x,u.y,h.x,h.y)&&Ei(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Jv(a,r,l,u){var h=a.prev,g=a,v=a.next;if(Ei(h,g,v)>=0)return!1;for(var w=h.x>g.x?h.x>v.x?h.x:v.x:g.x>v.x?g.x:v.x,D=h.y>g.y?h.y>v.y?h.y:v.y:g.y>v.y?g.y:v.y,T=Rf(h.x<g.x?h.x<v.x?h.x:v.x:g.x<v.x?g.x:v.x,h.y<g.y?h.y<v.y?h.y:v.y:g.y<v.y?g.y:v.y,r,l,u),S=Rf(w,D,r,l,u),N=a.prevZ,R=a.nextZ;N&&N.z>=T&&R&&R.z<=S;){if(N!==a.prev&&N!==a.next&&Ku(h.x,h.y,g.x,g.y,v.x,v.y,N.x,N.y)&&Ei(N.prev,N,N.next)>=0||(N=N.prevZ,R!==a.prev&&R!==a.next&&Ku(h.x,h.y,g.x,g.y,v.x,v.y,R.x,R.y)&&Ei(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;N&&N.z>=T;){if(N!==a.prev&&N!==a.next&&Ku(h.x,h.y,g.x,g.y,v.x,v.y,N.x,N.y)&&Ei(N.prev,N,N.next)>=0)return!1;N=N.prevZ}for(;R&&R.z<=S;){if(R!==a.prev&&R!==a.next&&Ku(h.x,h.y,g.x,g.y,v.x,v.y,R.x,R.y)&&Ei(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function Qv(a,r,l){var u=a;do{var h=u.prev,g=u.next.next;!Ff(h,g)&&Of(h,u,u.next,g)&&sh(h,g)&&sh(g,h)&&(r.push(h.i/l),r.push(u.i/l),r.push(g.i/l),ah(u),ah(u.next),u=a=g),u=u.next}while(u!==a);return eu(u)}function e1(a,r,l,u,h,g){var v=a;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&ii(v,w)){var D=K_(v,w);return v=eu(v,v.next),D=eu(D,D.next),Nf(v,r,l,u,h,g),void Nf(D,r,l,u,h,g)}w=w.next}v=v.next}while(v!==a)}function t1(a,r){return a.x-r.x}function Y_(a,r){var l=function(g,v){var w,D=v,T=g.x,S=g.y,N=-1/0;do{if(S<=D.y&&S>=D.next.y&&D.next.y!==D.y){var R=D.x+(S-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(R<=T&&R>N){if(N=R,R===T){if(S===D.y)return D;if(S===D.next.y)return D.next}w=D.x<D.next.x?D:D.next}}D=D.next}while(D!==v);if(!w)return null;if(T===N)return w;var z,j=w,W=w.x,te=w.y,re=1/0;D=w;do{T>=D.x&&D.x>=W&&T!==D.x&&Ku(S<te?T:N,S,W,te,S<te?N:T,S,D.x,D.y)&&(z=Math.abs(S-D.y)/(T-D.x),sh(D,g)&&(z<re||z===re&&(D.x>w.x||D.x===w.x&&Pf(w,D)))&&(w=D,re=z)),D=D.next}while(D!==j);return w}(a,r);if(!l)return r;var u=K_(l,a),h=eu(l,l.next);return eu(u,u.next),r===l?h:r}function Pf(a,r){return Ei(a.prev,a,r.prev)<0&&Ei(r.next,a,a.next)<0}function Rf(a,r,l,u,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*h)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-u)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Rm(a){var r=a,l=a;do{(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next}while(r!==a);return l}function Ku(a,r,l,u,h,g,v,w){return(h-v)*(r-w)-(a-v)*(g-w)>=0&&(a-v)*(u-w)-(l-v)*(r-w)>=0&&(l-v)*(g-w)-(h-v)*(u-w)>=0}function ii(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(l,u){var h=l;do{if(h.i!==l.i&&h.next.i!==l.i&&h.i!==u.i&&h.next.i!==u.i&&Of(h,h.next,l,u))return!0;h=h.next}while(h!==l);return!1}(a,r)&&(sh(a,r)&&sh(r,a)&&function(l,u){var h=l,g=!1,v=(l.x+u.x)/2,w=(l.y+u.y)/2;do{h.y>w!=h.next.y>w&&h.next.y!==h.y&&v<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next}while(h!==l);return g}(a,r)&&(Ei(a.prev,a,r.prev)||Ei(a,r.prev,r))||Ff(a,r)&&Ei(a.prev,a,a.next)>0&&Ei(r.prev,r,r.next)>0)}function Ei(a,r,l){return(r.y-a.y)*(l.x-r.x)-(r.x-a.x)*(l.y-r.y)}function Ff(a,r){return a.x===r.x&&a.y===r.y}function Of(a,r,l,u){var h=Lf(Ei(a,r,l)),g=Lf(Ei(a,r,u)),v=Lf(Ei(l,u,a)),w=Lf(Ei(l,u,r));return h!==g&&v!==w||!(0!==h||!oh(a,l,r))||!(0!==g||!oh(a,u,r))||!(0!==v||!oh(l,a,u))||!(0!==w||!oh(l,r,u))}function oh(a,r,l){return r.x<=Math.max(a.x,l.x)&&r.x>=Math.min(a.x,l.x)&&r.y<=Math.max(a.y,l.y)&&r.y>=Math.min(a.y,l.y)}function Lf(a){return a>0?1:a<0?-1:0}function sh(a,r){return Ei(a.prev,a,a.next)<0?Ei(a,r,a.next)>=0&&Ei(a,a.prev,r)>=0:Ei(a,r,a.prev)<0||Ei(a,a.next,r)<0}function K_(a,r){var l=new Q_(a.i,a.x,a.y),u=new Q_(r.i,r.x,r.y),h=a.next,g=r.prev;return a.next=r,r.prev=a,l.next=h,h.prev=l,u.next=l,l.prev=u,g.next=u,u.prev=g,u}function J_(a,r,l,u){var h=new Q_(a,r,l);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function ah(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Q_(a,r,l){this.i=a,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ey(a,r,l,u){for(var h=0,g=r,v=l-u;g<l;g+=u)h+=(a[v]-a[g])*(a[g+1]+a[v+1]),v=g;return h}function lh(a,r,l,u,h){Zr(a,r,l||0,u||a.length-1,h||ty)}function Zr(a,r,l,u,h){for(;u>l;){if(u-l>600){var g=u-l+1,v=r-l+1,w=Math.log(g),D=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*D*(g-D)/g)*(v-g/2<0?-1:1);Zr(a,r,Math.max(l,Math.floor(r-v*D/g+T)),Math.min(u,Math.floor(r+(g-v)*D/g+T)),h)}var S=a[r],N=l,R=u;for(tu(a,l,r),h(a[u],S)>0&&tu(a,l,u);N<R;){for(tu(a,N,R),N++,R--;h(a[N],S)<0;)N++;for(;h(a[R],S)>0;)R--}0===h(a[l],S)?tu(a,l,R):tu(a,++R,u),R<=r&&(l=R+1),r<=R&&(u=R-1)}}function tu(a,r,l){var u=a[r];a[r]=a[l],a[l]=u}function ty(a,r){return a<r?-1:a>r?1:0}function Bf(a,r){const l=a.length;if(l<=1)return[a];const u=[];let h,g;for(let v=0;v<l;v++){const w=Md(a[v]);0!==w&&(a[v].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(h&&u.push(h),h=[a[v]]):h.push(a[v]))}if(h&&u.push(h),r>1)for(let v=0;v<u.length;v++)u[v].length<=r||(lh(u[v],r,1,u[v].length-1,Xr),u[v]=u[v].slice(0,r));return u}function Xr(a,r){return r.area-a.area}function nu(a,r,l){const u=l.patternDependencies;let h=!1;for(const g of r){const v=g.paint.get(`${a}-pattern`);v.isConstant()||(h=!0);const w=v.constantOr(null);w&&(h=!0,u[w.to]=!0,u[w.from]=!0)}return h}function ch(a,r,l,u,h){const g=h.patternDependencies;for(const v of r){const w=v.paint.get(`${a}-pattern`).value;if("constant"!==w.kind){let D=w.evaluate({zoom:u-1},l,{},h.availableImages),T=w.evaluate({zoom:u},l,{},h.availableImages),S=w.evaluate({zoom:u+1},l,{},h.availableImages);D=D&&D.name?D.name:D,T=T&&T.name?T.name:T,S=S&&S.name?S.name:S,g[D]=!0,g[T]=!0,g[S]=!0,l.patterns[v.id]={min:D,mid:T,max:S}}}return l}Yu.deviation=function(a,r,l,u){var h=r&&r.length,g=Math.abs(ey(a,0,h?r[0]*l:a.length,l));if(h)for(var v=0,w=r.length;v<w;v++)g-=Math.abs(ey(a,r[v]*l,v<w-1?r[v+1]*l:a.length,l));var D=0;for(v=0;v<u.length;v+=3){var T=u[v]*l,S=u[v+1]*l,N=u[v+2]*l;D+=Math.abs((a[T]-a[N])*(a[S+1]-a[T+1])-(a[T]-a[S])*(a[N+1]-a[T+1]))}return 0===g&&0===D?0:Math.abs((D-g)/g)},Yu.flatten=function(a){for(var r=a[0][0].length,l={vertices:[],holes:[],dimensions:r},u=0,h=0;h<a.length;h++){for(var g=0;g<a[h].length;g++)for(var v=0;v<r;v++)l.vertices.push(a[h][g][v]);h>0&&l.holes.push(u+=a[h-1].length)}return l},Nm.default=Pm;class Vf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ft,this.indexArray=new ni,this.indexArray2=new Kn,this.programConfigurations=new Zc(r.layers,r.zoom),this.segments=new dr,this.segments2=new dr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u,h){this.hasPattern=nu("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:D,index:T,sourceLayerIndex:S}of r){const N=this.layers[0]._featureFilter.needGeometry,R=zo(w,N);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),R,u))continue;const z=g?g.evaluate(R,{},u,l.availableImages):void 0,j={id:D,properties:w.properties,type:w.type,sourceLayerIndex:S,index:T,geometry:N?R.geometry:As(w,u,h),patterns:{},sortKey:z};v.push(j)}g&&v.sort((w,D)=>w.sortKey-D.sortKey);for(const w of v){const{geometry:D,index:T,sourceLayerIndex:S}=w;if(this.hasPattern){const N=ch("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(w,D,T,u,{},l.availableImages);l.featureIndex.insert(r[T].feature,D,T,S,this.index)}}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}addFeatures(r,l,u,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,oC),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,u,h,g,v=[]){for(const w of Bf(l,500)){let D=0;for(const j of w)D+=j.length;const T=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),S=T.vertexLength,N=[],R=[];for(const j of w){if(0===j.length)continue;j!==w[0]&&R.push(N.length/2);const W=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),te=W.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(te+j.length-1,te),N.push(j[0].x),N.push(j[0].y);for(let re=1;re<j.length;re++)this.layoutVertexArray.emplaceBack(j[re].x,j[re].y),this.indexArray2.emplaceBack(te+re-1,te+re),N.push(j[re].x),N.push(j[re].y);W.vertexLength+=j.length,W.primitiveLength+=j.length}const z=Nm(N,R);for(let j=0;j<z.length;j+=3)this.indexArray.emplaceBack(S+z[j],S+z[j+1],S+z[j+2]);T.vertexLength+=D,T.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,v,h)}}st("FillBucket",Vf,{omit:["layers","patternFeatures"]});const n1=new Ne({"fill-sort-key":new le(be.layout_fill["fill-sort-key"])});var ny={paint:new Ne({"fill-antialias":new J(be.paint_fill["fill-antialias"]),"fill-opacity":new le(be.paint_fill["fill-opacity"]),"fill-color":new le(be.paint_fill["fill-color"]),"fill-outline-color":new le(be.paint_fill["fill-outline-color"]),"fill-translate":new J(be.paint_fill["fill-translate"]),"fill-translate-anchor":new J(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new fe(be.paint_fill["fill-pattern"])}),layout:n1};const r1=Te([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),iy=Te([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:o1}=r1;var Fm=Ju;function Ju(a,r,l,u,h){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=h,a.readFields(s1,this,r)}function s1(a,r,l){1==a?r.id=l.readVarint():2==a?function(u,h){for(var g=u.readVarint()+u.pos;u.pos<g;){var v=h._keys[u.readVarint()],w=h._values[u.readVarint()];h.properties[v]=w}}(l,r):3==a?r.type=l.readVarint():4==a&&(r._geometry=l.pos)}function a1(a){for(var r,l,u=0,h=0,g=a.length,v=g-1;h<g;v=h++)u+=((l=a[v]).x-(r=a[h]).x)*(r.y+l.y);return u}Ju.types=["Unknown","Point","LineString","Polygon"],Ju.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,l=a.readVarint()+a.pos,u=1,h=0,g=0,v=0,w=[];a.pos<l;){if(h<=0){var D=a.readVarint();u=7&D,h=D>>3}if(h--,1===u||2===u)g+=a.readSVarint(),v+=a.readSVarint(),1===u&&(r&&w.push(r),r=[]),r.push(new $e(g,v));else{if(7!==u)throw new Error("unknown command "+u);r&&r.push(r[0].clone())}}return r&&w.push(r),w},Ju.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,l=1,u=0,h=0,g=0,v=1/0,w=-1/0,D=1/0,T=-1/0;a.pos<r;){if(u<=0){var S=a.readVarint();l=7&S,u=S>>3}if(u--,1===l||2===l)(h+=a.readSVarint())<v&&(v=h),h>w&&(w=h),(g+=a.readSVarint())<D&&(D=g),g>T&&(T=g);else if(7!==l)throw new Error("unknown command "+l)}return[v,D,w,T]},Ju.prototype.toGeoJSON=function(a,r,l){var u,h,g=this.extent*Math.pow(2,l),v=this.extent*a,w=this.extent*r,D=this.loadGeometry(),T=Ju.types[this.type];function S(z){for(var j=0;j<z.length;j++){var W=z[j];z[j]=[360*(W.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(u=0;u<D.length;u++)N[u]=D[u][0];S(D=N);break;case 2:for(u=0;u<D.length;u++)S(D[u]);break;case 3:for(D=function(z){var j=z.length;if(j<=1)return[z];for(var W,te,re=[],ce=0;ce<j;ce++){var me=a1(z[ce]);0!==me&&(void 0===te&&(te=me<0),te===me<0?(W&&re.push(W),W=[z[ce]]):W.push(z[ce]))}return W&&re.push(W),re}(D),u=0;u<D.length;u++)for(h=0;h<D[u].length;h++)S(D[u][h])}1===D.length?D=D[0]:T="Multi"+T;var R={type:"Feature",geometry:{type:T,coordinates:D},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Om=zf;function zf(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(ry,this,r),this.length=this._features.length}function ry(a,r,l){15===a?r.version=l.readVarint():1===a?r.name=l.readString():5===a?r.extent=l.readVarint():2===a?r._features.push(l.pos):3===a?r._keys.push(l.readString()):4===a&&r._values.push(function(u){for(var h=null,g=u.readVarint()+u.pos;u.pos<g;){var v=u.readVarint()>>3;h=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return h}(l))}function l1(a,r,l){if(3===a){var u=new Om(l,l.readVarint()+l.pos);u.length&&(r[u.name]=u)}}zf.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new Fm(this._pbf,r,this.extent,this._keys,this._values)};var Qu={VectorTile:function(a,r){this.layers=a.readFields(l1,{},r)},VectorTileFeature:Fm,VectorTileLayer:Om};const oy=Qu.VectorTileFeature.types,Uf=Math.pow(2,13);function uh(a,r,l,u,h,g,v,w){a.emplaceBack((r<<1)+v,(l<<1)+g,(Math.floor(u*Uf)<<1)+h,Math.round(w))}class sy{constructor(){this.acc=new $e(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $e(r.x,r.y),this.max=new $e(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);let u=!!this.borders;const h=this.min,g=this.max;r.x<h.x?(h.x=r.x,u=!0):r.x>g.x&&(g.x=r.x,u=!0),r.y<h.y?(h.y=r.y,u=!0):r.y>g.y&&(g.y=r.y,u=!0),((0===r.x||r.x===fn)&&r.x===l.x)!=((0===r.y||r.y===fn)&&r.y===l.y)&&this.processBorderOverlap(r,l),u&&this.checkBorderIntersection(r,l)}checkBorderIntersection(r,l){l.x<0!=r.x<0&&this.addBorderIntersection(0,pt(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>fn!=r.x>fn&&this.addBorderIntersection(1,pt(l.y,r.y,(fn-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,pt(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>fn!=r.y>fn&&this.addBorderIntersection(3,pt(l.x,r.x,(fn-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const u=0===r.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,r.y)}else{const u=0===r.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,r.x)}}centroid(){const r=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==r?this.acc.div(r)._round():new $e(0,0)}span(){return new $e(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0)}}class ul{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new wt,this.centroidVertexArray=new ju,this.indexArray=new ni,this.programConfigurations=new Zc(r.layers,r.zoom),this.segments=new dr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=r.enableTerrain}populate(r,l,u,h){this.features=[],this.hasPattern=nu("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(g){const v=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*v/(v*v+1)/fn/(1<<g.z)}(u);for(const{feature:g,id:v,index:w,sourceLayerIndex:D}of r){const T=this.layers[0]._featureFilter.needGeometry,S=zo(g,T);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),S,u))continue;const N={id:v,sourceLayerIndex:D,index:w,geometry:T?S.geometry:As(g,u,h),properties:g.properties,type:g.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(ch("fill-extrusion",this.layers,N,this.zoom,l)):this.addFeature(N,N.geometry,w,u,{},l.availableImages),l.featureIndex.insert(g,N.geometry,w,D,this.index,R)}this.sortBorders()}addFeatures(r,l,u,h){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,l,u,h)}this.sortBorders()}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,o1),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,iy.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,u,h,g,v){const w=this.enableTerrain?new sy:null;for(const T of Bf(l,500)){let S=0,N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===T.length||(D=T[0]).every(te=>te.x<=0)||D.every(te=>te.x>=fn)||D.every(te=>te.y<=0)||D.every(te=>te.y>=fn))continue;for(let te=0;te<T.length;te++){const re=T[te];if(0===re.length)continue;S+=re.length;let ce=0;w&&w.startRing(re[0]);for(let me=0;me<re.length;me++){const ve=re[me];if(me>=1){const ye=re[me-1];if(!c1(ve,ye)){w&&w.append(ve,ye),N.vertexLength+4>dr.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const we=ve.sub(ye)._perp(),Fe=we.x/(Math.abs(we.x)+Math.abs(we.y)),ke=we.y>0?1:0,it=ye.dist(ve);ce+it>32768&&(ce=0),uh(this.layoutVertexArray,ve.x,ve.y,Fe,ke,0,0,ce),uh(this.layoutVertexArray,ve.x,ve.y,Fe,ke,0,1,ce),ce+=it,uh(this.layoutVertexArray,ye.x,ye.y,Fe,ke,0,0,ce),uh(this.layoutVertexArray,ye.x,ye.y,Fe,ke,0,1,ce);const Ge=N.vertexLength;this.indexArray.emplaceBack(Ge,Ge+2,Ge+1),this.indexArray.emplaceBack(Ge+1,Ge+2,Ge+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+S>dr.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),"Polygon"!==oy[r.type])continue;const R=[],z=[],j=N.vertexLength;for(let te=0;te<T.length;te++){const re=T[te];if(0!==re.length){re!==T[0]&&z.push(R.length/2);for(let ce=0;ce<re.length;ce++){const me=re[ce];uh(this.layoutVertexArray,me.x,me.y,0,0,1,1,0),R.push(me.x),R.push(me.y),w&&w.currentPolyCount.top++}}}const W=Nm(R,z);for(let te=0;te<W.length;te+=3)this.indexArray.emplaceBack(j+W[te],j+W[te+2],j+W[te+1]);N.primitiveLength+=W.length/3,N.vertexLength+=S}var D;if(w&&w.polyCount.length>0){if(w.borders){w.vertexArrayOffset=this.centroidVertexArray.length;const T=w.borders,S=this.featuresOnBorder.push(w)-1;for(let N=0;N<4;N++)T[N][0]!==Number.MAX_VALUE&&this.borders[N].push(S)}this.encodeCentroid(w.borders?void 0:w.centroid(),w)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,v,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((l,u)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}encodeCentroid(r,l,u=!0){let h,g;if(r)if(0!==r.y){const w=l.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else h=Math.ceil(7*(r.x+450)),g=0;else h=0,g=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const w of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let D=0;D<2*w.edges;D++)this.centroidVertexArray.emplace(v++,0,g),this.centroidVertexArray.emplace(v++,h,g);for(let D=0;D<w.top;D++)this.centroidVertexArray.emplace(v++,h,g)}}}function c1(a,r){return a.x===r.x&&(a.x<0||a.x>fn)||a.y===r.y&&(a.y<0||a.y>fn)}st("FillExtrusionBucket",ul,{omit:["layers","features"]}),st("PartMetadata",sy);var u1={paint:new Ne({"fill-extrusion-opacity":new J(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new le(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new J(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new J(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fe(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new le(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new le(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new J(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function dh(a,r){return a.x*r.x+a.y*r.y}function ay(a,r){if(1===a.length){let l=0;const u=r[l++];let h;for(;!h||u.equals(h);)if(h=r[l++],!h)return 1/0;for(;l<r.length;l++){const g=r[l],v=a[0],w=h.sub(u),D=g.sub(u),T=v.sub(u),S=dh(w,w),N=dh(w,D),R=dh(D,D),z=dh(T,w),j=dh(T,D),W=S*R-N*N,te=(R*z-N*j)/W,re=(S*j-N*z)/W,ce=u.z*(1-te-re)+h.z*te+g.z*re;if(isFinite(ce))return ce}return 1/0}{let l=1/0;for(const u of r)l=Math.min(l,u.z);return l}}function ly(a){const r=new $e(a[0],a[1]);return r.z=a[2],r}function jf(a,r,l,u,h,g,v,w){const D=v*h.getElevationAt(a,r,!0,!0),T=0!==g[0],S=T?0===g[1]?v*(g[0]/7-450):v*function(N,R,z){const j=Math.floor(R[0]/8),W=Math.floor(R[1]/8),te=10*(R[0]-8*j),re=10*(R[1]-8*W),ce=N.getElevationAt(j,W,!0,!0),me=N.getMeterToDEM(z),ve=Math.floor(.5*(te*me-1)),ye=Math.floor(.5*(re*me-1)),we=N.tileCoordToPixel(j,W),Fe=2*ve+1,ke=2*ye+1,it=(Ln=Fe,Nt=ke,[(ot=N).getElevationAtPixel(dt=we.x-ve,kt=we.y-ye,!0),ot.getElevationAtPixel(dt+Nt,kt,!0),ot.getElevationAtPixel(dt,kt+Nt,!0),ot.getElevationAtPixel(dt+Ln,kt+Nt,!0)]),Ge=Math.abs(it[0]-it[1]),Oe=Math.abs(it[2]-it[3]),qe=Math.abs(it[0]-it[2])+Math.abs(it[1]-it[3]),We=Math.min(.25,.5*me*(Ge+Oe)/Fe),ze=Math.min(.25,.5*me*qe/ke);var ot,dt,kt,Ln,Nt;return ce+Math.max(We*te,ze*re)}(h,g,w):D;return{base:D+(0===l)?-1:l,top:T?Math.max(S+u,D+l+2):D+u}}const ks=Te([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:cy}=ks,d1=Te([{name:"a_packed",components:3,type:"Float32"}]),{members:h1}=d1,uy=Qu.VectorTileFeature.types,sC=Math.cos(Math.PI/180*37.5);class hh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Dt,this.layoutVertexArray2=new Pt,this.indexArray=new ni,this.programConfigurations=new Zc(r.layers,r.zoom),this.segments=new dr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u,h){this.hasPattern=nu("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:S,id:N,index:R,sourceLayerIndex:z}of r){const j=this.layers[0]._featureFilter.needGeometry,W=zo(S,j);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),W,u))continue;const te=g?g.evaluate(W,{},u):void 0,re={id:N,properties:S.properties,type:S.type,sourceLayerIndex:z,index:R,geometry:j?W.geometry:As(S,u,h),patterns:{},sortKey:te};v.push(re)}g&&v.sort((S,N)=>S.sortKey-N.sortKey);const{lineAtlas:w,featureIndex:D}=l,T=this.addConstantDashes(w);for(const S of v){const{geometry:N,index:R,sourceLayerIndex:z}=S;if(T&&this.addFeatureDashes(S,w),this.hasPattern){const j=ch("line",this.layers,S,this.zoom,l);this.patternFeatures.push(j)}else this.addFeature(S,N,R,u,w.positions,l.availableImages);D.insert(r[R].feature,N,R,z,this.index)}}addConstantDashes(r){let l=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==g.kind)l=!0;else{const v=g.value,w=h.value;if(!w)continue;r.addDash(w.from,v),r.addDash(w.to,v),w.other&&r.addDash(w.other,v)}}return l}addFeatureDashes(r,l){const u=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,v=h.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===v.kind)continue;let w,D,T,S,N,R;if("constant"===g.kind){const te=g.value;if(!te)continue;w=te.other||te.to,D=te.to,T=te.from}else w=g.evaluate({zoom:u-1},r),D=g.evaluate({zoom:u},r),T=g.evaluate({zoom:u+1},r);"constant"===v.kind?S=N=R=v.value:(S=v.evaluate({zoom:u-1},r),N=v.evaluate({zoom:u},r),R=v.evaluate({zoom:u+1},r)),l.addDash(w,S),l.addDash(D,N),l.addDash(T,R);const z=l.getKey(w,S),j=l.getKey(D,N),W=l.getKey(T,R);r.patterns[h.id]={min:z,mid:j,max:W}}}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}addFeatures(r,l,u,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,h1)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,cy),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,u,h,g,v){const w=this.layers[0].layout,D=w.get("line-join").evaluate(r,{}),T=w.get("line-cap").evaluate(r,{}),S=w.get("line-miter-limit"),N=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const R of l)this.addLine(R,r,D,T,S,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,v,h)}addLine(r,l,u,h,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<r.length-1;re++)this.totalDistance+=r[re].dist(r[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===uy[l.type];let D=r.length;for(;D>=2&&r[D-1].equals(r[D-2]);)D--;let T=0;for(;T<D-1&&r[T].equals(r[T+1]);)T++;if(D<(w?3:2))return;"bevel"===u&&(g=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,N=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let R,z,j,W,te;this.e1=this.e2=-1,w&&(R=r[D-2],te=r[T].sub(R)._unit()._perp());for(let re=T;re<D;re++){if(j=re===D-1?w?r[T+1]:void 0:r[re+1],j&&r[re].equals(j))continue;te&&(W=te),R&&(z=R),R=r[re],te=j?j.sub(R)._unit()._perp():W,W=W||te;let ce=W.add(te);0===ce.x&&0===ce.y||ce._unit();const me=W.x*te.x+W.y*te.y,ve=ce.x*te.x+ce.y*te.y,ye=0!==ve?1/ve:1/0,we=2*Math.sqrt(2-2*ve),Fe=ve<sC&&z&&j,ke=W.x*te.y-W.y*te.x>0;if(Fe&&re>T){const Oe=R.dist(z);if(Oe>2*S){const qe=R.sub(R.sub(z)._mult(S/Oe)._round());this.updateDistance(z,qe),this.addCurrentVertex(qe,W,0,0,N),z=qe}}const it=z&&j;let Ge=it?u:w?"butt":h;if(it&&"round"===Ge&&(ye<v?Ge="miter":ye<=2&&(Ge="fakeround")),"miter"===Ge&&ye>g&&(Ge="bevel"),"bevel"===Ge&&(ye>2&&(Ge="flipbevel"),ye<g&&(Ge="miter")),z&&this.updateDistance(z,R),"miter"===Ge)ce._mult(ye),this.addCurrentVertex(R,ce,0,0,N);else if("flipbevel"===Ge){if(ye>100)ce=te.mult(-1);else{const Oe=ye*W.add(te).mag()/W.sub(te).mag();ce._perp()._mult(Oe*(ke?-1:1))}this.addCurrentVertex(R,ce,0,0,N),this.addCurrentVertex(R,ce.mult(-1),0,0,N)}else if("bevel"===Ge||"fakeround"===Ge){const Oe=-Math.sqrt(ye*ye-1),qe=ke?Oe:0,We=ke?0:Oe;if(z&&this.addCurrentVertex(R,W,qe,We,N),"fakeround"===Ge){const ze=Math.round(180*we/Math.PI/20);for(let ot=1;ot<ze;ot++){let dt=ot/ze;if(.5!==dt){const Ln=dt-.5;dt+=dt*Ln*(dt-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Ln*Ln+(.848013+me*(.215638*me-1.06021)))}const kt=te.sub(W)._mult(dt)._add(W)._unit()._mult(ke?-1:1);this.addHalfVertex(R,kt.x,kt.y,!1,ke,0,N)}}j&&this.addCurrentVertex(R,te,-qe,-We,N)}else if("butt"===Ge)this.addCurrentVertex(R,ce,0,0,N);else if("square"===Ge){const Oe=z?1:-1;z||this.addCurrentVertex(R,ce,Oe,Oe,N),this.addCurrentVertex(R,ce,0,0,N),z&&this.addCurrentVertex(R,ce,Oe,Oe,N)}else"round"===Ge&&(z&&(this.addCurrentVertex(R,W,0,0,N),this.addCurrentVertex(R,W,1,1,N,!0)),j&&(this.addCurrentVertex(R,te,-1,-1,N,!0),this.addCurrentVertex(R,te,0,0,N)));if(Fe&&re<D-1){const Oe=R.dist(j);if(Oe>2*S){const qe=R.add(j.sub(R)._mult(S/Oe)._round());this.updateDistance(R,qe),this.addCurrentVertex(qe,te,0,0,N),R=qe}}}}addCurrentVertex(r,l,u,h,g,v=!1){const w=l.y*h-l.x,D=-l.y-l.x*h;this.addHalfVertex(r,l.x+l.y*u,l.y-l.x*u,v,!1,u,g),this.addHalfVertex(r,w,D,v,!0,-h,g)}addHalfVertex({x:r,y:l},u,h,g,v,w,D){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),D.primitiveLength++),v?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}st("LineBucket",hh,{omit:["layers","patternFeatures"]});const f1=new Ne({"line-cap":new le(be.layout_line["line-cap"]),"line-join":new le(be.layout_line["line-join"]),"line-miter-limit":new J(be.layout_line["line-miter-limit"]),"line-round-limit":new J(be.layout_line["line-round-limit"]),"line-sort-key":new le(be.layout_line["line-sort-key"])});var dy={paint:new Ne({"line-opacity":new le(be.paint_line["line-opacity"]),"line-color":new le(be.paint_line["line-color"]),"line-translate":new J(be.paint_line["line-translate"]),"line-translate-anchor":new J(be.paint_line["line-translate-anchor"]),"line-width":new le(be.paint_line["line-width"]),"line-gap-width":new le(be.paint_line["line-gap-width"]),"line-offset":new le(be.paint_line["line-offset"]),"line-blur":new le(be.paint_line["line-blur"]),"line-dasharray":new fe(be.paint_line["line-dasharray"]),"line-pattern":new fe(be.paint_line["line-pattern"]),"line-gradient":new Me(be.paint_line["line-gradient"])}),layout:f1};const hy=new class extends le{possiblyEvaluate(a,r){return r=new B(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,l,u){return r=Qi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,l,u)}}(dy.paint.properties["line-width"].specification);function iu(a,r){return r>0?r+2*a:a}hy.useIntegerZoom=!0;const Ea=Te([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),aC=Te([{name:"a_projected_pos",components:3,type:"Float32"}],4);Te([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lC=Te([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fy=Te([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const p1=Te([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ss=Te([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Te([{name:"triangle",components:3,type:"Uint16"}]),Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Te([{type:"Float32",name:"offsetX"}]),Te([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ns=128;function Lm(a,r){const{expression:l}=r;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new B(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:h}=l;let g=0;for(;g<u.length&&u[g]<=a;)g++;g=Math.max(0,g-1);let v=g;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const w=u[g],D=u[v];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:D,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:D,minSize:l.evaluate(new B(w)),maxSize:l.evaluate(new B(D)),interpolationType:h}}}function fh(a,{uSize:r,uSizeT:l},{lowerSize:u,upperSize:h}){return"source"===a.kind?u/Ns:"composite"===a.kind?pt(u/Ns,h/Ns,l):r}function Ta(a,r){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:h,minZoom:g,maxZoom:v}=a,w=h?Sn(io.interpolationFactor(h,r,g,v),0,1):0;"camera"===a.kind?u=pt(a.minSize,a.maxSize,w):l=w}return{uSizeT:l,uSize:u}}var py=Object.freeze({__proto__:null,getSizeData:Lm,evaluateSizeForFeature:fh,evaluateSizeForZoom:Ta,SIZE_PACK_FACTOR:Ns});function my(a,r,l){return a.sections.forEach(u=>{u.text=function(h,g,v){const w=g.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?h=h.toLocaleUpperCase():"lowercase"===w&&(h=h.toLocaleLowerCase()),O.applyArabicShaping&&(h=O.applyArabicShaping(h)),h}(u.text,r,l)}),a}const ru={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Bm(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function gy(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var m1=function(a,r,l,u,h){var g,v,w=8*h-u-1,D=(1<<w)-1,T=D>>1,S=-7,N=l?h-1:0,R=l?-1:1,z=a[r+N];for(N+=R,g=z&(1<<-S)-1,z>>=-S,S+=w;S>0;g=256*g+a[r+N],N+=R,S-=8);for(v=g&(1<<-S)-1,g>>=-S,S+=u;S>0;v=256*v+a[r+N],N+=R,S-=8);if(0===g)g=1-T;else{if(g===D)return v?NaN:1/0*(z?-1:1);v+=Math.pow(2,u),g-=T}return(z?-1:1)*v*Math.pow(2,g-u)},ou=function(a,r,l,u,h,g){var v,w,D,T=8*g-h-1,S=(1<<T)-1,N=S>>1,R=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,z=u?0:g-1,j=u?1:-1,W=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(w=isNaN(r)?1:0,v=S):(v=Math.floor(Math.log(r)/Math.LN2),r*(D=Math.pow(2,-v))<1&&(v--,D*=2),(r+=v+N>=1?R/D:R*Math.pow(2,1-N))*D>=2&&(v++,D/=2),v+N>=S?(w=0,v=S):v+N>=1?(w=(r*D-1)*Math.pow(2,h),v+=N):(w=r*Math.pow(2,N-1)*Math.pow(2,h),v=0));h>=8;a[l+z]=255&w,z+=j,w/=256,h-=8);for(v=v<<h|w,T+=h;T>0;a[l+z]=255&v,z+=j,v/=256,T-=8);a[l+z-j]|=128*W},su=Fn;function Fn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Fn.Varint=0,Fn.Fixed64=1,Fn.Bytes=2,Fn.Fixed32=5;var Vm=4294967296,$f=1/Vm,_y="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function dl(a){return a.type===Fn.Bytes?a.readVarint()+a.pos:a.pos+1}function yy(a,r,l){var u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(u);for(var h=l.pos-1;h>=a;h--)l.buf[h+u]=l.buf[h]}function g1(a,r){for(var l=0;l<a.length;l++)r.writeVarint(a[l])}function _1(a,r){for(var l=0;l<a.length;l++)r.writeSVarint(a[l])}function vy(a,r){for(var l=0;l<a.length;l++)r.writeFloat(a[l])}function zm(a,r){for(var l=0;l<a.length;l++)r.writeDouble(a[l])}function by(a,r){for(var l=0;l<a.length;l++)r.writeBoolean(a[l])}function Um(a,r){for(var l=0;l<a.length;l++)r.writeFixed32(a[l])}function y1(a,r){for(var l=0;l<a.length;l++)r.writeSFixed32(a[l])}function v1(a,r){for(var l=0;l<a.length;l++)r.writeFixed64(a[l])}function xy(a,r){for(var l=0;l<a.length;l++)r.writeSFixed64(a[l])}function ph(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function Ps(a,r,l){a[l]=r,a[l+1]=r>>>8,a[l+2]=r>>>16,a[l+3]=r>>>24}function jm(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function wy(a,r,l){r.glyphs=[],1===a&&l.readMessage(b1,r)}function b1(a,r,l){if(3===a){const{id:u,bitmap:h,width:g,height:v,left:w,top:D,advance:T}=l.readMessage(Hf,{});r.glyphs.push({id:u,bitmap:new Nr({width:g+6,height:v+6},h),metrics:{width:g,height:v,left:w,top:D,advance:T}})}else 4===a?r.ascender=l.readSVarint():5===a&&(r.descender=l.readSVarint())}function Hf(a,r,l){1===a?r.id=l.readVarint():2===a?r.bitmap=l.readBytes():3===a?r.width=l.readVarint():4===a?r.height=l.readVarint():5===a?r.left=l.readSVarint():6===a?r.top=l.readSVarint():7===a&&(r.advance=l.readVarint())}function $m(a){let r=0,l=0;for(const v of a)r+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,w)=>w.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let h=0,g=0;for(const v of a)for(let w=u.length-1;w>=0;w--){const D=u[w];if(!(v.w>D.w||v.h>D.h)){if(v.x=D.x,v.y=D.y,g=Math.max(g,v.y+v.h),h=Math.max(h,v.x+v.w),v.w===D.w&&v.h===D.h){const T=u.pop();w<u.length&&(u[w]=T)}else v.h===D.h?(D.x+=v.w,D.w-=v.w):v.w===D.w?(D.y+=v.h,D.h-=v.h):(u.push({x:D.x+v.w,y:D.y,w:D.w-v.w,h:v.h}),D.y+=v.h,D.h-=v.h);break}}return{w:h,h:g,fill:r/(h*g)||0}}Fn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),h=u>>3,g=this.pos;this.type=7&u,a(h,r,this),this.pos===g&&this.skip(u)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=ph(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=jm(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=ph(this.buf,this.pos)+ph(this.buf,this.pos+4)*Vm;return this.pos+=8,a},readSFixed64:function(){var a=ph(this.buf,this.pos)+jm(this.buf,this.pos+4)*Vm;return this.pos+=8,a},readFloat:function(){var a=m1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=m1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,l,u=this.buf;return r=127&(l=u[this.pos++]),l<128?r:(r|=(127&(l=u[this.pos++]))<<7,l<128?r:(r|=(127&(l=u[this.pos++]))<<14,l<128?r:(r|=(127&(l=u[this.pos++]))<<21,l<128?r:function(h,g,v){var w,D,T=v.buf;if(w=(112&(D=T[v.pos++]))>>4,D<128||(w|=(127&(D=T[v.pos++]))<<3,D<128)||(w|=(127&(D=T[v.pos++]))<<10,D<128)||(w|=(127&(D=T[v.pos++]))<<17,D<128)||(w|=(127&(D=T[v.pos++]))<<24,D<128)||(w|=(1&(D=T[v.pos++]))<<31,D<128))return function(a,r,l){return l?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}(h,w,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&_y?_y.decode(this.buf.subarray(r,a)):function(l,u,h){for(var g="",v=u;v<h;){var w,D,T,S=l[v],N=null,R=S>239?4:S>223?3:S>191?2:1;if(v+R>h)break;1===R?S<128&&(N=S):2===R?128==(192&(w=l[v+1]))&&(N=(31&S)<<6|63&w)<=127&&(N=null):3===R?(D=l[v+2],128==(192&(w=l[v+1]))&&128==(192&D)&&((N=(15&S)<<12|(63&w)<<6|63&D)<=2047||N>=55296&&N<=57343)&&(N=null)):4===R&&(D=l[v+2],T=l[v+3],128==(192&(w=l[v+1]))&&128==(192&D)&&128==(192&T)&&((N=(15&S)<<18|(63&w)<<12|(63&D)<<6|63&T)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,R=1):N>65535&&(N-=65536,g+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),g+=String.fromCharCode(N),v+=R}return g}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==Fn.Bytes)return a.push(this.readVarint(r));var l=dl(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==Fn.Bytes)return a.push(this.readSVarint());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Fn.Bytes)return a.push(this.readBoolean());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Fn.Bytes)return a.push(this.readFloat());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Fn.Bytes)return a.push(this.readDouble());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Fn.Bytes)return a.push(this.readFixed32());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Fn.Bytes)return a.push(this.readSFixed32());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Fn.Bytes)return a.push(this.readFixed64());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Fn.Bytes)return a.push(this.readSFixed64());var r=dl(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===Fn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Fn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Fn.Fixed32)this.pos+=4;else{if(r!==Fn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Ps(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Ps(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Ps(this.buf,-1&a,this.pos),Ps(this.buf,Math.floor(a*$f),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Ps(this.buf,-1&a,this.pos),Ps(this.buf,Math.floor(a*$f),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,l){var u,h,g,w;if(r>=0?(u=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(u=~(-r%4294967296))?u=u+1|0:(u=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),g=u,(w=l).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(h,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(u,h,g){for(var v,w,D=0;D<h.length;D++){if((v=h.charCodeAt(D))>55295&&v<57344){if(!w){v>56319||D+1===h.length?(u[g++]=239,u[g++]=191,u[g++]=189):w=v;continue}if(v<56320){u[g++]=239,u[g++]=191,u[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(u[g++]=239,u[g++]=191,u[g++]=189,w=null);v<128?u[g++]=v:(v<2048?u[g++]=v>>6|192:(v<65536?u[g++]=v>>12|224:(u[g++]=v>>18|240,u[g++]=v>>12&63|128),u[g++]=v>>6&63|128),u[g++]=63&v|128)}return g}(this.buf,a,this.pos);var l=this.pos-r;l>=128&&yy(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),ou(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),ou(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,r){this.pos++;var l=this.pos;a(r,this);var u=this.pos-l;u>=128&&yy(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,r,l){this.writeTag(a,Fn.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,g1,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,_1,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,by,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,vy,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,zm,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,Um,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,y1,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,v1,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,xy,r)},writeBytesField:function(a,r){this.writeTag(a,Fn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,Fn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,Fn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,Fn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,Fn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,Fn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,Fn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,Fn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,Fn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,Fn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,Boolean(r))}};class Gf{constructor(r,{pixelRatio:l,version:u,stretchX:h,stretchY:g,content:v}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=h,this.stretchY=g,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hm{constructor(r,l){const u={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,u,g),this.addImages(l,h,g);const{w:v,h:w}=$m(g),D=new Pr({width:v||1,height:w||1});for(const T in r){const S=r[T],N=u[T].paddedRect;Pr.copy(S.data,D,{x:0,y:0},{x:N.x+1,y:N.y+1},S.data)}for(const T in l){const S=l[T],N=h[T].paddedRect,R=N.x+1,z=N.y+1,j=S.data.width,W=S.data.height;Pr.copy(S.data,D,{x:0,y:0},{x:R,y:z},S.data),Pr.copy(S.data,D,{x:0,y:W-1},{x:R,y:z-1},{width:j,height:1}),Pr.copy(S.data,D,{x:0,y:0},{x:R,y:z+W},{width:j,height:1}),Pr.copy(S.data,D,{x:j-1,y:0},{x:R-1,y:z},{width:1,height:W}),Pr.copy(S.data,D,{x:0,y:0},{x:R+j,y:z},{width:1,height:W})}this.image=D,this.iconPositions=u,this.patternPositions=h}addImages(r,l,u){for(const h in r){const g=r[h],v={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(v),l[h]=new Gf(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,l){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in r.updatedImages)this.patchUpdatedImage(this.iconPositions[u],r.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],r.getImage(u),l)}patchUpdatedImage(r,l,u){if(!r||!l||r.version===l.version)return;r.version=l.version;const[h,g]=r.tl;u.update(l.data,void 0,{x:h,y:g})}}st("ImagePosition",Gf),st("ImageAtlas",Hm);const Uo={horizontal:1,vertical:2,horizontalOnly:3};class au{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const u=new au;return u.scale=r||1,u.fontStack=l,u}static forImage(r){const l=new au;return l.imageName=r,l}}class lu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const u=new lu;for(let h=0;h<r.sections.length;h++){const g=r.sections[h];g.image?u.addImageSection(g):u.addTextSection(g,l)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(l,u){let h="";for(let g=0;g<l.length;g++){const v=l.charCodeAt(g+1)||null,w=l.charCodeAt(g-1)||null;h+=!u&&(v&&Es(v)&&!ru[l[g+1]]||w&&Es(w)&&!ru[l[g-1]])||!ru[l[g]]?l[g]:ru[l[g]]}return h}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&cu[this.text.charCodeAt(u)];u++)r++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&cu[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const u=new lu;return u.text=this.text.substring(r,l),u.sectionIndex=this.sectionIndex.slice(r,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(au.forText(r.scale,r.fontStack||l));const u=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(u)}addImageSection(r){const l=r.image?r.image.name:"";if(0===l.length)return void ri("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(au.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function td(a,r,l,u,h,g,v,w,D,T,S,N,R,z,j,W){const te=lu.fromFeature(a,h);let re;N===Uo.vertical&&te.verticalizePunctuation(R);const{processBidirectionalText:ce,processStyledBidirectionalText:me}=O;if(ce&&1===te.sections.length){re=[];const we=ce(te.toString(),Wf(te,T,g,r,u,z,j));for(const Fe of we){const ke=new lu;ke.text=Fe,ke.sections=te.sections;for(let it=0;it<Fe.length;it++)ke.sectionIndex.push(0);re.push(ke)}}else if(me){re=[];const we=me(te.text,te.sectionIndex,Wf(te,T,g,r,u,z,j));for(const Fe of we){const ke=new lu;ke.text=Fe[0],ke.sectionIndex=Fe[1],ke.sections=te.sections,re.push(ke)}}else re=function(we,Fe){const ke=[],it=we.text;let Ge=0;for(const Oe of Fe)ke.push(we.substring(Ge,Oe)),Ge=Oe;return Ge<it.length&&ke.push(we.substring(Ge,it.length)),ke}(te,Wf(te,T,g,r,u,z,j));const ve=[],ye={positionedLines:ve,text:te.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(we,Fe,ke,it,Ge,Oe,qe,We,ze,ot,dt,kt){let Ln=0,Nt=0,Dn=0;const tt="right"===We?1:"left"===We?0:.5;let Un=!1;for(const Nn of Ge){const yt=Nn.getSections();for(const Zn of yt){if(Zn.imageName)continue;const Fr=Fe[Zn.fontStack];if(Fr&&(Un=void 0!==Fr.ascender&&void 0!==Fr.descender,!Un))break}if(!Un)break}let bn=0;for(const Nn of Ge){Nn.trim();const yt=Nn.getMaxScale(),Zn=24*(yt-1),Fr={positionedGlyphs:[],lineOffset:0};we.positionedLines[bn]=Fr;const jn=Fr.positionedGlyphs;let Pi=0;if(!Nn.length()){Nt+=Oe,++bn;continue}let rr=0,fi=0;for(let $n=0;$n<Nn.length();$n++){const Ti=Nn.getSection($n),Mi=Nn.getSectionIndex($n),pi=Nn.getCharCode($n);let ui=Ti.scale,Zi=null,Hn=null,Xi=null,as=24,$o=0;const ls=!(ze===Uo.horizontal||!dt&&!Wd(pi)||dt&&(cu[pi]||(ki=pi,ff(ki)||pf(ki)||Pu(ki)||Lo(ki)||rc(ki))));if(Ti.imageName){const Ho=it[Ti.imageName];if(!Ho)continue;Xi=Ti.imageName,we.iconsInText=we.iconsInText||!0,Hn=Ho.paddedRect;const br=Ho.displaySize;ui=24*ui/kt,Zi={width:br[0],height:br[1],left:1,top:-3,advance:ls?br[1]:br[0],localGlyph:!1},$o=Un?-Zi.height*ui:24*yt-17-br[1]*ui,as=Zi.advance;const vl=(ls?br[0]:br[1])*ui-24*yt;vl>0&&vl>Pi&&(Pi=vl)}else{const Ho=ke[Ti.fontStack];if(!Ho)continue;Ho[pi]&&(Hn=Ho[pi]);const br=Fe[Ti.fontStack];if(!br)continue;const vl=br.glyphs[pi];if(!vl)continue;if(Zi=vl.metrics,as=8203!==pi?24:0,Un){const cd=void 0!==br.ascender?Math.abs(br.ascender):0,ud=void 0!==br.descender?Math.abs(br.descender):0,dd=(cd+ud)*ui;rr<dd&&(rr=dd,fi=(cd-ud)/2*ui),$o=-cd*ui}else $o=24*(yt-ui)-17}ls?(we.verticalizable=!0,jn.push({glyph:pi,imageName:Xi,x:Ln,y:Nt+$o,vertical:ls,scale:ui,localGlyph:Zi.localGlyph,fontStack:Ti.fontStack,sectionIndex:Mi,metrics:Zi,rect:Hn}),Ln+=as*ui+ot):(jn.push({glyph:pi,imageName:Xi,x:Ln,y:Nt+$o,vertical:ls,scale:ui,localGlyph:Zi.localGlyph,fontStack:Ti.fontStack,sectionIndex:Mi,metrics:Zi,rect:Hn}),Ln+=Zi.advance*ui+ot)}0!==jn.length&&(Dn=Math.max(Ln-ot,Dn),Un?Ey(jn,tt,Pi,fi,Oe*yt/2):Ey(jn,tt,Pi,0,Oe/2)),Ln=0;const mo=Oe*yt+Pi;Fr.lineOffset=Math.max(Pi,Zn),Nt+=mo,++bn}var ki;const Ni=Nt,{horizontalAlign:ir,verticalAlign:hr}=Wm(qe);(function(Nn,yt,Zn,Fr,jn,Pi){const rr=(yt-Zn)*jn,fi=-Pi*Fr;for(const mo of Nn)for(const $n of mo.positionedGlyphs)$n.x+=rr,$n.y+=fi})(we.positionedLines,tt,ir,hr,Dn,Ni),we.top+=-hr*Ni,we.bottom=we.top+Ni,we.left+=-ir*Dn,we.right=we.left+Dn,we.hasBaseline=Un}(ye,r,l,u,re,v,w,D,N,T,R,W),!function(we){for(const Fe of we)if(0!==Fe.positionedGlyphs.length)return!1;return!0}(ve)&&ye}const cu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qf(a,r,l,u,h,g){if(r.imageName){const v=u[r.imageName];return v?v.displaySize[0]*r.scale*24/g+h:0}{const v=l[r.fontStack],w=v&&v.glyphs[a];return w?w.metrics.advance*r.scale+h:0}}function Gm(a,r,l,u){const h=Math.pow(a-r,2);return u?a<r?h/2:2*h:h+Math.abs(l)*l}function qm(a,r,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==r&&65289!==r||(u+=50),u}function nd(a,r,l,u,h,g){let v=null,w=Gm(r,l,h,g);for(const D of u){const T=Gm(r-D.x,l,h,g)+D.badness;T<=w&&(v=D,w=T)}return{index:a,x:r,priorBreak:v,badness:w}}function Dy(a){return a?Dy(a.priorBreak).concat(a.index):[]}function Wf(a,r,l,u,h,g,v){if("point"!==g)return[];if(!a)return[];const w=[],D=function(R,z,j,W,te,re){let ce=0;for(let me=0;me<R.length();me++){const ve=R.getSection(me);ce+=qf(R.getCharCode(me),ve,W,te,z,re)}return ce/Math.max(1,Math.ceil(ce/j))}(a,r,l,u,h,v),T=a.text.indexOf("\u200b")>=0;let S=0;for(let R=0;R<a.length();R++){const z=a.getSection(R),j=a.getCharCode(R);if(cu[j]||(S+=qf(j,z,u,h,r,v)),R<a.length()-1){const W=!((N=j)<11904||!(Gd(N)||Lu(N)||Hc(N)||mf(N)||qd(N)||Ru(N)||Bu(N)||Ou(N)||zu(N)||Wi(N)||ic(N)||oc(N)||ol(N)||Fu(N)||nc(N)||Vu(N)||sl(N)||gf(N)||ci(N)||Xs(N)));(Cy[j]||W||z.imageName)&&w.push(nd(R+1,S,D,w,qm(j,a.getCharCode(R+1),W&&T),!1))}}var N;return Dy(nd(a.length(),S,D,w,0,!0))}function Wm(a){let r=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function Ey(a,r,l,u,h){if(!(r||l||u||h))return;const g=a.length-1,v=a[g],w=(v.x+v.metrics.advance*v.scale)*r;for(let D=0;D<=g;D++)a[D].x-=w,a[D].y+=l+u+h}function Ty(a,r,l){const{horizontalAlign:u,verticalAlign:h}=Wm(l),g=r[0]-a.displaySize[0]*u,v=r[1]-a.displaySize[1]*h;return{image:a,top:v,bottom:v+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function Zf(a,r,l,u,h,g){const v=a.image;let w;if(v.content){const te=v.content,re=v.pixelRatio||1;w=[te[0]/re,te[1]/re,v.displaySize[0]-te[2]/re,v.displaySize[1]-te[3]/re]}const D=r.left*g,T=r.right*g;let S,N,R,z;"width"===l||"both"===l?(z=h[0]+D-u[3],N=h[0]+T+u[1]):(z=h[0]+(D+T-v.displaySize[0])/2,N=z+v.displaySize[0]);const j=r.top*g,W=r.bottom*g;return"height"===l||"both"===l?(S=h[1]+j-u[0],R=h[1]+W+u[2]):(S=h[1]+(j+W-v.displaySize[1])/2,R=S+v.displaySize[1]),{image:v,top:S,right:N,bottom:R,left:z,collisionPadding:w}}class hl extends $e{constructor(r,l,u,h,g){super(r,l),this.angle=h,this.z=u,void 0!==g&&(this.segment=g)}clone(){return new hl(this.x,this.y,this.z,this.angle,this.segment)}}function x1(a,r,l,u,h){if(void 0===r.segment)return!0;let g=r,v=r.segment+1,w=0;for(;w>-l/2;){if(v--,v<0)return!1;w-=a[v].dist(g),g=a[v]}w+=a[v].dist(a[v+1]),v++;const D=[];let T=0;for(;w<l/2;){const S=a[v],N=a[v+1];if(!N)return!1;let R=a[v-1].angleTo(S)-S.angleTo(N);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:w,angleDelta:R}),T+=R;w-D[0].distance>u;)T-=D.shift().angleDelta;if(T>h)return!1;v++,w+=S.dist(N)}return!0}function Zm(a){let r=0;for(let l=0;l<a.length-1;l++)r+=a[l].dist(a[l+1]);return r}function My(a,r,l){return a?.6*r*l:0}function Xm(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function w1(a,r,l,u,h,g){const v=My(l,h,g),w=Xm(l,u)*g;let D=0;const T=Zm(a)/2;for(let S=0;S<a.length-1;S++){const N=a[S],R=a[S+1],z=N.dist(R);if(D+z>T){const j=(T-D)/z,W=pt(N.x,R.x,j),te=pt(N.y,R.y,j),re=new hl(W,te,0,R.angleTo(N),S);return!v||x1(a,re,w,v,r)?re:void 0}D+=z}}function C1(a,r,l,u,h,g,v,w,D){const T=My(u,g,v),S=Xm(u,h),N=S*v,R=0===a[0].x||a[0].x===D||0===a[0].y||a[0].y===D;return r-N<r/4&&(r=N+r/4),Rs(a,R?r/2*w%r:(S/2+2*g)*v*w%r,r,T,l,N,R,!1,D)}function Rs(a,r,l,u,h,g,v,w,D){const T=g/2,S=Zm(a);let N=0,R=r-l,z=[];for(let j=0;j<a.length-1;j++){const W=a[j],te=a[j+1],re=W.dist(te),ce=te.angleTo(W);for(;R+l<N+re;){R+=l;const me=(R-N)/re,ve=pt(W.x,te.x,me),ye=pt(W.y,te.y,me);if(ve>=0&&ve<D&&ye>=0&&ye<D&&R-T>=0&&R+T<=S){const we=new hl(ve,ye,0,ce,j);we._round(),u&&!x1(a,we,g,u,h)||z.push(we)}}N+=re}return w||z.length||v||(z=Rs(a,N/2,l,u,h,g,v,!0,D)),z}function Iy(a,r,l,u,h){const g=[];for(let v=0;v<a.length;v++){const w=a[v];let D;for(let T=0;T<w.length-1;T++){let S=w[T],N=w[T+1];S.x<r&&N.x<r||(S.x<r?S=new $e(r,S.y+(r-S.x)/(N.x-S.x)*(N.y-S.y))._round():N.x<r&&(N=new $e(r,S.y+(r-S.x)/(N.x-S.x)*(N.y-S.y))._round()),S.y<l&&N.y<l||(S.y<l?S=new $e(S.x+(l-S.y)/(N.y-S.y)*(N.x-S.x),l)._round():N.y<l&&(N=new $e(S.x+(l-S.y)/(N.y-S.y)*(N.x-S.x),l)._round()),S.x>=u&&N.x>=u||(S.x>=u?S=new $e(u,S.y+(u-S.x)/(N.x-S.x)*(N.y-S.y))._round():N.x>=u&&(N=new $e(u,S.y+(u-S.x)/(N.x-S.x)*(N.y-S.y))._round()),S.y>=h&&N.y>=h||(S.y>=h?S=new $e(S.x+(h-S.y)/(N.y-S.y)*(N.x-S.x),h)._round():N.y>=h&&(N=new $e(S.x+(h-S.y)/(N.y-S.y)*(N.x-S.x),h)._round()),D&&S.equals(D[D.length-1])||(D=[S],g.push(D)),D.push(N)))))}}return g}st("Anchor",hl);const id=1e20;function Sy(a,r,l,u,h,g,v,w,D){for(let T=r;T<r+u;T++)Ay(a,l*g+T,g,h,v,w,D);for(let T=l;T<l+h;T++)Ay(a,T*g+r,1,u,v,w,D)}function Ay(a,r,l,u,h,g,v){g[0]=0,v[0]=-id,v[1]=id,h[0]=a[r];for(let w=1,D=0,T=0;w<u;w++){h[w]=a[r+w*l];const S=w*w;do{const N=g[D];T=(h[w]-h[N]+S-N*N)/(w-N)/2}while(T<=v[D]&&--D>-1);D++,g[D]=w,v[D]=T,v[D+1]=id}for(let w=0,D=0;w<u;w++){for(;v[D+1]<w;)D++;const T=g[D],S=w-T;a[r+w*l]=h[T]+S*S}}const Ym={none:0,ideographs:1,all:2};class rd{constructor(r,l,u){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const u=[];for(const h in r)for(const g of r[h])u.push({stack:h,id:g});dn(u,({stack:h,id:g},v)=>{let w=this.entries[h];w||(w=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=w.glyphs[g];if(void 0!==D)return void v(null,{stack:h,id:g,glyph:D});if(D=this._tinySDF(w,h,g),D)return w.glyphs[g]=D,void v(null,{stack:h,id:g,glyph:D});const T=Math.floor(g/256);if(256*T>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void v(null,{stack:h,id:g,glyph:D});let S=w.requests[T];S||(S=w.requests[T]=[],rd.loadGlyphRange(h,T,this.url,this.requestManager,(N,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(const z in R.glyphs)this._doesCharSupportLocalGlyph(+z)||(w.glyphs[+z]=R.glyphs[+z]);w.ranges[T]=!0}for(const z of S)z(N,R);delete w.requests[T]})),S.push((N,R)=>{N?v(N):R&&v(null,{stack:h,id:g,glyph:R.glyphs[g]||null})})},(h,g)=>{if(h)l(h);else if(g){const v={};for(const{stack:w,id:D,glyph:T}of g)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[D]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;l(null,v)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Ym.none&&(this.localGlyphMode===Ym.all?!!this.localFontFamily:!!this.localFontFamily&&(Wi(r)||Ys(r)||ol(r)||sl(r))||Ou(r))}_tinySDF(r,l,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let W="400";/bold/i.test(l)?W="900":/medium/i.test(l)?W="500":/light/i.test(l)&&(W="200"),g=r.tinySDF=new rd.TinySDF({fontFamily:h,fontWeight:W,fontSize:48,buffer:6,radius:16}),g.fontWeight=W}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const v=String.fromCharCode(u),{data:w,width:D,height:T,glyphWidth:S,glyphHeight:N,glyphLeft:R,glyphTop:z,glyphAdvance:j}=g.draw(v);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Nr({width:D,height:T},w),metrics:{width:S/2,height:N/2,left:R/2,top:z/2-27,advance:j/2,localGlyph:!0}}}}function Km(a,r,l,u){const h=[],g=a.image,v=g.pixelRatio,w=g.paddedRect.w-2,D=g.paddedRect.h-2,T=a.right-a.left,S=a.bottom-a.top,N=g.stretchX||[[0,w]],R=g.stretchY||[[0,D]],z=(Oe,qe)=>Oe+qe[1]-qe[0],j=N.reduce(z,0),W=R.reduce(z,0),te=w-j,re=D-W;let ce=0,me=j,ve=0,ye=W,we=0,Fe=te,ke=0,it=re;if(g.content&&u){const Oe=g.content;ce=Xf(N,0,Oe[0]),ve=Xf(R,0,Oe[1]),me=Xf(N,Oe[0],Oe[2]),ye=Xf(R,Oe[1],Oe[3]),we=Oe[0]-ce,ke=Oe[1]-ve,Fe=Oe[2]-Oe[0]-me,it=Oe[3]-Oe[1]-ye}const Ge=(Oe,qe,We,ze)=>{const ot=Yf(Oe.stretch-ce,me,T,a.left),dt=zt(Oe.fixed-we,Fe,Oe.stretch,j),kt=Yf(qe.stretch-ve,ye,S,a.top),Ln=zt(qe.fixed-ke,it,qe.stretch,W),Nt=Yf(We.stretch-ce,me,T,a.left),Dn=zt(We.fixed-we,Fe,We.stretch,j),tt=Yf(ze.stretch-ve,ye,S,a.top),Un=zt(ze.fixed-ke,it,ze.stretch,W),bn=new $e(ot,kt),ki=new $e(Nt,kt),Ni=new $e(Nt,tt),ir=new $e(ot,tt),hr=new $e(dt/v,Ln/v),Nn=new $e(Dn/v,Un/v),yt=r*Math.PI/180;if(yt){const jn=Math.sin(yt),Pi=Math.cos(yt),rr=[Pi,-jn,jn,Pi];bn._matMult(rr),ki._matMult(rr),ir._matMult(rr),Ni._matMult(rr)}const Zn=Oe.stretch+Oe.fixed,Fr=qe.stretch+qe.fixed;return{tl:bn,tr:ki,bl:ir,br:Ni,tex:{x:g.paddedRect.x+1+Zn,y:g.paddedRect.y+1+Fr,w:We.stretch+We.fixed-Zn,h:ze.stretch+ze.fixed-Fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hr,pixelOffsetBR:Nn,minFontScaleX:Fe/v/T,minFontScaleY:it/v/S,isSDF:l}};if(u&&(g.stretchX||g.stretchY)){const Oe=ky(N,te,j),qe=ky(R,re,W);for(let We=0;We<Oe.length-1;We++){const ze=Oe[We],ot=Oe[We+1];for(let dt=0;dt<qe.length-1;dt++)h.push(Ge(ze,qe[dt],ot,qe[dt+1]))}}else h.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:D+1}));return h}function Xf(a,r,l){let u=0;for(const h of a)u+=Math.max(r,Math.min(l,h[1]))-Math.max(r,Math.min(l,h[0]));return u}function ky(a,r,l){const u=[{fixed:-1,stretch:0}];for(const[h,g]of a){const v=u[u.length-1];u.push({fixed:h-v.stretch,stretch:v.stretch}),u.push({fixed:h-v.stretch,stretch:v.stretch+(g-h)})}return u.push({fixed:r+1,stretch:l}),u}function Yf(a,r,l,u){return a/r*l+u}function zt(a,r,l,u){return a-r*l/u}function nt(a,r,l,u){const h=r+a.positionedLines[u].lineOffset;return 0===u?l+h/2:l+(h+(r+a.positionedLines[u-1].lineOffset))/2}rd.loadGlyphRange=function(a,r,l,u,h){const g=256*r,v=g+255,w=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${g}-${v}`),Ga.Glyphs);$(w,(D,T)=>{if(D)h(D);else if(T){const S={},N=new su(T).readFields(wy,{});for(const R of N.glyphs)S[R.id]=R;h(null,{glyphs:S,ascender:N.ascender,descender:N.descender})}})},rd.TinySDF=class{constructor({fontSize:a=24,buffer:r=3,radius:l=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}){this.buffer=r,this.cutoff=u,this.radius=l;const w=this.size=a+4*r,D=this._createCanvas(w),T=this.ctx=D.getContext("2d",{willReadFrequently:!0});T.font=`${v} ${g} ${a}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const r=document.createElement("canvas");return r.width=r.height=a,r}draw(a){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(a),v=Math.floor(l),w=Math.min(this.size-this.buffer,Math.ceil(g-h)),D=Math.min(this.size-this.buffer,Math.ceil(l)+Math.ceil(u)),T=w+2*this.buffer,S=D+2*this.buffer,N=T*S,R=new Uint8ClampedArray(N),z={data:R,width:T,height:S,glyphWidth:w,glyphHeight:D,glyphTop:v,glyphLeft:0,glyphAdvance:r};if(0===w||0===D)return z;const{ctx:j,buffer:W,gridInner:te,gridOuter:re}=this;j.clearRect(W,W,w,D),j.fillText(a,W,W+v+1);const ce=j.getImageData(W,W,w,D);re.fill(id,0,N),te.fill(0,0,N);for(let me=0;me<D;me++)for(let ve=0;ve<w;ve++){const ye=ce.data[4*(me*w+ve)+3]/255;if(0===ye)continue;const we=(me+W)*T+ve+W;if(1===ye)re[we]=0,te[we]=id;else{const Fe=.5-ye;re[we]=Fe>0?Fe*Fe:0,te[we]=Fe<0?Fe*Fe:0}}Sy(re,0,0,T,S,T,this.f,this.v,this.z),Sy(te,W,W,w,D,T,this.f,this.v,this.z);for(let me=0;me<N;me++){const ve=Math.sqrt(re[me])-Math.sqrt(te[me]);R[me]=Math.round(255-255*(ve/this.radius+this.cutoff))}return z}};class Ny{constructor(r=[],l=Kf){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:u}=this,h=l[r];for(;r>0;){const g=r-1>>1,v=l[g];if(u(h,v)>=0)break;l[r]=v,r=g}l[r]=h}_down(r){const{data:l,compare:u}=this,h=this.length>>1,g=l[r];for(;r<h;){let v=1+(r<<1),w=l[v];const D=v+1;if(D<this.length&&u(l[D],w)<0&&(v=D,w=l[D]),u(w,g)>=0)break;l[r]=w,r=v}l[r]=g}}function Kf(a,r){return a<r?-1:a>r?1:0}function ea(a,r=1,l=!1){let u=1/0,h=1/0,g=-1/0,v=-1/0;const w=a[0];for(let z=0;z<w.length;z++){const j=w[z];(!z||j.x<u)&&(u=j.x),(!z||j.y<h)&&(h=j.y),(!z||j.x>g)&&(g=j.x),(!z||j.y>v)&&(v=j.y)}const D=Math.min(g-u,v-h);let T=D/2;const S=new Ny([],Py);if(0===D)return new $e(u,h);for(let z=u;z<g;z+=D)for(let j=h;j<v;j+=D)S.push(new od(z+T,j+T,T,a));let N=function(z){let j=0,W=0,te=0;const re=z[0];for(let ce=0,me=re.length,ve=me-1;ce<me;ve=ce++){const ye=re[ce],we=re[ve],Fe=ye.x*we.y-we.x*ye.y;W+=(ye.x+we.x)*Fe,te+=(ye.y+we.y)*Fe,j+=3*Fe}return new od(W/j,te/j,0,z)}(a),R=S.length;for(;S.length;){const z=S.pop();(z.d>N.d||!N.d)&&(N=z,l&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,R)),z.max-N.d<=r||(T=z.h/2,S.push(new od(z.p.x-T,z.p.y-T,T,a)),S.push(new od(z.p.x+T,z.p.y-T,T,a)),S.push(new od(z.p.x-T,z.p.y+T,T,a)),S.push(new od(z.p.x+T,z.p.y+T,T,a)),R+=4)}return l&&(console.log(`num probes: ${R}`),console.log(`best distance: ${N.d}`)),N.p}function Py(a,r){return r.max-a.max}function od(a,r,l,u){this.p=new $e(a,r),this.h=l,this.d=function(h,g){let v=!1,w=1/0;for(let D=0;D<g.length;D++){const T=g[D];for(let S=0,N=T.length,R=N-1;S<N;R=S++){const z=T[S],j=T[R];z.y>h.y!=j.y>h.y&&h.x<(j.x-z.x)*(h.y-z.y)/(j.y-z.y)+z.x&&(v=!v),w=Math.min(w,P_(h,z,j))}}return(v?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const mh=Number.POSITIVE_INFINITY,fl=Math.sqrt(2);function Jf(a,r){return r[1]!==mh?function(l,u,h){let g=0,v=0;switch(u=Math.abs(u),h=Math.abs(h),l){case"top-right":case"top-left":case"top":v=h-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-h}switch(l){case"top-right":case"bottom-right":case"right":g=-u;break;case"top-left":case"bottom-left":case"left":g=u}return[g,v]}(a,r[0],r[1]):function(l,u){let h=0,g=0;u<0&&(u=0);const v=u/fl;switch(l){case"top-right":case"top-left":g=v-7;break;case"bottom-right":case"bottom-left":g=7-v;break;case"bottom":g=7-u;break;case"top":g=u-7}switch(l){case"top-right":case"bottom-right":h=-v;break;case"top-left":case"bottom-left":h=v;break;case"left":h=u;break;case"right":h=-u}return[h,g]}(a,r[0])}function Ry(a,r,l,u,h,g,v,w,D){a.createArrays(),a.tilePixelRatio=fn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const T=a.layers[0].layout,S=a.layers[0]._unevaluatedLayout._values,N={};if("composite"===a.textSizeData.kind){const{minZoom:j,maxZoom:W}=a.textSizeData;N.compositeTextSizes=[S["text-size"].possiblyEvaluate(new B(j),w),S["text-size"].possiblyEvaluate(new B(W),w)]}if("composite"===a.iconSizeData.kind){const{minZoom:j,maxZoom:W}=a.iconSizeData;N.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new B(j),w),S["icon-size"].possiblyEvaluate(new B(W),w)]}N.layoutTextSize=S["text-size"].possiblyEvaluate(new B(D+1),w),N.layoutIconSize=S["icon-size"].possiblyEvaluate(new B(D+1),w),N.textMaxSize=S["text-size"].possiblyEvaluate(new B(18),w);const R="map"===T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement"),z=T.get("text-size");for(const j of a.features){const W=T.get("text-font").evaluate(j,{},w).join(","),te=z.evaluate(j,{},w),re=N.layoutTextSize.evaluate(j,{},w),ce=(N.layoutIconSize.evaluate(j,{},w),{horizontal:{},vertical:void 0}),me=j.text;let ve,ye=[0,0];if(me){const ke=me.toString(),it=24*T.get("text-letter-spacing").evaluate(j,{},w),Ge=24*T.get("text-line-height").evaluate(j,{},w),Oe=sc(ke)?it:0,qe=T.get("text-anchor").evaluate(j,{},w),We=T.get("text-variable-anchor");if(!We){const Nt=T.get("text-radial-offset").evaluate(j,{},w);ye=Nt?Jf(qe,[24*Nt,mh]):T.get("text-offset").evaluate(j,{},w).map(Dn=>24*Dn)}let ze=R?"center":T.get("text-justify").evaluate(j,{},w);const ot=T.get("symbol-placement"),dt="point"===ot,kt="point"===ot?24*T.get("text-max-width").evaluate(j,{},w):0,Ln=Nt=>{a.allowVerticalPlacement&&rs(ke)&&(ce.vertical=td(me,r,l,h,W,kt,Ge,qe,Nt,Oe,ye,Uo.vertical,!0,ot,re,te))};if(!R&&We){const Nt="auto"===ze?We.map(tt=>gh(tt)):[ze];let Dn=!1;for(let tt=0;tt<Nt.length;tt++){const Un=Nt[tt];if(!ce.horizontal[Un])if(Dn)ce.horizontal[Un]=ce.horizontal[0];else{const bn=td(me,r,l,h,W,kt,Ge,"center",Un,Oe,ye,Uo.horizontal,!1,ot,re,te);bn&&(ce.horizontal[Un]=bn,Dn=1===bn.positionedLines.length)}}Ln("left")}else{if("auto"===ze&&(ze=gh(qe)),dt||T.get("text-writing-mode").indexOf("horizontal")>=0||!rs(ke)){const Nt=td(me,r,l,h,W,kt,Ge,qe,ze,Oe,ye,Uo.horizontal,!1,ot,re,te);Nt&&(ce.horizontal[ze]=Nt)}Ln("point"===ot?"left":ze)}}let we=!1;if(j.icon&&j.icon.name){const ke=u[j.icon.name];ke&&(ve=Ty(h[j.icon.name],T.get("icon-offset").evaluate(j,{},w),T.get("icon-anchor").evaluate(j,{},w)),we=ke.sdf,void 0===a.sdfIcons?a.sdfIcons=ke.sdf:a.sdfIcons!==ke.sdf&&ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==a.pixelRatio||0!==T.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Fe=Ma(ce.horizontal)||ce.vertical;a.iconsInText||(a.iconsInText=!!Fe&&Fe.iconsInText),(Fe||ve)&&cC(a,j,ce,ve,u,N,re,0,ye,we,v,w)}g&&a.generateCollisionDebugBuffers(D,a.collisionBoxArray)}function gh(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cC(a,r,l,u,h,g,v,w,D,T,S,N){let R=g.textMaxSize.evaluate(r,{},N);void 0===R&&(R=v);const z=a.layers[0].layout,j=z.get("icon-offset").evaluate(r,{},N),W=Ma(l.horizontal)||l.vertical,te=v/24,re=a.tilePixelRatio*R/24,ce=a.tilePixelRatio*z.get("symbol-spacing"),me=z.get("text-padding")*a.tilePixelRatio,ve=z.get("icon-padding")*a.tilePixelRatio,ye=Mt(z.get("text-max-angle")),we="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),Fe="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),ke=z.get("symbol-placement"),it=ce/2,Ge=z.get("icon-text-fit");let Oe;u&&"none"!==Ge&&(a.allowVerticalPlacement&&l.vertical&&(Oe=Zf(u,l.vertical,Ge,z.get("icon-text-fit-padding"),j,te)),W&&(u=Zf(u,W,Ge,z.get("icon-text-fit-padding"),j,te)));const qe=(We,ze)=>{ze.x<0||ze.x>=fn||ze.y<0||ze.y>=fn||function(ot,dt,kt,Ln,Nt,Dn,tt,Un,bn,ki,Ni,ir,hr,Nn,yt,Zn,Fr,jn,Pi,rr,fi,mo,$n,Ti,Mi){const pi=ot.addToLineVertexArray(dt,Ln);let ui,Zi,Hn,Xi,as,$o,ls,Ho=0,br=0,vl=0,cd=0,ud=-1,dd=-1;const na={};let V1=vf(""),hp=0,_g=0;if(void 0===bn._unevaluatedLayout.getValue("text-radial-offset")?[hp,_g]=bn.layout.get("text-offset").evaluate(fi,{},Mi).map(Kr=>24*Kr):(hp=24*bn.layout.get("text-radial-offset").evaluate(fi,{},Mi),_g=mh),ot.allowVerticalPlacement&&Nt.vertical){const Kr=Nt.vertical;if(yt)$o=sd(Kr),Un&&(ls=sd(Un));else{const Go=bn.layout.get("text-rotate").evaluate(fi,{},Mi)+90;Hn=uu(ki,kt,dt,Ni,ir,hr,Kr,Nn,Go,Zn),Un&&(Xi=uu(ki,kt,dt,Ni,ir,hr,Un,jn,Go))}}if(Dn){const Kr=bn.layout.get("icon-rotate").evaluate(fi,{},Mi),Go="none"!==bn.layout.get("icon-text-fit"),hd=Km(Dn,Kr,$n,Go),fp=Un?Km(Un,Kr,$n,Go):void 0;Zi=uu(ki,kt,dt,Ni,ir,hr,Dn,jn,Kr),Ho=4*hd.length;const z1=ot.iconSizeData;let Or=null;"source"===z1.kind?(Or=[Ns*bn.layout.get("icon-size").evaluate(fi,{},Mi)],Or[0]>pl&&ri(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===z1.kind&&(Or=[Ns*mo.compositeIconSizes[0].evaluate(fi,{},Mi),Ns*mo.compositeIconSizes[1].evaluate(fi,{},Mi)],(Or[0]>pl||Or[1]>pl)&&ri(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,hd,Or,rr,Pi,fi,!1,kt,dt,pi.lineStartIndex,pi.lineLength,-1,Ti,Mi),ud=ot.icon.placedSymbolArray.length-1,fp&&(br=4*fp.length,ot.addSymbols(ot.icon,fp,Or,rr,Pi,fi,Uo.vertical,kt,dt,pi.lineStartIndex,pi.lineLength,-1,Ti,Mi),dd=ot.icon.placedSymbolArray.length-1)}for(const Kr in Nt.horizontal){const Go=Nt.horizontal[Kr];ui||(V1=vf(Go.text),yt?as=sd(Go):ui=uu(ki,kt,dt,Ni,ir,hr,Go,Nn,bn.layout.get("text-rotate").evaluate(fi,{},Mi),Zn));const hd=1===Go.positionedLines.length;if(vl+=D1(ot,kt,dt,Go,tt,bn,yt,fi,Zn,pi,Nt.vertical?Uo.horizontal:Uo.horizontalOnly,hd?Object.keys(Nt.horizontal):[Kr],na,ud,mo,Ti,Mi),hd)break}Nt.vertical&&(cd+=D1(ot,kt,dt,Nt.vertical,tt,bn,yt,fi,Zn,pi,Uo.vertical,["vertical"],na,dd,mo,Ti,Mi));let pc=-1;const Jy=(Kr,Go)=>Kr?Math.max(Kr,Go):Go;pc=Jy(as,pc),pc=Jy($o,pc),pc=Jy(ls,pc);const _C=pc>-1?1:0;ot.glyphOffsetArray.length>=ml.MAX_GLYPHS&&ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==fi.sortKey&&ot.addToSortKeyRanges(ot.symbolInstances.length,fi.sortKey),ot.symbolInstances.emplaceBack(kt.x,kt.y,kt.z,dt.x,dt.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical>=0?na.vertical:-1,ud,dd,V1,void 0!==ui?ui:ot.collisionBoxArray.length,void 0!==ui?ui+1:ot.collisionBoxArray.length,void 0!==Hn?Hn:ot.collisionBoxArray.length,void 0!==Hn?Hn+1:ot.collisionBoxArray.length,void 0!==Zi?Zi:ot.collisionBoxArray.length,void 0!==Zi?Zi+1:ot.collisionBoxArray.length,Xi||ot.collisionBoxArray.length,Xi?Xi+1:ot.collisionBoxArray.length,Ni,vl,cd,Ho,br,_C,0,hp,_g,pc)}(a,ze,ze,We,l,u,h,Oe,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,me,we,D,0,ve,Fe,j,r,g,T,S,N)};if("line"===ke)for(const We of Iy(r.geometry,0,0,fn,fn)){const ze=C1(We,ce,ye,l.vertical||W,u,24,re,a.overscaling,fn);for(const ot of ze){const dt=W;dt&&Jm(a,dt.text,it,ot)||qe(We,ot)}}else if("line-center"===ke){for(const We of r.geometry)if(We.length>1){const ze=w1(We,ye,l.vertical||W,u,24,re);ze&&qe(We,ze)}}else if("Polygon"===r.type)for(const We of Bf(r.geometry,0)){const ze=ea(We,16);qe(We[0],new hl(ze.x,ze.y,0,0,void 0))}else if("LineString"===r.type)for(const We of r.geometry)qe(We,new hl(We[0].x,We[0].y,0,0,void 0));else if("Point"===r.type)for(const We of r.geometry)for(const ze of We)qe([ze],new hl(ze.x,ze.y,0,0,void 0))}const pl=32640;function D1(a,r,l,u,h,g,v,w,D,T,S,N,R,z,j,W,te){const re=function(ve,ye,we,Fe,ke,it,Ge,Oe){const qe=[];if(0===ye.positionedLines.length)return qe;const We=Fe.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,ze=function(Nt){const Dn=Nt[0],tt=Nt[1],Un=Dn*tt;return Un>0?[Dn,-tt]:Un<0?[-Dn,tt]:0===Dn?[tt,Dn]:[tt,-Dn]}(we);let ot=Math.abs(ye.top-ye.bottom);for(const Nt of ye.positionedLines)ot-=Nt.lineOffset;const dt=ye.positionedLines.length,kt=ot/dt;let Ln=ye.top-we[1];for(let Nt=0;Nt<dt;++Nt){const Dn=ye.positionedLines[Nt];Ln=nt(ye,kt,Ln,Nt);for(const tt of Dn.positionedGlyphs){if(!tt.rect)continue;const Un=tt.rect||{};let bn=4,ki=!0,Ni=1,ir=0;if(tt.imageName){const Hn=Ge[tt.imageName];if(!Hn)continue;if(Hn.sdf){ri("SDF images are not supported in formatted text and will be ignored.");continue}ki=!1,Ni=Hn.pixelRatio,bn=1/Ni}const hr=(ke||Oe)&&tt.vertical,Nn=tt.metrics.advance*tt.scale/2,yt=tt.metrics,Zn=tt.rect;if(null===Zn)continue;Oe&&ye.verticalizable&&(ir=tt.imageName?Nn-tt.metrics.width*tt.scale/2:0);const Fr=ke?[tt.x+Nn,tt.y]:[0,0];let jn=[0,0],Pi=[0,0],rr=!1;ke||(hr?(Pi=[tt.x+Nn+ze[0],tt.y+ze[1]-ir],rr=!0):jn=[tt.x+Nn+we[0],tt.y+we[1]-ir]);const fi=Zn.w*tt.scale/(Ni*(tt.localGlyph?2:1)),mo=Zn.h*tt.scale/(Ni*(tt.localGlyph?2:1));let $n,Ti,Mi,pi;if(hr){const Hn=tt.y-Ln,Xi=new $e(-Nn,Nn-Hn),as=-Math.PI/2,$o=new $e(...Pi);$n=new $e(-Nn+jn[0],jn[1]),$n._rotateAround(as,Xi)._add($o),$n.x+=-Hn+Nn,$n.y-=(yt.left-bn)*tt.scale;const ls=tt.imageName?yt.advance*tt.scale:24*tt.scale,Ho=String.fromCharCode(tt.glyph);Bm(Ho)?$n.x+=(1-bn)*tt.scale:gy(Ho)?$n.x+=ls-yt.height*tt.scale+(-bn-1)*tt.scale:$n.x+=tt.imageName||yt.width+2*bn===Zn.w&&yt.height+2*bn===Zn.h?(ls-mo)/2:(ls-(yt.height+2*bn)*tt.scale)/2,Ti=new $e($n.x,$n.y-fi),Mi=new $e($n.x+mo,$n.y),pi=new $e($n.x+mo,$n.y-fi)}else{const Hn=(yt.left-bn)*tt.scale-Nn+jn[0],Xi=(-yt.top-bn)*tt.scale+jn[1],as=Hn+fi,$o=Xi+mo;$n=new $e(Hn,Xi),Ti=new $e(as,Xi),Mi=new $e(Hn,$o),pi=new $e(as,$o)}if(We){let Hn;Hn=ke?new $e(0,0):rr?new $e(ze[0],ze[1]):new $e(we[0],we[1]),$n._rotateAround(We,Hn),Ti._rotateAround(We,Hn),Mi._rotateAround(We,Hn),pi._rotateAround(We,Hn)}const ui=new $e(0,0),Zi=new $e(0,0);qe.push({tl:$n,tr:Ti,bl:Mi,br:pi,tex:Un,writingMode:ye.writingMode,glyphOffset:Fr,sectionIndex:tt.sectionIndex,isSDF:ki,pixelOffsetTL:ui,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}}return qe}(0,u,D,g,v,w,h,a.allowVerticalPlacement),ce=a.textSizeData;let me=null;"source"===ce.kind?(me=[Ns*g.layout.get("text-size").evaluate(w,{},te)],me[0]>pl&&ri(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ce.kind&&(me=[Ns*j.compositeTextSizes[0].evaluate(w,{},te),Ns*j.compositeTextSizes[1].evaluate(w,{},te)],(me[0]>pl||me[1]>pl)&&ri(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,re,me,D,v,w,S,r,l,T.lineStartIndex,T.lineLength,z,W,te);for(const ve of N)R[ve]=a.text.placedSymbolArray.length-1;return 4*re.length}function Ma(a){for(const r in a)return a[r];return null}function uu(a,r,l,u,h,g,v,w,D,T){let S=v.top,N=v.bottom,R=v.left,z=v.right;const j=v.collisionPadding;if(j&&(R-=j[0],S-=j[1],z+=j[2],N+=j[3]),D){const W=new $e(R,S),te=new $e(z,S),re=new $e(R,N),ce=new $e(z,N),me=Mt(D);let ve=new $e(0,0);T&&(ve=new $e(T[0],T[1])),W._rotateAround(me,ve),te._rotateAround(me,ve),re._rotateAround(me,ve),ce._rotateAround(me,ve),R=Math.min(W.x,te.x,re.x,ce.x),z=Math.max(W.x,te.x,re.x,ce.x),S=Math.min(W.y,te.y,re.y,ce.y),N=Math.max(W.y,te.y,re.y,ce.y)}return a.emplaceBack(r.x,r.y,r.z,l.x,l.y,R,S,z,N,w,u,h,g),a.length-1}function sd(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const r=a.bottom-a.top;return r>0?Math.max(10,r):null}function Jm(a,r,l,u){const h=a.compareText;if(r in h){const g=h[r];for(let v=g.length-1;v>=0;v--)if(u.dist(g[v])<l)return!0}else h[r]=[];return h[r].push(u),!1}const uC=Qu.VectorTileFeature.types,E1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _h(a,r,l,u,h,g,v,w,D,T,S,N,R,z,j,W){const te=S?Math.min(pl,Math.round(S[0])):0,re=S?Math.min(pl,Math.round(S[1])):0;a.emplaceBack(r,l,Math.round(32*v),Math.round(32*w),D,T,(te<<1)+(N?1:0),re,16*R,16*z,256*j,256*W,u,h,g,0)}function Fy(a,r,l){a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l)}function T1(a){for(const r of a.sections)if(_m(r.text))return!0;return!1}class Oy{constructor(r){this.layoutVertexArray=new At,this.indexArray=new ni,this.programConfigurations=r,this.segments=new dr,this.dynamicLayoutVertexArray=new Pt,this.opacityVertexArray=new Ft,this.placedSymbolArray=new ym}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,l,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ea.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,aC.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,E1,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",Oy);class Qf{constructor(r,l,u){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new u,this.segments=new dr,this.collisionVertexArray=new Ai,this.collisionVertexArrayExt=new Pt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,lC.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,fy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}st("CollisionBuffers",Qf);class ml{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(v=>v.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=L_([]),this.placementViewportMatrix=L_([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lm(this.zoom,l["text-size"]),this.iconSizeData=Lm(this.zoom,l["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>Uo[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=r.sourceID}createArrays(){this.text=new Oy(new Zc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Oy(new Zc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new vm,this.lineVertexArray=new Uu,this.symbolInstances=new qc}calculateGlyphDependencies(r,l,u,h,g){for(let v=0;v<r.length;v++)if(l[r.charCodeAt(v)]=!0,h&&g){const w=ru[r.charAt(v)];w&&(l[w.charCodeAt(0)]=!0)}}populate(r,l,u,h){const g=this.layers[0],v=g.layout,w=v.get("text-font"),D=v.get("text-field"),T=v.get("icon-image"),S=("constant"!==D.value.kind||D.value.value instanceof pr&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),N="constant"!==T.value.kind||!!T.value.value||Object.keys(T.parameters).length>0,R=v.get("symbol-sort-key");if(this.features=[],!S&&!N)return;const z=l.iconDependencies,j=l.glyphDependencies,W=l.availableImages,te=new B(this.zoom);for(const{feature:re,id:ce,index:me,sourceLayerIndex:ve}of r){const ye=g._featureFilter.needGeometry,we=zo(re,ye);if(!g._featureFilter.filter(te,we,u))continue;let Fe,ke;if(ye||(we.geometry=As(re,u,h)),S){const Ge=g.getValueAndResolveTokens("text-field",we,u,W),Oe=pr.factory(Ge);T1(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===P()||this.hasRTLText&&O.isParsed())&&(Fe=my(Oe,g,we))}if(N){const Ge=g.getValueAndResolveTokens("icon-image",we,u,W);ke=Ge instanceof Ui?Ge:Ui.fromString(Ge)}if(!Fe&&!ke)continue;const it=this.sortFeaturesByKey?R.evaluate(we,{},u):void 0;if(this.features.push({id:ce,text:Fe,icon:ke,index:me,sourceLayerIndex:ve,geometry:we.geometry,properties:re.properties,type:uC[re.type],sortKey:it}),ke&&(z[ke.name]=!0),Fe){const Ge=w.evaluate(we,{},u).join(","),Oe="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Uo.vertical)>=0;for(const qe of Fe.sections)if(qe.image)z[qe.image.name]=!0;else{const We=rs(Fe.toString()),ze=qe.fontStack||Ge,ot=j[ze]=j[ze]||{};this.calculateGlyphDependencies(qe.text,ot,Oe,this.allowVerticalPlacement,We)}}}"line"===v.get("symbol-placement")&&(this.features=function(re){const ce={},me={},ve=[];let ye=0;function we(Ge){ve.push(re[Ge]),ye++}function Fe(Ge,Oe,qe){const We=me[Ge];return delete me[Ge],me[Oe]=We,ve[We].geometry[0].pop(),ve[We].geometry[0]=ve[We].geometry[0].concat(qe[0]),We}function ke(Ge,Oe,qe){const We=ce[Oe];return delete ce[Oe],ce[Ge]=We,ve[We].geometry[0].shift(),ve[We].geometry[0]=qe[0].concat(ve[We].geometry[0]),We}function it(Ge,Oe,qe){const We=qe?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ge}:${We.x}:${We.y}`}for(let Ge=0;Ge<re.length;Ge++){const Oe=re[Ge],qe=Oe.geometry,We=Oe.text?Oe.text.toString():null;if(!We){we(Ge);continue}const ze=it(We,qe),ot=it(We,qe,!0);if(ze in me&&ot in ce&&me[ze]!==ce[ot]){const dt=ke(ze,ot,qe),kt=Fe(ze,ot,ve[dt].geometry);delete ce[ze],delete me[ot],me[it(We,ve[kt].geometry,!0)]=kt,ve[dt].geometry=null}else ze in me?Fe(ze,ot,qe):ot in ce?ke(ze,ot,qe):(we(Ge),ce[ze]=ye-1,me[ot]=ye-1)}return ve.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,ce)=>re.sortKey-ce.sortKey)}update(r,l,u,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,u,h),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,u,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const u=this.lineVertexArray.length;if(void 0!==r.segment){let h=r.dist(l[r.segment+1]),g=r.dist(l[r.segment]);const v={};for(let w=r.segment+1;w<l.length;w++)v[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:h},w<l.length-1&&(h+=l[w+1].dist(l[w]));for(let w=r.segment||0;w>=0;w--)v[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=l[w-1].dist(l[w]));for(let w=0;w<l.length;w++){const D=v[w];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,l,u,h,g,v,w,D,T,S,N,R,z,j){const W=r.indexArray,te=r.layoutVertexArray,re=r.segments.prepareSegment(4*l.length,te,W,this.canOverlap?v.sortKey:void 0),ce=this.glyphOffsetArray.length,me=re.vertexLength,ve=this.allowVerticalPlacement&&w===Uo.vertical?Math.PI/2:0,ye=v.text&&v.text.sections;for(let we=0;we<l.length;we++){const{tl:Fe,tr:ke,bl:it,br:Ge,tex:Oe,pixelOffsetTL:qe,pixelOffsetBR:We,minFontScaleX:ze,minFontScaleY:ot,glyphOffset:dt,isSDF:kt,sectionIndex:Ln}=l[we],Nt=re.vertexLength,Dn=dt[1];_h(te,D.x,D.y,D.z,T.x,T.y,Fe.x,Dn+Fe.y,Oe.x,Oe.y,u,kt,qe.x,qe.y,ze,ot),_h(te,D.x,D.y,D.z,T.x,T.y,ke.x,Dn+ke.y,Oe.x+Oe.w,Oe.y,u,kt,We.x,qe.y,ze,ot),_h(te,D.x,D.y,D.z,T.x,T.y,it.x,Dn+it.y,Oe.x,Oe.y+Oe.h,u,kt,qe.x,We.y,ze,ot),_h(te,D.x,D.y,D.z,T.x,T.y,Ge.x,Dn+Ge.y,Oe.x+Oe.w,Oe.y+Oe.h,u,kt,We.x,We.y,ze,ot),Fy(r.dynamicLayoutVertexArray,D,ve),W.emplaceBack(Nt,Nt+1,Nt+2),W.emplaceBack(Nt+1,Nt+2,Nt+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),we!==l.length-1&&Ln===l[we+1].sectionIndex||r.programConfigurations.populatePaintArrays(te.length,v,v.index,{},z,j,ye&&ye[Ln])}r.placedSymbolArray.emplaceBack(D.x,D.y,D.z,T.x,T.y,ce,this.glyphOffsetArray.length-ce,me,S,N,T.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],w,0,!1,0,R,0)}_commitLayoutVertex(r,l,u,h,g,v,w){r.emplaceBack(l,u,h,g,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(r,l,u,h,g,v,w){const D=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),T=D.vertexLength,S=w.tileAnchorX,N=w.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),u.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(u.layoutVertexArray,h,g,v,S,N,new $e(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,v,S,N,new $e(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,v,S,N,new $e(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,g,v,S,N,new $e(r.x1,r.y2)),D.vertexLength+=4;const R=u.indexArray;R.emplaceBack(T,T+1),R.emplaceBack(T+1,T+2),R.emplaceBack(T+2,T+3),R.emplaceBack(T+3,T),D.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,u,h,g,v){for(let w=h;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceTextSize(r,v,l,w);this._addCollisionDebugVertices(D,T,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(r,l,u,h,g,v){for(let w=h;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceIconSize(r,l,w);this._addCollisionDebugVertices(D,T,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,v)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qf(si,p1.members,Kn),this.iconCollisionBox=new Qf(si,p1.members,Kn);const u=Ta(this.iconSizeData,r),h=Ta(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,r,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(h,r,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,r,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,r,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(r,l,u,h){const g=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:h),v=fh(this.textSizeData,r,g)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(r,l,u){const h=this.icon.placedSymbolArray.get(u),g=fh(this.iconSizeData,r,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,l,u){r.emplaceBack(l,-u,-u),r.emplaceBack(l,u,-u),r.emplaceBack(l,u,u),r.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(r,l,u,h,g,v){for(let w=h;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceTextSize(r,v,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,D.padding)}}_updateIconDebugCollisionBoxes(r,l,u,h,g){for(let v=h;v<g;v++){const w=u.get(v),D=this.getSymbolInstanceIconSize(r,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,w.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Ta(this.iconSizeData,r),h=Ta(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,r,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(h,r,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,r,l,v.iconBoxStartIndex,v.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,r,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,u,h,g,v,w,D,T){const S={};for(let N=l;N<u;N++){const R=r.get(N);S.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},S.textFeatureIndex=R.featureIndex;break}for(let N=h;N<g;N++){const R=r.get(N);S.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},S.verticalTextFeatureIndex=R.featureIndex;break}for(let N=v;N<w;N++){const R=r.get(N);S.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},S.iconFeatureIndex=R.featureIndex;break}for(let N=D;N<T;N++){const R=r.get(N);S.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},S.verticalIconFeatureIndex=R.featureIndex;break}return S}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const u=r.placedSymbolArray.get(l),h=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<h;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(r),u=Math.cos(r),h=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const D=this.symbolInstances.get(w);h.push(0|Math.round(l*D.tileAnchorX+u*D.tileAnchorY)),g.push(D.featureIndex)}return v.sort((w,D)=>h[w]-h[D]||g[D]-g[w]),v}addToSortKeyRanges(r,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((h,g,v)=>{h>=0&&v.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}st("SymbolBucket",ml,{omit:["layers","collisionBoxArray","features","compareText"]}),ml.MAX_GLYPHS=65535,ml.addDynamicAttributes=Fy;const M1=new Ne({"symbol-placement":new J(be.layout_symbol["symbol-placement"]),"symbol-spacing":new J(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new J(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new le(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new J(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new J(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new J(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new J(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new J(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new le(be.layout_symbol["icon-size"]),"icon-text-fit":new J(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new J(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new le(be.layout_symbol["icon-image"]),"icon-rotate":new le(be.layout_symbol["icon-rotate"]),"icon-padding":new J(be.layout_symbol["icon-padding"]),"icon-keep-upright":new J(be.layout_symbol["icon-keep-upright"]),"icon-offset":new le(be.layout_symbol["icon-offset"]),"icon-anchor":new le(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new J(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new J(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new J(be.layout_symbol["text-rotation-alignment"]),"text-field":new le(be.layout_symbol["text-field"]),"text-font":new le(be.layout_symbol["text-font"]),"text-size":new le(be.layout_symbol["text-size"]),"text-max-width":new le(be.layout_symbol["text-max-width"]),"text-line-height":new le(be.layout_symbol["text-line-height"]),"text-letter-spacing":new le(be.layout_symbol["text-letter-spacing"]),"text-justify":new le(be.layout_symbol["text-justify"]),"text-radial-offset":new le(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new J(be.layout_symbol["text-variable-anchor"]),"text-anchor":new le(be.layout_symbol["text-anchor"]),"text-max-angle":new J(be.layout_symbol["text-max-angle"]),"text-writing-mode":new J(be.layout_symbol["text-writing-mode"]),"text-rotate":new le(be.layout_symbol["text-rotate"]),"text-padding":new J(be.layout_symbol["text-padding"]),"text-keep-upright":new J(be.layout_symbol["text-keep-upright"]),"text-transform":new le(be.layout_symbol["text-transform"]),"text-offset":new le(be.layout_symbol["text-offset"]),"text-allow-overlap":new J(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new J(be.layout_symbol["text-ignore-placement"]),"text-optional":new J(be.layout_symbol["text-optional"])});var yh={paint:new Ne({"icon-opacity":new le(be.paint_symbol["icon-opacity"]),"icon-color":new le(be.paint_symbol["icon-color"]),"icon-halo-color":new le(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new le(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new le(be.paint_symbol["icon-halo-blur"]),"icon-translate":new J(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new J(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new le(be.paint_symbol["text-opacity"]),"text-color":new le(be.paint_symbol["text-color"],{runtimeType:Si,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new le(be.paint_symbol["text-halo-color"]),"text-halo-width":new le(be.paint_symbol["text-halo-width"]),"text-halo-blur":new le(be.paint_symbol["text-halo-blur"]),"text-translate":new J(be.paint_symbol["text-translate"]),"text-translate-anchor":new J(be.paint_symbol["text-translate-anchor"])}),layout:M1};class I1{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:vs,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",I1,{omit:["defaultValue"]});class Qm extends ho{constructor(r){super(r,yh)}recalculate(r,l){super.recalculate(r,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const g of u)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,u,h){const g=this.layout.get(r).evaluate(l,{},u,h),v=this._unevaluatedLayout._values[r];return v.isDataDriven()||Fo(v.value)||!g?g:(w=l.properties,g.replace(/{([^{}]+)}/g,(T,S)=>S in w?String(w[S]):""));var w}createBucket(r){return new ml(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of yh.paint.overridableProperties){if(!Qm.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),u=new I1(l),h=new Mn(u,l.property.specification);let g=null;g="constant"===l.value.kind||"source"===l.value.kind?new ya("source",h):new Lc("composite",h,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new ne(l.property,g,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&Qm.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const u=r.get("text-field"),h=yh.paint.properties[l];let g=!1;const v=w=>{for(const D of w)if(h.overrides&&h.overrides.hasOverride(D))return void(g=!0)};if("constant"===u.value.kind&&u.value.value instanceof pr)v(u.value.value.sections);else if("source"===u.value.kind){const w=T=>{g||(T instanceof ql&&Vn(T.value)===Sc?v(T.value.sections):T instanceof Ac?v(T.sections):T.eachChild(w))},D=u.value;D._styleExpression&&w(D._styleExpression.expression)}return g}getProgramConfiguration(r){return new ll(this,r)}}var dC={paint:new Ne({"background-color":new J(be.paint_background["background-color"]),"background-pattern":new Se(be.paint_background["background-pattern"]),"background-opacity":new J(be.paint_background["background-opacity"])})},hC={paint:new Ne({"raster-opacity":new J(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new J(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new J(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new J(be.paint_raster["raster-brightness-max"]),"raster-saturation":new J(be.paint_raster["raster-saturation"]),"raster-contrast":new J(be.paint_raster["raster-contrast"]),"raster-resampling":new J(be.paint_raster["raster-resampling"]),"raster-fade-duration":new J(be.paint_raster["raster-fade-duration"])})};class fC extends ho{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var pC={paint:new Ne({"sky-type":new J(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new J(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new J(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new J(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new J(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Me(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new J(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new J(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new J(be.paint_sky["sky-opacity"])})};function Ly(a,r,l){const u=Qc(0,0,1),h=$_(Sm());return function(g,v,w){w*=.5;var D=v[0],T=v[1],S=v[2],N=v[3],R=Math.sin(w),z=Math.cos(w);g[0]=D*z-S*R,g[1]=T*z+N*R,g[2]=S*z+D*R,g[3]=N*z-T*R}(h,h,l?-Mt(a)+Math.PI:Mt(a)),H_(h,h,-Mt(r)),U_(u,u,h),z_(u,u)}const mC={circle:class extends ho{constructor(a){super(a,Zu)}createBucket(a){return new Ef(a)}queryRadius(a){const r=a;return Wu("circle-radius",this,r)+Wu("circle-stroke-width",this,r)+If(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,l,u,h,g,v,w){const D=eh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return Am(a,u,g,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,T)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new ll(this,a)}},heatmap:class extends ho{createBucket(a){return new Kv(a)}constructor(a){super(a,W_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Af({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Wu("heatmap-radius",this,a)}queryIntersectsFeature(a,r,l,u,h,g,v,w){const D=this.paint.get("heatmap-radius").evaluate(r,l);return Am(a,u,g,v,w,!0,!0,new $e(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new ll(this,a)}},hillshade:class extends ho{constructor(a){super(a,Z_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(a){return new ll(this,a)}},fill:class extends ho{constructor(a){super(a,ny)}getProgramIds(){const a=this.paint.get("fill-pattern"),r=a&&a.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new ll(this,a)}recalculate(a,r){super.recalculate(a,r);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Vf(a)}queryRadius(){return If(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,l,u,h,g){return!a.queryGeometry.isAboveHorizon&&Dm(F_(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends ho{constructor(a){super(a,u1)}createBucket(a){return new ul(a)}queryRadius(){return If(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new ll(this,a)}queryIntersectsFeature(a,r,l,u,h,g,v,w,D){const T=eh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(r,l),N=this.paint.get("fill-extrusion-base").evaluate(r,l),R=[0,0],z=w&&g.elevation,j=g.elevation?g.elevation.exaggeration():1;if(z){const re=a.tile.getBucket(this).centroidVertexArray,ce=D+1;if(ce<re.length){const me=re.get(ce);R[0]=me.a_centroid_pos0,R[1]=me.a_centroid_pos1}}if(0===R[0]&&1===R[1])return!1;const W=(re=u,ce=N,me=S,ve=T,ye=v,(we=z?w:null)?function(Ge,Oe,qe,We,ze,ot,dt,kt,Ln){const Nt=[],Dn=[],tt=[0,0,0,1];for(const Un of Ge){const bn=[],ki=[];for(const Ni of Un){const ir=Ni.x+We.x,hr=Ni.y+We.y,Nn=jf(ir,hr,Oe,qe,ot,dt,kt,Ln);tt[0]=ir,tt[1]=hr,tt[2]=Nn.base,tt[3]=1,rh(tt,tt,ze),tt[3]=Math.max(tt[3],1e-5);const yt=ly([tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]]);tt[0]=ir,tt[1]=hr,tt[2]=Nn.top,tt[3]=1,rh(tt,tt,ze),tt[3]=Math.max(tt[3],1e-5);const Zn=ly([tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]]);bn.push(yt),ki.push(Zn)}Nt.push(bn),Dn.push(ki)}return[Nt,Dn]}(re,ce,me,ve,ye,we,R,j,g.center.lat):function(Ge,Oe,qe,We,ze){const ot=[],dt=[],kt=ze[8]*Oe,Ln=ze[9]*Oe,Nt=ze[10]*Oe,Dn=ze[11]*Oe,tt=ze[8]*qe,Un=ze[9]*qe,bn=ze[10]*qe,ki=ze[11]*qe;for(const Ni of Ge){const ir=[],hr=[];for(const Nn of Ni){const yt=Nn.x+We.x,Zn=Nn.y+We.y,Fr=ze[0]*yt+ze[4]*Zn+ze[12],jn=ze[1]*yt+ze[5]*Zn+ze[13],Pi=ze[2]*yt+ze[6]*Zn+ze[14],rr=ze[3]*yt+ze[7]*Zn+ze[15],fi=Fr+kt,mo=jn+Ln,$n=Pi+Nt,Ti=Math.max(rr+Dn,1e-5),Mi=Fr+tt,pi=jn+Un,ui=Pi+bn,Zi=Math.max(rr+ki,1e-5),Hn=new $e(fi/Ti,mo/Ti);Hn.z=$n/Ti,ir.push(Hn);const Xi=new $e(Mi/Zi,pi/Zi);Xi.z=ui/Zi,hr.push(Xi)}ot.push(ir),dt.push(hr)}return[ot,dt]}(re,ce,me,ve,ye)),te=a.queryGeometry;var re,ce,me,ve,ye,we;return function(re,ce,me){let ve=1/0;Dm(me,ce)&&(ve=ay(me,ce[0]));for(let ye=0;ye<ce.length;ye++){const we=ce[ye],Fe=re[ye];for(let ke=0;ke<we.length-1;ke++){const it=we[ke],Ge=[it,we[ke+1],Fe[ke+1],Fe[ke],it];Tf(me,Ge)&&(ve=Math.min(ve,ay(me,Ge)))}}return ve!==1/0&&ve}(W[0],W[1],te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends ho{constructor(a){super(a,dy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ht,this.gradientVersion=(this.gradientVersion+1)%Ko}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=hy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new hh(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new ll(this,a)}queryRadius(a){const r=a,l=iu(Wu("line-width",this,r),Wu("line-gap-width",this,r)),u=Wu("line-offset",this,r);return l/2+Math.abs(u)+If(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,l,u,h,g){if(a.queryGeometry.isAboveHorizon)return!1;const v=F_(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*iu(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),D=this.paint.get("line-offset").evaluate(r,l);return D&&(u=function(T,S){const N=[],R=new $e(0,0);for(let z=0;z<T.length;z++){const j=T[z],W=[];for(let te=0;te<j.length;te++){const re=j[te-1],ce=j[te],me=j[te+1],ve=0===te?R:ce.sub(re)._unit()._perp(),ye=te===j.length-1?R:me.sub(ce)._unit()._perp(),we=ve._add(ye)._unit();we._mult(1/(we.x*ye.x+we.y*ye.y)),W.push(we._mult(S)._add(ce))}N.push(W)}return N}(u,D*a.pixelToTileUnitsFactor)),function(T,S,N){for(let R=0;R<S.length;R++){const z=S[R];if(T.length>=3)for(let j=0;j<z.length;j++)if(Jc(T,z[j]))return!0;if(qv(T,z,N))return!0}return!1}(v,u,w)}isTileClipped(){return!0}},symbol:Qm,background:class extends ho{constructor(a){super(a,dC)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ho{constructor(a){super(a,hC)}getProgramIds(){return["raster"]}},sky:class extends ho{constructor(a){super(a,pC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Af({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(a,r){const l=this.paint.get("sky-type");if("atmosphere"===l){const u=this.paint.get("sky-atmosphere-sun"),h=!u,g=a.style.light,v=g.properties.get("position");return h&&"viewport"===g.properties.get("anchor")&&ri("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Ly(v.azimuthal,90-v.polar,r):Ly(u[0],90-u[1],r)}if("gradient"===l){const u=this.paint.get("sky-gradient-center");return Ly(u[0],90-u[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}},{HTMLImageElement:S1,HTMLCanvasElement:A1,HTMLVideoElement:k1,ImageData:gl,ImageBitmap:ad}=ut;class ep{constructor(r,l,u,h){this.context=r,this.format=u,this.texture=r.gl.createTexture(),this.update(l,h)}update(r,l,u){const{width:h,height:g}=r,{context:v}=this,{gl:w}=v;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===h&&this.size[1]===g){const{x:D,y:T}=u||{x:0,y:0};r instanceof S1||r instanceof A1||r instanceof k1||r instanceof gl||ad&&r instanceof ad?w.texSubImage2D(w.TEXTURE_2D,0,D,T,w.RGBA,w.UNSIGNED_BYTE,r):w.texSubImage2D(w.TEXTURE_2D,0,D,T,h,g,w.RGBA,w.UNSIGNED_BYTE,r.data)}else this.size=[h,g],r instanceof S1||r instanceof A1||r instanceof k1||r instanceof gl||ad&&r instanceof ad?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,r):w.texImage2D(w.TEXTURE_2D,0,this.format,h,g,0,this.format,w.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(r,l){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,l),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class tp{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new Nr({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const u=this.getKey(r,l);return this.positions[u]}trim(){const r=this.width,l=this.height=Rn(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,u){const h=[];let g=r.length%2==1?-r[r.length-1]*u:0,v=r[0]*u,w=!0;h.push({left:g,right:v,isDash:w,zeroLength:0===r[0]});let D=r[0];for(let T=1;T<r.length;T++){w=!w;const S=r[T];g=D*u,D+=S,v=D*u,h.push({left:g,right:v,isDash:w,zeroLength:0===S})}return h}addRoundDash(r,l,u){const h=l/2;for(let g=-u;g<=u;g++){const v=this.width*(this.nextRow+u+g);let w=0,D=r[w];for(let T=0;T<this.width;T++){T/D.right>1&&(D=r[++w]);const S=Math.abs(T-D.left),N=Math.abs(T-D.right),R=Math.min(S,N);let z;const j=g/u*(h+1);if(D.isDash){const W=h-Math.abs(j);z=Math.sqrt(R*R+W*W)}else z=h-Math.sqrt(R*R+j*j);this.image.data[v+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(r,l){for(let D=r.length-1;D>=0;--D){const T=r[D],S=r[D+1];T.zeroLength?r.splice(D,1):S&&S.isDash===T.isDash&&(S.left=T.left,r.splice(D,1))}const u=r[0],h=r[r.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const g=this.width*this.nextRow;let v=0,w=r[v];for(let D=0;D<this.width;D++){D/w.right>1&&(w=r[++v]);const T=Math.abs(D-w.left),S=Math.abs(D-w.right),N=Math.min(T,S);this.image.data[g+D]=Math.max(0,Math.min(255,(w.isDash?N:-N)+l+128))}}addDash(r,l){const u=this.getKey(r,l);if(this.positions[u])return this.positions[u];const h="round"===l,g=h?7:0,v=2*g+1;if(this.nextRow+v>this.height)return ri("LineAtlas out of space"),null;0===r.length&&r.push(1);let w=0;for(let S=0;S<r.length;S++)r[S]<0&&(ri("Negative value is found in line dasharray, replacing values with 0"),r[S]=0),w+=r[S];if(0!==w){const S=this.width/w,N=this.getDashRanges(r,this.width,S);h?this.addRoundDash(N,S,g):this.addRegularDash(N,"square"===l?.5*S:0)}const D=this.nextRow+g;this.nextRow+=v;const T={tl:[D,g],br:[w,0]};return this.positions[u]=T,T}}st("LineAtlas",tp);class eg{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const By=ut.performance;function np(a){const r=a?a.url.toString():void 0;return By.getEntriesByName(r)}class N1{constructor(){this.tasks={},this.taskQueue=[],Io(["process"],this),this.invoker=new eg(this.process),this.nextId=0}add(r,l){const u=this.nextId++,h=function({type:g,isSymbolTile:v,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||v?"parseTile"!==g||v?"parseTile"===g&&v?300-w:"maybePrepare"===g&&v?400-w:500:200-w:100-w}(l);if(0===h){Jo();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:r,metadata:l,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Jo();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<l&&(l=g.priority,r=h)}if(null===r)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}function ta(a,r){const l=Math.pow(2,-a.z),u=a.x*l,h=(a.x+1)*l,g=a.y*l,v=(a.y+1)*l;if("mercator"===r.name)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:r};const w=dc(u),D=dc(h),T=Qs(g),S=Qs(v),N=r.project(w,T),R=r.project(D,T),z=r.project(D,S),j=r.project(w,S);let W=Math.min(N.x,R.x,z.x,j.x),te=Math.min(N.y,R.y,z.y,j.y),re=Math.max(N.x,R.x,z.x,j.x),ce=Math.max(N.y,R.y,z.y,j.y);const me=l/16;function ve(we,Fe,ke,it,Ge,Oe){const qe=(ke+Ge)/2,We=(it+Oe)/2,ze=r.project(dc(qe),Qs(We)),ot=Math.max(0,W-ze.x,te-ze.y,ze.x-re,ze.y-ce);W=Math.min(W,ze.x),re=Math.max(re,ze.x),te=Math.min(te,ze.y),ce=Math.max(ce,ze.y),ot>me&&(ve(we,ze,ke,it,qe,We),ve(ze,Fe,qe,We,Ge,Oe))}ve(N,R,u,g,h,g),ve(R,z,h,g,h,v),ve(z,j,h,v,u,v),ve(j,N,u,v,u,g),W-=me,te-=me,re+=me,ce+=me;const ye=1/Math.max(re-W,ce-te);return{scale:ye,x:W*ye,y:te*ye,x2:re*ye,y2:ce*ye,projection:r}}function tg(a,r,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}class ng{constructor(r,l,u){this.z=r,this.x=l,this.y=u,this.key=vh(0,r,r,l,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const u=(g=this.y,v=this.z,w=tg(256*(h=this.x),256*(g=Math.pow(2,v)-g-1),v),D=tg(256*(h+1),256*(g+1),v),w[0]+","+w[1]+","+D[0]+","+D[1]);var h,g,v,w,D;const T=function(S,N,R){let z,j="";for(let W=S;W>0;W--)z=1<<W-1,j+=(N&z?1:0)+(R&z?2:0);return j}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",T).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class P1{constructor(r,l){this.wrap=r,this.canonical=l,this.key=vh(r,l.z,l.z,l.x,l.y)}}class Rr{constructor(r,l,u,h,g){this.overscaledZ=r,this.wrap=l,this.canonical=new ng(u,+h,+g),this.key=0===l&&r===u?this.canonical.key:vh(l,r,u,h,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new Rr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return vh(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return vh(this.wrap*+l,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Rr(l,this.wrap,l,u,h),new Rr(l,this.wrap,l,u+1,h),new Rr(l,this.wrap,l,u,h+1),new Rr(l,this.wrap,l,u+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Rr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new P1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vh(a,r,l,u,h){const g=1<<Math.min(l,22);let v=g*(h%g)+u%g;return a&&l<22&&(v+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(r-l)}st("CanonicalTileID",ng),st("OverscaledTileID",Rr,{omit:["projMatrix"]});class ig{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const u=r[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class Vy{constructor(r,l,u,h,g){this.type="Feature",this._vectorTileFeature=r,r._z=l,r._x=u,r._y=h,this.properties=r.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(r[l]=this[l]);return r}}var R1=Te([{name:"a_pos",type:"Int16",components:2}]);const Ia=new Uint16Array(8184);for(let a=0;a<2046;a++){let r=a+2,l=0,u=0,h=0,g=0,v=0,w=0;for(1&r?h=g=v=32:l=u=w=32;(r>>=1)>1;){const T=l+h>>1,S=u+g>>1;1&r?(h=l,g=u,l=v,u=w):(l=h,u=g,h=v,g=w),v=T,w=S}const D=4*a;Ia[D+0]=l,Ia[D+1]=u,Ia[D+2]=h,Ia[D+3]=g}const po=new Uint16Array(2178),Fs=new Uint8Array(1089),_l=new Uint16Array(1089);function zy(a){return 0===a?-.03125:32===a?.03125:0}var ip=Te([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const rg={type:2,extent:fn,loadGeometry:()=>[[new $e(0,0),new $e(8193,0),new $e(8193,8193),new $e(0,8193),new $e(0,0)]]};class rp{constructor(r,l,u,h,g){this.tileID=r,this.uid=Ba(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<to.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ta(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,u){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,g){const v={};if(!g)return v;for(const w of h){const D=w.layerIds.map(T=>g.getLayer(T)).filter(Boolean);if(0!==D.length){w.layers=D,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(T=>D.filter(S=>S.id===T)[0]));for(const T of D)v[T.id]=w}}return v}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof ml){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof ml&&g.hasRTLText){this.hasRTLText=!0,O.isLoading()||O.isLoaded()||"deferred"!==P()||F();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(h).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new kr}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const u in this.buckets){const h=this.buckets[u];h.uploadPending()&&h.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ep(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ep(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ep(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,u,h,g,v,w,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:w,transform:v,params:g,tileTransform:this.tileTransform},r,l,u):{}}querySourceFeatures(r,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),g=l?l.sourceLayer:"",v=h._geojsonTileLayer||h[g];if(!v)return;const w=Yn(l&&l.filter),{z:D,x:T,y:S}=this.tileID.canonical,N={z:D,x:T,y:S};for(let R=0;R<v.length;R++){const z=v.feature(R);if(w.needGeometry){const te=zo(z,!0);if(!w.filter(new B(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!w.filter(new B(this.tileID.overscaledZ),z))continue;const j=u.getId(z,g),W=new Vy(z,D,T,S,j);W.tile=N,r.push(W)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const u=Va(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(l)if(this.expirationTime<l)h=!0;else{const g=this.expirationTime-l;g?this.expirationTime=u+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),h=l.style.listImages();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const v=this.buckets[g],w=v.layers[0].sourceLayer||"_geojsonTileLayer",D=u[w],T=r[w];if(!D||!T||0===Object.keys(T).length)continue;if(v.update(T,D,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof hh||v instanceof Vf){const N=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&N&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(N.id,this.tileID)}const S=l&&l.style&&l.style.getLayer(g);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<to.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=to.now()+r}setDependencies(r,l){const u={};for(const h of l)u[h]=!0;this.dependencies[r]=u}hasDependency(r,l){for(const u of r){const h=this.dependencies[u];if(h)for(const g of l)if(h[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=As(rg,this.tileID.canonical,this.tileTransform)[0],h=new ft,g=new yr;for(let v=0;v<u.length;v++){const{x:w,y:D}=u[v];h.emplaceBack(w,D),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(h,ip.members),this._tileDebugSegments=dr.simpleSegment(0,0,h.length,g.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=As(rg,this.tileID.canonical,this.tileTransform)[0];let h,g;if(this.isRaster){const v=function(w,D){const T=ta(w,D),S=Math.pow(2,w.z);for(let te=0;te<33;te++)for(let re=0;re<33;re++){const ce=dc((w.x+(re+zy(re))/32)/S),me=Qs((w.y+(te+zy(te))/32)/S),ve=D.project(ce,me),ye=33*te+re;po[2*ye+0]=Math.round((ve.x*T.scale-T.x)*fn),po[2*ye+1]=Math.round((ve.y*T.scale-T.y)*fn)}Fs.fill(0),_l.fill(0);for(let te=2045;te>=0;te--){const re=4*te,ce=Ia[re+0],me=Ia[re+1],ve=Ia[re+2],ye=Ia[re+3],we=ce+ve>>1,Fe=me+ye>>1,ke=we+Fe-me,it=Fe+ce-we,Ge=33*me+ce,Oe=33*ye+ve,qe=33*Fe+we,We=Math.hypot((po[2*Ge+0]+po[2*Oe+0])/2-po[2*qe+0],(po[2*Ge+1]+po[2*Oe+1])/2-po[2*qe+1])>=16;if(Fs[qe]=Fs[qe]||(We?1:0),te<1022){const ze=33*(me+it>>1)+(ce+ke>>1),ot=33*(ye+it>>1)+(ve+ke>>1);Fs[qe]=Fs[qe]||Fs[ze]||Fs[ot]}}const N=new wt,R=new ni;let z=0;function j(te,re){const ce=33*re+te;return 0===_l[ce]&&(N.emplaceBack(po[2*ce+0],po[2*ce+1],te*fn/32,re*fn/32),_l[ce]=++z),_l[ce]-1}function W(te,re,ce,me,ve,ye){const we=te+ce>>1,Fe=re+me>>1;if(Math.abs(te-ve)+Math.abs(re-ye)>1&&Fs[33*Fe+we])W(ve,ye,te,re,we,Fe),W(ce,me,ve,ye,we,Fe);else{const ke=j(te,re),it=j(ce,me),Ge=j(ve,ye);R.emplaceBack(ke,it,Ge)}}return W(0,0,32,32,32,0),W(32,32,0,0,0,32),{vertices:N,indices:R}}(this.tileID.canonical,l);h=v.vertices,g=v.indices}else{h=new wt,g=new ni;for(const{x:w,y:D}of u)h.emplaceBack(w,D,0,0);const v=Nm(h.int16,void 0,4);for(let w=0;w<v.length;w+=3)g.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,ip.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=dr.simpleSegment(0,0,h.length,g.length)}}class og{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,u){const h=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},Qi(this.stateChanges[r][h],u),null===this.deletedStates[r]){this.deletedStates[r]={};for(const g in this.state[r])g!==h&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const g in this.state[r][h])u[g]||(this.deletedStates[r][h][g]=null)}else for(const g in u)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][g]&&delete this.deletedStates[r][h][g]}removeFeatureState(r,l,u){if(null===this.deletedStates[r])return;const h=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&void 0!==l)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][u]=null);else if(void 0!==l)if(this.stateChanges[r]&&this.stateChanges[r][h])for(u in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][u]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,l){const u=String(l),h=Qi({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const g=this.deletedStates[r][l];if(null===g)return{};for(const v in g)delete h[v]}return h}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),Qi(this.state[h][v],this.stateChanges[h][v]),g[v]=this.state[h][v];u[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(null===this.deletedStates[h])for(const v in this.state[h])g[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(null===this.deletedStates[h][v])this.state[h][v]={};else for(const w of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][w];g[v]=this.state[h][v]}u[h]=u[h]||{},Qi(u[h],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const h in r)r[h].setFeatureState(u,l)}}class sg{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const u=this.toIdx(r,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function bh(a,r,l,u){let h=0,g=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>r[v])return null}else{const w=1/u[v];let D=(a[v]-l[v])*w,T=(r[v]-l[v])*w;if(D>T){const S=D;D=T,T=S}if(D>h&&(h=D),T<g&&(g=T),h>g)return null}return h}function Uy(a,r,l,u,h,g,v,w,D,T,S){const N=u-a,R=h-r,z=g-l,j=v-a,W=w-r,te=D-l,re=S[1]*te-S[2]*W,ce=S[2]*j-S[0]*te,me=S[0]*W-S[1]*j,ve=N*re+R*ce+z*me;if(Math.abs(ve)<1e-15)return null;const ye=1/ve,we=T[0]-a,Fe=T[1]-r,ke=T[2]-l,it=(we*re+Fe*ce+ke*me)*ye;if(it<0||it>1)return null;const Ge=Fe*z-ke*R,Oe=ke*N-we*z,qe=we*R-Fe*N,We=(S[0]*Ge+S[1]*Oe+S[2]*qe)*ye;return We<0||it+We>1?null:(j*Ge+W*Oe+te*qe)*ye}function ag(a,r,l){return(a-r)/(l-r)}function F1(a,r,l,u,h,g,v,w,D){const T=1<<l,S=g-u,N=v-h,R=(a+1)/T*S+u,z=(r+0)/T*N+h,j=(r+1)/T*N+h;w[0]=(a+0)/T*S+u,w[1]=z,D[0]=R,D[1]=j}class lg{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(g){const v=Math.ceil(Math.log2(g.dim/8)),w=[];let D=Math.ceil(Math.pow(2,v));const T=1/D,S=(z,j,W,te,re)=>{const ce=te?1:0,me=(z+1)*W-ce,ve=j*W,ye=(j+1)*W-ce;re[0]=z*W,re[1]=ve,re[2]=me,re[3]=ye};let N=new sg(D);const R=[];for(let z=0;z<D*D;z++){S(z%D,Math.floor(z/D),T,!1,R);const j=fc(R[0],R[1],g),W=fc(R[2],R[1],g),te=fc(R[2],R[3],g),re=fc(R[0],R[3],g);N.minimums.push(Math.min(j,W,te,re)),N.maximums.push(Math.max(j,W,te,re)),N.leaves.push(1)}for(w.push(N),D/=2;D>=1;D/=2){const z=w[w.length-1];N=new sg(D);for(let j=0;j<D*D;j++){S(j%D,Math.floor(j/D),2,!0,R);const W=z.getElevation(R[0],R[1]),te=z.getElevation(R[2],R[1]),re=z.getElevation(R[2],R[3]),ce=z.getElevation(R[0],R[3]),me=z.isLeaf(R[0],R[1]),ve=z.isLeaf(R[2],R[1]),ye=z.isLeaf(R[2],R[3]),we=z.isLeaf(R[0],R[3]),Fe=Math.min(W.min,te.min,re.min,ce.min),ke=Math.max(W.max,te.max,re.max,ce.max),it=me&&ve&&ye&&we;N.maximums.push(ke),N.minimums.push(Fe),N.leaves.push(ke-Fe<=5&&it?1:0)}w.push(N)}return w}(this.dem),u=l.length-1,h=l[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(r,l,u,h,g,v,w=1){return bh([r,l,-100],[u,h,this.maximums[0]*w],g,v)}raycast(r,l,u,h,g,v,w=1){if(!this.nodeCount)return null;const D=this.raycastRoot(r,l,u,h,g,v,w);if(null==D)return null;const T=[],S=[],N=[],R=[],z=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:j,t:W,nodex:te,nodey:re,depth:ce}=z.pop();if(this.leaves[j]){F1(te,re,ce,r,l,u,h,N,R);const ve=1<<ce,ye=(te+0)/ve,we=(te+1)/ve,Fe=(re+0)/ve,ke=(re+1)/ve,it=fc(ye,Fe,this.dem)*w,Ge=fc(we,Fe,this.dem)*w,Oe=fc(we,ke,this.dem)*w,qe=fc(ye,ke,this.dem)*w,We=Uy(N[0],N[1],it,R[0],N[1],Ge,R[0],R[1],Oe,g,v),ze=Uy(R[0],R[1],Oe,N[0],R[1],qe,N[0],N[1],it,g,v),ot=Math.min(null!==We?We:Number.MAX_VALUE,null!==ze?ze:Number.MAX_VALUE);if(ot!==Number.MAX_VALUE)return ot;{const dt=V_([],g,v,W);if(cg(it,Ge,qe,Oe,ag(dt[0],N[0],R[0]),ag(dt[1],N[1],R[1]))>=dt[2])return W}continue}let me=0;for(let ve=0;ve<this._siblingOffset.length;ve++){F1((te<<1)+this._siblingOffset[ve][0],(re<<1)+this._siblingOffset[ve][1],ce+1,r,l,u,h,N,R),N[2]=-100,R[2]=this.maximums[this.childOffsets[j]+ve]*w;const ye=bh(N,R,g,v);if(null!=ye){const we=ye;T[ve]=we;let Fe=!1;for(let ke=0;ke<me&&!Fe;ke++)we>=T[S[ke]]&&(S.splice(ke,0,ve),Fe=!0);Fe||(S[me]=ve),me++}}for(let ve=0;ve<me;ve++){const ye=S[ve];z.push({idx:this.childOffsets[j]+ye,t:T[ye],nodex:(te<<1)+this._siblingOffset[ye][0],nodey:(re<<1)+this._siblingOffset[ye][1],depth:ce+1})}}return null}_addNode(r,l,u){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,u,h,g){if(1===r[h].isLeaf(l,u))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const v=h-1,w=r[v];let D,T=0;for(let S=0;S<this._siblingOffset.length;S++){const N=2*l+this._siblingOffset[S][0],R=2*u+this._siblingOffset[S][1],z=w.getElevation(N,R),j=w.isLeaf(N,R),W=this._addNode(z.min,z.max,j);j&&(T|=1<<S),D||(D=W)}for(let S=0;S<this._siblingOffset.length;S++)T&1<<S||this._construct(r,2*l+this._siblingOffset[S][0],2*u+this._siblingOffset[S][1],v,D+S)}}function cg(a,r,l,u,h,g){return pt(pt(a,l,g),pt(r,u,g),h)}function fc(a,r,l){const u=l.dim,h=Sn(a*u-.5,0,u-1),g=Sn(r*u-.5,0,u-1),v=Math.floor(h),w=Math.floor(g),D=Math.min(v+1,u-1),T=Math.min(w+1,u-1);return cg(l.get(v,w),l.get(D,w),l.get(v,T),l.get(D,T),h-v,g-w)}const ug={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class op{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,u,h=!1,g=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return ri(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2;if(this.data=new Uint32Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=h,!h){for(let w=0;w<v;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(v,w)]=this.data[this._idx(v-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,v)]=this.data[this._idx(w,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new lg(this)}get(r,l,u=!1){const h=new Uint8Array(this.data.buffer);u&&(r=Sn(r,-1,this.dim),l=Sn(l,-1,this.dim));const g=4*this._idx(r,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[g],h[g+1],h[g+2])}static getUnpackVector(r){return ug[r]}get unpackVector(){return ug[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}_unpackMapbox(r,l,u){return(256*r*256+256*l+u)/10-1e4}_unpackTerrarium(r,l,u){return 256*r+l+u/256-32768}static pack(r,l){const u=[0,0,0,0],h=op.getUnpackVector(l);let g=Math.floor((r+h[3])/h[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new Pr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,l,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=l*this.dim,g=l*this.dim+this.dim,v=u*this.dim,w=u*this.dim+this.dim;switch(l){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:v=w-1;break;case 1:w=v+1}const D=-l*this.dim,T=-u*this.dim;for(let S=v;S<w;S++)for(let N=h;N<g;N++)this.data[this._idx(N,S)]=r.data[this._idx(N+D,S+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}st("DEMData",op),st("DemMinMaxQuadTree",lg,{omit:["dem"]});class O1{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,u){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const g={value:l,timeout:void 0};if(void 0!==u&&(g.timeout=setTimeout(()=>{this.remove(r,g)},u)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const u=r.wrapped().key,h=void 0===l?0:this.data[u].indexOf(l),g=this.data[u][h];return this.data[u].splice(h,1),g.timeout&&clearTimeout(g.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const u in this.data)for(const h of this.data[u])r(h.value)||l.push(h);for(const u of l)this.remove(u.value.tileID,u)}}class vr{constructor(r,l,u){this.func=r,this.mask=l,this.range=u}}vr.ReadOnly=!1,vr.ReadWrite=!0,vr.disabled=new vr(519,vr.ReadOnly,[0,1]);class hg{constructor(r,l,u,h,g,v){this.test=r,this.ref=l,this.mask=u,this.fail=h,this.depthFail=g,this.pass=v}}hg.disabled=new hg({func:519,mask:0},0,0,7680,7680,7680);class yl{constructor(r,l,u){this.blendFunction=r,this.blendColor=l,this.mask=u}}yl.Replace=[1,0],yl.disabled=new yl(yl.Replace,mn.transparent,[!1,!1,!1,!1]),yl.unblended=new yl(yl.Replace,mn.transparent,[!0,!0,!0,!0]),yl.alphaBlended=new yl([1,771],mn.transparent,[!0,!0,!0,!0]);class Sa{constructor(r,l,u){this.enable=r,this.mode=l,this.frontFace=u}}Sa.disabled=new Sa(!1,1029,2305),Sa.backCCW=new Sa(!0,1029,2305),Sa.backCW=new Sa(!0,1029,2304),Sa.frontCW=new Sa(!0,1028,2304),Sa.frontCCW=new Sa(!0,1028,2305);class du extends Je{constructor(r,l,u){super(),this.id=r,this._onlySymbols=u,l.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new O1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new og}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(r),u.prepare(this.map.style.imageManager)}}getIds(){return La(this._tiles).map(r=>r.tileID).sort(ap).map(r=>r.key)}getRenderableIds(r){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,r)&&l.push(this._tiles[u]);return r?l.sort((u,h)=>{const g=u.tileID,v=h.tileID,w=new $e(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),D=new $e(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||D.y-w.y||D.x-w.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(ap).map(u=>u.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const u=this._tiles[r];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,r,l)))}_tileLoaded(r,l,u,h){if(h)return r.state="errored",void(404!==h.status?this._source.fire(new vt(h,{tile:r})):this.update(this.transform));r.timeAdded=to.now(),"expired"===u&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),"raster-dem"===this.getSource().type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Le("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let h=0;h<l.length;h++){const g=l[h];if(r.neighboringTiles&&r.neighboringTiles[g]){const v=this.getTileByID(g);u(r,v),u(v,r)}}function u(h,g){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-h.tileID.canonical.x;const w=g.tileID.canonical.y-h.tileID.canonical.y,D=Math.pow(2,h.tileID.canonical.z),T=g.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+D)?v+=D:1===Math.abs(v-D)&&(v-=D)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,v,w),h.neighboringTiles&&h.neighboringTiles[T]&&(h.neighboringTiles[T].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,u,h){for(const g in this._tiles){let v=this._tiles[g];if(h[g]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const T=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[T.key],v&&v.hasData()&&(w=T)}let D=w;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){h[w.key]=w;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=r.overscaledZ-1;u>=l;u--){const h=r.scaledTo(u),g=this._getLoadedTile(h);if(g)return g}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const u=Math.ceil(r.width/l)+1,h=Math.ceil(r.height/l)+1,g=Math.floor(u*h*5),v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(r){const l=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,l){const u={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+l),u[g.tileID.key]=g}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,l,u){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let h;this.updateCacheSize(r,l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Rr(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(h=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(w=>this._source.hasTile(w)))):h=[];const g=this._updateRetainedTiles(h);if(fg(this._source.type)&&0!==h.length){const w={},D={},T=Object.keys(g);for(const N of T){const R=g[N],z=this._tiles[N];if(!z||z.fadeEndTime&&z.fadeEndTime<=to.now())continue;const j=this.findLoadedParent(R,Math.max(R.overscaledZ-du.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),w[j.tileID.key]=j.tileID),D[N]=R}const S=h[h.length-1].overscaledZ;for(const N in this._tiles){const R=this._tiles[N];if(g[N]||!R.hasData())continue;let z=R.tileID;for(;z.overscaledZ>S;){z=z.scaledTo(z.overscaledZ-1);const j=this._tiles[z.key];if(j&&j.hasData()&&D[z.key]){g[N]=R.tileID;break}}}for(const N in w)g[N]||(this._coveredTiles[N]=!0,g[N]=w[N])}for(const w in g)this._tiles[w].clearFadeHold();const v=function(w,D){const T=[];for(const S in w)S in D||T.push(S);return T}(this._tiles,g);for(const w of v){const D=this._tiles[w];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(0===r.length)return l;const u={},h=r.reduce((T,S)=>Math.min(T,S.overscaledZ),1/0),g=r[0].overscaledZ,v=Math.max(g-du.maxOverzooming,this._source.minzoom),w=Math.max(g+du.maxUnderzooming,this._source.minzoom),D={};for(const T of r){const S=this._addTile(T);l[T.key]=T,S.hasData()||h<this._source.maxzoom&&(D[T.key]=T)}this._retainLoadedChildren(D,h,w,l);for(const T of r){let S=this._tiles[T.key];if(S.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const R=T.children(this._source.maxzoom)[0],z=this.getTile(R);if(z&&z.hasData()){l[R.key]=R;continue}}else{const R=T.children(this._source.maxzoom);if(l[R[0].key]&&l[R[1].key]&&l[R[2].key]&&l[R[3].key])continue}let N=S.wasRequested();for(let R=T.overscaledZ-1;R>=v;--R){const z=T.scaledTo(R);if(u[z.key]||(u[z.key]=!0,S=this.getTile(z),!S&&N&&(S=this._addTile(z)),S&&(l[z.key]=z,N=S.wasRequested(),S.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let u,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}l.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;h=g}for(const g of l)this._loadedParentTiles[g]=u}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const u=Boolean(l);if(!u){const h=this.map?this.map.painter:null;l=new rp(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,u||this._source.fire(new Le("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=l.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(r,l,u){const h=[],g=this.transform;if(!g)return h;for(const v in this._tiles){const w=this._tiles[v];if(u&&w.clearQueryDebugViz(),w.holdingForFade())continue;const D=r.containsTile(w,g,l);D&&h.push(D)}return h}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(fg(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=to.now())return!0}return!1}setFeatureState(r,l,u){this._state.updateState(r=r||"_geojsonTileLayer",l,u)}removeFeatureState(r,l,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,u)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,u){const h=this._tiles[r];h&&h.setDependencies(l,u)}reloadTilesForDependencies(r,l){for(const u in this._tiles)this._tiles[u].hasDependency(r,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,l))}}function ap(a,r){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return a.overscaledZ-r.overscaledZ||u-l||r.canonical.y-a.canonical.y||r.canonical.x-a.canonical.x}function fg(a){return"raster"===a||"image"===a||"video"===a}du.maxOverzooming=10,du.maxUnderzooming=3;class lp{constructor(r,l,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(r,l,u){const h=u||r.findDEMTileFor(l);if(!h||!h.dem)return;const g=h.dem,v=h.tileID,w=1<<l.canonical.z-v.canonical.z;return new lp(h,h.tileSize/fn/w,[(l.canonical.x/w-v.canonical.x)*g.dim,(l.canonical.y/w-v.canonical.y)*g.dim])}tileCoordToPixel(r,l){const u=l*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(u);return new $e(h,g)}getElevationAt(r,l,u,h){const g=r*this._scale+this._offset[0],v=l*this._scale+this._offset[1],w=Math.floor(g),D=Math.floor(v),T=this._dem;return h=!!h,u?pt(pt(T.get(w,D,h),T.get(w,D+1,h),v-D),pt(T.get(w+1,D,h),T.get(w+1,D+1,h),v-D),g-w):T.get(w,D,h)}getElevationAtPixel(r,l,u){return this._dem.get(r,l,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Be(1,r)*this._dem.stride}}class $y{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Uc(fn,16,0),this.featureIndexArray=new Uv,this.promoteId=l}insert(r,l,u,h,g,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g,v);const D=this.grid;for(let T=0;T<l.length;T++){const S=l[T],N=[1/0,1/0,-1/0,-1/0];for(let R=0;R<S.length;R++){const z=S[R];N[0]=Math.min(N[0],z.x),N[1]=Math.min(N[1],z.y),N[2]=Math.max(N[2],z.x),N[3]=Math.max(N[3],z.y)}N[0]<fn&&N[1]<fn&&N[2]>=0&&N[3]>=0&&D.insert(w,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Qu.VectorTile(new su(this.rawTileData)).layers,this.sourceLayerCoder=new ig(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,u,h){this.loadVTLayers();const g=r.params||{},v=Yn(g.filter),w=r.tileResult,D=r.transform,T=w.bufferedTilespaceBounds,S=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(j,W,te,re)=>R_(w.bufferedTilespaceGeometry,j,W,te,re));S.sort(Gy);let N=null;D.elevation&&S.length>0&&(N=lp.create(D.elevation,this.tileID));const R={};let z;for(let j=0;j<S.length;j++){const W=S[j];if(W===z)continue;z=W;const te=this.featureIndexArray.get(W);let re=null;this.loadMatchingFeature(R,te,v,g.layers,g.availableImages,l,u,h,(ce,me,ve,ye=0)=>(re||(re=As(ce,this.tileID.canonical,r.tileTransform)),me.queryIntersectsFeature(w,ce,ve,re,this.z,r.transform,r.pixelPosMatrix,N,ye)))}return R}loadMatchingFeature(r,l,u,h,g,v,w,D,T){const{featureIndex:S,bucketIndex:N,sourceLayerIndex:R,layoutVertexArrayOffset:z}=l,j=this.bucketLayerIDs[N];if(h&&!function(ce,me){for(let ve=0;ve<ce.length;ve++)if(me.indexOf(ce[ve])>=0)return!0;return!1}(h,j))return;const W=this.sourceLayerCoder.decode(R),te=this.vtLayers[W].feature(S);if(u.needGeometry){const ce=zo(te,!0);if(!u.filter(new B(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!u.filter(new B(this.tileID.overscaledZ),te))return;const re=this.getId(te,W);for(let ce=0;ce<j.length;ce++){const me=j[ce];if(h&&h.indexOf(me)<0)continue;const ve=v[me];if(!ve)continue;let ye={};void 0!==re&&D&&(ye=D.getState(ve.sourceLayer||"_geojsonTileLayer",re));const we=Qi({},w[me]);we.paint=Hy(we.paint,ve.paint,te,ye,g),we.layout=Hy(we.layout,ve.layout,te,ye,g);const Fe=!T||T(te,ve,ye,z);if(!Fe)continue;const ke=new Vy(te,this.z,this.x,this.y,re);ke.layer=we;let it=r[me];void 0===it&&(it=r[me]=[]),it.push({featureIndex:S,feature:ke,intersectionZ:Fe})}}lookupSymbolFeatures(r,l,u,h,g,v,w,D){const T={};this.loadVTLayers();const S=Yn(g);for(const N of r)this.loadMatchingFeature(T,{bucketIndex:u,sourceLayerIndex:h,featureIndex:N,layoutVertexArrayOffset:0},S,v,w,D,l);return T}loadFeature(r){const{featureIndex:l,sourceLayerIndex:u}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),g=this.vtFeatures[h];if(g[l])return g[l];const v=this.vtLayers[h].feature(l);return g[l]=v,v}hasLayer(r){for(const l of this.bucketLayerIDs)for(const u of l)if(r===u)return!0;return!1}getId(r,l){let u=r.id;return this.promoteId&&(u=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof u&&(u=Number(u))),u}}function Hy(a,r,l,u,h){return js(a,(g,v)=>{const w=r instanceof se?r.get(v):null;return w&&w.evaluate?w.evaluate(l,u,h):w})}function Gy(a,r){return r-a}st("FeatureIndex",$y,{omit:["rawTileData","sourceLayerCoder"]});class qy{constructor(r){const l={},u=[];for(const w in r){const D=r[w],T=l[w]={};for(const S in D.glyphs){const N=D.glyphs[+S];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const R=N.metrics.localGlyph?2:1,z={x:0,y:0,w:N.bitmap.width+2*R,h:N.bitmap.height+2*R};u.push(z),T[S]=z}}const{w:h,h:g}=$m(u),v=new Nr({width:h||1,height:g||1});for(const w in r){const D=r[w];for(const T in D.glyphs){const S=D.glyphs[+T];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const N=l[w][T],R=S.metrics.localGlyph?2:1;Nr.copy(S.bitmap,v,{x:0,y:0},{x:N.x+R,y:N.y+R},S.bitmap)}}this.image=v,this.positions=l}}st("GlyphAtlas",qy);class Wy{constructor(r){this.tileID=new Rr(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,r.projection&&(this.tileTransform=ta(r.tileID.canonical,r.projection))}parse(r,l,u,h,g){this.status="parsing",this.data=r,this.collisionBoxArray=new kr;const v=new ig(Object.keys(r.layers).sort()),w=new $y(this.tileID,this.promoteId);w.bucketLayerIDs=[];const D={},T=new tp(256,256),S={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:u},N=l.familiesBySource[this.source];for(const ye in N){const we=r.layers[ye];if(!we)continue;let Fe=!1,ke=!1;for(const Oe of N[ye])"symbol"===Oe[0].type?Fe=!0:ke=!0;if(!0===this.isSymbolTile&&!Fe||!1===this.isSymbolTile&&!ke)continue;1===we.version&&ri(`Vector tile source "${this.source}" layer "${ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const it=v.encode(ye),Ge=[];for(let Oe=0;Oe<we.length;Oe++){const qe=we.feature(Oe),We=w.getId(qe,ye);Ge.push({feature:qe,id:We,index:Oe,sourceLayerIndex:it})}for(const Oe of N[ye]){const qe=Oe[0];void 0!==this.isSymbolTile&&"symbol"===qe.type!==this.isSymbolTile||qe.minzoom&&this.zoom<Math.floor(qe.minzoom)||qe.maxzoom&&this.zoom>=qe.maxzoom||"none"!==qe.visibility&&(pg(Oe,this.zoom,u),(D[qe.id]=qe.createBucket({index:w.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:it,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:u})).populate(Ge,S,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(Oe.map(We=>We.id)))}}let R,z,j,W;T.trim();const te={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=js(S.glyphDependencies,ye=>Object.keys(ye).map(Number));Object.keys(re).length?h.send("getGlyphs",{uid:this.uid,stacks:re},(ye,we)=>{R||(R=ye,z=we,ve.call(this))},void 0,!1,te):z={};const ce=Object.keys(S.iconDependencies);ce.length?h.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"icons"},(ye,we)=>{R||(R=ye,j=we,ve.call(this))},void 0,!1,te):j={};const me=Object.keys(S.patternDependencies);function ve(){if(R)return g(R);if(z&&j&&W){const ye=new qy(z),we=new Hm(j,W);for(const Fe in D){const ke=D[Fe];ke instanceof ml?(pg(ke.layers,this.zoom,u),Ry(ke,z,ye.positions,j,we.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom)):ke.hasPattern&&(ke instanceof hh||ke instanceof Vf||ke instanceof ul)&&(pg(ke.layers,this.zoom,u),ke.addFeatures(S,this.tileID.canonical,we.patternPositions,u))}this.status="done",g(null,{buckets:La(D).filter(Fe=>!Fe.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ye.image,lineAtlas:T,imageAtlas:we,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?ye.positions:null})}}me.length?h.send("getImages",{icons:me,source:this.source,tileID:this.tileID,type:"patterns"},(ye,we)=>{R||(R=ye,W=we,ve.call(this))},void 0,!1,te):W={},ve.call(this)}}function pg(a,r,l){const u=new B(r);for(const h of a)h.recalculate(u,l)}class Zy{constructor(r){this.entries={},this.scheduler=r}request(r,l,u,h){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[v,w]=g.result;return this.scheduler?this.scheduler.add(()=>{h(v,w)},l):h(v,w),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=u((v,w)=>{g.result=[v,w];for(const D of g.callbacks)this.scheduler?this.scheduler.add(()=>{D(v,w)},l):D(v,w);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(v=>v!==h),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function mg(a,r,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const g=$(a.request,(v,w,D,T)=>{v?h(v):w&&h(null,{vectorTile:l?void 0:new Qu.VectorTile(new su(w)),rawData:w,cacheControl:D,expires:T})});return()=>{g.cancel(),h()}},r)}var Xy={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&G_(this.parallels,this.constants.parallels))return;const a=Math.sin(Mt(this.parallels[0])),r=(a+Math.sin(Mt(this.parallels[1])))/2,l=1+a*(2*r-a),u=Math.sqrt(l)/r;this.constants={n:r,c:l,r0:u,parallels:this.parallels}},project(a,r){this.initializeConstants();const l=Mt(a-this.center[0]),u=Mt(r),{n:h,c:g,r0:v}=this.constants,w=Math.sqrt(g-2*h*Math.sin(u))/h;return{x:w*Math.sin(l*h),y:w*Math.cos(l*h)-v}},unproject(a,r){this.initializeConstants();const{n:l,c:u,r0:h}=this.constants,g=h+r;let v=Math.atan2(a,Math.abs(g))*Math.sign(g);g*l<0&&(v-=Math.PI*Math.sign(a)*Math.sign(g));const w=Mt(this.center[0])*l;v=la(v,-Math.PI-w,Math.PI-w);const D=Er(v/l)+this.center[0],T=Math.asin(Sn((u-(a*a+g*g)*l*l)/(2*l),-1,1)),S=Sn(Er(T),-85.051129,Ss);return new On(D,S)}};const xh=1.340264,jo=-.081106,hu=893e-6,wh=.003796,cp=Math.sqrt(3)/2;var gC={name:"equalEarth",center:[0,0],range:[3.5,7],project(a,r){r=r/180*Math.PI,a=a/180*Math.PI;const l=Math.asin(cp*Math.sin(r)),u=l*l,h=u*u*u;return{x:.5*(a*Math.cos(l)/(cp*(xh+3*jo*u+h*(7*hu+9*wh*u)))/Math.PI+.5),y:1-.5*(l*(xh+jo*u+h*(hu+wh*u))/Math.PI+1)}},unproject(a,r){a=(2*a-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=l*l,h=u*u*u;for(let T,S,N,R=0;R<12&&(S=l*(xh+jo*u+h*(hu+wh*u))-r,N=xh+3*jo*u+h*(7*hu+9*wh*u),T=S/N,l=Sn(l-T,-Math.PI/3,Math.PI/3),u=l*l,h=u*u*u,!(Math.abs(T)<1e-12));++R);const g=cp*a*(xh+3*jo*u+h*(7*hu+9*wh*u))/Math.cos(l),v=Math.asin(Math.sin(l)/cp),w=Sn(180*g/Math.PI,-180,180),D=Sn(180*v/Math.PI,-85.051129,Ss);return new On(w,D)}},Yy={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(a,r)=>({x:.5+a/360,y:.5-r/360}),unproject(a,r){const l=360*(a-.5),u=Sn(360*(.5-r),-85.051129,Ss);return new On(l,u)}};const ld=Math.PI/2;function up(a){return Math.tan((ld+a)/2)}var L1={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&G_(this.parallels,this.constants.parallels))return;const a=Mt(this.parallels[0]),r=Mt(this.parallels[1]),l=Math.cos(a),u=a===r?Math.sin(a):Math.log(l/Math.cos(r))/Math.log(up(r)/up(a)),h=l*Math.pow(up(a),u)/u;this.constants={n:u,f:h,parallels:this.parallels}},project(a,r){this.initializeConstants(),r=Mt(r),a=Mt(a-this.center[0]);const l=1e-6,{n:u,f:h}=this.constants;h>0?r<-ld+l&&(r=-ld+l):r>ld-l&&(r=ld-l);const g=h/Math.pow(up(r),u),v=g*Math.sin(u*a),w=h-g*Math.cos(u*a);return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+.5)}},unproject(a,r){this.initializeConstants(),a=(2*a-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:l,f:u}=this.constants,h=u-r,g=Math.sign(h),v=Math.sign(l)*Math.sqrt(a*a+h*h);let w=Math.atan2(a,Math.abs(h))*g;h*l<0&&(w-=Math.PI*Math.sign(a)*g);const D=Sn(Er(w/l)+this.center[0],-180,180),T=Sn(Er(2*Math.atan(Math.pow(u/v,1/l))-ld),-85.051129,Ss);return new On(D,T)}},gg={name:"mercator",wrap:!0,center:[0,0],project:(a,r)=>({x:uc(a),y:Cm(r)}),unproject(a,r){const l=dc(a),u=Qs(r);return new On(l,u)}};const Ky=Mt(Ss);var B1={name:"naturalEarth",center:[0,0],range:[3.5,7],project(a,r){const l=(r=Mt(r))*r,u=l*l;return{x:.5*((a=Mt(a))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1)}},unproject(a,r){a=(2*a-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=25,h=0,g=l*l;do{g=l*l;const D=g*g;h=(l*(1.007226+g*(.015085+D*(.028874*g-.044475-.005916*D)))-r)/(1.007226+g*(.045255+D*(.259866*g-.311325-.005916*11*D))),l=Sn(l-h,-Ky,Ky)}while(Math.abs(h)>1e-6&&--u>0);g=l*l;const v=Sn(Er(a/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=Er(l);return new On(v,w)}};const Ch=Mt(Ss),dp={albers:Xy,equalEarth:gC,equirectangular:Yy,lambertConformalConic:L1,mercator:gg,naturalEarth:B1,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(a,r){r=Mt(r),a=Mt(a);const l=Math.cos(r),u=2/Math.PI,h=Math.acos(l*Math.cos(a/2)),g=Math.sin(h)/h,v=.5*(a*u+2*l*Math.sin(a/2)/g)||0,w=.5*(r+Math.sin(r)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1)}},unproject(a,r){let l=a=(2*a-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,h=25;const g=1e-6;let v=0,w=0;do{const D=Math.cos(u),T=Math.sin(u),S=2*T*D,N=T*T,R=D*D,z=Math.cos(l/2),j=Math.sin(l/2),W=2*z*j,te=j*j,re=1-R*z*z,ce=re?1/re:0,me=re?Math.acos(D*z)*Math.sqrt(1/re):0,ve=.5*(2*me*D*j+2*l/Math.PI)-a,ye=.5*(me*T+u)-r,we=.5*ce*(R*te+me*D*z*N)+1/Math.PI,Fe=ce*(W*S/4-me*T*j),ke=.125*ce*(S*j-me*T*R*W),it=.5*ce*(N*z+me*te*D)+.5,Ge=Fe*ke-it*we;v=(ye*Fe-ve*it)/Ge,w=(ve*ke-ye*we)/Ge,l=Sn(l-v,-Math.PI,Math.PI),u=Sn(u-w,-Ch,Ch)}while((Math.abs(v)>g||Math.abs(w)>g)&&--h>0);return new On(Er(l),Er(u))}}};p.ARRAY_TYPE=Wr,p.AUTH_ERR_MSG=ai,p.Actor=class{constructor(a,r,l){this.target=a,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Io(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Jo()?a:ut,this.scheduler=new N1}send(a,r,l,u,h=!1,g){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[v]=l);const w=Cc(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:h,sourceMapId:this.mapId,data:ao(r,w)},w),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const r=a.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(r.mustQueue||Jo()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,r),u&&u.metadata||{type:"message"})}else this.processTask(l,r)}processTask(a,r){if("<response>"===r.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(r.error?l($c(r.error)):l(null,$c(r.data)))}else{const l=Cc(this.globalScope)?void 0:[],u=r.hasCallback?(g,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:g?ao(g):null,data:ao(v,l)},l)}:g=>{},h=$c(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,u);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],h.source)[g[1]](h,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=ng,p.Color=mn,p.ColorMode=yl,p.CullFaceMode=Sa,p.DEMData=op,p.DataConstantProperty=J,p.DedupedRequest=Zy,p.DepthMode=vr,p.EXTENT=fn,p.Elevation=class{getAtPointOrZero(a,r=0){return this.getAtPoint(a,r)||0}getAtPoint(a,r,l=!0){null==r&&(r=null);const u=this._source();if(!u||a.y<0||a.y>1)return r;const h=u.getSource().maxzoom,g=1<<h,v=Math.floor(a.x),w=a.x-v,D=new Rr(h,v,h,Math.floor(w*g),Math.floor(a.y*g)),T=this.findDEMTileFor(D);if(!T||!T.dem)return r;const S=T.dem,N=1<<T.tileID.canonical.z,R=(w*N-T.tileID.canonical.x)*S.dim,z=(a.y*N-T.tileID.canonical.y)*S.dim,j=Math.floor(R),W=Math.floor(z);return(l?this.exaggeration():1)*pt(pt(S.get(j,W),S.get(j,W+1),z-W),pt(S.get(j+1,W),S.get(j+1,W+1),z-W),R-j)}getAtTileOffset(a,r,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new wf(a.wrap+(a.canonical.x+r/fn)/u,(a.canonical.y+l/fn)/u))}getForTilePoints(a,r,l,u){const h=lp.create(this,a,u);return!!h&&(r.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],l)}),!0)}getMinMaxForTile(a){const r=this.findDEMTileFor(a);if(!r||!r.dem)return null;const l=r.dem.tree,u=r.tileID,h=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/h-u.canonical.x,v=a.canonical.y/h-u.canonical.y,w=0;for(let D=0;D<a.canonical.z-u.canonical.z&&!l.leaves[w];D++){g*=2,v*=2;const T=2*Math.floor(v)+Math.floor(g);w=l.childOffsets[w]+T,g%=1,v%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=vt,p.EvaluationParameters=B,p.Event=Le,p.Evented=Je,p.GlyphManager=rd,p.ImagePosition=Gf,p.LineAtlas=tp,p.LngLat=On,p.LngLatBounds=Xc,p.LocalGlyphMode=Ym,p.MAX_MERCATOR_LATITUDE=Ss,p.MAX_SAFE_INTEGER=Ko,p.MercatorCoordinate=wf,p.ONE_EM=24,p.OverscaledTileID=Rr,p.Properties=Ne,p.RGBAImage=Pr,p.RequestManager=class{constructor(a,r,l){this._transformRequestFn=a,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ys,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,r){return this._transformRequestFn&&this._transformRequestFn(a,r)||{url:a}}normalizeStyleURL(a,r){if(!Ao(a))return a;const l=fr(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(a,r){if(!Ao(a))return a;const l=fr(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(a,r){if(!Ao(a))return a;const l=fr(a);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||r)}normalizeSpriteURL(a,r,l,u){const h=fr(a);return Ao(a)?(h.path=`/styles/v1${h.path}/sprite${r}${l}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${r}${l}`,zi(h))}normalizeTileURL(a,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Ao(a))return a;const u=fr(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&"raster"!==u.authority&&512===l?"@2x":""}${Ua.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${on.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${on.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(g){for(const v of g){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(u.params)||on.ACCESS_TOKEN;return on.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(a,r){const l=fr(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${on.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${on.TILE_URL_VERSION}/`,"")}`;let h=l.params;return r&&(h=h.filter(g=>!g.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(a,r){const l=!!r&&Ao(r),u=[];for(const h of a.tiles||[])da(h)?u.push(this.canonicalizeTileURL(h,l)):u.push(h);return u}_makeAPIURL(a,r){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=fr(on.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const h=a.params.indexOf("secure");h>=0&&a.params.splice(h,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!on.REQUIRE_ACCESS_TOKEN)return zi(a);if(r=r||on.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(h=>-1===h.indexOf("access_token")),a.params.push(`access_token=${r||""}`),zi(a)}},p.ResourceType=Ga,p.SegmentVector=dr,p.SourceCache=du,p.StencilMode=hg,p.StructArrayLayout1ui2=yr,p.StructArrayLayout2f1f2i16=Ci,p.StructArrayLayout2i4=ft,p.StructArrayLayout2ui4=Kn,p.StructArrayLayout3f12=Pt,p.StructArrayLayout3ui6=ni,p.StructArrayLayout4i8=wt,p.Texture=ep,p.Tile=rp,p.Transitionable=ee,p.Uniform1f=Kd,p.Uniform1i=class extends qr{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends qr{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},p.Uniform3f=class extends qr{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},p.Uniform4f=I_,p.UniformColor=S_,p.UniformMatrix2f=class extends qr{constructor(a,r){super(a,r),this.current=A_}set(a){for(let r=0;r<4;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends qr{constructor(a,r){super(a,r),this.current=nC}set(a){for(let r=0;r<9;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends qr{constructor(a,r){super(a,r),this.current=tC}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},p.UnwrappedTileID=P1,p.ValidationError=Ae,p.VectorTileWorkerSource=class extends Je{constructor(a,r,l,u,h){super(),this.actor=a,this.layerIndex=r,this.availableImages=l,this.loadVectorData=h||mg,this.loading={},this.loaded={},this.deduped=new Zy(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,r){const l=a.uid,u=a&&a.request,h=u&&u.collectResourceTiming,g=this.loading[l]=new Wy(a);g.abort=this.loadVectorData(a,(v,w)=>{const D=!this.loading[l];if(delete this.loading[l],D||v||!w)return g.status="done",D||(this.loaded[l]=g),r(v);const T=w.rawData,S={};w.expires&&(S.expires=w.expires),w.cacheControl&&(S.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new Qu.VectorTile(new su(T));const N=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,z)=>{if(R||!z)return r(R);const j={};if(h){const W=np(u);W.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(W)))}r(null,Qi({rawTileData:T.slice(0)},z,S,j))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[l]=g})}reloadTile(a,r){const l=this.loaded,u=a.uid,h=this;if(l&&l[u]){const g=l[u];g.showCollisionBoxes=a.showCollisionBoxes,g.enableTerrain=!!a.enableTerrain;const v=(w,D)=>{const T=g.reloadCallback;T&&(delete g.reloadCallback,g.parse(g.vectorTile,h.layerIndex,this.availableImages,h.actor,T)),r(w,D)};"parsing"===g.status?g.reloadCallback=v:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,r){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),r()}removeTile(a,r){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],r()}},p.WritingMode=Uo,p.ZoomHistory=Hd,p.add=function(a,r,l){return a[0]=r[0]+l[0],a[1]=r[1]+l[1],a[2]=r[2]+l[2],a},p.addDynamicAttributes=Fy,p.altitudeFromMercatorZ=cl,p.asyncAll=dn,p.bezier=To,p.bindAll=Io,p.boundsAttributes=ip,p.bufferConvexPolygon=function(a,r){const l=[];for(let u=0;u<a.length;u++){const h=la(u-1,-1,a.length-1),g=la(u+1,-1,a.length-1),v=a[u],w=a[g],D=a[h].sub(v).unit(),T=w.sub(v).unit(),S=T.angleWithSep(D.x,D.y),N=D.add(T).unit().mult(-1*r/Math.sin(S/2));l.push(v.add(N))}return l},p.cacheEntryPossiblyAdded=function(a){Ha++,Ha>an&&(a.getActor().send("enforceCacheSizeLimit",Ic),Ha=0)},p.clamp=Sn,p.clearTileCache=function(a){const r=ut.caches.delete(Mc);a&&r.catch(a).then(()=>a())},p.clipLine=Iy,p.clone=function(a){var r=new Wr(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},p.clone$1=function(a){var r=new Wr(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},p.clone$2=Bi,p.collisionCircleLayout=ss,p.config=on,p.conjugate=function(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a[3]=r[3],a},p.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a},p.create=nh,p.create$1=function(){var a=new Wr(16);return Wr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$2=O_,p.createExpression=Ql,p.createLayout=Te,p.createStyleLayer=function(a){return"custom"===a.type?new fC(a):new mC[a.type](a)},p.cross=function(a,r,l){var u=r[0],h=r[1],g=r[2],v=l[0],w=l[1],D=l[2];return a[0]=h*D-g*w,a[1]=g*v-u*D,a[2]=u*w-h*v,a},p.degToRad=Mt,p.div=function(a,r,l){return a[0]=r[0]/l[0],a[1]=r[1]/l[1],a[2]=r[2]/l[2],a},p.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},p.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},p.ease=Mo,p.easeCubicInOut=Ol,p.emitValidationErrors=Nu,p.endsWith=Ut,p.enforceCacheSizeLimit=function(a){Qo(),ko&&ko.then(r=>{r.keys().then(l=>{for(let u=0;u<l.length-a;u++)r.delete(l[u])})})},p.evaluateSizeForFeature=fh,p.evaluateSizeForZoom=Ta,p.evaluateVariableOffset=Jf,p.evented=I,p.exactEquals=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]},p.exactEquals$1=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]},p.exported=to,p.exported$1=Ua,p.extend=Qi,p.filterObject=_s,p.fromMat4=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[4],a[4]=r[5],a[5]=r[6],a[6]=r[8],a[7]=r[9],a[8]=r[10],a},p.fromQuat=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],v=l+l,w=u+u,D=h+h,T=l*v,S=u*v,N=u*w,R=h*v,z=h*w,j=h*D,W=g*v,te=g*w,re=g*D;return a[0]=1-N-j,a[1]=S+re,a[2]=R-te,a[3]=0,a[4]=S-re,a[5]=1-T-j,a[6]=z+W,a[7]=0,a[8]=R+te,a[9]=z-W,a[10]=1-T-N,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,r){var l=Math.sin(r),u=Math.cos(r);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.furthestTileCorner=function(a){const r=Math.round((a+45+360)%360/90)%4;return vu[r]},p.getAABBPointSquareDist=function(a,r,l){let u=0;for(let h=0;h<2;++h){const g=l?l[h]:0;a[h]>g&&(u+=(a[h]-g)*(a[h]-g)),r[h]<g&&(u+=(g-r[h])*(g-r[h]))}return u},p.getAnchorAlignment=Wm,p.getAnchorJustification=gh,p.getBounds=function(a){let r=1/0,l=1/0,u=-1/0,h=-1/0;for(const g of a)r=Math.min(r,g.x),l=Math.min(l,g.y),u=Math.max(u,g.x),h=Math.max(h,g.y);return{min:new $e(r,l),max:new $e(u,h)}},p.getImage=Ce,p.getJSON=function(a,r){return V(Qi(a,{type:"json"}),r)},p.getMapSessionAPI=Ad,p.getPerformanceMeasurement=np,p.getProjection=function(a){const r=dp[a.name];if(!r)throw new Error(`Invalid projection name: ${a.name}`);return r.conic?function(l,u){if(u.parallels&&Math.abs(u.parallels[0]+u.parallels[1])<.01){let h=function(g){const v=Math.max(.01,Math.cos(Mt(g))),w=1/(2*Math.max(Math.PI*v,1/v));return{wrap:!0,project(D,T){const S=Mt(D)*v,N=Math.sin(Mt(T))/v;return{x:S*w+.5,y:-N*w+.5}},unproject(D,T){const S=-(T-.5)/w,N=Sn(Er((D-.5)/w)/v,-180,180),R=Math.asin(Sn(S*v,-1,1)),z=Sn(Er(R),-85.051129,Ss);return new On(N,z)}}}(u.parallels[0]);if("lambertConformalConic"===u.name){const{project:g,unproject:v}=dp.mercator;h={wrap:!0,project:g,unproject:v}}return om(om(om({},l),u),h)}return om(om({},l),u)}(r,a):r},p.getRTLTextPluginStatus=P,p.getReferrer=G,p.getTilePoint=function(a,{x:r,y:l},u=0){return new $e(((r-u)*a.scale-a.x)*fn,(l*a.scale-a.y)*fn)},p.getTileVec3=function(a,r,l=0){return Qc(((r.x-l)*a.scale-a.x)*fn,(r.y*a.scale-a.y)*fn,cl(r.z,r.y))},p.getVideo=function(a,r){const l=ut.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let u=0;u<a.length;u++){const h=ut.document.createElement("source");he(a[u])||(l.crossOrigin="Anonymous"),h.src=a[u],l.appendChild(h)}return{cancel:()=>{}}},p.identity=L_,p.identity$1=$_,p.invert=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],v=r[4],w=r[5],D=r[6],T=r[7],S=r[8],N=r[9],R=r[10],z=r[11],j=r[12],W=r[13],te=r[14],re=r[15],ce=l*w-u*v,me=l*D-h*v,ve=l*T-g*v,ye=u*D-h*w,we=u*T-g*w,Fe=h*T-g*D,ke=S*W-N*j,it=S*te-R*j,Ge=S*re-z*j,Oe=N*te-R*W,qe=N*re-z*W,We=R*re-z*te,ze=ce*We-me*qe+ve*Oe+ye*Ge-we*it+Fe*ke;return ze?(a[0]=(w*We-D*qe+T*Oe)*(ze=1/ze),a[1]=(h*qe-u*We-g*Oe)*ze,a[2]=(W*Fe-te*we+re*ye)*ze,a[3]=(R*we-N*Fe-z*ye)*ze,a[4]=(D*Ge-v*We-T*it)*ze,a[5]=(l*We-h*Ge+g*it)*ze,a[6]=(te*ve-j*Fe-re*me)*ze,a[7]=(S*Fe-R*ve+z*me)*ze,a[8]=(v*qe-w*Ge+T*ke)*ze,a[9]=(u*Ge-l*qe-g*ke)*ze,a[10]=(j*we-W*ve+re*ce)*ze,a[11]=(N*ve-S*we-z*ce)*ze,a[12]=(w*it-v*Oe-D*ke)*ze,a[13]=(l*Oe-u*it+h*ke)*ze,a[14]=(W*me-j*ye-te*ce)*ze,a[15]=(S*ye-N*me+R*ce)*ze,a):null},p.isMapAuthenticated=function(a){return fa.has(a)},p.isMapboxURL=Ao,p.latFromMercatorY=Qs,p.len=j_,p.length=Im,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.loadVectorTile=mg,p.makeRequest=V,p.mercatorXfromLng=uc,p.mercatorYfromLat=Cm,p.mercatorZfromAltitude=Be,p.mul=function(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a[3]=r[3]*l[3],a},p.mul$1=Mm,p.mul$2=Da,p.multiply=th,p.multiply$1=B_,p.nextPowerOfTwo=Rn,p.normalize=z_,p.normalize$1=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],v=l*l+u*u+h*h+g*g;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=h*v,a[3]=g*v,a},p.number=pt,p.ortho=function(a,r,l,u,h,g,v){var w=1/(r-l),D=1/(u-h),T=1/(g-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(r+l)*w,a[13]=(h+u)*D,a[14]=(v+g)*T,a[15]=1,a},p.pbf=su,p.perspective=function(a,r,l,u,h){var g,v=1/Math.tan(r/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=h&&h!==1/0?(a[10]=(h+u)*(g=1/(u-h)),a[14]=2*h*u*g):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,r){const l={};for(let u=0;u<r.length;u++){const h=r[u];h in a&&(l[h]=a[h])}return l},p.plugin=O,p.pointGeometry=$e,p.polygonIntersectsBox=R_,p.polygonIntersectsPolygon=Tf,p.polygonizeBounds=function(a,r,l=0,u=!0){const h=new $e(l,l),g=a.sub(h),v=r.add(h),w=[g,new $e(v.x,g.y),v,new $e(g.x,v.y)];return u&&w.push(g),w},p.posAttributes=R1,p.postMapLoadEvent=Sd,p.postTurnstileEvent=Tc,p.potpack=$m,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=Er,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:_,pluginURL:b}),I.on("pluginStateChange",a),a},p.removeAuthState=function(a){fa.delete(a)},p.renderColorRamp=Af,p.rotateX=function(a,r,l){var u=Math.sin(l),h=Math.cos(l),g=r[4],v=r[5],w=r[6],D=r[7],T=r[8],S=r[9],N=r[10],R=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=g*h+T*u,a[5]=v*h+S*u,a[6]=w*h+N*u,a[7]=D*h+R*u,a[8]=T*h-g*u,a[9]=S*h-v*u,a[10]=N*h-w*u,a[11]=R*h-D*u,a},p.rotateX$1=H_,p.rotateY=function(a,r,l){var u=Math.sin(l),h=Math.cos(l),g=r[0],v=r[1],w=r[2],D=r[3],T=r[8],S=r[9],N=r[10],R=r[11];return r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*h-T*u,a[1]=v*h-S*u,a[2]=w*h-N*u,a[3]=D*h-R*u,a[8]=g*u+T*h,a[9]=v*u+S*h,a[10]=w*u+N*h,a[11]=D*u+R*h,a},p.rotateZ=function(a,r,l){var u=Math.sin(l),h=Math.cos(l),g=r[0],v=r[1],w=r[2],D=r[3],T=r[4],S=r[5],N=r[6],R=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*h+T*u,a[1]=v*h+S*u,a[2]=w*h+N*u,a[3]=D*h+R*u,a[4]=T*h-g*u,a[5]=S*h-v*u,a[6]=N*h-w*u,a[7]=R*h-D*u,a},p.rotateZ$1=function(a,r,l){l*=.5;var u=r[0],h=r[1],g=r[2],v=r[3],w=Math.sin(l),D=Math.cos(l);return a[0]=u*D+h*w,a[1]=h*D-u*w,a[2]=g*D+v*w,a[3]=v*D-g*w,a},p.scale=function(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a},p.scale$1=function(a,r,l){var u=l[0],h=l[1],g=l[2];return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a[3]=r[3]*u,a[4]=r[4]*h,a[5]=r[5]*h,a[6]=r[6]*h,a[7]=r[7]*h,a[8]=r[8]*g,a[9]=r[9]*g,a[10]=r[10]*g,a[11]=r[11]*g,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},p.scale$2=function(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a[3]=r[3]*l,a},p.scaleAndAdd=V_,p.setCacheLimits=function(a,r){Ic=a,an=r},p.setRTLTextPlugin=function(a,r,l=!1){if(_===Ms||_===m||_===s)throw new Error("setRTLTextPlugin cannot be called multiple times.");b=to.resolveURL(a),_=Ms,d=r,E(),l||F()},p.smoothstep=function(a,r,l){return(l=Sn((l-a)/(r-a),0,1))*l*(3-2*l)},p.spec=be,p.storeAuthState=function(a,r){r?fa.add(a):fa.delete(a)},p.sub=os,p.subtract=hc,p.symbolSize=py,p.tileTransform=ta,p.transformMat3=function(a,r,l){var u=r[0],h=r[1],g=r[2];return a[0]=u*l[0]+h*l[3]+g*l[6],a[1]=u*l[1]+h*l[4]+g*l[7],a[2]=u*l[2]+h*l[5]+g*l[8],a},p.transformMat4=rh,p.transformMat4$1=function(a,r,l){var u=r[0],h=r[1],g=r[2],v=l[3]*u+l[7]*h+l[11]*g+l[15];return a[0]=(l[0]*u+l[4]*h+l[8]*g+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*h+l[9]*g+l[13])/v,a[2]=(l[2]*u+l[6]*h+l[10]*g+l[14])/v,a},p.transformQuat=U_,p.translate=function(a,r,l){var u,h,g,v,w,D,T,S,N,R,z,j,W=l[0],te=l[1],re=l[2];return r===a?(a[12]=r[0]*W+r[4]*te+r[8]*re+r[12],a[13]=r[1]*W+r[5]*te+r[9]*re+r[13],a[14]=r[2]*W+r[6]*te+r[10]*re+r[14],a[15]=r[3]*W+r[7]*te+r[11]*re+r[15]):(h=r[1],g=r[2],v=r[3],w=r[4],D=r[5],T=r[6],S=r[7],N=r[8],R=r[9],z=r[10],j=r[11],a[0]=u=r[0],a[1]=h,a[2]=g,a[3]=v,a[4]=w,a[5]=D,a[6]=T,a[7]=S,a[8]=N,a[9]=R,a[10]=z,a[11]=j,a[12]=u*W+w*te+N*re+r[12],a[13]=h*W+D*te+R*re+r[13],a[14]=g*W+T*te+z*re+r[14],a[15]=v*W+S*te+j*re+r[15]),a},p.triggerPluginCompletionEvent=x,p.uniqueId=Ba,p.validateCustomStyleLayer=function(a){const r=[],l=a.id;return void 0===l&&r.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&r.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFog=il,p.validateLight=hf,p.validateStyle=ti,p.values=La,p.vectorTile=Qu,p.version="2.6.0",p.warnOnce=ri,p.window=ut,p.wrap=la}),Td(0,function(p){function $r(G){const V=typeof G;if("number"===V||"boolean"===V||"string"===V||null==G)return JSON.stringify(G);if(Array.isArray(G)){let oe="[";for(const he of G)oe+=`${$r(he)},`;return`${oe}]`}const $=Object.keys(G).sort();let Q="{";for(let oe=0;oe<$.length;oe++)Q+=`${JSON.stringify($[oe])}:${$r(G[$[oe]])},`;return`${Q}}`}function Cr(G){let V="";for(const $ of p.refProperties)V+=`/${$r(G[$])}`;return V}class Dr{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const oe of V)this._layerConfigs[oe.id]=oe,(this._layers[oe.id]=p.createStyleLayer(oe)).compileFilter(),this.keyCache[oe.id]&&delete this.keyCache[oe.id];for(const oe of $)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const Q=function(oe,he){const de={};for(let pe=0;pe<oe.length;pe++){const Ce=he&&he[oe[pe].id]||Cr(oe[pe]);he&&(he[oe[pe].id]=Ce);let Ve=de[Ce];Ve||(Ve=de[Ce]=[]),Ve.push(oe[pe])}const _e=[];for(const pe in de)_e.push(de[pe]);return _e}(p.values(this._layerConfigs),this.keyCache);for(const oe of Q){const he=oe.map(Qe=>this._layers[Qe.id]),de=he[0];if("none"===de.visibility)continue;const _e=de.source||"";let pe=this.familiesBySource[_e];pe||(pe=this.familiesBySource[_e]={});const Ce=de.sourceLayer||"_geojsonTileLayer";let Ve=pe[Ce];Ve||(Ve=pe[Ce]=[]),Ve.push(he)}}}const{ImageBitmap:$e}=p.window;class je{loadTile(V,$){const{uid:Q,encoding:oe,rawImageData:he,padding:de,buildQuadTree:_e}=V,pe=$e&&he instanceof $e?this.getImageData(he,de):he;$(null,new p.DEMData(Q,pe,oe,de<1,_e))}getImageData(V,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const Q=this.offscreenCanvasContext.getImageData(-$,-$,V.width+2*$,V.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:Q.width,height:Q.height},Q.data)}}var ut=function G(V,$){var Q,oe=V&&V.type;if("FeatureCollection"===oe)for(Q=0;Q<V.features.length;Q++)G(V.features[Q],$);else if("GeometryCollection"===oe)for(Q=0;Q<V.geometries.length;Q++)G(V.geometries[Q],$);else if("Feature"===oe)G(V.geometry,$);else if("Polygon"===oe)Ko(V.coordinates,$);else if("MultiPolygon"===oe)for(Q=0;Q<V.coordinates.length;Q++)Ko(V.coordinates[Q],$);return V};function Ko(G,V){if(0!==G.length){aa(G[0],V);for(var $=1;$<G.length;$++)aa(G[$],!V)}}function aa(G,V){for(var $=0,Q=0,oe=0,he=G.length,de=he-1;oe<he;de=oe++){var _e=(G[oe][0]-G[de][0])*(G[de][1]+G[oe][1]),pe=$+_e;Q+=Math.abs($)>=Math.abs(_e)?$-pe+_e:_e-pe+$,$=pe}$+Q>=0!=!!V&&G.reverse()}const wc=p.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Mt{constructor(V){this._feature=V,this.extent=p.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(1===this._feature.type){const V=[];for(const $ of this._feature.geometry)V.push([new p.pointGeometry($[0],$[1])]);return V}{const V=[];for(const $ of this._feature.geometry){const Q=[];for(const oe of $)Q.push(new p.pointGeometry(oe[0],oe[1]));V.push(Q)}return V}}toGeoJSON(V,$,Q){return wc.call(this,V,$,Q)}}class Er{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=V.length,this._features=V}feature(V){return new Mt(this._features[V])}}var vu=p.vectorTile.VectorTileFeature,Ol=To;function To(G,V){this.options=V||{},this.features=G,this.length=G.length}function Mo(G,V){this.id="number"==typeof G.id?G.id:void 0,this.type=G.type,this.rawGeometry=1===G.type?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=V||4096}To.prototype.feature=function(G){return new Mo(this.features[G],this.options.extent)},Mo.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var V=0;V<G.length;V++){for(var $=G[V],Q=[],oe=0;oe<$.length;oe++)Q.push(new p.pointGeometry($[oe][0],$[oe][1]));this.geometry.push(Q)}return this.geometry},Mo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,V=1/0,$=-1/0,Q=1/0,oe=-1/0,he=0;he<G.length;he++)for(var de=G[he],_e=0;_e<de.length;_e++){var pe=de[_e];V=Math.min(V,pe.x),$=Math.max($,pe.x),Q=Math.min(Q,pe.y),oe=Math.max(oe,pe.y)}return[V,Q,$,oe]},Mo.prototype.toGeoJSON=vu.prototype.toGeoJSON;var Sn=dn,la=Ol;function dn(G){var V=new p.pbf;return function($,Q){for(var oe in $.layers)Q.writeMessage(3,La,$.layers[oe])}(G,V),V.finish()}function La(G,V){var $;V.writeVarintField(15,G.version||1),V.writeStringField(1,G.name||""),V.writeVarintField(5,G.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<G.length;$++)Q.feature=G.feature($),V.writeMessage(2,Qi,Q);var oe=Q.keys;for($=0;$<oe.length;$++)V.writeStringField(3,oe[$]);var he=Q.values;for($=0;$<he.length;$++)V.writeMessage(4,Bl,he[$])}function Qi(G,V){var $=G.feature;void 0!==$.id&&V.writeVarintField(1,$.id),V.writeMessage(2,ca,G),V.writeVarintField(3,$.type),V.writeMessage(4,Rn,$)}function ca(G,V){var $=G.feature,Q=G.keys,oe=G.values,he=G.keycache,de=G.valuecache;for(var _e in $.properties){var pe=$.properties[_e],Ce=he[_e];if(null!==pe){void 0===Ce&&(Q.push(_e),he[_e]=Ce=Q.length-1),V.writeVarint(Ce);var Ve=typeof pe;"string"!==Ve&&"boolean"!==Ve&&"number"!==Ve&&(pe=JSON.stringify(pe));var Qe=Ve+":"+pe,Le=de[Qe];void 0===Le&&(oe.push(pe),de[Qe]=Le=oe.length-1),V.writeVarint(Le)}}}function Ba(G,V){return(V<<3)+(7&G)}function Ll(G){return G<<1^G>>31}function Rn(G,V){for(var $=G.loadGeometry(),Q=G.type,oe=0,he=0,de=$.length,_e=0;_e<de;_e++){var pe=$[_e],Ce=1;1===Q&&(Ce=pe.length),V.writeVarint(Ba(1,Ce));for(var Ve=3===Q?pe.length-1:pe.length,Qe=0;Qe<Ve;Qe++){1===Qe&&1!==Q&&V.writeVarint(Ba(2,Ve-1));var Le=pe[Qe].x-oe,vt=pe[Qe].y-he;V.writeVarint(Ll(Le)),V.writeVarint(Ll(vt)),oe+=Le,he+=vt}3===Q&&V.writeVarint(Ba(7,1))}}function Bl(G,V){var $=typeof G;"string"===$?V.writeStringField(1,G):"boolean"===$?V.writeBooleanField(7,G):"number"===$&&(G%1!=0?V.writeDoubleField(3,G):G<0?V.writeSVarintField(6,G):V.writeVarintField(5,G))}function Io(G,V,$,Q,oe,he){if(oe-Q<=$)return;const de=Q+oe>>1;Ut(G,V,de,Q,oe,he%2),Io(G,V,$,Q,de-1,he+1),Io(G,V,$,de+1,oe,he+1)}function Ut(G,V,$,Q,oe,he){for(;oe>Q;){if(oe-Q>600){const Ce=oe-Q+1,Ve=$-Q+1,Qe=Math.log(Ce),Le=.5*Math.exp(2*Qe/3),vt=.5*Math.sqrt(Qe*Le*(Ce-Le)/Ce)*(Ve-Ce/2<0?-1:1);Ut(G,V,$,Math.max(Q,Math.floor($-Ve*Le/Ce+vt)),Math.min(oe,Math.floor($+(Ce-Ve)*Le/Ce+vt)),he)}const de=V[2*$+he];let _e=Q,pe=oe;for(js(G,V,Q,$),V[2*oe+he]>de&&js(G,V,Q,oe);_e<pe;){for(js(G,V,_e,pe),_e++,pe--;V[2*_e+he]<de;)_e++;for(;V[2*pe+he]>de;)pe--}V[2*Q+he]===de?js(G,V,Q,pe):(pe++,js(G,V,pe,oe)),pe<=$&&(Q=pe+1),$<=pe&&(oe=pe-1)}}function js(G,V,$,Q){_s(G,$,Q),_s(V,2*$,2*Q),_s(V,2*$+1,2*Q+1)}function _s(G,V,$){const Q=G[V];G[V]=G[$],G[$]=Q}function Bi(G,V,$,Q){const oe=G-$,he=V-Q;return oe*oe+he*he}Sn.fromVectorTileJs=dn,Sn.fromGeojsonVt=function(G,V){V=V||{};var $={};for(var Q in G)$[Q]=new Ol(G[Q].features,V),$[Q].name=Q,$[Q].version=V.version,$[Q].extent=V.extent;return dn({layers:$})},Sn.GeoJSONWrapper=la;const Vl=G=>G[0],ri=G=>G[1];class Vi{constructor(V,$=Vl,Q=ri,oe=64,he=Float64Array){this.nodeSize=oe,this.points=V;const de=V.length<65536?Uint16Array:Uint32Array,_e=this.ids=new de(V.length),pe=this.coords=new he(2*V.length);for(let Ce=0;Ce<V.length;Ce++)_e[Ce]=Ce,pe[2*Ce]=$(V[Ce]),pe[2*Ce+1]=Q(V[Ce]);Io(_e,pe,oe,0,_e.length-1,0)}range(V,$,Q,oe){return function(he,de,_e,pe,Ce,Ve,Qe){const Le=[0,he.length-1,0],vt=[];let Je,be;for(;Le.length;){const Ae=Le.pop(),tn=Le.pop(),Tn=Le.pop();if(tn-Tn<=Qe){for(let pn=Tn;pn<=tn;pn++)Je=de[2*pn],be=de[2*pn+1],Je>=_e&&Je<=Ce&&be>=pe&&be<=Ve&&vt.push(he[pn]);continue}const Ot=Math.floor((Tn+tn)/2);Je=de[2*Ot],be=de[2*Ot+1],Je>=_e&&Je<=Ce&&be>=pe&&be<=Ve&&vt.push(he[Ot]);const hn=(Ae+1)%2;(0===Ae?_e<=Je:pe<=be)&&(Le.push(Tn),Le.push(Ot-1),Le.push(hn)),(0===Ae?Ce>=Je:Ve>=be)&&(Le.push(Ot+1),Le.push(tn),Le.push(hn))}return vt}(this.ids,this.coords,V,$,Q,oe,this.nodeSize)}within(V,$,Q){return function(oe,he,de,_e,pe,Ce){const Ve=[0,oe.length-1,0],Qe=[],Le=pe*pe;for(;Ve.length;){const vt=Ve.pop(),Je=Ve.pop(),be=Ve.pop();if(Je-be<=Ce){for(let hn=be;hn<=Je;hn++)Bi(he[2*hn],he[2*hn+1],de,_e)<=Le&&Qe.push(oe[hn]);continue}const Ae=Math.floor((be+Je)/2),tn=he[2*Ae],Tn=he[2*Ae+1];Bi(tn,Tn,de,_e)<=Le&&Qe.push(oe[Ae]);const Ot=(vt+1)%2;(0===vt?de-pe<=tn:_e-pe<=Tn)&&(Ve.push(be),Ve.push(Ae-1),Ve.push(Ot)),(0===vt?de+pe>=tn:_e+pe>=Tn)&&(Ve.push(Ae+1),Ve.push(Je),Ve.push(Ot))}return Qe}(this.ids,this.coords,V,$,Q,this.nodeSize)}}const Md={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},Jo=Math.fround||(Va=new Float32Array(1),G=>(Va[0]=+G,Va[0]));var Va;class za{constructor(V){this.options=on(Object.create(Md),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:$,minZoom:Q,maxZoom:oe,nodeSize:he}=this.options;$&&console.time("total time");const de=`prepare ${V.length} points`;$&&console.time(de),this.points=V;let _e=[];for(let pe=0;pe<V.length;pe++)V[pe].geometry&&_e.push(ua(V[pe],pe));this.trees[oe+1]=new Vi(_e,Ua,oi,he,Float32Array),$&&console.timeEnd(de);for(let pe=oe;pe>=Q;pe--){const Ce=+Date.now();_e=this._cluster(_e,pe),this.trees[pe]=new Vi(_e,Ua,oi,he,Float32Array),$&&console.log("z%d: %d clusters in %dms",pe,_e.length,+Date.now()-Ce)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let Q=((V[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,V[1]));let he=180===V[2]?180:((V[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)Q=-180,he=180;else if(Q>he){const Ve=this.getClusters([Q,oe,180,de],$),Qe=this.getClusters([-180,oe,he,de],$);return Ve.concat(Qe)}const _e=this.trees[this._limitZoom($)],pe=_e.range($s(Q),to(de),$s(he),to(oe)),Ce=[];for(const Ve of pe){const Qe=_e.points[Ve];Ce.push(Qe.numPoints?zl(Qe):this.points[Qe.index])}return Ce}getChildren(V){const $=this._getOriginId(V),Q=this._getOriginZoom(V),oe="No cluster with the specified id.",he=this.trees[Q];if(!he)throw new Error(oe);const de=he.points[$];if(!de)throw new Error(oe);const _e=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),pe=he.within(de.x,de.y,_e),Ce=[];for(const Ve of pe){const Qe=he.points[Ve];Qe.parentId===V&&Ce.push(Qe.numPoints?zl(Qe):this.points[Qe.index])}if(0===Ce.length)throw new Error(oe);return Ce}getLeaves(V,$,Q){const oe=[];return this._appendLeaves(oe,V,$=$||10,Q=Q||0,0),oe}getTile(V,$,Q){const oe=this.trees[this._limitZoom(V)],he=Math.pow(2,V),{extent:de,radius:_e}=this.options,pe=_e/de,Ce=(Q-pe)/he,Ve=(Q+1+pe)/he,Qe={features:[]};return this._addTileFeatures(oe.range(($-pe)/he,Ce,($+1+pe)/he,Ve),oe.points,$,Q,he,Qe),0===$&&this._addTileFeatures(oe.range(1-pe/he,Ce,1,Ve),oe.points,he,Q,he,Qe),$===he-1&&this._addTileFeatures(oe.range(0,Ce,pe/he,Ve),oe.points,-1,Q,he,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){const Q=this.getChildren(V);if($++,1!==Q.length)break;V=Q[0].properties.cluster_id}return $}_appendLeaves(V,$,Q,oe,he){const de=this.getChildren($);for(const _e of de){const pe=_e.properties;if(pe&&pe.cluster?he+pe.point_count<=oe?he+=pe.point_count:he=this._appendLeaves(V,pe.cluster_id,Q,oe,he):he<oe?he++:V.push(_e),V.length===Q)break}return he}_addTileFeatures(V,$,Q,oe,he,de){for(const _e of V){const pe=$[_e],Ce=pe.numPoints;let Ve,Qe,Le;if(Ce)Ve=Cc(pe),Qe=pe.x,Le=pe.y;else{const be=this.points[pe.index];Ve=be.properties,Qe=$s(be.geometry.coordinates[0]),Le=to(be.geometry.coordinates[1])}const vt={type:1,geometry:[[Math.round(this.options.extent*(Qe*he-Q)),Math.round(this.options.extent*(Le*he-oe))]],tags:Ve};let Je;Ce?Je=pe.id:this.options.generateId?Je=pe.index:this.points[pe.index].id&&(Je=this.points[pe.index].id),void 0!==Je&&(vt.id=Je),de.features.push(vt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,$){const Q=[],{radius:oe,extent:he,reduce:de,minPoints:_e}=this.options,pe=oe/(he*Math.pow(2,$));for(let Ce=0;Ce<V.length;Ce++){const Ve=V[Ce];if(Ve.zoom<=$)continue;Ve.zoom=$;const Qe=this.trees[$+1],Le=Qe.within(Ve.x,Ve.y,pe),vt=Ve.numPoints||1;let Je=vt;for(const be of Le){const Ae=Qe.points[be];Ae.zoom>$&&(Je+=Ae.numPoints||1)}if(Je>vt&&Je>=_e){let be=Ve.x*vt,Ae=Ve.y*vt,tn=de&&vt>1?this._map(Ve,!0):null;const Tn=(Ce<<5)+($+1)+this.points.length;for(const Ot of Le){const hn=Qe.points[Ot];if(hn.zoom<=$)continue;hn.zoom=$;const pn=hn.numPoints||1;be+=hn.x*pn,Ae+=hn.y*pn,hn.parentId=Tn,de&&(tn||(tn=this._map(Ve,!0)),de(tn,this._map(hn)))}Ve.parentId=Tn,Q.push(sn(be/Je,Ae/Je,Tn,Je,tn))}else if(Q.push(Ve),Je>1)for(const be of Le){const Ae=Qe.points[be];Ae.zoom<=$||(Ae.zoom=$,Q.push(Ae))}}return Q}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$){if(V.numPoints)return $?on({},V.properties):V.properties;const Q=this.points[V.index].properties,oe=this.options.map(Q);return $&&oe===Q?on({},oe):oe}}function sn(G,V,$,Q,oe){return{x:Jo(G),y:Jo(V),zoom:1/0,id:$,parentId:-1,numPoints:Q,properties:oe}}function ua(G,V){const[$,Q]=G.geometry.coordinates;return{x:Jo($s($)),y:Jo(to(Q)),zoom:1/0,index:V,parentId:-1}}function zl(G){return{type:"Feature",id:G.id,properties:Cc(G),geometry:{type:"Point",coordinates:[(V=G.x,360*(V-.5)),Ul(G.y)]}};var V}function Cc(G){const V=G.numPoints,$=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return on(on({},G.properties),{cluster:!0,cluster_id:G.id,point_count:V,point_count_abbreviated:$})}function $s(G){return G/360+.5}function to(G){const V=Math.sin(G*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Ul(G){const V=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function on(G,V){for(const $ in V)G[$]=V[$];return G}function Ua(G){return G.x}function oi(G){return G.y}function Hr(G,V,$,Q){for(var oe,he=Q,de=$-V>>1,_e=$-V,pe=G[V],Ce=G[V+1],Ve=G[$],Qe=G[$+1],Le=V+3;Le<$;Le+=3){var vt=bu(G[Le],G[Le+1],pe,Ce,Ve,Qe);if(vt>he)oe=Le,he=vt;else if(vt===he){var Je=Math.abs(Le-de);Je<_e&&(oe=Le,_e=Je)}}he>Q&&(oe-V>3&&Hr(G,V,oe,Q),G[oe+2]=he,$-oe>3&&Hr(G,oe,$,Q))}function bu(G,V,$,Q,oe,he){var de=oe-$,_e=he-Q;if(0!==de||0!==_e){var pe=((G-$)*de+(V-Q)*_e)/(de*de+_e*_e);pe>1?($=oe,Q=he):pe>0&&($+=de*pe,Q+=_e*pe)}return(de=G-$)*de+(_e=V-Q)*_e}function So(G,V,$,Q){var oe={id:void 0===G?null:G,type:V,geometry:$,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var de=he.geometry,_e=he.type;if("Point"===_e||"MultiPoint"===_e||"LineString"===_e)Dc(he,de);else if("Polygon"===_e||"MultiLineString"===_e)for(var pe=0;pe<de.length;pe++)Dc(he,de[pe]);else if("MultiPolygon"===_e)for(pe=0;pe<de.length;pe++)for(var Ce=0;Ce<de[pe].length;Ce++)Dc(he,de[pe][Ce])}(oe),oe}function Dc(G,V){for(var $=0;$<V.length;$+=3)G.minX=Math.min(G.minX,V[$]),G.minY=Math.min(G.minY,V[$+1]),G.maxX=Math.max(G.maxX,V[$]),G.maxY=Math.max(G.maxY,V[$+1])}function ys(G,V,$,Q){if(V.geometry){var oe=V.geometry.coordinates,he=V.geometry.type,de=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),_e=[],pe=V.id;if($.promoteId?pe=V.properties[$.promoteId]:$.generateId&&(pe=Q||0),"Point"===he)ai(oe,_e);else if("MultiPoint"===he)for(var Ce=0;Ce<oe.length;Ce++)ai(oe[Ce],_e);else if("LineString"===he)Ao(oe,_e,de,!1);else if("MultiLineString"===he){if($.lineMetrics){for(Ce=0;Ce<oe.length;Ce++)Ao(oe[Ce],_e=[],de,!1),G.push(So(pe,"LineString",_e,V.properties));return}da(oe,_e,de,!1)}else if("Polygon"===he)da(oe,_e,de,!0);else{if("MultiPolygon"!==he){if("GeometryCollection"===he){for(Ce=0;Ce<V.geometry.geometries.length;Ce++)ys(G,{id:pe,geometry:V.geometry.geometries[Ce],properties:V.properties},$,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<oe.length;Ce++){var Ve=[];da(oe[Ce],Ve,de,!0),_e.push(Ve)}}G.push(So(pe,he,_e,V.properties))}}function ai(G,V){V.push(Id(G[0])),V.push(fr(G[1])),V.push(0)}function Ao(G,V,$,Q){for(var oe,he,de=0,_e=0;_e<G.length;_e++){var pe=Id(G[_e][0]),Ce=fr(G[_e][1]);V.push(pe),V.push(Ce),V.push(0),_e>0&&(de+=Q?(oe*Ce-pe*he)/2:Math.sqrt(Math.pow(pe-oe,2)+Math.pow(Ce-he,2))),oe=pe,he=Ce}var Ve=V.length-3;V[2]=1,Hr(V,0,Ve,$),V[Ve+2]=1,V.size=Math.abs(de),V.start=0,V.end=V.size}function da(G,V,$,Q){for(var oe=0;oe<G.length;oe++){var he=[];Ao(G[oe],he,$,Q),V.push(he)}}function Id(G){return G/360+.5}function fr(G){var V=Math.sin(G*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function zi(G,V,$,Q,oe,he,de,_e){if(Q/=V,he>=($/=V)&&de<Q)return G;if(de<$||he>=Q)return null;for(var pe=[],Ce=0;Ce<G.length;Ce++){var Ve=G[Ce],Qe=Ve.geometry,Le=Ve.type,vt=0===oe?Ve.minX:Ve.minY,Je=0===oe?Ve.maxX:Ve.maxY;if(vt>=$&&Je<Q)pe.push(Ve);else if(!(Je<$||vt>=Q)){var be=[];if("Point"===Le||"MultiPoint"===Le)jl(Qe,be,$,Q,oe);else if("LineString"===Le)ha(Qe,be,$,Q,oe,!1,_e.lineMetrics);else if("MultiLineString"===Le)Tc(Qe,be,$,Q,oe,!1);else if("Polygon"===Le)Tc(Qe,be,$,Q,oe,!0);else if("MultiPolygon"===Le)for(var Ae=0;Ae<Qe.length;Ae++){var tn=[];Tc(Qe[Ae],tn,$,Q,oe,!0),tn.length&&be.push(tn)}if(be.length){if(_e.lineMetrics&&"LineString"===Le){for(Ae=0;Ae<be.length;Ae++)pe.push(So(Ve.id,Le,be[Ae],Ve.tags));continue}"LineString"!==Le&&"MultiLineString"!==Le||(1===be.length?(Le="LineString",be=be[0]):Le="MultiLineString"),"Point"!==Le&&"MultiPoint"!==Le||(Le=3===be.length?"Point":"MultiPoint"),pe.push(So(Ve.id,Le,be,Ve.tags))}}}return pe.length?pe:null}function jl(G,V,$,Q,oe){for(var he=0;he<G.length;he+=3){var de=G[he+oe];de>=$&&de<=Q&&(V.push(G[he]),V.push(G[he+1]),V.push(G[he+2]))}}function ha(G,V,$,Q,oe,he,de){for(var _e,pe,Ce=Ec(G),Ve=0===oe?Sd:xu,Qe=G.start,Le=0;Le<G.length-3;Le+=3){var vt=G[Le],Je=G[Le+1],be=G[Le+2],Ae=G[Le+3],tn=G[Le+4],Tn=0===oe?vt:Je,Ot=0===oe?Ae:tn,hn=!1;de&&(_e=Math.sqrt(Math.pow(vt-Ae,2)+Math.pow(Je-tn,2))),Tn<$?Ot>$&&(pe=Ve(Ce,vt,Je,Ae,tn,$),de&&(Ce.start=Qe+_e*pe)):Tn>Q?Ot<Q&&(pe=Ve(Ce,vt,Je,Ae,tn,Q),de&&(Ce.start=Qe+_e*pe)):ja(Ce,vt,Je,be),Ot<$&&Tn>=$&&(pe=Ve(Ce,vt,Je,Ae,tn,$),hn=!0),Ot>Q&&Tn<=Q&&(pe=Ve(Ce,vt,Je,Ae,tn,Q),hn=!0),!he&&hn&&(de&&(Ce.end=Qe+_e*pe),V.push(Ce),Ce=Ec(G)),de&&(Qe+=_e)}var pn=G.length-3;vt=G[pn],Je=G[pn+1],be=G[pn+2],(Tn=0===oe?vt:Je)>=$&&Tn<=Q&&ja(Ce,vt,Je,be),pn=Ce.length-3,he&&pn>=3&&(Ce[pn]!==Ce[0]||Ce[pn+1]!==Ce[1])&&ja(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&V.push(Ce)}function Ec(G){var V=[];return V.size=G.size,V.start=G.start,V.end=G.end,V}function Tc(G,V,$,Q,oe,he){for(var de=0;de<G.length;de++)ha(G[de],V,$,Q,oe,he,!1)}function ja(G,V,$,Q){G.push(V),G.push($),G.push(Q)}function Sd(G,V,$,Q,oe,he){var de=(he-V)/(Q-V);return G.push(he),G.push($+(oe-$)*de),G.push(1),de}function xu(G,V,$,Q,oe,he){var de=(he-$)/(oe-$);return G.push(V+(Q-V)*de),G.push(he),G.push(1),de}function Ad(G,V){for(var $=[],Q=0;Q<G.length;Q++){var oe,he=G[Q],de=he.type;if("Point"===de||"MultiPoint"===de||"LineString"===de)oe=fa(he.geometry,V);else if("MultiLineString"===de||"Polygon"===de){oe=[];for(var _e=0;_e<he.geometry.length;_e++)oe.push(fa(he.geometry[_e],V))}else if("MultiPolygon"===de)for(oe=[],_e=0;_e<he.geometry.length;_e++){for(var pe=[],Ce=0;Ce<he.geometry[_e].length;Ce++)pe.push(fa(he.geometry[_e][Ce],V));oe.push(pe)}$.push(So(he.id,de,oe,he.tags))}return $}function fa(G,V){var $=[];$.size=G.size,void 0!==G.start&&($.start=G.start,$.end=G.end);for(var Q=0;Q<G.length;Q+=3)$.push(G[Q]+V,G[Q+1],G[Q+2]);return $}function Mc(G,V){if(G.transformed)return G;var $,Q,oe,he=1<<G.z,de=G.x,_e=G.y;for($=0;$<G.features.length;$++){var pe=G.features[$],Ce=pe.geometry,Ve=pe.type;if(pe.geometry=[],1===Ve)for(Q=0;Q<Ce.length;Q+=2)pe.geometry.push(ko(Ce[Q],Ce[Q+1],V,he,de,_e));else for(Q=0;Q<Ce.length;Q++){var Qe=[];for(oe=0;oe<Ce[Q].length;oe+=2)Qe.push(ko(Ce[Q][oe],Ce[Q][oe+1],V,he,de,_e));pe.geometry.push(Qe)}}return G.transformed=!0,G}function ko(G,V,$,Q,oe,he){return[Math.round($*(G*Q-oe)),Math.round($*(V*Q-he))]}function $a(G,V,$,Q,oe){for(var he=V===oe.maxZoom?0:oe.tolerance/((1<<V)*oe.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:Q,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<G.length;_e++){de.numFeatures++,Ic(de,G[_e],he,oe);var pe=G[_e].minX,Ce=G[_e].minY,Ve=G[_e].maxX,Qe=G[_e].maxY;pe<de.minX&&(de.minX=pe),Ce<de.minY&&(de.minY=Ce),Ve>de.maxX&&(de.maxX=Ve),Qe>de.maxY&&(de.maxY=Qe)}return de}function Ic(G,V,$,Q){var oe=V.geometry,he=V.type,de=[];if("Point"===he||"MultiPoint"===he)for(var _e=0;_e<oe.length;_e+=3)de.push(oe[_e]),de.push(oe[_e+1]),G.numPoints++,G.numSimplified++;else if("LineString"===he)an(de,oe,G,$,!1,!1);else if("MultiLineString"===he||"Polygon"===he)for(_e=0;_e<oe.length;_e++)an(de,oe[_e],G,$,"Polygon"===he,0===_e);else if("MultiPolygon"===he)for(var pe=0;pe<oe.length;pe++){var Ce=oe[pe];for(_e=0;_e<Ce.length;_e++)an(de,Ce[_e],G,$,!0,0===_e)}if(de.length){var Ve=V.tags||null;if("LineString"===he&&Q.lineMetrics){for(var Qe in Ve={},V.tags)Ve[Qe]=V.tags[Qe];Ve.mapbox_clip_start=oe.start/oe.size,Ve.mapbox_clip_end=oe.end/oe.size}var Le={geometry:de,type:"Polygon"===he||"MultiPolygon"===he?3:"LineString"===he||"MultiLineString"===he?2:1,tags:Ve};null!==V.id&&(Le.id=V.id),G.features.push(Le)}}function an(G,V,$,Q,oe,he){var de=Q*Q;if(Q>0&&V.size<(oe?de:Q))$.numPoints+=V.length/3;else{for(var _e=[],pe=0;pe<V.length;pe+=3)(0===Q||V[pe+2]>de)&&($.numSimplified++,_e.push(V[pe]),_e.push(V[pe+1])),$.numPoints++;oe&&function(Ce,Ve){for(var Qe=0,Le=0,vt=Ce.length,Je=vt-2;Le<vt;Je=Le,Le+=2)Qe+=(Ce[Le]-Ce[Je])*(Ce[Le+1]+Ce[Je+1]);if(Qe>0===Ve)for(Le=0,vt=Ce.length;Le<vt/2;Le+=2){var be=Ce[Le],Ae=Ce[Le+1];Ce[Le]=Ce[vt-2-Le],Ce[Le+1]=Ce[vt-1-Le],Ce[vt-2-Le]=be,Ce[vt-1-Le]=Ae}}(_e,he),G.push(_e)}}function Qo(G,V){var $=(V=this.options=function(oe,he){for(var de in he)oe[de]=he[de];return oe}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var oe,he,de,_e,pe,Ce,Q=function(oe,he){var de=[];if("FeatureCollection"===oe.type)for(var _e=0;_e<oe.features.length;_e++)ys(de,oe.features[_e],he,_e);else ys(de,"Feature"===oe.type?oe:{geometry:oe},he);return de}(G,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(oe=Q,he=V,de=he.buffer/he.extent,_e=oe,pe=zi(oe,1,-1-de,de,0,-1,2,he),Ce=zi(oe,1,1-de,2+de,0,-1,2,he),(pe||Ce)&&(_e=zi(oe,1,-de,1+de,0,-1,2,he)||[],pe&&(_e=Ad(pe,1).concat(_e)),Ce&&(_e=_e.concat(Ad(Ce,-1)))),Q=_e).length&&this.splitTile(Q,0,0,0),$&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jt(G,V,$){return 32*((1<<G)*$+V)+G}function Ha(G,V){const $=G.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const Q=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!Q)return V(null,null);const oe=new Er(Q.features);let he=Sn(oe);0===he.byteOffset&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),V(null,{vectorTile:oe,rawData:he.buffer})}Qo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qo.prototype.splitTile=function(G,V,$,Q,oe,he,de){for(var _e=[G,V,$,Q],pe=this.options,Ce=pe.debug;_e.length;){Q=_e.pop(),$=_e.pop(),V=_e.pop(),G=_e.pop();var Ve=1<<V,Qe=jt(V,$,Q),Le=this.tiles[Qe];if(!Le&&(Ce>1&&console.time("creation"),Le=this.tiles[Qe]=$a(G,V,$,Q,pe),this.tileCoords.push({z:V,x:$,y:Q}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,Q,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var vt="z"+V;this.stats[vt]=(this.stats[vt]||0)+1,this.total++}if(Le.source=G,oe){if(V===pe.maxZoom||V===oe)continue;var Je=1<<oe-V;if($!==Math.floor(he/Je)||Q!==Math.floor(de/Je))continue}else if(V===pe.indexMaxZoom||Le.numPoints<=pe.indexMaxPoints)continue;if(Le.source=null,0!==G.length){Ce>1&&console.time("clipping");var be,Ae,tn,Tn,Ot,hn,pn=.5*pe.buffer/pe.extent,$l=.5-pn,vs=.5+pn,rt=1+pn;be=Ae=tn=Tn=null,Ot=zi(G,Ve,$-pn,$+vs,0,Le.minX,Le.maxX,pe),hn=zi(G,Ve,$+$l,$+rt,0,Le.minX,Le.maxX,pe),G=null,Ot&&(be=zi(Ot,Ve,Q-pn,Q+vs,1,Le.minY,Le.maxY,pe),Ae=zi(Ot,Ve,Q+$l,Q+rt,1,Le.minY,Le.maxY,pe),Ot=null),hn&&(tn=zi(hn,Ve,Q-pn,Q+vs,1,Le.minY,Le.maxY,pe),Tn=zi(hn,Ve,Q+$l,Q+rt,1,Le.minY,Le.maxY,pe),hn=null),Ce>1&&console.timeEnd("clipping"),_e.push(be||[],V+1,2*$,2*Q),_e.push(Ae||[],V+1,2*$,2*Q+1),_e.push(tn||[],V+1,2*$+1,2*Q),_e.push(Tn||[],V+1,2*$+1,2*Q+1)}}},Qo.prototype.getTile=function(G,V,$){var Q=this.options,oe=Q.extent,he=Q.debug;if(G<0||G>24)return null;var de=1<<G,_e=jt(G,V=(V%de+de)%de,$);if(this.tiles[_e])return Mc(this.tiles[_e],oe);he>1&&console.log("drilling down to z%d-%d-%d",G,V,$);for(var pe,Ce=G,Ve=V,Qe=$;!pe&&Ce>0;)Ce--,Ve=Math.floor(Ve/2),Qe=Math.floor(Qe/2),pe=this.tiles[jt(Ce,Ve,Qe)];return pe&&pe.source?(he>1&&console.log("found parent tile z%d-%d-%d",Ce,Ve,Qe),he>1&&console.time("drilling down"),this.splitTile(pe.source,Ce,Ve,Qe,G,V,$),he>1&&console.timeEnd("drilling down"),this.tiles[_e]?Mc(this.tiles[_e],oe):null):null};class Ga extends p.VectorTileWorkerSource{constructor(V,$,Q,oe,he){super(V,$,Q,oe,Ha),he&&(this.loadGeoJSON=he)}loadData(V,$){const Q=V&&V.request,oe=Q&&Q.collectResourceTiming;this.loadGeoJSON(V,(he,de)=>{if(he||!de)return $(he);if("object"!=typeof de)return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{ut(de,!0);try{if(V.filter){const pe=p.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===pe.result)throw new Error(pe.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));const Ce=de.features.filter(Ve=>pe.value.evaluate({zoom:0},Ve));de={type:"FeatureCollection",features:Ce}}this._geoJSONIndex=V.cluster?new za(function({superclusterOptions:pe,clusterProperties:Ce}){if(!Ce||!pe)return pe;const Ve={},Qe={},Le={accumulated:null,zoom:0},vt={properties:null},Je=Object.keys(Ce);for(const be of Je){const[Ae,tn]=Ce[be],Tn=p.createExpression(tn),Ot=p.createExpression("string"==typeof Ae?[Ae,["accumulated"],["get",be]]:Ae);Ve[be]=Tn.value,Qe[be]=Ot.value}return pe.map=be=>{vt.properties=be;const Ae={};for(const tn of Je)Ae[tn]=Ve[tn].evaluate(Le,vt);return Ae},pe.reduce=(be,Ae)=>{vt.properties=Ae;for(const tn of Je)Le.accumulated=be[tn],be[tn]=Qe[tn].evaluate(Le,vt)},pe}(V)).load(de.features):new Qo(pe=de,V.geojsonVtOptions)}catch(pe){return $(pe)}this.loaded={};const _e={};if(oe){const pe=p.getPerformanceMeasurement(Q);pe&&(_e.resourceTiming={},_e.resourceTiming[V.source]=JSON.parse(JSON.stringify(pe)))}$(null,_e)}var pe})}reloadTile(V,$){const Q=this.loaded;return Q&&Q[V.uid]?super.reloadTile(V,$):this.loadTile(V,$)}loadGeoJSON(V,$){if(V.request)p.getJSON(V.request,$);else{if("string"!=typeof V.data)return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(V.data))}catch(Q){return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(Q){$(Q)}}getClusterChildren(V,$){try{$(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(Q){$(Q)}}getClusterLeaves(V,$){try{$(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(Q){$(Q)}}}class $t{constructor(V){this.self=V,this.actor=new p.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Ga},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,Q)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=Q},this.self.registerRTLTextPlugin=$=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=$.applyArabicShaping,p.plugin.processBidirectionalText=$.processBidirectionalText,p.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(V,$,Q){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],Q()}checkIfReady(V,$,Q){Q()}setReferrer(V,$){this.referrer=$}spriteLoaded(V,$){this.isSpriteLoaded[V]=$;for(const Q in this.workerSources[V]){const oe=this.workerSources[V][Q];for(const he in oe)oe[he]instanceof p.VectorTileWorkerSource&&(oe[he].isSpriteLoaded=$,oe[he].fire(new p.Event("isSpriteLoaded")))}}setImages(V,$,Q){this.availableImages[V]=$;for(const oe in this.workerSources[V]){const he=this.workerSources[V][oe];for(const de in he)he[de].availableImages=$}Q()}enableTerrain(V,$,Q){this.terrain=$,Q()}setProjection(V,$){this.projections[V]=p.getProjection($)}setLayers(V,$,Q){this.getLayerIndex(V).replace($),Q()}updateLayers(V,$,Q){this.getLayerIndex(V).update($.layers,$.removedIds),Q()}loadTile(V,$,Q){const oe=this.enableTerrain?p.extend({enableTerrain:this.terrain},$):$;oe.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).loadTile(oe,Q)}loadDEMTile(V,$,Q){const oe=this.enableTerrain?p.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(V,$.source).loadTile(oe,Q)}reloadTile(V,$,Q){const oe=this.enableTerrain?p.extend({enableTerrain:this.terrain},$):$;oe.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,$.type,$.source).reloadTile(oe,Q)}abortTile(V,$,Q){this.getWorkerSource(V,$.type,$.source).abortTile($,Q)}removeTile(V,$,Q){this.getWorkerSource(V,$.type,$.source).removeTile($,Q)}removeSource(V,$,Q){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const oe=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],void 0!==oe.removeSource?oe.removeSource($,Q):Q()}loadWorkerSource(V,$,Q){try{this.self.importScripts($.url),Q()}catch(oe){Q(oe.toString())}}syncRTLPluginState(V,$,Q){try{p.plugin.setState($);const oe=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=oe){this.self.importScripts(oe);const he=p.plugin.isParsed();Q(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${oe}`),he)}}catch(oe){Q(oe.toString())}}getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new Dr),$}getWorkerSource(V,$,Q){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),this.workerSources[V][$][Q]||(this.workerSources[V][$][Q]=new this.workerSourceTypes[$]({send:(oe,he,de,_e,pe,Ce)=>{this.actor.send(oe,he,de,V,pe,Ce)},scheduler:this.actor.scheduler},this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])),this.workerSources[V][$][Q]}getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new je),this.demWorkerSources[V][$]}enforceCacheSizeLimit(V,$){p.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(V,$,Q){Q(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new $t(self)),$t}),Td(0,function(p){var $r=Cr;function Cr(m){return s=m,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{b=new Worker(E),_=!0}catch(I){_=!1}return b&&b.terminate(),URL.revokeObjectURL(E),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var x=b.getImageData(0,0,1,1);return x&&x.width===_.width}()||(void 0===Dr[d=s&&s.failIfMajorPerformanceCaveat]&&(Dr[d]=function(_){var b,E,I,P,x=(E=_,I=document.createElement("canvas"),(P=Object.create(Cr.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,I.getContext("webgl",P)||I.getContext("experimental-webgl",P));if(!x)return!1;try{b=x.createShader(x.VERTEX_SHADER)}catch(E){return!1}return!(!b||x.isContextLost())&&(x.shaderSource(b,"void main() {}"),x.compileShader(b),!0===x.getShaderParameter(b,x.COMPILE_STATUS))}(d)),!Dr[d]||document.documentMode));var s,d}var Dr={};function $e(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let d=0;d<m.length;d++)if(!$e(m[d],s[d]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==s){if("object"!=typeof s||Object.keys(m).length!==Object.keys(s).length)return!1;for(const d in m)if(!$e(m[d],s[d]))return!1;return!0}return m===s}Cr.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const je={create:function(m,s,d){const _=p.window.document.createElement(m);return void 0!==s&&(_.className=s),d&&d.appendChild(_),_},createNS:function(m,s){return p.window.document.createElementNS(m,s)}},ut=p.window.document&&p.window.document.documentElement.style,Ko=ut&&void 0!==ut.userSelect?"userSelect":"WebkitUserSelect";let aa;je.disableDrag=function(){ut&&Ko&&(aa=ut[Ko],ut[Ko]="none")},je.enableDrag=function(){ut&&Ko&&(ut[Ko]=aa)},je.setTransform=function(m,s){m.style.transform=s};let wc=!1;try{const m=Object.defineProperty({},"passive",{get(){wc=!0}});p.window.addEventListener("test",m,m),p.window.removeEventListener("test",m,m)}catch(m){wc=!1}je.addEventListener=function(m,s,d,_={}){m.addEventListener(s,d,"passive"in _&&wc?_:_.capture)},je.removeEventListener=function(m,s,d,_={}){m.removeEventListener(s,d,"passive"in _&&wc?_:_.capture)};const Mt=function(m){m.preventDefault(),m.stopPropagation(),p.window.removeEventListener("click",Mt,!0)};function Er(m,s,d){const _=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new p.pointGeometry((d.clientX-s.left)*_,(d.clientY-s.top)*_)}function vu(m,s){var d=s[0],_=s[1],b=s[2],x=s[3],E=d*x-b*_;return E?(m[0]=x*(E=1/E),m[1]=-_*E,m[2]=-b*E,m[3]=d*E,m):null}je.suppressClick=function(){p.window.addEventListener("click",Mt,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Mt,!0)},0)},je.mousePos=function(m,s){const d=m.getBoundingClientRect();return Er(m,d,s)},je.touchPos=function(m,s){const d=m.getBoundingClientRect(),_=[];for(let b=0;b<s.length;b++)_.push(Er(m,d,s[b]));return _},je.mouseButton=function(m){return void 0!==p.window.InstallTrigger&&2===m.button&&m.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button},je.remove=function(m){m.parentNode&&m.parentNode.removeChild(m)};class Ol{constructor(s,d){this.pos=s,this.dir=d}intersectsPlane(s,d,_){const b=p.dot(d,this.dir);if(Math.abs(b)<1e-6)return!1;const x=p.dot(p.sub(p.create(),s,this.pos),d)/b,E=p.scaleAndAdd(p.create(),this.pos,this.dir,x);return p.copy(_,E),!0}}class To{constructor(s,d){this.points=s,this.planes=d}static fromInvProjectionMatrix(s,d,_){const b=Math.pow(2,_),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const P=p.transformMat4([],I,s),F=1/P[3]/d*b;return p.mul(P,P,[F,F,1/P[3],F])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const P=p.sub([],x[I[0]],x[I[1]]),F=p.sub([],x[I[2]],x[I[1]]),O=p.normalize([],p.cross([],P,F)),B=-p.dot(O,x[I[1]]);return O.concat(B)});return new To(x,E)}}class Mo{constructor(s,d){this.min=s,this.max=d,this.center=p.scale([],p.add([],this.min,this.max),.5)}quadrant(s){const d=[s%2==0,s<2],_=p.clone(this.min),b=p.clone(this.max);for(let x=0;x<d.length;x++)_[x]=d[x]?this.min[x]:this.center[x],b[x]=d[x]?this.center[x]:this.max[x];return b[2]=this.max[2],new Mo(_,b)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}intersects(s){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let b=0;b<s.planes.length;b++){const x=s.planes[b];let E=0;for(let I=0;I<d.length;I++)E+=p.dot$1(x,d[I])>=0;if(0===E)return 0;E!==d.length&&(_=!1)}if(_)return 2;for(let b=0;b<3;b++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let I=0;I<s.points.length;I++){const P=s.points[I][b]-this.min[b];x=Math.min(x,P),E=Math.max(E,P)}if(E<0||x>this.max[b]-this.min[b])return 0}return 1}}function Sn(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class la extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,d){this._validate(s,d)&&(this.images[s]=d)}_validate(s,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new p.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),_=!1),_}_validateStretch(s,d){if(!s)return!0;let _=0;for(const b of s){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(s,d){return!(s&&(4!==s.length||s[0]<0||d.data.width<s[0]||s[1]<0||d.data.height<s[1]||s[2]<0||d.data.width<s[2]||s[3]<0||d.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,d){d.version=this.images[s].version+1,this.images[s]=d,this.updatedImages[s]=!0}removeImage(s){const d=this.images[s];delete this.images[s],delete this.patterns[s],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,d){let _=!0;if(!this.isLoaded())for(const b of s)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(s,d):this.requestors.push({ids:s,callback:d})}_notify(s,d){const _={};for(const b of s){this.images[b]||this.fire(new p.Event("styleimagemissing",{id:b}));const x=this.images[b];x?_[b]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:p.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:s,height:d}=this.atlasImage;return{width:s,height:d}}getPattern(s){const d=this.patterns[s],_=this.getImage(s);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},x=new p.ImagePosition(b,_);this.patterns[s]={bin:b,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const d=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(s,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:d,h:_}=p.potpack(s),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],I=E.x+1,P=E.y+1,F=this.images[x].data,O=F.width,B=F.height;p.RGBAImage.copy(F,b,{x:0,y:0},{x:I,y:P},{width:O,height:B}),p.RGBAImage.copy(F,b,{x:0,y:B-1},{x:I,y:P-1},{width:O,height:1}),p.RGBAImage.copy(F,b,{x:0,y:0},{x:I,y:P+B},{width:O,height:1}),p.RGBAImage.copy(F,b,{x:O-1,y:0},{x:I-1,y:P},{width:1,height:B}),p.RGBAImage.copy(F,b,{x:0,y:0},{x:I+O,y:P},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const d of s){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];Sn(_)&&this.updateImage(d,_)}}}const dn=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(m,s){return function([d,_,b]){const x=p.degToRad(_+90),E=p.degToRad(b);return{x:d*Math.cos(x)*Math.sin(E),y:d*Math.sin(x)*Math.sin(E),z:d*Math.cos(E),azimuthal:_,polar:b}}(m.expression.evaluate(s))}interpolate(m,s,d){return{x:p.number(m.x,s.x,d),y:p.number(m.y,s.y,d),z:p.number(m.z,s.z,d),azimuthal:p.number(m.azimuthal,s.azimuthal,d),polar:p.number(m.polar,s.polar,d)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),La="-transition";class Qi extends p.Evented{constructor(s){super(),this._transitionable=new p.Transitionable(dn),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,d={}){if(!this._validate(p.validateLight,s,d))for(const _ in s){const b=s[_];p.endsWith(_,La)?this._transitionable.setTransition(_.slice(0,-La.length),b):this._transitionable.setValue(_,b)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,s.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ca=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),Ba="-transition";class Ll extends p.Evented{constructor(s){super(),this._transitionable=new p.Transitionable(ca),this.set(s),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(s){for(const d in s){const _=s[d];p.endsWith(d,Ba)?this._transitionable.setTransition(d.slice(0,-Ba.length),_):this._transitionable.setValue(d,_)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}}function Rn(m,s,d,_){const b=p.smoothstep(45,65,d),[x,E]=Bl(m,_),I=p.length(s);let P=1-Math.min(1,Math.exp((I-x)/(E-x)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*m.alpha}function Bl(m,s){const d=.5/Math.tan(.5*s);return[m.range[0]+d,m.range[1]+d]}const Io=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"])}),Ut="-transition";class js extends p.Evented{constructor(s,d){super(),this._transitionable=new p.Transitionable(Io),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=d}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,d={}){if(!this._validate(p.validateFog,s,d))for(const _ in s){const b=s[_];p.endsWith(_,Ut)?this._transitionable.setTransition(_.slice(0,-Ut.length),b):this._transitionable.setValue(_,b)}}getOpacity(s){if(this.isSoftDisabled())return 0;const d=this.properties&&this.properties.get("color")||1;return p.smoothstep(45,65,s)*d.a}getOpacityAtLatLng(s,d){return this.isSoftDisabled()?0:function(_,b,x){const E=p.MercatorCoordinate.fromLngLat(b),I=x.elevation?x.elevation.getAtPointOrZero(E):0,P=[E.x,E.y,I];return p.transformMat4$1(P,P,x.mercatorFogMatrix),Rn(_,P,x.pitch,x._fov)}(this.state,s,d)}getFovAdjustedRange(s){return this.isSoftDisabled()?[0,1]:Bl(this.state,s)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,s.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class _s{constructor(s,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const x=new _s.Actor(_[b],d,this.id);x.name=`Worker ${b}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,d,_){p.asyncAll(this.actors,(b,x)=>{b.send(s,d,x)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Bi(m,s,d){return s*(p.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}_s.Actor=p.Actor;class Vl{constructor(s,d,_,b){this.screenBounds=s,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>b.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(s,d){let _,b;if(s instanceof p.pointGeometry||"number"==typeof s[0]){const x=p.pointGeometry.convert(s);_=[p.pointGeometry.convert(s)],b=d.isPointAboveHorizon(x)}else{const x=p.pointGeometry.convert(s[0]),E=p.pointGeometry.convert(s[1]);_=[x,E],b=p.polygonizeBounds(x,E).every(I=>d.isPointAboveHorizon(I))}return new Vl(_,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],b=p.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),p.bufferConvexPolygon(b,s)}containsTile(s,d,_){const b=s.queryPadding+1,x=s.tileID.wrap,E=_?this._bufferedCameraMercator(b,d).map(ee=>p.getTilePoint(s.tileTransform,ee,x)):this._bufferedScreenMercator(b,d).map(ee=>p.getTilePoint(s.tileTransform,ee,x)),I=this.screenGeometryMercator.map(ee=>p.getTileVec3(s.tileTransform,ee,x)),P=I.map(ee=>new p.pointGeometry(ee[0],ee[1])),F=d.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),O=p.getTileVec3(s.tileTransform,F,x),B=I.map(ee=>{const X=p.sub(ee,ee,O);return p.normalize(X,X),new Ol(O,X)}),H=Bi(s,1,d.zoom);if(p.polygonIntersectsBox(E,0,0,p.EXTENT,p.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:B,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(Y=p.getBounds(E),Y.min.x=p.clamp(Y.min.x,0,p.EXTENT),Y.min.y=p.clamp(Y.min.y,0,p.EXTENT),Y.max.x=p.clamp(Y.max.x,0,p.EXTENT),Y.max.y=p.clamp(Y.max.y,0,p.EXTENT),Y),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:H};var Y}_bufferedScreenMercator(s,d){const _=ri(s);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const b=this.bufferedScreenGeometry(s).map(x=>d.pointCoordinate3D(x));return this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(s,d){const _=ri(s);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const b=this.bufferedCameraGeometry(s).map(x=>d.pointCoordinate3D(x));return this._cameraRaycastCache[_]=b,b}}}function ri(m){return 100*m|0}function Vi(m,s,d){const _=function(b,x){if(b)return d(b);if(x){const E=p.pick(p.extend(x,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(I=>I.id)),E.tiles=s.canonicalizeTileset(E,m.url),d(null,E)}};return m.url?p.getJSON(s.transformRequest(s.normalizeSourceURL(m.url),p.ResourceType.Source),_):p.exported.frame(()=>_(null,m))}class Md{constructor(s,d,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const d=Math.pow(2,s.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*d),x=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*d),E=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*d);return s.x>=_&&s.x<x&&s.y>=b&&s.y<E}}class Jo{constructor(s,d,_){this.context=s;const b=s.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Va={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class za{constructor(s,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,d){for(let _=0;_<this.attributes.length;_++){const b=d.attributes[this.attributes[_].name];void 0!==b&&s.enableVertexAttribArray(b)}}setVertexAttribPointers(s,d,_){for(let b=0;b<this.attributes.length;b++){const x=this.attributes[b],E=d.attributes[x.name];void 0!==E&&s.vertexAttribPointer(E,x.components,s[Va[x.type]],!1,this.itemSize,x.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ua extends sn{getDefault(){return p.Color.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class zl extends sn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Cc extends sn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class $s extends sn{getDefault(){return[!0,!0,!0,!0]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class to extends sn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Ul extends sn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class on extends sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const d=this.current;(s.func!==d.func||s.ref!==d.ref||s.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Ua extends sn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class oi extends sn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=s,this.dirty=!1}}class Hr extends sn{getDefault(){return[0,1]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class bu extends sn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=s,this.dirty=!1}}class So extends sn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Dc extends sn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.BLEND):d.disable(d.BLEND),this.current=s,this.dirty=!1}}class ys extends sn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class ai extends sn{getDefault(){return p.Color.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ao extends sn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class da extends sn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=s,this.dirty=!1}}class Id extends sn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class fr extends sn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class zi extends sn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class jl extends sn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ha extends sn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ec extends sn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Tc extends sn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ja extends sn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Sd extends sn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class xu extends sn{getDefault(){return null}set(s){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ad extends sn{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class fa extends sn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Mc extends sn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ko extends sn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class $a extends sn{constructor(s,d){super(s),this.context=s,this.parent=d}getDefault(){return null}}class Ic extends $a{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class an extends $a{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Qo extends an{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class jt{constructor(s,d,_,b){this.context=s,this.width=d,this.height=_;const x=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Ic(s,x),b&&(this.depthAttachment=new an(s,x))}destroy(){const s=this.context.gl,d=this.colorAttachment.get();if(d&&s.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&s.deleteRenderbuffer(_)}s.deleteFramebuffer(this.framebuffer)}}class Ha{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ua(this),this.clearDepth=new zl(this),this.clearStencil=new Cc(this),this.colorMask=new $s(this),this.depthMask=new to(this),this.stencilMask=new Ul(this),this.stencilFunc=new on(this),this.stencilOp=new Ua(this),this.stencilTest=new oi(this),this.depthRange=new Hr(this),this.depthTest=new bu(this),this.depthFunc=new So(this),this.blend=new Dc(this),this.blendFunc=new ys(this),this.blendColor=new ai(this),this.blendEquation=new Ao(this),this.cullFace=new da(this),this.cullFaceSide=new Id(this),this.frontFace=new fr(this),this.program=new zi(this),this.activeTexture=new jl(this),this.viewport=new ha(this),this.bindFramebuffer=new Ec(this),this.bindRenderbuffer=new Tc(this),this.bindTexture=new ja(this),this.bindVertexBuffer=new Sd(this),this.bindElementBuffer=new xu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ad(this),this.pixelStoreUnpack=new fa(this),this.pixelStoreUnpackPremultiplyAlpha=new Mc(this),this.pixelStoreUnpackFlipY=new ko(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,d){return new Jo(this,s,d)}createVertexBuffer(s,d,_){return new za(this,s,d,_)}createRenderbuffer(s,d,_){const b=this.gl,x=b.createRenderbuffer();return this.bindRenderbuffer.set(x),b.renderbufferStorage(b.RENDERBUFFER,s,d,_),this.bindRenderbuffer.set(null),x}createFramebuffer(s,d,_){return new jt(this,s,d,_)}clear({color:s,depth:d,stencil:_}){const b=this.gl;let x=0;s&&(x|=b.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(x|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(x|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(x)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){$e(s.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ga extends p.Evented{constructor(s,d,_,b){super(),this.id=s,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},d),p.extend(this,p.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,(s,d)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new p.ErrorEvent(s)):d&&(p.extend(this,d),d.bounds&&(this.tileBounds=new Md(d.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(d.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,d){const _=p.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);s.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),(x,E,I,P)=>{if(delete s.request,s.aborted)s.state="unloaded",d(null);else if(x)s.state="errored",d(x);else if(E){this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:P});const F=this.map.painter.context,O=F.gl;s.texture=this.map.painter.getTileTexture(E.width),s.texture?s.texture.update(E,{useMipmap:!0}):(s.texture=new p.Texture(F,E,O.RGBA,{useMipmap:!0}),s.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE),F.extTextureFilterAnisotropic&&O.texParameterf(O.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax)),s.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(s,d){s.request&&(s.request.cancel(),delete s.request),d()}unloadTile(s,d){s.texture&&this.map.painter.saveTileTexture(s.texture),d()}hasTransition(){return!1}}let $t;class G extends p.Evented{constructor(s,d,_,b){super(),this.id=s,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d}load(s,d){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,b)=>{this._loaded=!0,_?this.fire(new p.ErrorEvent(_)):b&&(this.image=p.exported.getImageData(b),s&&(this.coordinates=s),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s,delete this._boundsArray;const d=s.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,x=1/0,E=-1/0,I=-1/0;for(const B of _)b=Math.min(b,B.x),x=Math.min(x,B.y),E=Math.max(E,B.x),I=Math.max(I,B.y);const P=Math.max(E-b,I-x),F=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),O=Math.pow(2,F);return new p.CanonicalTileID(F,Math.floor((b+E)/2*O),Math.floor((x+I)/2*O))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const s=p.tileTransform(this.tileID,this.map.transform.projection),d=this.coordinates.map(_=>{const b=s.projection.project(_[0],_[1]);return p.getTilePoint(s,b)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,d=s.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(s,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const _ in this.tiles){const b=this.tiles[_];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture)}}loadTile(s,d){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},d(null)):(s.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const V={vector:class extends p.Evented{constructor(m,s,d,_){if(super(),this.id=m,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(s,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,(m,s)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new p.ErrorEvent(m)):s&&(p.extend(this,s),s.bounds&&(this.tileBounds=new Md(s.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(s.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const s=this.map.style._getSourceCaches(this.id);for(const d of s)d.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}loadTile(m,s){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(d,p.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=s:m.request=m.actor.send("reloadTile",_,b.bind(this));else if(m.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",_,b.bind(this),void 0,!0);else{const x=p.loadVectorTile.call({deduped:this._deduped},_,(E,I)=>{E||!I?b.call(this,E):(_.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},m.actor&&m.actor.send("loadTile",_,b.bind(this),void 0,!0))},!0);m.request={cancel:x}}function b(x,E){return delete m.request,m.aborted?s(null):x&&404!==x.status?s(x):(E&&E.resourceTiming&&(m.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadVectorData(E,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Ga,"raster-dem":class extends Ga{constructor(m,s,d,_){super(m,s,d,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,x){b&&(m.state="errored",s(b)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=p.getImage(this.map._requestManager.transformRequest(d,p.ResourceType.Tile),function(b,x,E,I){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(b)m.state="errored",s(b);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:I});const P=p.window.ImageBitmap&&x instanceof p.window.ImageBitmap&&(null==$t&&($t=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),$t),F=1-(x.width-p.prevPowerOfTwo(x.width))/2;F<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const O=P?x:p.exported.getImageData(x,F),B={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:F};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const s=m.canonical,d=Math.pow(2,s.z),_=(s.x-1+d)%d,b=0===s.x?m.wrap-1:m.wrap,x=(s.x+1+d)%d,E=s.x+1===d?m.wrap+1:m.wrap,I={};return I[new p.OverscaledTileID(m.overscaledZ,b,s.z,_,s.y).key]={backfilled:!1},I[new p.OverscaledTileID(m.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(I[new p.OverscaledTileID(m.overscaledZ,b,s.z,_,s.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(m.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<d&&(I[new p.OverscaledTileID(m.overscaledZ,b,s.z,_,s.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(m.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),I}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends p.Evented{constructor(m,s,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=s.data,this._options=p.extend({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const b=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*b,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*b,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*b,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},s),this}getClusterLeaves(m,s,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:s,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=p.extend({},this.workerOptions),s=this._data;"string"==typeof s?(m.request=this.map._requestManager.transformRequest(p.exported.resolveURL(s),p.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new p.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,s){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?s(null):_?s(_):(m.loadVectorData(b,this.map.painter,"reloadTile"===d),s(null))),void 0,"loadTile"===d)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends G{constructor(m,s,d,_){super(m,s,d,_),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,p.ResourceType.Source).url);p.getVideo(this.urls,(s,d)=>{this._loaded=!0,s?this.fire(new p.ErrorEvent(s)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(m,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const d in this.tiles){const _=this.tiles[d];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:G,canvas:class extends G{constructor(m,s,d,_){super(m,s,d,_),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(x=>"number"!=typeof x))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context,d=s.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(s,this.canvas,d.RGBA,{premultiply:!0});for(const _ in this.tiles){const b=this.tiles[_];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}}},$=function(m,s,d,_){const b=new V[s.type](m,s,d,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Q(m,s){const d=p.identity([]);return p.scale$1(d,d,[.5*m.width,.5*-m.height,1]),p.translate(d,d,[1,-1,0]),p.multiply(d,d,m.calculateProjMatrix(s.toUnwrapped()))}function oe(m,s,d,_,b,x,E,I=!1){const P=m.tilesIn(_,E,I);P.sort(de);const F=[];for(const B of P)F.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,d,m._state,B,b,x,Q(m.transform,B.tile.tileID),I)});const O=function(B){const H={},Y={};for(const ee of B){const X=ee.queryResults,ie=ee.wrappedTileID,K=Y[ie]=Y[ie]||{};for(const ne in X){const se=X[ne],J=K[ne]=K[ne]||{},le=H[ne]=H[ne]||[];for(const fe of se)J[fe.featureIndex]||(J[fe.featureIndex]=!0,le.push(fe))}}return H}(F);for(const B in O)O[B].forEach(H=>{const Y=H.feature,ee=m.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=ee});return O}function he(m,s){const d=m.getRenderableIds().map(x=>m.getTileByID(x)),_=[],b={};for(let x=0;x<d.length;x++){const E=d[x],I=E.tileID.canonical.key;b[I]||(b[I]=!0,E.querySourceFeatures(_,s))}return _}function de(m,s){const d=m.tileID,_=s.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function _e(){return null!=Ms.workerClass?new Ms.workerClass:new p.window.Worker(Ms.workerUrl)}const pe="mapboxgl_preloaded_worker_pool";class Ce{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Ce.workerCount;)this.workers.push(new _e);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pe]}numActive(){return Object.keys(this.active).length}}let Ve;function Qe(){return Ve||(Ve=new Ce),Ve}function Le(m,s){const d={};for(const _ in m)"ref"!==_&&(d[_]=m[_]);return p.refProperties.forEach(_=>{_ in s&&(d[_]=s[_])}),d}function vt(m){m=m.slice();const s=Object.create(null);for(let d=0;d<m.length;d++)s[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=Le(m[d],s[m[d].ref]));return m}Ce.workerCount=2;const Je={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function be(m,s,d){d.push({command:Je.addSource,args:[m,s[m]]})}function Ae(m,s,d){s.push({command:Je.removeSource,args:[m]}),d[m]=!0}function tn(m,s,d,_){Ae(m,d,_),be(m,s,d)}function Tn(m,s,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&"data"!==_&&!$e(m[d][_],s[d][_]))return!1;for(_ in s[d])if(s[d].hasOwnProperty(_)&&"data"!==_&&!$e(m[d][_],s[d][_]))return!1;return!0}function Ot(m,s,d,_,b,x){let E;for(E in s=s||{},m=m||{})m.hasOwnProperty(E)&&($e(m[E],s[E])||d.push({command:x,args:[_,E,s[E],b]}));for(E in s)s.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&($e(m[E],s[E])||d.push({command:x,args:[_,E,s[E],b]}))}function hn(m){return m.id}function pn(m,s){return m[s.id]=s,m}class $l{constructor(s,d){this.reset(s,d)}reset(s,d){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=p.clamp(s,0,1);let d=1,_=this._distances[d];const b=s*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];const x=d-1,E=this._distances[x],I=_-E,P=I>0?(b-E)/I:0;return this.points[x].mult(1-P).add(this.points[d].mult(P))}}class vs{constructor(s,d,_){const b=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(d/_);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=d,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,d,_,b,x){this._forEachCell(d,_,b,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(x)}insertCircle(s,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(s,d,_,b,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,d,_,b,x,E){this.circleCells[x].push(E)}_query(s,d,_,b,x,E){if(_<0||s>this.width||b<0||d>this.height)return!x&&[];const I=[];if(s<=0&&d<=0&&this.width<=_&&this.height<=b){if(x)return!0;for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const F=this.circles[3*P],O=this.circles[3*P+1],B=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:F-B,y1:O-B,x2:F+B,y2:O+B})}return E?I.filter(E):I}return this._forEachCell(s,d,_,b,this._queryCell,I,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?I.length>0:I}_queryCircle(s,d,_,b,x){const E=s-_,I=s+_,P=d-_,F=d+_;if(I<0||E>this.width||F<0||P>this.height)return!b&&[];const O=[];return this._forEachCell(E,P,I,F,this._queryCellCircle,O,{hitTest:b,circle:{x:s,y:d,radius:_},seenUids:{box:{},circle:{}}},x),b?O.length>0:O}query(s,d,_,b,x){return this._query(s,d,_,b,!1,x)}hitTest(s,d,_,b,x){return this._query(s,d,_,b,!0,x)}hitTestCircle(s,d,_,b){return this._queryCircle(s,d,_,!0,b)}_queryCell(s,d,_,b,x,E,I,P){const F=I.seenUids,O=this.boxCells[x];if(null!==O){const H=this.bboxes;for(const Y of O)if(!F.box[Y]){F.box[Y]=!0;const ee=4*Y;if(s<=H[ee+2]&&d<=H[ee+3]&&_>=H[ee+0]&&b>=H[ee+1]&&(!P||P(this.boxKeys[Y]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Y],x1:H[ee],y1:H[ee+1],x2:H[ee+2],y2:H[ee+3]})}}}const B=this.circleCells[x];if(null!==B){const H=this.circles;for(const Y of B)if(!F.circle[Y]){F.circle[Y]=!0;const ee=3*Y;if(this._circleAndRectCollide(H[ee],H[ee+1],H[ee+2],s,d,_,b)&&(!P||P(this.circleKeys[Y]))){if(I.hitTest)return E.push(!0),!0;{const X=H[ee],ie=H[ee+1],K=H[ee+2];E.push({key:this.circleKeys[Y],x1:X-K,y1:ie-K,x2:X+K,y2:ie+K})}}}}}_queryCellCircle(s,d,_,b,x,E,I,P){const F=I.circle,O=I.seenUids,B=this.boxCells[x];if(null!==B){const Y=this.bboxes;for(const ee of B)if(!O.box[ee]){O.box[ee]=!0;const X=4*ee;if(this._circleAndRectCollide(F.x,F.y,F.radius,Y[X+0],Y[X+1],Y[X+2],Y[X+3])&&(!P||P(this.boxKeys[ee])))return E.push(!0),!0}}const H=this.circleCells[x];if(null!==H){const Y=this.circles;for(const ee of H)if(!O.circle[ee]){O.circle[ee]=!0;const X=3*ee;if(this._circlesCollide(Y[X],Y[X+1],Y[X+2],F.x,F.y,F.radius)&&(!P||P(this.circleKeys[ee])))return E.push(!0),!0}}}_forEachCell(s,d,_,b,x,E,I,P){const F=this._convertToXCellCoord(s),O=this._convertToYCellCoord(d),B=this._convertToXCellCoord(_),H=this._convertToYCellCoord(b);for(let Y=F;Y<=B;Y++)for(let ee=O;ee<=H;ee++)if(x.call(this,s,d,_,b,this.xCellCount*ee+Y,E,I,P))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,d,_,b,x,E){const I=b-s,P=x-d,F=_+E;return F*F>I*I+P*P}_circleAndRectCollide(s,d,_,b,x,E,I){const P=(E-b)/2,F=Math.abs(s-(b+P));if(F>P+_)return!1;const O=(I-x)/2,B=Math.abs(d-(x+O));if(B>O+_)return!1;if(F<=P||B<=O)return!0;const H=F-P,Y=B-O;return H*H+Y*Y<=_*_}}const rt=Math.tan(85*Math.PI/180);function It(m,s,d,_,b){const x=p.create$1();if(s){const E=vu([],b);x[0]=E[0],x[1]=E[1],x[4]=E[2],x[5]=E[3],d||p.rotateZ(x,x,_.angle)}else p.multiply(x,_.labelPlaneMatrix,m);return x}function _t(m,s,d,_,b){if(s){const x=p.clone$1(m),E=p.identity([]);return E[0]=b[0],E[1]=b[1],E[4]=b[2],E[5]=b[3],p.multiply(x,x,E),d||p.rotateZ(x,x,-_.angle),x}return _.glCoordMatrix}function Si(m,s,d=0){const _=[m.x,m.y,d,1];d?p.transformMat4(_,_,s):Gl(_,_,s);const b=_[3];return{point:new p.pointGeometry(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function Hl(m,s){return Math.min(.5+m/s*.5,1.5)}function Yt(m,s){const d=m[0]/m[3],_=m[1]/m[3];return d>=-s[0]&&d<=s[0]&&_>=-s[1]&&_<=s[1]}function ct(m,s,d,_,b,x,E,I,P){const F=_?m.textSizeData:m.iconSizeData,O=p.evaluateSizeForZoom(F,d.transform.zoom),B=[256/d.width*2+1,256/d.height*2+1],H=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();const Y=m.lineVertexArray,ee=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,X=d.transform.width/d.transform.height;let ie=!1;for(let K=0;K<ee.length;K++){const ne=ee.get(K);if(ne.writingMode!==p.WritingMode.vertical||ie||0!==K&&ee.get(K-1).writingMode===p.WritingMode.horizontal||(ie=!0),ne.hidden||ne.writingMode===p.WritingMode.vertical&&!ie){Gr(ne.numGlyphs,H);continue}ie=!1;const se=new p.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),J=P?P(se):0,le=[se.x,se.y,J],fe=[...le,1];if(p.transformMat4(fe,fe,s),!Yt(fe,B)){Gr(ne.numGlyphs,H);continue}const Se=Hl(d.transform.cameraToCenterDistance,fe[3]),Me=p.evaluateSizeForFeature(F,O,ne),Ne=E?Me/Se:Me*Se,Re=Si(new p.pointGeometry(le[0],le[1]),b,le[2]);if(Re.signedDistanceFromCamera<=0){Gr(ne.numGlyphs,H);continue}let Ze={};const Pe=E?null:P,Xe=yi(ne,Ne,!1,I,s,b,x,m.glyphOffsetArray,Y,H,Re.point,se,Ze,X,Pe);ie=Xe.useVertical,Pe&&Xe.needsFlipping&&(Ze={}),(Xe.notEnoughRoom||ie||Xe.needsFlipping&&yi(ne,Ne,!0,I,s,b,x,m.glyphOffsetArray,Y,H,Re.point,se,Ze,X,Pe).notEnoughRoom)&&Gr(ne.numGlyphs,H)}_?m.text.dynamicLayoutVertexBuffer.updateData(H):m.icon.dynamicLayoutVertexBuffer.updateData(H)}function Sc(m,s,d,_,b,x,E,I,P,F,O,B,H){const Y=I.glyphStartIndex+I.numGlyphs,ee=I.lineStartIndex,X=I.lineStartIndex+I.lineLength,ie=s.getoffsetX(I.glyphStartIndex),K=s.getoffsetX(Y-1),ne=pa(m*ie,d,_,b,x,E,I.segment,ee,X,P,F,O,B,H,!0);if(!ne)return null;const se=pa(m*K,d,_,b,x,E,I.segment,ee,X,P,F,O,B,H,!0);return se?{first:ne,last:se}:null}function nn(m,s,d,_){return m.writingMode===p.WritingMode.horizontal&&Math.abs(d.y-s.y)>Math.abs(d.x-s.x)*_?{useVertical:!0}:m.writingMode===p.WritingMode.vertical?s.y<d.y?{needsFlipping:!0}:null:0!==m.flipState&&function(b,x,E){const I=(x.x-b.x)*E;return 0===I||Math.abs((x.y-b.y)/I)>rt}(s,d,_)?1===m.flipState?{needsFlipping:!0}:null:s.x>d.x?{needsFlipping:!0}:null}function yi(m,s,d,_,b,x,E,I,P,F,O,B,H,Y,ee){const X=s/24,ie=m.lineOffsetX*X,K=m.lineOffsetY*X;let ne;if(m.numGlyphs>1){const se=m.glyphStartIndex+m.numGlyphs,J=m.lineStartIndex,le=m.lineStartIndex+m.lineLength,fe=Sc(X,I,ie,K,d,O,B,m,P,x,H,ee,!1);if(!fe)return{notEnoughRoom:!0};const Se=Si(fe.first.point,E).point,Me=Si(fe.last.point,E).point;if(_&&!d){const Ne=nn(m,Se,Me,Y);if(m.flipState=Ne&&Ne.needsFlipping?1:2,Ne)return Ne}ne=[fe.first];for(let Ne=m.glyphStartIndex+1;Ne<se-1;Ne++)ne.push(pa(X*I.getoffsetX(Ne),ie,K,d,O,B,m.segment,J,le,P,x,H,ee,!1,!1));ne.push(fe.last)}else{if(_&&!d){const J=Si(B,b).point,le=m.lineStartIndex+m.segment+1,fe=new p.pointGeometry(P.getx(le),P.gety(le)),Se=Si(fe,b),Me=nn(m,J,Se.signedDistanceFromCamera>0?Se.point:Zh(B,fe,J,1,b,void 0),Y);if(m.flipState=Me&&Me.needsFlipping?1:2,Me)return Me}const se=pa(X*I.getoffsetX(m.glyphStartIndex),ie,K,d,O,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,P,x,H,ee,!1,!1);if(!se)return{notEnoughRoom:!0};ne=[se]}for(const se of ne)p.addDynamicAttributes(F,se.point,se.angle);return{}}function Xn(m,s,d){const _={x:m.x,y:m.y,z:0};if(!d)return Si(_,s,_.z);const b=d(m);return Si(new p.pointGeometry(_.x,_.y),s,_.z+b)}function Zh(m,s,d,_,b,x){const E=Xn(m.add(m.sub(s)._unit()),b,x).point,I=d.sub(E);return d.add(I._mult(_/I.mag()))}function pa(m,s,d,_,b,x,E,I,P,F,O,B,H,Y,ee){const X=_?m-s:m+s;let ie=X>0?1:-1,K=0;_&&(ie*=-1,K=Math.PI),ie<0&&(K+=Math.PI);let ne=ie>0?I+E:I+E+1,se=b,J=b,le=0,fe=0;const Se=Math.abs(X),Me=[],Ne=[];let Re=x;const Ze=()=>{const wt=ne-ie;return 0===le?x:new p.pointGeometry(F.getx(wt),F.gety(wt))},Pe=()=>Zh(Ze(),Re,J,Se-le+1,O,H);for(;le+fe<=Se;){if(ne+=ie,ne<I||ne>=P)return null;if(J=se,Me.push(se),Y&&Ne.push(Re||Ze()),se=B[ne],void 0===se){Re=new p.pointGeometry(F.getx(ne),F.gety(ne));const wt=Xn(Re,O,H);se=wt.signedDistanceFromCamera>0?B[ne]=wt.point:Pe()}else Re=null;le+=fe,fe=J.dist(se)}ee&&H&&(Re=Re||new p.pointGeometry(F.getx(ne),F.gety(ne)),B[ne]=se=void 0===B[ne]?se:Pe(),fe=J.dist(se));const Xe=(Se-le)/fe,Te=se.sub(J),Ke=Te.mult(Xe)._add(J);d&&Ke._add(Te._unit()._perp()._mult(d*ie));const ft=K+Math.atan2(se.y-J.y,se.x-J.x);return Me.push(Ke),Y&&(Re=Re||new p.pointGeometry(F.getx(ne),F.gety(ne)),Ne.push(function(wt,Dt,Pt){const St=1-Pt;return new p.pointGeometry(wt.x*St+Dt.x*Pt,wt.y*St+Dt.y*Pt)}(Ne.length>0?Ne[Ne.length-1]:Re,Re,Xe))),{point:Ke,angle:ft,path:Me,tilePath:Ne}}const wu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gr(m,s){for(let d=0;d<m;d++){const _=s.length;s.resize(_+4),s.float32.set(wu,3*_)}}function Gl(m,s,d){const _=s[0],b=s[1];return m[0]=d[0]*_+d[4]*b+d[12],m[1]=d[1]*_+d[5]*b+d[13],m[3]=d[3]*_+d[7]*b+d[15],m}const No=100;class mn{constructor(s,d,_=new vs(s.width+200,s.height+200,25),b=new vs(s.width+200,s.height+200,25)){this.transform=s,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+No,this.screenBottomBoundary=s.height+No,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=d}placeCollisionBox(s,d,_,b,x,E,I){let P=d.projectedAnchorZ;d.elevation&&(P+=d.elevation);const F=this.projectAndGetPerspectiveRatio(E,d.projectedAnchorX,d.projectedAnchorY,P,d.tileID),O=x*F.perspectiveRatio,B=(d.x1*s+_.x-d.padding)*O+F.point.x,H=(d.y1*s+_.y-d.padding)*O+F.point.y,Y=(d.x2*s+_.x+d.padding)*O+F.point.x,ee=(d.y2*s+_.y+d.padding)*O+F.point.y,X=F.perspectiveRatio<=.55||F.aboveHorizon;return!this.isInsideGrid(B,H,Y,ee)||!b&&this.grid.hitTest(B,H,Y,ee,I)||X?{box:[],offscreen:!1}:{box:[B,H,Y,ee],offscreen:this.isOffscreen(B,H,Y,ee)}}placeCollisionCircles(s,d,_,b,x,E,I,P,F,O,B,H,Y,ee){const X=[],ie=this.transform.elevation,K=ie?Pe=>ie.getAtTileOffset(ee,Pe.x,Pe.y):Pe=>0,ne=new p.pointGeometry(d.tileAnchorX,d.tileAnchorY),se=K(ne),J=this.projectAndGetPerspectiveRatio(E,ne.x,ne.y,se,ee),{perspectiveRatio:le}=J,fe=(O?x/le:x*le)/p.ONE_EM,Se=Si(ne,I,se).point,Me=J.signedDistanceFromCamera>0?Sc(fe,b,d.lineOffsetX*fe,d.lineOffsetY*fe,!1,Se,ne,d,_,I,{},ie&&!O?K:null,O&&!!ie):null;let Ne=!1,Re=!1,Ze=!0;if(Me&&!J.aboveHorizon){const Pe=.5*H*le+Y,Xe=new p.pointGeometry(-100,-100),Te=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ke=new $l,ft=Me.first,wt=Me.last;let Dt=[];for(let xt=ft.path.length-1;xt>=1;xt--)Dt.push(ft.path[xt]);for(let xt=1;xt<wt.path.length;xt++)Dt.push(wt.path[xt]);const Pt=2.5*Pe;if(P){const xt=Dt.map(ie?(At,Ft)=>{const hi=K(Ft<ft.path.length-1?ft.tilePath[ft.path.length-1-Ft]:wt.tilePath[Ft-ft.path.length+2]);return Si(At,P,hi)}:At=>Si(At,P));Dt=xt.some(At=>At.signedDistanceFromCamera<=0)?[]:xt.map(At=>At.point)}let St=[];if(Dt.length>0){const xt=Dt[0].clone(),At=Dt[0].clone();for(let Ft=1;Ft<Dt.length;Ft++)xt.x=Math.min(xt.x,Dt[Ft].x),xt.y=Math.min(xt.y,Dt[Ft].y),At.x=Math.max(At.x,Dt[Ft].x),At.y=Math.max(At.y,Dt[Ft].y);St=xt.x>=Xe.x&&At.x<=Te.x&&xt.y>=Xe.y&&At.y<=Te.y?[Dt]:At.x<Xe.x||xt.x>Te.x||At.y<Xe.y||xt.y>Te.y?[]:p.clipLine([Dt],Xe.x,Xe.y,Te.x,Te.y)}for(const xt of St){Ke.reset(xt,.25*Pe);let At=0;At=Ke.length<=.5*Pe?1:Math.ceil(Ke.paddedLength/Pt)+1;for(let Ft=0;Ft<At;Ft++){const hi=Ft/Math.max(At-1,1),si=Ke.lerp(hi),Ci=si.x+No,Ai=si.y+No;X.push(Ci,Ai,Pe,0);const ni=Ci-Pe,lo=Ai-Pe,Bo=Ci+Pe,Cn=Ai+Pe;if(Ze=Ze&&this.isOffscreen(ni,lo,Bo,Cn),Re=Re||this.isInsideGrid(ni,lo,Bo,Cn),!s&&this.grid.hitTestCircle(Ci,Ai,Pe,B)&&(Ne=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ne}}}}return{circles:!F&&Ne||!Re?[]:X,offscreen:Ze,collisionDetected:Ne}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,b=1/0,x=-1/0,E=-1/0;for(const O of s){const B=new p.pointGeometry(O.x+No,O.y+No);_=Math.min(_,B.x),b=Math.min(b,B.y),x=Math.max(x,B.x),E=Math.max(E,B.y),d.push(B)}const I=this.grid.query(_,b,x,E).concat(this.ignoredGrid.query(_,b,x,E)),P={},F={};for(const O of I){const B=O.key;if(void 0===P[B.bucketInstanceId]&&(P[B.bucketInstanceId]={}),P[B.bucketInstanceId][B.featureIndex])continue;const H=[new p.pointGeometry(O.x1,O.y1),new p.pointGeometry(O.x2,O.y1),new p.pointGeometry(O.x2,O.y2),new p.pointGeometry(O.x1,O.y2)];p.polygonIntersectsPolygon(d,H)&&(P[B.bucketInstanceId][B.featureIndex]=!0,void 0===F[B.bucketInstanceId]&&(F[B.bucketInstanceId]=[]),F[B.bucketInstanceId].push(B.featureIndex))}return F}insertCollisionBox(s,d,_,b,x){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,d,_,b,x){const E=d?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:b,collisionGroupID:x};for(let P=0;P<s.length;P+=4)E.insertCircle(I,s[P],s[P+1],s[P+2])}projectAndGetPerspectiveRatio(s,d,_,b,x){const E=[d,_,b||0,1];let I=!1;if(b||this.transform.pitch>0){p.transformMat4(E,E,s);let P=!1;this.fogState&&x&&(P=function(F,O,B,H,Y,ee){const X=ee.calculateFogTileMatrix(Y),ie=[O,B,H];return p.transformMat4$1(ie,ie,X),Rn(F,ie,ee.pitch,ee._fov)}(this.fogState,d,_,b||0,x.toUnwrapped(),this.transform)>.9),I=E[2]>E[3]||P}else Gl(E,E,s);return{point:new p.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+No,(-E[1]/E[3]+1)/2*this.transform.height+No),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:I}}isOffscreen(s,d,_,b){return _<No||s>=this.screenRightBoundary||b<No||d>this.screenBottomBoundary}isInsideGrid(s,d,_,b){return _>=0&&s<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const s=p.identity([]);return p.translate(s,s,[-100,-100,0]),s}}class Tt{constructor(s,d,_,b){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Hs{constructor(s,d,_,b,x,E=!1){this.text=new Tt(s?s.text:null,d,_,x),this.icon=new Tt(s?s.icon:null,d,b,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pr{constructor(s,d,_,b=!1){this.text=s,this.icon=d,this.skipFade=_,this.clipped=b}}class Ui{constructor(){this.invProjMatrix=p.create$1(),this.viewportMatrix=p.create$1(),this.circles=[]}}class kd{constructor(s,d,_,b,x){this.bucketInstanceId=s,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=x}}class Nd{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const d=++this.maxGroupID;this.collisionGroups[s]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[s]}}function Vn(m,s,d,_,b){const{horizontalAlign:x,verticalAlign:E}=p.getAnchorAlignment(m),I=-(x-.5)*s,P=-(E-.5)*d,F=p.evaluateVariableOffset(m,_);return new p.pointGeometry(I+F[0]*b,P+F[1]*b)}function er(m,s,d,_,b){const x=new p.pointGeometry(m,s);return d&&x._rotate(_?b:-b),x}class ql{constructor(s,d,_,b,x){this.transform=s.clone(),this.collisionIndex=new mn(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Nd(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,d,_,b){const x=_.getBucket(d),E=_.latestFeatureIndex;if(!x||!E||d.id!==x.layerIds[0])return;const I=x.layers[0].layout,P=_.collisionBoxArray,F=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),O=_.tileSize/p.EXTENT,B=_.tileID.toUnwrapped(),H=this.transform.calculateProjMatrix(B),Y="map"===I.get("text-pitch-alignment"),ee="map"===I.get("text-rotation-alignment");d.compileFilter();const X=d.dynamicFilter(),ie=d.dynamicFilterNeedsFeature(),K=this.transform.calculatePixelsToTileUnitsMatrix(_),ne=It(H,Y,ee,this.transform,K);let se=null;if(Y){const fe=_t(H,Y,ee,this.transform,K);se=p.multiply([],this.transform.labelPlaneMatrix,fe)}let J=null;X&&_.latestFeatureIndex&&(J={unwrappedTileID:B,dynamicFilter:X,dynamicFilterNeedsFeature:ie,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new kd(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,_.tileID);const le={bucket:x,layout:I,posMatrix:H,textLabelPlaneMatrix:ne,labelToScreenMatrix:se,clippingData:J,scale:F,textPixelRatio:O,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(b)for(const fe of x.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:Me,symbolInstanceEnd:Ne}=fe;s.push({sortKey:Se,symbolInstanceStart:Me,symbolInstanceEnd:Ne,parameters:le})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:le})}attemptAnchorPlacement(s,d,_,b,x,E,I,P,F,O,B,H,Y,ee,X,ie,K,ne){const se=[H.textOffset0,H.textOffset1],J=Vn(s,_,b,se,x),le=this.collisionIndex.placeCollisionBox(x,d,er(J.x,J.y,E,I,this.transform.angle),B,P,F,O.predicate);if((!ie||0!==this.collisionIndex.placeCollisionBox(ee.getSymbolInstanceIconSize(ne,this.transform.zoom,Y),ie,er(J.x,J.y,E,I,this.transform.angle),B,P,F,O.predicate).box.length)&&le.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[H.crossTileID].anchor),this.variableOffsets[H.crossTileID]={textOffset:se,width:_,height:b,anchor:s,textScale:x,prevAnchor:fe},this.markUsedJustification(ee,s,H,X),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,X,H),this.placedOrientations[H.crossTileID]=X),{shift:J,placedGlyphBoxes:le}}}placeLayerBucketPart(s,d,_,b){const{bucket:x,layout:E,posMatrix:I,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:O,textPixelRatio:B,holdingForFade:H,collisionBoxArray:Y,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:X,collisionGroup:ie}=s.parameters,K=E.get("text-optional"),ne=E.get("icon-optional"),se=E.get("text-allow-overlap"),J=E.get("icon-allow-overlap"),le="map"===E.get("text-rotation-alignment"),fe="map"===E.get("text-pitch-alignment"),Se="none"!==E.get("icon-text-fit"),Me="viewport-y"===E.get("symbol-z-order"),Ne=se&&(J||!x.hasIconData()||ne),Re=J&&(se||!x.hasTextData()||K);!x.collisionArrays&&Y&&x.deserializeCollisionBoxes(Y),_&&b&&x.updateCollisionDebugBuffers(this.transform.zoom,Y);const Ze=(Pe,Xe,Te)=>{if(O){const Cn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Di=null;if(O.dynamicFilterNeedsFeature){const _n=this.retainedQueryData[x.bucketInstanceId];Di=O.featureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:_n.bucketIndex,sourceLayerIndex:_n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Cn,Di,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new p.pointGeometry(Pe.tileAnchorX,Pe.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Pe.crossTileID]=new pr(!1,!1,!1,!0),void(d[Pe.crossTileID]=!0)}if(d[Pe.crossTileID])return;if(H)return void(this.placements[Pe.crossTileID]=new pr(!1,!1,!1));let Ke=!1,ft=!1,wt=!0,Dt=null,Pt={box:null,offscreen:null},St={box:null,offscreen:null},xt=null,At=null,Ft=null,hi=0,si=0,Ci=0;Te.textFeatureIndex?hi=Te.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(hi=Pe.featureIndex),Te.verticalTextFeatureIndex&&(si=Te.verticalTextFeatureIndex);const Ai=Cn=>{Cn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Cn.elevation)&&(Cn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Cn.tileAnchorX,Cn.tileAnchorY):0)},ni=Te.textBox;if(ni){Ai(ni);const Cn=_n=>{let Kn=p.WritingMode.horizontal;if(x.allowVerticalPlacement&&!_n&&this.prevPlacement){const yr=this.prevPlacement.placedOrientations[Pe.crossTileID];yr&&(this.placedOrientations[Pe.crossTileID]=yr,Kn=yr,this.markUsedOrientation(x,Kn,Pe))}return Kn},Di=(_n,Kn)=>{if(x.allowVerticalPlacement&&Pe.numVerticalGlyphVertices>0&&Te.verticalTextBox){for(const yr of x.writingModes)if(yr===p.WritingMode.vertical?(Pt=Kn(),St=Pt):Pt=_n(),Pt&&Pt.box&&Pt.box.length)break}else Pt=_n()};if(E.get("text-variable-anchor")){let _n=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pe.crossTileID]){const Wn=this.prevPlacement.variableOffsets[Pe.crossTileID];_n.indexOf(Wn.anchor)>0&&(_n=_n.filter(bt=>bt!==Wn.anchor),_n.unshift(Wn.anchor))}const Kn=(Wn,bt,Gc)=>{const kr=x.getSymbolInstanceTextSize(ee,Pe,this.transform.zoom,Xe),al=(Wn.x2-Wn.x1)*kr+2*Wn.padding,ym=(Wn.y2-Wn.y1)*kr+2*Wn.padding,Zd=Se&&!J?bt:null;Zd&&Ai(Zd);let qc={box:[],offscreen:!1};const vm=se?2*_n.length:_n.length;for(let Uu=0;Uu<vm;++Uu){const Xd=this.attemptAnchorPlacement(_n[Uu%_n.length],Wn,al,ym,kr,le,fe,B,I,ie,Uu>=_n.length,Pe,Xe,x,Gc,Zd,ee,X);if(Xd&&(qc=Xd.placedGlyphBoxes,qc&&qc.box&&qc.box.length)){Ke=!0,Dt=Xd.shift;break}}return qc};Di(()=>Kn(ni,Te.iconBox,p.WritingMode.horizontal),()=>{const Wn=Te.verticalTextBox;return Wn&&Ai(Wn),x.allowVerticalPlacement&&!(Pt&&Pt.box&&Pt.box.length)&&Pe.numVerticalGlyphVertices>0&&Wn?Kn(Wn,Te.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Pt&&(Ke=Pt.box,wt=Pt.offscreen);const yr=Cn(Pt&&Pt.box);if(!Ke&&this.prevPlacement){const Wn=this.prevPlacement.variableOffsets[Pe.crossTileID];Wn&&(this.variableOffsets[Pe.crossTileID]=Wn,this.markUsedJustification(x,Wn.anchor,Pe,yr))}}else{const _n=(Kn,yr)=>{const Wn=x.getSymbolInstanceTextSize(ee,Pe,this.transform.zoom,Xe),bt=this.collisionIndex.placeCollisionBox(Wn,Kn,new p.pointGeometry(0,0),se,B,I,ie.predicate);return bt&&bt.box&&bt.box.length&&(this.markUsedOrientation(x,yr,Pe),this.placedOrientations[Pe.crossTileID]=yr),bt};Di(()=>_n(ni,p.WritingMode.horizontal),()=>{const Kn=Te.verticalTextBox;return x.allowVerticalPlacement&&Pe.numVerticalGlyphVertices>0&&Kn?(Ai(Kn),_n(Kn,p.WritingMode.vertical)):{box:null,offscreen:null}}),Cn(Pt&&Pt.box&&Pt.box.length)}}if(xt=Pt,Ke=xt&&xt.box&&xt.box.length>0,wt=xt&&xt.offscreen,Pe.useRuntimeCollisionCircles){const Cn=x.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex>=0?Pe.centerJustifiedTextSymbolIndex:Pe.verticalPlacedTextSymbolIndex),Di=p.evaluateSizeForFeature(x.textSizeData,ee,Cn),_n=E.get("text-padding");At=this.collisionIndex.placeCollisionCircles(se,Cn,x.lineVertexArray,x.glyphOffsetArray,Di,I,P,F,_,fe,ie.predicate,Pe.collisionCircleDiameter*Di/p.ONE_EM,_n,this.retainedQueryData[x.bucketInstanceId].tileID),Ke=se||At.circles.length>0&&!At.collisionDetected,wt=wt&&At.offscreen}if(Te.iconFeatureIndex&&(Ci=Te.iconFeatureIndex),Te.iconBox){const Cn=Di=>{Ai(Di);const _n=Se&&Dt?er(Dt.x,Dt.y,le,fe,this.transform.angle):new p.pointGeometry(0,0),Kn=x.getSymbolInstanceIconSize(X,this.transform.zoom,Xe);return this.collisionIndex.placeCollisionBox(Kn,Di,_n,J,B,I,ie.predicate)};St&&St.box&&St.box.length&&Te.verticalIconBox?(Ft=Cn(Te.verticalIconBox),ft=Ft.box.length>0):(Ft=Cn(Te.iconBox),ft=Ft.box.length>0),wt=wt&&Ft.offscreen}const lo=K||0===Pe.numHorizontalGlyphVertices&&0===Pe.numVerticalGlyphVertices,Bo=ne||0===Pe.numIconVertices;if(lo||Bo?Bo?lo||(ft=ft&&Ke):Ke=ft&&Ke:ft=Ke=ft&&Ke,Ke&&xt&&xt.box&&this.collisionIndex.insertCollisionBox(xt.box,E.get("text-ignore-placement"),x.bucketInstanceId,St&&St.box&&si?si:hi,ie.ID),ft&&Ft&&this.collisionIndex.insertCollisionBox(Ft.box,E.get("icon-ignore-placement"),x.bucketInstanceId,Ci,ie.ID),At&&(Ke&&this.collisionIndex.insertCollisionCircles(At.circles,E.get("text-ignore-placement"),x.bucketInstanceId,hi,ie.ID),_)){const Cn=x.bucketInstanceId;let Di=this.collisionCircleArrays[Cn];void 0===Di&&(Di=this.collisionCircleArrays[Cn]=new Ui);for(let _n=0;_n<At.circles.length;_n+=4)Di.circles.push(At.circles[_n+0]),Di.circles.push(At.circles[_n+1]),Di.circles.push(At.circles[_n+2]),Di.circles.push(At.collisionDetected?1:0)}this.placements[Pe.crossTileID]=new pr(Ke||Ne,ft||Re,wt||x.justReloaded),d[Pe.crossTileID]=!0};if(Me){const Pe=x.getSortedSymbolIndexes(this.transform.angle);for(let Xe=Pe.length-1;Xe>=0;--Xe){const Te=Pe[Xe];Ze(x.symbolInstances.get(Te),Te,x.collisionArrays[Te])}}else for(let Pe=s.symbolInstanceStart;Pe<s.symbolInstanceEnd;Pe++)Ze(x.symbolInstances.get(Pe),Pe,x.collisionArrays[Pe]);if(_&&x.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[x.bucketInstanceId];p.invert(Pe.invProjMatrix,I),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,d,_,b){let x;x=b===p.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(d)];const E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=x>=0&&I!==x?0:_.crossTileID)}markUsedOrientation(s,d,_){const b=d===p.WritingMode.horizontal||d===p.WritingMode.horizontalOnly?d:0,x=d===p.WritingMode.vertical?d:0,E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const I of E)s.text.placedSymbolArray.get(I).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(s):1,x=d?d.opacities:{},E=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const P in this.placements){const F=this.placements[P],O=x[P];O?(this.opacities[P]=new Hs(O,b,F.text,F.icon,null,F.clipped),_=_||F.text!==O.text.placed||F.icon!==O.icon.placed):(this.opacities[P]=new Hs(null,b,F.text,F.icon,F.skipFade,F.clipped),_=_||F.text||F.icon)}for(const P in x){const F=x[P];if(!this.opacities[P]){const O=new Hs(F,b,!1,!1);O.isHidden()||(this.opacities[P]=O,_=_||F.text.placed||F.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);_?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:s)}updateLayerOpacities(s,d){const _={};for(const b of d){const x=b.getBucket(s);x&&b.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,_,b.collisionBoxArray)}}updateBucketOpacities(s,d,_){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const b=s.layers[0].layout,x=!!s.layers[0].dynamicFilter(),E=new Hs(null,0,!1,!1,!0),I=b.get("text-allow-overlap"),P=b.get("icon-allow-overlap"),F=b.get("text-variable-anchor"),O="map"===b.get("text-rotation-alignment"),B="map"===b.get("text-pitch-alignment"),H="none"!==b.get("icon-text-fit"),Y=new Hs(null,0,I&&(P||!s.hasIconData()||b.get("icon-optional")),P&&(I||!s.hasTextData()||b.get("text-optional")),!0);!s.collisionArrays&&_&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(_);const ee=(X,ie,K)=>{for(let ne=0;ne<ie/4;ne++)X.opacityVertexArray.emplaceBack(K)};for(let X=0;X<s.symbolInstances.length;X++){const ie=s.symbolInstances.get(X),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ne,crossTileID:se}=ie;let J=this.opacities[se];d[se]?J=E:J||(J=Y,this.opacities[se]=J),d[se]=!0;const le=ie.numIconVertices>0,fe=this.placedOrientations[ie.crossTileID],Se=fe===p.WritingMode.vertical,Me=fe===p.WritingMode.horizontal||fe===p.WritingMode.horizontalOnly;if(K>0||ne>0){const Ne=Xh(J.text);ee(s.text,K,Se?bi:Ne),ee(s.text,ne,Me?bi:Ne);const Re=J.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(Xe=>{Xe>=0&&(s.text.placedSymbolArray.get(Xe).hidden=Re||Se?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=Re||Me?1:0);const Ze=this.variableOffsets[ie.crossTileID];Ze&&this.markUsedJustification(s,Ze.anchor,ie,fe);const Pe=this.placedOrientations[ie.crossTileID];Pe&&(this.markUsedJustification(s,"left",ie,Pe),this.markUsedOrientation(s,Pe,ie))}if(le){const Ne=Xh(J.icon);ie.placedIconSymbolIndex>=0&&(ee(s.icon,ie.numIconVertices,Se?bi:Ne),s.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=J.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(ee(s.icon,ie.numVerticalIconVertices,Me?bi:Ne),s.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=J.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ne=s.collisionArrays[X];if(Ne){let Re=new p.pointGeometry(0,0),Ze=!0;if(Ne.textBox||Ne.verticalTextBox){if(F){const Xe=this.variableOffsets[se];Xe?(Re=Vn(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textScale),O&&Re._rotate(B?this.transform.angle:-this.transform.angle)):Ze=!1}x&&(Ze=!J.clipped),Ne.textBox&&ji(s.textCollisionBox.collisionVertexArray,J.text.placed,!Ze||Se,Re.x,Re.y),Ne.verticalTextBox&&ji(s.textCollisionBox.collisionVertexArray,J.text.placed,!Ze||Me,Re.x,Re.y)}const Pe=Ze&&Boolean(!Me&&Ne.verticalIconBox);Ne.iconBox&&ji(s.iconCollisionBox.collisionVertexArray,J.icon.placed,Pe,H?Re.x:0,H?Re.y:0),Ne.verticalIconBox&&ji(s.iconCollisionBox.collisionVertexArray,J.icon.placed,!Pe,H?Re.x:0,H?Re.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=X.invProjMatrix,s.placementViewportMatrix=X.viewportMatrix,s.collisionCircleArray=X.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function ji(m,s,d,_,b){m.emplaceBack(s?1:0,d?1:0,_||0,b||0),m.emplaceBack(s?1:0,d?1:0,_||0,b||0),m.emplaceBack(s?1:0,d?1:0,_||0,b||0),m.emplaceBack(s?1:0,d?1:0,_||0,b||0)}const vi=Math.pow(2,25),es=Math.pow(2,24),Ac=Math.pow(2,17),Cu=Math.pow(2,16),E_=Math.pow(2,9),ln=Math.pow(2,8),T_=Math.pow(2,1);function Xh(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const s=m.placed?1:0,d=Math.floor(127*m.opacity);return d*vi+s*es+d*Ac+s*Cu+d*E_+s*ln+d*T_+s}const bi=0;class An{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,d,_,b,x){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(d.getBucketParts(E,b,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,P)=>I.sortKey-P.sortKey));this._currentPartIndex<E.length;){const I=E[this._currentPartIndex];if(d.placeLayerBucketPart(I,this._seenCrossTileIDs,_,0===I.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class ts{constructor(s,d,_,b,x,E,I,P){this.placement=new ql(s,x,E,I,P),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,d,_){const b=p.exported.now(),x=()=>{const E=p.exported.now()-b;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=d[s[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new An(E)),this._inProgressLayer.continuePlacement(_[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const kc=512/p.EXTENT/2;class Wl{constructor(s,d,_){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let b=0;b<d.length;b++){const x=d.get(b),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,s)})}}getScaledCoordinates(s,d){const _=kc/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*p.EXTENT+s.tileAnchorX)*_),y:Math.floor((d.canonical.y*p.EXTENT+s.tileAnchorY)*_)}}findMatches(s,d,_){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<s.length;x++){const E=s.get(x);if(E.crossTileID)continue;const I=this.indexedSymbolInstances[E.key];if(!I)continue;const P=this.getScaledCoordinates(E,d);for(const F of I)if(Math.abs(F.coord.x-P.x)<=b&&Math.abs(F.coord.y-P.y)<=b&&!_[F.crossTileID]){_[F.crossTileID]=!0,E.crossTileID=F.crossTileID;break}}}}class Yh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const d=Math.round((s-this.lng)/360);if(0!==d)for(const _ in this.indexes){const b=this.indexes[_],x={};for(const E in b){const I=b[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),x[I.tileID.key]=I}this.indexes[_]=x}this.lng=s}addBucket(s,d,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const b=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>s.overscaledZ)for(const I in E){const P=E[I];P.tileID.isChildOf(s)&&P.findMatches(d.symbolInstances,s,b)}else{const I=E[s.scaledTo(Number(x)).key];I&&I.findMatches(d.symbolInstances,s,b)}}for(let x=0;x<d.symbolInstances.length;x++){const E=d.symbolInstances.get(x);E.crossTileID||(E.crossTileID=_.generate(),b[E.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Wl(s,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(s,d){for(const _ in d.indexedSymbolInstances)for(const b of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[s][b.crossTileID]}removeStaleBuckets(s){let d=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const x in b)s[b[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[x]),delete b[x],d=!0)}return d}}class Po{constructor(){this.layerIndexes={},this.crossTileIDs=new Yh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,d,_){let b=this.layerIndexes[s.id];void 0===b&&(b=this.layerIndexes[s.id]=new sm);let x=!1;const E={};b.handleWrapJump(_);for(const I of d){const P=I.getBucket(s);P&&s.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,P,this.crossTileIDs)&&(x=!0),E[P.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(s){const d={};s.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const ma=(m,s)=>p.emitValidationErrors(m,s&&s.filter(d=>"source.canvas"!==d.identifier)),Kh=p.pick(Je,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),kn=p.pick(Je,["setCenter","setZoom","setBearing","setPitch"]),Jh=function(){const m={},s=p.spec.$version;for(const d in p.spec.$root){const _=p.spec.$root[d];if(_.required){let b=null;b="version"===d?s:"array"===_.type?[]:{},null!=b&&(m[d]=b)}}return m}(),Qh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class no extends p.Evented{constructor(s,d={}){super(),this.map=s,this.dispatcher=new _s(Qe(),this),this.imageManager=new la,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(s._requestManager,d.localFontFamily?p.LocalGlyphMode.all:d.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new p.LineAtlas(256,512),this.crossTileSymbolIndex=new Po,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=no.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(x,E)=>{if(p.triggerPluginCompletionEvent(x),E&&E.every(I=>I))for(const I in _._sourceCaches){const P=_._sourceCaches[I],F=P.getSource().type;"vector"!==F&&"geojson"!==F||P.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const x=this.getSource(b.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===x.id&&this._validateLayer(I)}})}loadURL(s,d={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!p.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,d.accessToken);const b=this.map._requestManager.transformRequest(s,p.ResourceType.Style);this._request=p.getJSON(b,(x,E)=>{this._request=null,x?this.fire(new p.ErrorEvent(x)):E&&this._load(E,_)})}loadJSON(s,d={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(s,!1!==d.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Jh,!1)}_updateLayerCount(s,d){const _=d?1:-1;s.is3D()&&(this._num3DLayers+=_),"circle"===s.type&&(this._numCircleLayers+=_),"symbol"===s.type&&(this._numSymbolLayers+=_)}_load(s,d){if(d&&ma(this,p.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s,this.updateProjection();for(const b in s.sources)this.addSource(b,s.sources[b],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const _=vt(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of _)b=p.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Qi(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const s=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),s){this.map.painter.clearBackgroundTiles();for(const d in this._sourceCaches)this._sourceCaches[d].clearTiles();this.map._update(!0)}}_loadSprite(s){this._spriteRequest=function(d,_,b){let x,E,I;const P=p.exported.devicePixelRatio>1?"@2x":"";let F=p.getJSON(_.transformRequest(_.normalizeSpriteURL(d,P,".json"),p.ResourceType.SpriteJSON),(H,Y)=>{F=null,I||(I=H,x=Y,B())}),O=p.getImage(_.transformRequest(_.normalizeSpriteURL(d,P,".png"),p.ResourceType.SpriteImage),(H,Y)=>{O=null,I||(I=H,E=Y,B())});function B(){if(I)b(I);else if(x&&E){const H=p.exported.getImageData(E),Y={};for(const ee in x){const{width:X,height:ie,x:K,y:ne,sdf:se,pixelRatio:J,stretchX:le,stretchY:fe,content:Se}=x[ee],Me=new p.RGBAImage({width:X,height:ie});p.RGBAImage.copy(H,Me,{x:K,y:ne},{x:0,y:0},{width:X,height:ie}),Y[ee]={data:Me,pixelRatio:J,sdf:se,stretchX:le,stretchY:fe,content:Se}}b(null,Y)}}return{cancel(){F&&(F.cancel(),F=null),O&&(O.cancel(),O=null)}}}(s,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new p.ErrorEvent(d));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(s){const d=this.getSource(s.source);if(!d)return;const _=s.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const d=[];for(const _ of s){const b=this._layers[_];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&Qh[s.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(b.length||x.length)&&this._updateWorkerLayers(b,x);for(const E in this._updatedSources){const I=this._updatedSources[E];"reload"===I?this._reloadSource(E):"clear"===I&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const x=this._sourceCaches[b];_[b]=x.used,x.used=!1}for(const b of this._order){const x=this._layers[b];if(x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)){const I=this._getLayerSourceCache(x);I&&(I.used=!0)}const E=this.map.painter;if(E){const I=x.getProgramIds();if(!I)continue;const P=x.getProgramConfiguration(s.zoom);for(const F of I)E.useProgram(F,P)}}for(const b in _){const x=this._sourceCaches[b];_[b]!==x.used&&x.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),ma(this,p.validateStyle(s)))return!1;(s=p.clone$2(s)).layers=vt(s.layers);const d=function(b,x){if(!b)return[{command:Je.setStyle,args:[x]}];let E=[];try{if(!$e(b.version,x.version))return[{command:Je.setStyle,args:[x]}];$e(b.center,x.center)||E.push({command:Je.setCenter,args:[x.center]}),$e(b.zoom,x.zoom)||E.push({command:Je.setZoom,args:[x.zoom]}),$e(b.bearing,x.bearing)||E.push({command:Je.setBearing,args:[x.bearing]}),$e(b.pitch,x.pitch)||E.push({command:Je.setPitch,args:[x.pitch]}),$e(b.sprite,x.sprite)||E.push({command:Je.setSprite,args:[x.sprite]}),$e(b.glyphs,x.glyphs)||E.push({command:Je.setGlyphs,args:[x.glyphs]}),$e(b.transition,x.transition)||E.push({command:Je.setTransition,args:[x.transition]}),$e(b.light,x.light)||E.push({command:Je.setLight,args:[x.light]}),$e(b.fog,x.fog)||E.push({command:Je.setFog,args:[x.fog]}),$e(b.projection,x.projection)||E.push({command:Je.setProjection,args:[x.projection]});const I={},P=[];!function(B,H,Y,ee){let X;for(X in H=H||{},B=B||{})B.hasOwnProperty(X)&&(H.hasOwnProperty(X)||Ae(X,Y,ee));for(X in H)H.hasOwnProperty(X)&&(B.hasOwnProperty(X)?$e(B[X],H[X])||("geojson"===B[X].type&&"geojson"===H[X].type&&Tn(B,H,X)?Y.push({command:Je.setGeoJSONSourceData,args:[X,H[X].data]}):tn(X,H,Y,ee)):be(X,H,Y))}(b.sources,x.sources,P,I);const F=[];b.layers&&b.layers.forEach(B=>{I[B.source]?E.push({command:Je.removeLayer,args:[B.id]}):F.push(B)});let O=b.terrain;O&&I[O.source]&&(E.push({command:Je.setTerrain,args:[void 0]}),O=void 0),E=E.concat(P),$e(O,x.terrain)||E.push({command:Je.setTerrain,args:[x.terrain]}),function(B,H,Y){H=H||[];const ee=(B=B||[]).map(hn),X=H.map(hn),ie=B.reduce(pn,{}),K=H.reduce(pn,{}),ne=ee.slice(),se=Object.create(null);let J,le,fe,Se,Me,Ne,Re;for(J=0,le=0;J<ee.length;J++)fe=ee[J],K.hasOwnProperty(fe)?le++:(Y.push({command:Je.removeLayer,args:[fe]}),ne.splice(ne.indexOf(fe,le),1));for(J=0,le=0;J<X.length;J++)fe=X[X.length-1-J],ne[ne.length-1-J]!==fe&&(ie.hasOwnProperty(fe)?(Y.push({command:Je.removeLayer,args:[fe]}),ne.splice(ne.lastIndexOf(fe,ne.length-le),1)):le++,Ne=ne[ne.length-J],Y.push({command:Je.addLayer,args:[K[fe],Ne]}),ne.splice(ne.length-J,0,fe),se[fe]=!0);for(J=0;J<X.length;J++)if(fe=X[J],Se=ie[fe],Me=K[fe],!se[fe]&&!$e(Se,Me))if($e(Se.source,Me.source)&&$e(Se["source-layer"],Me["source-layer"])&&$e(Se.type,Me.type)){for(Re in Ot(Se.layout,Me.layout,Y,fe,null,Je.setLayoutProperty),Ot(Se.paint,Me.paint,Y,fe,null,Je.setPaintProperty),$e(Se.filter,Me.filter)||Y.push({command:Je.setFilter,args:[fe,Me.filter]}),$e(Se.minzoom,Me.minzoom)&&$e(Se.maxzoom,Me.maxzoom)||Y.push({command:Je.setLayerZoomRange,args:[fe,Me.minzoom,Me.maxzoom]}),Se)Se.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?Ot(Se[Re],Me[Re],Y,fe,Re.slice(6),Je.setPaintProperty):$e(Se[Re],Me[Re])||Y.push({command:Je.setLayerProperty,args:[fe,Re,Me[Re]]}));for(Re in Me)Me.hasOwnProperty(Re)&&!Se.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?Ot(Se[Re],Me[Re],Y,fe,Re.slice(6),Je.setPaintProperty):$e(Se[Re],Me[Re])||Y.push({command:Je.setLayerProperty,args:[fe,Re,Me[Re]]}))}else Y.push({command:Je.removeLayer,args:[fe]}),Ne=ne[ne.lastIndexOf(fe)+1],Y.push({command:Je.addLayer,args:[Me,Ne]})}(F,x.layers,E)}catch(I){console.warn("Unable to compute style diff:",I),E=[{command:Je.setStyle,args:[x]}]}return E}(this.serialize(),s).filter(b=>!(b.command in kn));if(0===d.length)return!1;const _=d.filter(b=>!(b.command in Kh));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=s,!0}addImage(s,d){if(this.getImage(s))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(s,d),this._afterImageUpdated(s)}updateImage(s,d){this.imageManager.updateImage(s,d)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(s))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(p.validateStyle.source,`sources.${s}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=$(s,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:b.serialize(),sourceId:s}));const x=E=>{const I=(E?"symbol:":"other:")+s,P=this._sourceCaches[I]=new p.SourceCache(I,b,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[s]=P,P.style=this,P.onAdd(this.map)};x(!1),"vector"!==d.type&&"geojson"!==d.type||x(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const d=this.getSource(s);if(void 0===d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===s)return this.fire(new p.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new p.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(s);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,d){this._checkLoaded(),this.getSource(s).setData(d),this._changed=!0}getSource(s){const d=this._getSourceCache(s);return d&&d.getSource()}addLayer(s,d,_={}){this._checkLoaded();const b=s.id;if(this.getLayer(b))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let x;if("custom"===s.type){if(ma(this,p.validateCustomStyleLayer(s)))return;x=p.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(b,s.source),s=p.clone$2(s),s=p.extend(s,{source:b})),this._validate(p.validateStyle.layer,`layers.${b}`,s,{arrayIndex:-1},_))return;x=p.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const E=d?this._order.indexOf(d):this._order.length;if(d&&-1===E)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=x;const I=this._getLayerSourceCache(x);if(this._removedLayers[b]&&x.source&&I&&"custom"!==x.type){const P=this._removedLayers[b];delete this._removedLayers[b],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,d){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===d)return;const _=this._order.indexOf(s);this._order.splice(_,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const d=this._layers[s];if(!d)return void this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(s);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=d,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const d in this._layers)if(this._layers[d].type===s)return!0;return!1}setLayerZoomRange(s,d,_){this._checkLoaded();const b=this.getLayer(s);b?b.minzoom===d&&b.maxzoom===_||(null!=d&&(b.minzoom=d),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,d,_={}){this._checkLoaded();const b=this.getLayer(s);if(b){if(!$e(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateStyle.filter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=p.clone$2(d),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){return p.clone$2(this.getLayer(s).filter)}setLayoutProperty(s,d,_,b={}){this._checkLoaded();const x=this.getLayer(s);x?$e(x.getLayoutProperty(d),_)||(x.setLayoutProperty(d,_,b),this._updateLayer(x)):this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,d){const _=this.getLayer(s);if(_)return _.getLayoutProperty(d);this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,d,_,b={}){this._checkLoaded();const x=this.getLayer(s);x?$e(x.getPaintProperty(d),_)||(x.setPaintProperty(d,_,b)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,d){return this.getLayer(s).getPaintProperty(d)}setFeatureState(s,d){this._checkLoaded();const _=s.source,b=s.sourceLayer,x=this.getSource(_);if(void 0===x)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const E=x.type;if("geojson"===E&&b)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!b)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(_);for(const P of I)P.setFeatureState(b,s.id,d)}removeFeatureState(s,d){this._checkLoaded();const _=s.source,b=this.getSource(_);if(void 0===b)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const x=b.type,E="vector"===x?s.sourceLayer:void 0;if("vector"===x&&!E)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(_);for(const P of I)P.removeFeatureState(E,s.id,d)}getFeatureState(s){this._checkLoaded();const d=s.source,_=s.sourceLayer,b=this.getSource(d);if(void 0!==b){if("vector"!==b.type||_)return void 0===s.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,s.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();s[_.id]||(s[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(s){this._updatedLayers[s.id]=!0;const d=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[s.source]="reload",d.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const d=E=>"fill-extrusion"===this._layers[E].type,_={},b=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(d(I)){_[I]=E;for(const P of s){const F=P[I];if(F)for(const O of F)b.push(O)}}}b.sort((E,I)=>I.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(d(I))for(let P=b.length-1;P>=0;P--){const F=b[P].feature;if(_[F.layer.id]<E)break;x.push(F),b.pop()}else for(const P of s){const F=P[I];if(F)for(const O of F)x.push(O.feature)}}return x}queryRenderedFeatures(s,d,_){d&&d.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const F=this._layers[P];if(!F)return this.fire(new p.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];b[F.source]=!0}}const x=[];d.availableImages=this._availableImages;const E=d&&d.layers?d.layers.some(P=>{const F=this.getLayer(P);return F&&F.is3D()}):this.has3DLayers(),I=Vl.createFromScreenPoints(s,_);for(const P in this._sourceCaches){const F=this._sourceCaches[P].getSource().id;d.layers&&!b[F]||x.push(oe(this._sourceCaches[P],this._layers,this._serializedLayers,I,d,_,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,F,O,B,H,Y,ee){const X={},ie=Y.queryRenderedSymbols(B),K=[];for(const ne of Object.keys(ie).map(Number))K.push(ee[ne]);K.sort(de);for(const ne of K){const se=ne.featureIndex.lookupSymbolFeatures(ie[ne.bucketInstanceId],F,ne.bucketIndex,ne.sourceLayerIndex,H.filter,H.layers,H.availableImages,P);for(const J in se){const le=X[J]=X[J]||[],fe=se[J];fe.sort((Se,Me)=>{const Ne=ne.featureSortOrder;if(Ne){const Re=Ne.indexOf(Se.featureIndex);return Ne.indexOf(Me.featureIndex)-Re}return Me.featureIndex-Se.featureIndex});for(const Se of fe)le.push(Se)}}for(const ne in X)X[ne].forEach(se=>{const J=se.feature,le=O(P[ne]).getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=le});return X}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,d){d&&d.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(s);let b=[];for(const x of _)b=b.concat(he(x,d));return b}addSourceType(s,d,_){return no.getSourceType(s)?_(new Error(`A source type called "${s}" already exists.`)):(no.setSourceType(s,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(s,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const E in s)if(!$e(s[E],_[E])){b=!0;break}if(!b)return;const x={now:p.exported.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,d),this.light.updateTransitions(x)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(s){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof s.source){const d="terrain-dem-src";this.addSource(d,s.source),s=p.clone$2(s),s=p.extend(s,{source:d})}if(!this._validate(p.validateStyle.terrain,"terrain",s)){if(this.terrain){const d=this.terrain,_=d.get();for(const b in s)if(!$e(s[b],_[b])){d.set(s),this.stylesheet.terrain=s;const x={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(x);break}}else this._createTerrain(s);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(s){const d=this.fog=new js(s,this.map.transform);this.stylesheet.fog=s;const _={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();for(const b in s)if(!$e(s[b],_[b])){d.set(s),this.stylesheet.fog=s;const x={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(x);break}}else this._createFog(s);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...d)}_createTerrain(s){const d=this.terrain=new Ll(s);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const _={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(_)}_force3DLayerUpdate(){for(const s in this._layers){const d=this._layers[s];"fill-extrusion"===d.type&&this._updateLayer(d)}}_validate(s,d,_,b,x={}){return(!x||!1!==x.validate)&&ma(this,s.call(p.validateStyle,p.extend({key:d,style:this.serialize(),value:_,styleSpec:p.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const d=this._getSourceCaches(s);for(const _ of d)_.clearTiles()}_reloadSource(s){const d=this._getSourceCaches(s);for(const _ of d)_.resume(),_.reload()}_updateSources(s){for(const d in this._sourceCaches)this._sourceCaches[d].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const d=this._sourceCaches[s];d.resume(),d.reload()}}_updatePlacement(s,d,_,b,x=!1){let E=!1,I=!1;const P={};for(const F of this._order){const O=this._layers[F];if("symbol"!==O.type)continue;if(!P[O.source]){const H=this._getLayerSourceCache(O);if(!H)continue;P[O.source]=H.getRenderableIds(!0).map(Y=>H.getTileByID(Y)).sort((Y,ee)=>ee.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(ee.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(O,P[O.source],s.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),s.zoom))&&(this.pauseablePlacement=new ts(s,this._order,x,d,_,b,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const F of this._order){const O=this._layers[F];"symbol"===O.type&&this.placement.updateLayerOpacities(O,P[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const b=x=>{x&&x.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(s,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(s,d,_){return p.makeRequest(d,_)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const d=[];return this._otherSourceCaches[s]&&d.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&d.push(this._symbolSourceCaches[s]),d}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}no.getSourceType=function(m){return V[m]},no.setSourceType=function(m,s){V[m]=s},no.registerForPluginStateChange=p.registerForPluginStateChange;var Du="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",vn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Nc={},qa={};Nc=qt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),qa=qt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const et=qt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),$i=Du;var tr={background:qt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:qt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:qt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:qt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:qt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:qt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:qt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:qt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:qt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:qt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:qt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:qt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:qt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:qt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:qt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:qt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:qt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:qt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:qt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:qt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",vn),skyboxGradient:qt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",vn),skyboxCapture:qt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:qt("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:qt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function qt(m,s,d){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=m.match(b),I=s.match(b),P=Du.match(b);let F=I?I.concat(E):E;d||(Nc.staticUniforms&&(F=Nc.staticUniforms.concat(F)),qa.staticUniforms&&(F=qa.staticUniforms.concat(F))),F&&(F=F.concat(P));const O={};return{fragmentSource:m=m.replace(_,(B,H,Y,ee,X)=>(O[X]=!0,"define"===H?`\n#ifndef HAS_UNIFORM_u_${X}\nvarying ${Y} ${ee} ${X};\n#else\nuniform ${Y} ${ee} u_${X};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${X}\n    ${Y} ${ee} ${X} = u_${X};\n#endif\n`)),vertexSource:s=s.replace(_,(B,H,Y,ee,X)=>{const ie="float"===ee?"vec2":"vec4",K=X.match(/color/)?"color":ie;return O[X]?"define"===H?`\n#ifndef HAS_UNIFORM_u_${X}\nuniform lowp float u_${X}_t;\nattribute ${Y} ${ie} a_${X};\nvarying ${Y} ${ee} ${X};\n#else\nuniform ${Y} ${ee} u_${X};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${X}\n    ${X} = a_${X};\n#else\n    ${Y} ${ee} ${X} = u_${X};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${X}\n    ${X} = unpack_mix_${K}(a_${X}, u_${X}_t);\n#else\n    ${Y} ${ee} ${X} = u_${X};\n#endif\n`:"define"===H?`\n#ifndef HAS_UNIFORM_u_${X}\nuniform lowp float u_${X}_t;\nattribute ${Y} ${ie} a_${X};\n#else\nuniform ${Y} ${ee} u_${X};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${X}\n    ${Y} ${ee} ${X} = a_${X};\n#else\n    ${Y} ${ee} ${X} = u_${X};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${X}\n    ${Y} ${ee} ${X} = unpack_mix_${K}(a_${X}, u_${X}_t);\n#else\n    ${Y} ${ee} ${X} = u_${X};\n#endif\n`}),staticAttributes:x,staticUniforms:F}}class bs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,d,_,b,x,E,I,P){this.context=s;let F=this.boundPaintVertexBuffers.length!==b.length;for(let O=0;!F&&O<b.length;O++)this.boundPaintVertexBuffers[O]!==b[O]&&(F=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===_&&!F&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===P?(s.bindVertexArrayOES.set(this.vao),I&&I.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind()):this.freshBind(d,_,b,x,E,I,P)}freshBind(s,d,_,b,x,E,I){let P;const F=s.numAttributes,O=this.context,B=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=s,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I;else{P=O.currentNumAttributes||0;for(let H=F;H<P;H++)B.disableVertexAttribArray(H)}d.enableAttributes(B,s);for(const H of _)H.enableAttributes(B,s);E&&E.enableAttributes(B,s),I&&I.enableAttributes(B,s),d.bind(),d.setVertexAttribPointers(B,s,x);for(const H of _)H.bind(),H.setVertexAttribPointers(B,s,x);E&&(E.bind(),E.setVertexAttribPointers(B,s,x)),b&&b.bind(),I&&(I.bind(),I.setVertexAttribPointers(B,s,x)),O.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tr(m,s){const d=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new p.MercatorCoordinate(0,_/d).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function Pd(m,s,d,_,b,x,E){const I=m.context,P=I.gl,F=d.fbo;if(!F)return;m.prepareDrawTile(s);const O=m.useProgram("hillshade");I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get());const B=((X,ie,K,ne)=>{const se=K.paint.get("hillshade-shadow-color"),J=K.paint.get("hillshade-highlight-color"),le=K.paint.get("hillshade-accent-color");let fe=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===K.paint.get("hillshade-illumination-anchor")&&(fe-=X.transform.angle);const Se=!X.options.moving;return{u_matrix:ne||X.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Tr(0,ie.tileID),u_light:[K.paint.get("hillshade-exaggeration"),fe],u_shadow:se,u_highlight:J,u_accent:le}})(m,d,_,m.terrain?s.projMatrix:null);m.prepareDrawProgram(I,O,s.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:Y,tileBoundsSegments:ee}=m.getTileBoundsBuffers(d);O.draw(I,P.TRIANGLES,b,x,E,p.CullFaceMode.disabled,B,_.id,H,Y,ee)}function mr(m,s,d){if(!s.needsDEMTextureUpload)return;const _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(d.stride);const x=d.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new p.Texture(_,x,b.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function ht(m,s,d,_,b,x){const E=m.context,I=E.gl;if(!s.dem)return;const P=s.dem;if(E.activeTexture.set(I.TEXTURE1),mr(m,s,P),!s.demTexture)return;s.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const F=P.dim;E.activeTexture.set(I.TEXTURE0);let O=s.fbo;if(!O){const ee=new p.Texture(E,{width:F,height:F,data:null},I.RGBA);ee.bind(I.LINEAR,I.CLAMP_TO_EDGE),O=s.fbo=E.createFramebuffer(F,F,!0),O.colorAttachment.set(ee.texture)}E.bindFramebuffer.set(O.framebuffer),E.viewport.set([0,0,F,F]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:Y}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(E,I.TRIANGLES,_,b,x,p.CullFaceMode.disabled,((ee,X)=>{const ie=X.stride,K=p.create$1();return p.ortho(K,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(K,K,[0,-p.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[ie,ie],u_zoom:ee.overscaledZ,u_unpack:X.unpackVector}})(s.tileID,P),d.id,B,H,Y),s.needsHillshadePrepare=!1}const pt=(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_image0:new p.Uniform1i(m,s.u_image0),u_skirt_height:new p.Uniform1f(m,s.u_skirt_height)}),zn=(m,s)=>({u_matrix:m,u_image0:0,u_skirt_height:s}),gr=new class{constructor(){this.operations={}}newMorphing(m,s,d,_,b){if(m in this.operations){const x=this.operations[m];x.to.tileID.key!==d.tileID.key&&(x.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:b,from:s,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const d=this.operations[s];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Gs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Hi(m,s){const d=1<<m.z;return!s&&(0===m.x||m.x===d-1)||0===m.y||m.y===d-1}const ns=m=>({u_matrix:m});function li(m,s,d,_,b){if(b>0){const x=p.exported.now(),E=(x-m.timeAdded)/b,I=s?(x-s.timeAdded)/b:-1,P=d.getSource(),F=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),O=!s||Math.abs(s.tileID.overscaledZ-F)>Math.abs(m.tileID.overscaledZ-F),B=O&&m.refreshedUponExpiration?1:p.clamp(O?E:1-I,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Pc extends p.SourceCache{constructor(s){const d=$("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new _s(Qe(),null),s.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,d,_){if(s.freezeTileCoverage)return;this.transform=s;const b=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const I=new p.Tile(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);I.state="loaded",this._tiles[E.key]=I}return x},{});for(const x in this._tiles)x in b||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const d=this.proxyCachedFBO[s];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Wa extends p.OverscaledTileID{constructor(s,d,_){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Zt extends p.Elevation{constructor(s,d){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,x]=function(P){const F=new p.StructArrayLayout4i8,O=new p.StructArrayLayout3ui6,B=131;F.reserve(17161),O.reserve(33800);const H=p.EXTENT/128,Y=p.EXTENT+H/2,ee=Y+H;for(let ie=-H;ie<ee;ie+=H)for(let K=-H;K<ee;K+=H){const ne=K<0||K>Y||ie<0||ie>Y?24575:0,se=p.clamp(Math.round(K),0,p.EXTENT),J=p.clamp(Math.round(ie),0,p.EXTENT);F.emplaceBack(se+ne,J,se,J)}const X=(ie,K)=>{const ne=K*B+ie;O.emplaceBack(ne+1,ne,ne+B),O.emplaceBack(ne+B,ne+B+1,ne+1)};for(let ie=1;ie<129;ie++)for(let K=1;K<129;K++)X(K,ie);return[0,129].forEach(ie=>{for(let K=0;K<130;K++)X(K,ie),X(ie,K)}),[F,O,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(_,p.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(b),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pc(d.map),this.orthoMatrix=p.create$1(),p.ortho(this.orthoMatrix,0,p.EXTENT,0,p.EXTENT,0,1);const I=E.gl;this._overlapStencilMode=new p.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency()}update(s,d,_){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const b=s.terrain.properties;this.sourceCache=s._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const x=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.sourceCache.getSource().tileSize/128,I=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(d,E*I,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),d.updateElevation(!_),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==s.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(P=>{const F=d.getTileByID(P).tileID;return F.projMatrix=_.calculateProjMatrix(F.toUnwrapped()),F});(function(P,F){const O=F.transform.pointCoordinate(F.transform.getCameraPoint()),B=new p.pointGeometry(O.x,O.y);P.sort((H,Y)=>{if(Y.overscaledZ-H.overscaledZ)return Y.overscaledZ-H.overscaledZ;const ee=new p.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),X=new p.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ie=B.mult(1<<H.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ee)-ie.distSqr(X)})})(b,this.painter),this._previousZoom=_.zoom;const x=this.proxyToSource||{};this.proxyToSource={},b.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const P in E){const F=E[P];if(!F.used||(F!==this.sourceCache&&(this._findCoveringTileCache[F.id]={}),this._setupProxiedCoordsForOrtho(F,s[P],x),F.usedForTerrain))continue;const O=s[P];F.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[d.id]=b.map(P=>new Wa(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const I={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const F=this.terrainTileForTile[P.key];if(!F)continue;const O=F.tileID.key;O in I||(this._visibleDemTiles.push(F),I[O]=O)}}_assignTerrainTiles(s){this._initializing||s.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const s=this.painter.context,d=s.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],x=b.dem;!x||b.demTexture&&!b.needsDEMTextureUpload||(s.activeTexture.set(d.TEXTURE1),mr(this.painter,b,x))}}_prepareDemTileUniforms(s,d,_,b){if(!d||null==d.demTexture)return!1;const x=s.tileID.canonical,E=Math.pow(2,d.tileID.canonical.z-x.z),I=b||"";return _[`u_dem_tl${I}`]=[x.x*E%1,x.y*E%1],_[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let s=0;const d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const x=b.dem.tree.minimums[0];return x>0&&s++,_+x},0);return s?d/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,d=s.gl;s.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),b={width:1,height:1,data:new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(b,{premultiply:!1}):x=this._emptyDEMTexture=new p.Texture(s,b,d.RGBA,{premultiply:!1}),x}setupElevationDraw(s,d,_){const b=this.painter.context,x=b.gl,E=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var I;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let P=null,F=null,O=1;if(_&&_.morphing&&this._useVertexMorphing){const B=_.morphing.srcDemTile,H=_.morphing.dstDemTile;O=_.morphing.phase,B&&H&&(this._prepareDemTileUniforms(s,B,E,"_prev")&&(F=B),this._prepareDemTileUniforms(s,H,E)&&(P=H))}if(F&&P?(b.activeTexture.set(x.TEXTURE2),P.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),b.activeTexture.set(x.TEXTURE4),F.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_dem_lerp=O):(P=this.terrainTileForTile[s.tileID.key],b.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(s,P,E)?P.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),_&&_.useDepthForOcclusion&&(b.activeTexture.set(x.TEXTURE3),this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),_&&_.useMeterToDem&&P){const B=(1<<P.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=B}_&&_.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,E)}renderToBackBuffer(s){const d=this.painter,_=this.painter.context;0!==s.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(b,x,E,I,P){const F=b.context,O=F.gl;let B,H;const Y=b.options.showTerrainWireframe?2:0,ee=(se,J)=>{if(H===se)return;const le=[Gs[se]];J&&le.push(Gs[Y]),B=b.useProgram("terrainRaster",null,le),H=se},X=b.colorModeForRenderPass(),ie=new p.DepthMode(O.LEQUAL,p.DepthMode.ReadWrite,b.depthRangeFor3D);gr.update(P);const K=b.transform,ne=6*Math.pow(1.5,22-K.zoom)*x.exaggeration();(Y?[!1,!0]:[!1]).forEach(se=>{H=-1;const J=se?O.LINES:O.TRIANGLES,[le,fe]=se?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const Ne of I){const Re=E.getTile(Ne),Ze=p.StencilMode.disabled,Pe=x.prevTerrainTileForTile[Ne.key],Xe=x.terrainTileForTile[Ne.key];Me=Xe,null!=(Se=Pe)&&null!=Me&&Se.hasData()&&Me.hasData()&&null!=Se.demTexture&&null!=Me.demTexture&&Se.tileID.key!==Me.tileID.key&&gr.newMorphing(Ne.key,Pe,Xe,P,250),F.activeTexture.set(O.TEXTURE0),Re.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const Te=gr.getMorphValuesForProxy(Ne.key),Ke=Te?1:0;let ft;Te&&(ft={morphing:{srcDemTile:Te.from,dstDemTile:Te.to,phase:p.easeCubicInOut(Te.phase)}});const wt=zn(Ne.projMatrix,Hi(Ne.canonical,K.renderWorldCopies)?ne/10:ne);ee(Ke,se),x.setupElevationDraw(Re,B,ft),b.prepareDrawProgram(F,B,Ne.toUnwrapped()),B.draw(F,J,ie,Ze,X,p.CullFaceMode.backCCW,wt,"terrain_raster",x.gridBuffer,le,fe)}var Se,Me})}(d,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,b=this.proxySourceCache,x=this.proxiedCoords[b.id],E=this._drapedRenderBatches.shift(),I=[],P=d.style.order;let F=0;for(const O of x){const B=b.getTileByID(O.proxyTileKey),H=b.proxyCachedFBO[O.key]?b.proxyCachedFBO[O.key][s]:void 0,Y=void 0!==H?b.renderCache[H]:this.pool[F++],ee=void 0!==H;if(B.texture=Y.tex,ee&&!Y.dirty){I.push(B.tileID);continue}let X;_.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(_.clear({color:p.Color.transparent}),Y.dirty=!1);for(let ie=E.start;ie<=E.end;++ie){const K=d.style._layers[P[ie]];if(K.isHidden(d.transform.zoom))continue;const ne=d.style._getLayerSourceCache(K),se=ne?this.proxyToSource[O.key][ne.id]:[O];if(!se)continue;const J=se;_.viewport.set([0,0,Y.fb.width,Y.fb.height]),X!==(ne?ne.id:null)&&(this._setupStencil(Y,se,K,ne),X=ne?ne.id:null),d.renderLayer(d,ne,K,J)}this.renderedToTile?(Y.dirty=!0,I.push(B.tileID)):ee||--F,5===F&&(F=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),E.end+1}postRender(){}renderCacheEfficiency(s){const d=s.order.length;if(0===d)return{efficiency:100};let _,b=0,x=0,E=!1;for(let I=0;I<d;++I){const P=s._layers[s.order[I]];this._style.isLayerDraped(P)?(E&&++b,++x):E||(E=!0,_=P.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-b/x),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{s=Math.min(s,d.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,d,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,I=Math.pow(2,E.overscaledZ),{x:P,y:F}=E.canonical,O=P/I,B=(P+1)/I,H=F/I,Y=(F+1)/I;return{minx:O,miny:H,maxx:B,maxy:Y,t:x.dem.tree.raycastRoot(O,H,B,Y,s,d,_),tile:x}});b.sort((x,E)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const x of b){if(null==x.t)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,d,_);if(null!=E)return E}return null}_createFBO(){const s=this.painter.context,d=s.gl,_=this.drapeBufferSize;s.activeTexture.set(d.TEXTURE0);const b=new p.Texture(s,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const x=s.createFramebuffer(_[0],_[1],!1);return x.colorAttachment.set(b.texture),x.depthAttachment=new Qo(s,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const d=this._style._layers[s],_=d.isHidden(this.painter.transform.zoom),b=d.getCrossfadeParameters(),x=!!b&&1!==b.t,E=d.hasTransition();return"custom"!==d.type&&!_&&(x||E)})}_clearRasterFadeFromRenderCache(){let s=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof Ga){s=!0;break}if(s)for(let d=0;d<this._style.order.length;++d){const _=this._style._layers[this._style.order[d]],b=_.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(_);if("raster"!==_.type||b||!x)continue;const E=_.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const P=this.proxyToSource[I.key][x.id];if(P)for(const F of P){const O=li(x.getTile(F),x.findLoadedParent(F,0),x,this.painter.transform,E);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(x.id,F)}}}}_setupDrapedRenderBatches(){const s=this._style.order,d=s.length;if(0===d)return;const _=[];let b,x=0,E=this._style._layers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<d;)E=this._style._layers[s[x]];for(;x<d;++x){const I=this._style._layers[s[x]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===b&&(b=x):void 0!==b&&(_.push({start:b,end:x-1}),b=void 0))}void 0!==b&&_.push({start:b,end:x-1}),this._drapedRenderBatches=_}_setupRenderCache(s){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const E=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let I=0;I<E.length;++I){const P=Object.values(E[I]);d.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let E=_.length-1;E>=0;E--){const I=_[E];if(d.getTileByID(I.key),void 0!==d.proxyCachedFBO[I.key]){const P=s[I.key],F=this.proxyToSource[I.key];let O=0;for(const B in F){const H=F[B],Y=P[B];if(!Y||Y.length!==H.length||H.some((ee,X)=>ee!==Y[X]||b[B]&&b[B].hasOwnProperty(ee.key))){O=-1;break}++O}for(const B in d.proxyCachedFBO[I.key])d.renderCache[d.proxyCachedFBO[I.key][B]].dirty=O<0||O!==Object.values(P).length}}const x=[...this._drapedRenderBatches];x.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of x)for(const I of _){if(d.proxyCachedFBO[I.key])continue;let P=d.renderCachePool.pop();void 0===P&&d.renderCache.length<50&&(P=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==P&&(d.proxyCachedFBO[I.key]={},d.proxyCachedFBO[I.key][E.start]=P,d.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(s,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=d.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(s,d){const _=this.painter,b=this.painter.context,x=b.gl;_._tileClippingMaskIDs={},b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const E=_.useProgram("clippingMask");for(const I of s){const P=_._tileClippingMaskIDs[I.key]=--d;E.draw(b,x.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ns(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(s){const d=this.painter.transform;if(s.x<0||s.x>d.width||s.y<0||s.y>d.height)return null;const _=[s.x,s.y,1,1];p.transformMat4(_,_,d.pixelMatrixInverse),p.scale$2(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const b=d._camera.position,x=p.mercatorZfromAltitude(1,d.center.lat),E=[b[0],b[1],b[2]/x,0],I=p.subtract([],_.slice(0,3),E);p.normalize(I,I);const P=this.raycast(E,I,this._exaggeration);return null!==P&&P?(p.scaleAndAdd(E,E,I,P),E[3]=E[2],E[2]*=x,E):null}drawDepth(){const s=this.painter,d=s.context,_=this.proxySourceCache,b=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=d.gl,I=d.createFramebuffer(b,x,!0);d.activeTexture.set(E.TEXTURE0);const P=new p.Texture(d,{width:b,height:x,data:null},E.RGBA);P.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.colorAttachment.set(P.texture);const F=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,x);I.depthAttachment.set(F),this._depthFBO=I,this._depthTexture=P}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,x]),function(E,I,P,F){const O=E.context,B=O.gl;O.clear({depth:1});const H=E.useProgram("terrainDepth"),Y=new p.DepthMode(B.LESS,p.DepthMode.ReadWrite,E.depthRangeFor3D);for(const ee of F){const X=P.getTile(ee),ie=zn(ee.projMatrix,0);I.setupElevationDraw(X,H),H.draw(O,B.TRIANGLES,Y,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ie,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(s,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,d,_){if(s.getSource()instanceof G)return this._setupProxiedCoordsForImageSource(s,d,_);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const b=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let I=0;I<x.length;I++){const P=x[I],F=this._findTileCoveringTileID(P,s);if(F){const O=this._createProxiedId(P,F,_[P.key]&&_[P.key][s.id]);b.push(O),this.proxyToSource[P.key][s.id]=[O]}}let E=!1;for(let I=0;I<d.length;I++){const P=s.getTile(d[I]);if(!P||!P.hasData())continue;const F=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==P.tileID.canonical.z){const O=this.proxyToSource[F.tileID.key][s.id],B=this._createProxiedId(F.tileID,P,_[F.tileID.key]&&_[F.tileID.key][s.id]);O?O.splice(O.length-1,0,B):this.proxyToSource[F.tileID.key][s.id]=[B],b.push(B),E=!0}}this._sourceTilesOverlap[s.id]=E}_setupProxiedCoordsForImageSource(s,d,_){if(!s.getSource().loaded())return;const b=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),I=new p.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),P=E.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((O,B)=>(O.min.x=Math.min(O.min.x,B.x-I.x),O.min.y=Math.min(O.min.y,B.y-I.y),O.max.x=Math.max(O.max.x,B.x-I.x),O.max.y=Math.max(O.max.y,B.y-I.y),O),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(O,B)=>{const H=O.wrap+O.canonical.x/(1<<O.canonical.z),Y=O.canonical.y/(1<<O.canonical.z),ee=p.EXTENT/(1<<O.canonical.z),X=B.wrap+B.canonical.x/(1<<B.canonical.z),ie=B.canonical.y/(1<<B.canonical.z);return H+ee<X+P.min.x||H>X+P.max.x||Y+ee<ie+P.min.y||Y>ie+P.max.y};for(let O=0;O<x.length;O++){const B=x[O];for(let H=0;H<d.length;H++){const Y=s.getTile(d[H]);if(!Y||!Y.hasData()||F(B,Y.tileID))continue;const ee=this._createProxiedId(B,Y,_[B.key]&&_[B.key][s.id]),X=this.proxyToSource[B.key][s.id];X?X.push(ee):this.proxyToSource[B.key][s.id]=[ee],b.push(ee)}}}_createProxiedId(s,d,_){let b=this.orthoMatrix;if(_){const x=_.find(E=>E.key===d.tileID.key);if(x)return x}if(d.tileID.key!==s.key){const x=s.canonical.z-d.tileID.canonical.z;let E,I,P;b=p.create$1();const F=d.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=p.EXTENT>>x,I=E*((d.tileID.canonical.x<<x)-s.canonical.x+F),P=E*((d.tileID.canonical.y<<x)-s.canonical.y)):(E=p.EXTENT<<-x,I=p.EXTENT*(d.tileID.canonical.x-(s.canonical.x+F<<-x)),P=p.EXTENT*(d.tileID.canonical.y-(s.canonical.y<<-x))),p.ortho(b,0,E,0,E,0,1),p.translate(b,b,[I,P,0])}return new Wa(d.tileID,s.key,b)}_findTileCoveringTileID(s,d){let _=d.getTile(s);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[d.id],x=b[s.key];if(_=x?d.getTileByID(x):null,_&&_.hasData()||null===x)return _;let E=_?_.tileID:s,I=E.overscaledZ;const P=d.getSource().minzoom,F=[];if(!x){const B=d.getSource().maxzoom;if(s.canonical.z>=B){const H=s.canonical.z-B;d.getSource().reparseOverscaled?(I=Math.max(s.canonical.z+2,d.transform.tileZoom),E=new p.OverscaledTileID(I,s.wrap,B,s.canonical.x>>H,s.canonical.y>>H)):0!==H&&(I=B,E=new p.OverscaledTileID(I,s.wrap,B,s.canonical.x>>H,s.canonical.y>>H))}E.key!==s.key&&(F.push(E.key),_=d.getTile(E))}const O=B=>{F.forEach(H=>{b[H]=B}),F.length=0};for(I-=1;I>=P&&(!_||!_.hasData());I--){_&&O(_.tileID.key);const B=E.calculateScaledKey(I);if(_=d.getTileByID(B),_&&_.hasData())break;const H=b[B];if(null===H)break;void 0===H?F.push(B):_=d.getTileByID(H)}return O(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(s){this.renderedToTile=!0}_clearRenderCacheForTile(s,d){let _=this._tilesDirty[s];_||(_=this._tilesDirty[s]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(d){let _,b,x;const E=new p.StructArrayLayout2ui4,I=131;for(b=1;b<129;b++){for(_=1;_<129;_++)x=b*I+_,E.emplaceBack(x,x+1),E.emplaceBack(x,x+I),E.emplaceBack(x+1,x+I),128===b&&E.emplaceBack(x+I,x+I+1);E.emplaceBack(x+1,x+1+I)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Za(m){const s=[];for(let d=0;d<m.length;d++){if(null===m[d])continue;const _=m[d].split(" ");s.push(_.pop())}return s}class qs{static cacheKey(s,d,_){let b=`${s}${_?_.cacheKey:""}`;for(const x of d)b+=`/${x}`;return b}constructor(s,d,_,b,x,E){const I=s.gl;this.program=I.createProgram();const P=Za(_.staticAttributes),F=b?b.getBinderAttributes():[],O=P.concat(F),B=_.staticUniforms?Za(_.staticUniforms):[],H=b?b.getBinderUniforms():[],Y=B.concat(H),ee=[];for(const le of Y)ee.indexOf(le)<0&&ee.push(le);let X=b?b.defines():[];X=X.concat(E.map(le=>`#define ${le}`));const ie=X.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",$i,et.fragmentSource,qa.fragmentSource,_.fragmentSource).join("\n"),K=X.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",$i,et.vertexSource,qa.vertexSource,Nc.vertexSource,_.vertexSource).join("\n"),ne=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ne,ie),I.compileShader(ne),I.attachShader(this.program,ne);const se=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(se,K),I.compileShader(se),I.attachShader(this.program,se),this.attributes={};const J={};this.numAttributes=O.length;for(let le=0;le<this.numAttributes;le++)O[le]&&(I.bindAttribLocation(this.program,le,O[le]),this.attributes[O[le]]=le);I.linkProgram(this.program),I.deleteShader(se),I.deleteShader(ne);for(let le=0;le<ee.length;le++){const fe=ee[le];if(fe&&!J[fe]){const Se=I.getUniformLocation(this.program,fe);Se&&(J[fe]=Se)}}var le,fe;this.fixedUniforms=x(s,J),this.binderUniforms=b?b.getUniforms(s,J):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(le=s,(fe=J).u_dem),u_dem_prev:new p.Uniform1i(le,fe.u_dem_prev),u_dem_unpack:new p.Uniform4f(le,fe.u_dem_unpack),u_dem_tl:new p.Uniform2f(le,fe.u_dem_tl),u_dem_scale:new p.Uniform1f(le,fe.u_dem_scale),u_dem_tl_prev:new p.Uniform2f(le,fe.u_dem_tl_prev),u_dem_scale_prev:new p.Uniform1f(le,fe.u_dem_scale_prev),u_dem_size:new p.Uniform1f(le,fe.u_dem_size),u_dem_lerp:new p.Uniform1f(le,fe.u_dem_lerp),u_exaggeration:new p.Uniform1f(le,fe.u_exaggeration),u_depth:new p.Uniform1i(le,fe.u_depth),u_depth_size_inv:new p.Uniform2f(le,fe.u_depth_size_inv),u_meter_to_dem:new p.Uniform1f(le,fe.u_meter_to_dem),u_label_plane_matrix_inv:new p.UniformMatrix4f(le,fe.u_label_plane_matrix_inv),u_tile_tl_up:new p.Uniform3f(le,fe.u_tile_tl_up),u_tile_tr_up:new p.Uniform3f(le,fe.u_tile_tr_up),u_tile_br_up:new p.Uniform3f(le,fe.u_tile_br_up),u_tile_bl_up:new p.Uniform3f(le,fe.u_tile_bl_up),u_tile_up_scale:new p.Uniform1f(le,fe.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((le,fe)=>({u_fog_matrix:new p.UniformMatrix4f(le,fe.u_fog_matrix),u_fog_range:new p.Uniform2f(le,fe.u_fog_range),u_fog_color:new p.Uniform4f(le,fe.u_fog_color),u_fog_horizon_blend:new p.Uniform1f(le,fe.u_fog_horizon_blend),u_fog_temporal_offset:new p.Uniform1f(le,fe.u_fog_temporal_offset)}))(s,J))}setTerrainUniformValues(s,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in d)_[b].set(d[b])}}setFogUniformValues(s,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in d)_[b].location&&_[b].set(d[b])}}draw(s,d,_,b,x,E,I,P,F,O,B,H,Y,ee,X,ie){const K=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(_),s.setStencilMode(b),s.setColorMode(x),s.setCullFace(E);for(const se in this.fixedUniforms)this.fixedUniforms[se].set(I[se]);ee&&ee.setUniforms(s,this.binderUniforms,H,{zoom:Y});const ne={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[d];for(const se of B.get()){const J=se.vaos||(se.vaos={});(J[P]||(J[P]=new bs)).bind(s,this,F,ee?ee.getPaintVertexBuffers():[],O,se.vertexOffset,X,ie),K.drawElements(d,se.primitiveLength*ne,K.UNSIGNED_SHORT,se.primitiveOffset*ne*2)}}}function Zl(m,s,d){const _=1/Bi(d,1,s.transform.tileZoom),b=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,s.transform.tileZoom)/b,E=x*(d.tileID.canonical.x+d.tileID.wrap*b),I=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const ga=(m,s,d,_)=>{const b=s.style.light,x=b.properties.get("position"),E=[x.x,x.y,x.z],I=p.create$2();"viewport"===b.properties.get("anchor")&&(p.fromRotation(I,-s.transform.angle),p.transformMat3(E,E,I));const P=b.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+d,u_opacity:_}},Mr=(m,s,d,_,b,x,E)=>p.extend(ga(m,s,d,_),Zl(x,s,E),{u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8}),Xl=m=>({u_matrix:m}),is=(m,s,d,_)=>p.extend(Xl(m),Zl(d,s,_)),Ir=(m,s)=>({u_matrix:m,u_world:s}),qn=(m,s,d,_,b)=>p.extend(is(m,s,d,_),{u_world:b}),io=(m,s,d,_)=>{const b=m.transform;let x;return x="map"===_.paint.get("circle-pitch-alignment")?b.calculatePixelsToTileUnitsMatrix(d):new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]),{u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:m.translatePosMatrix(s.projMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:x}},Rd=m=>{const s=[];return"map"===m.paint.get("circle-pitch-alignment")&&s.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&s.push("SCALE_WITH_MAP"),s},Xa=(m,s,d)=>{const _=p.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.cameraToCenterDistance,u_extrude_scale:[s.pixelsToGLUnits[0]/_,s.pixelsToGLUnits[1]/_]}},Ya=(m,s,d=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:d}),Ka=(m,s,d,_)=>({u_matrix:m,u_extrude_scale:Bi(s,1,d),u_intensity:_}),Yl=(m,s,d,_,b,x)=>{const E=m.transform,I=E.calculatePixelsToTileUnitsMatrix(s),P={u_matrix:Eu(m,s,d,b),u_pixels_to_tile_units:I,u_device_pixel_ratio:p.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(oo(d)){const F=Gi(s,m.transform);P.u_texsize=s.lineAtlasTexture.size,P.u_scale=[F,_.fromScale,_.toScale],P.u_mix=_.t}return P},xs=(m,s,d,_,b)=>{const x=m.transform,E=Gi(s,x);return{u_matrix:Eu(m,s,d,b),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:p.exported.devicePixelRatio,u_image:0,u_scale:[E,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}};function Gi(m,s){return 1/Bi(m,1,s.tileZoom)}function Eu(m,s,d,_){return m.translatePosMatrix(_||s.tileID.projMatrix,s,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const ro=m=>{const s=[];return oo(m)&&s.push("RENDER_LINE_DASH"),m.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT"),s};function oo(m){const s=m.paint.get("line-dasharray").value;return s.value||"constant"!==s.kind}const Tu=(m,s,d,_,b)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(E=b.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=b.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Ws(b.paint.get("raster-hue-rotate"))};var x,E};function Ws(m){m*=Math.PI/180;const s=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*s-d+1)/3,(Math.sqrt(3)*s-d+1)/3]}const Rc=(m,s,d,_,b,x,E,I,P,F,O,B,H,Y)=>{const ee=b.transform;return{u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ee.width/ee.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+P,u_pitch_with_map:+_,u_texsize:F,u_tile_id:O,u_zoom_transition:B,u_inv_rot_matrix:H,u_merc_center:Y,u_texture:0}},Ro=(m,s,d,_,b,x,E,I,P,F,O,B,H,Y,ee)=>{const{cameraToCenterDistance:X,_pitch:ie}=b.transform;return p.extend(Rc(m,s,d,_,b,x,E,I,P,F,B,H,Y,ee),{u_gamma_scale:_?X*Math.cos(b.terrain?0:ie):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+O})},am=(m,s,d,_,b,x,E,I,P,F,O,B,H,Y)=>p.extend(Ro(m,s,d,_,b,x,E,I,!0,P,!0,O,B,H,Y),{u_texsize_icon:F,u_texture_icon:1}),M_=(m,s,d)=>({u_matrix:m,u_opacity:s,u_color:d}),lm=(m,s,d,_,b,x)=>p.extend(function(E,I,P,F){const O=P.imageManager.getPattern(E.from.toString()),B=P.imageManager.getPattern(E.to.toString()),{width:H,height:Y}=P.imageManager.getPixelSize(),ee=Math.pow(2,F.tileID.overscaledZ),X=F.tileSize*Math.pow(2,P.transform.tileZoom)/ee,ie=X*(F.tileID.canonical.x+F.tileID.wrap*ee),K=X*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[H,Y],u_mix:I.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Bi(F,1,P.transform.tileZoom),u_pixel_coord_upper:[ie>>16,K>>16],u_pixel_coord_lower:[65535&ie,65535&K]}}(_,x,d,b),{u_matrix:m,u_opacity:s}),cm={fillExtrusion:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_lightpos:new p.Uniform3f(m,s.u_lightpos),u_lightintensity:new p.Uniform1f(m,s.u_lightintensity),u_lightcolor:new p.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,s.u_vertical_gradient),u_opacity:new p.Uniform1f(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_lightpos:new p.Uniform3f(m,s.u_lightpos),u_lightintensity:new p.Uniform1f(m,s.u_lightintensity),u_lightcolor:new p.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,s.u_vertical_gradient),u_height_factor:new p.Uniform1f(m,s.u_height_factor),u_image:new p.Uniform1i(m,s.u_image),u_texsize:new p.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,s.u_scale),u_fade:new p.Uniform1f(m,s.u_fade),u_opacity:new p.Uniform1f(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_image:new p.Uniform1i(m,s.u_image),u_texsize:new p.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,s.u_scale),u_fade:new p.Uniform1f(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_world:new p.Uniform2f(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_world:new p.Uniform2f(m,s.u_world),u_image:new p.Uniform1i(m,s.u_image),u_texsize:new p.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,s.u_scale),u_fade:new p.Uniform1f(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new p.Uniform1f(m,s.u_camera_to_center_distance),u_extrude_scale:new p.UniformMatrix2f(m,s.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(m,s.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_camera_to_center_distance:new p.Uniform1f(m,s.u_camera_to_center_distance),u_extrude_scale:new p.Uniform2f(m,s.u_extrude_scale)}),collisionCircle:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_inv_matrix:new p.UniformMatrix4f(m,s.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(m,s.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new p.UniformColor(m,s.u_color),u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_overlay:new p.Uniform1i(m,s.u_overlay),u_overlay_scale:new p.Uniform1f(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new p.Uniform1f(m,s.u_extrude_scale),u_intensity:new p.Uniform1f(m,s.u_intensity),u_matrix:new p.UniformMatrix4f(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_image:new p.Uniform1i(m,s.u_image),u_color_ramp:new p.Uniform1i(m,s.u_color_ramp),u_opacity:new p.Uniform1f(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_image:new p.Uniform1i(m,s.u_image),u_latrange:new p.Uniform2f(m,s.u_latrange),u_light:new p.Uniform2f(m,s.u_light),u_shadow:new p.UniformColor(m,s.u_shadow),u_highlight:new p.UniformColor(m,s.u_highlight),u_accent:new p.UniformColor(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_image:new p.Uniform1i(m,s.u_image),u_dimension:new p.Uniform2f(m,s.u_dimension),u_zoom:new p.Uniform1f(m,s.u_zoom),u_unpack:new p.Uniform4f(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_pixels_to_tile_units:new p.UniformMatrix2f(m,s.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(m,s.u_units_to_pixels),u_dash_image:new p.Uniform1i(m,s.u_dash_image),u_gradient_image:new p.Uniform1i(m,s.u_gradient_image),u_image_height:new p.Uniform1f(m,s.u_image_height),u_texsize:new p.Uniform2f(m,s.u_texsize),u_scale:new p.Uniform3f(m,s.u_scale),u_mix:new p.Uniform1f(m,s.u_mix)}),linePattern:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_texsize:new p.Uniform2f(m,s.u_texsize),u_pixels_to_tile_units:new p.UniformMatrix2f(m,s.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,s.u_device_pixel_ratio),u_image:new p.Uniform1i(m,s.u_image),u_units_to_pixels:new p.Uniform2f(m,s.u_units_to_pixels),u_scale:new p.Uniform3f(m,s.u_scale),u_fade:new p.Uniform1f(m,s.u_fade)}),raster:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_tl_parent:new p.Uniform2f(m,s.u_tl_parent),u_scale_parent:new p.Uniform1f(m,s.u_scale_parent),u_buffer_scale:new p.Uniform1f(m,s.u_buffer_scale),u_fade_t:new p.Uniform1f(m,s.u_fade_t),u_opacity:new p.Uniform1f(m,s.u_opacity),u_image0:new p.Uniform1i(m,s.u_image0),u_image1:new p.Uniform1i(m,s.u_image1),u_brightness_low:new p.Uniform1f(m,s.u_brightness_low),u_brightness_high:new p.Uniform1f(m,s.u_brightness_high),u_saturation_factor:new p.Uniform1f(m,s.u_saturation_factor),u_contrast_factor:new p.Uniform1f(m,s.u_contrast_factor),u_spin_weights:new p.Uniform3f(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new p.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,s.u_size_t),u_size:new p.Uniform1f(m,s.u_size),u_camera_to_center_distance:new p.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,s.u_pitch),u_rotate_symbol:new p.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,s.u_fade_change),u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new p.Uniform1i(m,s.u_is_text),u_pitch_with_map:new p.Uniform1i(m,s.u_pitch_with_map),u_texsize:new p.Uniform2f(m,s.u_texsize),u_tile_id:new p.Uniform3f(m,s.u_tile_id),u_zoom_transition:new p.Uniform1f(m,s.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,s.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,s.u_merc_center),u_texture:new p.Uniform1i(m,s.u_texture)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new p.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,s.u_size_t),u_size:new p.Uniform1f(m,s.u_size),u_camera_to_center_distance:new p.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,s.u_pitch),u_rotate_symbol:new p.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,s.u_fade_change),u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new p.Uniform1i(m,s.u_is_text),u_pitch_with_map:new p.Uniform1i(m,s.u_pitch_with_map),u_texsize:new p.Uniform2f(m,s.u_texsize),u_texture:new p.Uniform1i(m,s.u_texture),u_gamma_scale:new p.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,s.u_device_pixel_ratio),u_tile_id:new p.Uniform3f(m,s.u_tile_id),u_zoom_transition:new p.Uniform1f(m,s.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,s.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,s.u_merc_center),u_is_halo:new p.Uniform1i(m,s.u_is_halo)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new p.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,s.u_size_t),u_size:new p.Uniform1f(m,s.u_size),u_camera_to_center_distance:new p.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,s.u_pitch),u_rotate_symbol:new p.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,s.u_fade_change),u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new p.Uniform1i(m,s.u_is_text),u_pitch_with_map:new p.Uniform1i(m,s.u_pitch_with_map),u_texsize:new p.Uniform2f(m,s.u_texsize),u_texsize_icon:new p.Uniform2f(m,s.u_texsize_icon),u_texture:new p.Uniform1i(m,s.u_texture),u_texture_icon:new p.Uniform1i(m,s.u_texture_icon),u_gamma_scale:new p.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(m,s.u_is_halo)}),background:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_opacity:new p.Uniform1f(m,s.u_opacity),u_color:new p.UniformColor(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_opacity:new p.Uniform1f(m,s.u_opacity),u_image:new p.Uniform1i(m,s.u_image),u_pattern_tl_a:new p.Uniform2f(m,s.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(m,s.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(m,s.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(m,s.u_pattern_br_b),u_texsize:new p.Uniform2f(m,s.u_texsize),u_mix:new p.Uniform1f(m,s.u_mix),u_pattern_size_a:new p.Uniform2f(m,s.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(m,s.u_pattern_size_b),u_scale_a:new p.Uniform1f(m,s.u_scale_a),u_scale_b:new p.Uniform1f(m,s.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(m,s.u_tile_units_to_pixels)}),terrainRaster:pt,terrainDepth:pt,skybox:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_sun_direction:new p.Uniform3f(m,s.u_sun_direction),u_cubemap:new p.Uniform1i(m,s.u_cubemap),u_opacity:new p.Uniform1f(m,s.u_opacity),u_temporal_offset:new p.Uniform1f(m,s.u_temporal_offset)}),skyboxGradient:(m,s)=>({u_matrix:new p.UniformMatrix4f(m,s.u_matrix),u_color_ramp:new p.Uniform1i(m,s.u_color_ramp),u_center_direction:new p.Uniform3f(m,s.u_center_direction),u_radius:new p.Uniform1f(m,s.u_radius),u_opacity:new p.Uniform1f(m,s.u_opacity),u_temporal_offset:new p.Uniform1f(m,s.u_temporal_offset)}),skyboxCapture:(m,s)=>({u_matrix_3f:new p.UniformMatrix3f(m,s.u_matrix_3f),u_sun_direction:new p.Uniform3f(m,s.u_sun_direction),u_sun_intensity:new p.Uniform1f(m,s.u_sun_intensity),u_color_tint_r:new p.Uniform4f(m,s.u_color_tint_r),u_color_tint_m:new p.Uniform4f(m,s.u_color_tint_m),u_luminance:new p.Uniform1f(m,s.u_luminance)})};let Fc;function Fd(m,s,d,_,b,x,E){const I=m.context,P=I.gl,F=m.useProgram("collisionBox"),O=[];let B=0,H=0;for(let se=0;se<_.length;se++){const J=_[se],le=s.getTile(J),fe=le.getBucket(d);if(!fe)continue;let Se=J.projMatrix;0===b[0]&&0===b[1]||(Se=m.translatePosMatrix(J.projMatrix,le,b,x));const Me=E?fe.textCollisionBox:fe.iconCollisionBox,Ne=fe.collisionCircleArray;if(Ne.length>0){const Re=p.create$1(),Ze=Se;p.mul$1(Re,fe.placementInvProjMatrix,m.transform.glCoordMatrix),p.mul$1(Re,Re,fe.placementViewportMatrix),O.push({circleArray:Ne,circleOffset:H,transform:Ze,invTransform:Re}),B+=Ne.length/4,H=B}Me&&(m.terrain&&m.terrain.setupElevationDraw(le,F),F.draw(I,P.LINES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,Xa(Se,m.transform,le),d.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,m.transform.zoom,null,Me.collisionVertexBuffer,Me.collisionVertexBufferExt))}if(!E||!O.length)return;const Y=m.useProgram("collisionCircle"),ee=new p.StructArrayLayout2f1f2i16;ee.resize(4*B),ee._trim();let X=0;for(const se of O)for(let J=0;J<se.circleArray.length/4;J++){const le=4*J,fe=se.circleArray[le+0],Se=se.circleArray[le+1],Me=se.circleArray[le+2],Ne=se.circleArray[le+3];ee.emplace(X++,fe,Se,Me,Ne,0),ee.emplace(X++,fe,Se,Me,Ne,1),ee.emplace(X++,fe,Se,Me,Ne,2),ee.emplace(X++,fe,Se,Me,Ne,3)}(!Fc||Fc.length<2*B)&&(Fc=function(se){const J=2*se,le=new p.StructArrayLayout3ui6;le.resize(J),le._trim();for(let fe=0;fe<J;fe++){const Se=6*fe;le.uint16[Se+0]=4*fe+0,le.uint16[Se+1]=4*fe+1,le.uint16[Se+2]=4*fe+2,le.uint16[Se+3]=4*fe+2,le.uint16[Se+4]=4*fe+3,le.uint16[Se+5]=4*fe+0}return le}(B));const ie=I.createIndexBuffer(Fc,!0),K=I.createVertexBuffer(ee,p.collisionCircleLayout.members,!0);for(const se of O){const J={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(ne=m.transform).cameraToCenterDistance,u_viewport_size:[ne.width,ne.height]};Y.draw(I,P.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,J,d.id,K,ie,p.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,m.transform.zoom,null,null,null)}var ne;K.destroy(),ie.destroy()}const Kl=p.identity(new Float32Array(16));function um(m,s,d,_,b,x){const{horizontalAlign:E,verticalAlign:I}=p.getAnchorAlignment(m),P=-(E-.5)*s,F=-(I-.5)*d,O=p.evaluateVariableOffset(m,_);return new p.pointGeometry((P/b+O[0])*x,(F/b+O[1])*x)}function dm(m,s,d,_,b,x,E,I,P,F,O,B){const H=m.text.placedSymbolArray,Y=m.text.dynamicLayoutVertexArray,ee=m.icon.dynamicLayoutVertexArray,X={};Y.clear();for(let ie=0;ie<H.length;ie++){const K=H.get(ie),ne=m.allowVerticalPlacement&&!K.placedOrientation,se=K.hidden||!K.crossTileID||ne?null:_[K.crossTileID];if(se){const J=new p.pointGeometry(K.tileAnchorX,K.tileAnchorY),le=B(J),fe=Si(J,d?I:E,le),Se=Hl(x.cameraToCenterDistance,fe.signedDistanceFromCamera);let Me=b.evaluateSizeForFeature(m.textSizeData,F,K)*Se/p.ONE_EM;d&&(Me*=m.tilePixelRatio/P);const{width:Ne,height:Re,anchor:Ze,textOffset:Pe,textScale:Xe}=se,Te=um(Ze,Ne,Re,Pe,Xe,Me),Ke=d?Si(J.add(Te),E,le).point:fe.point.add(s?Te.rotate(-x.angle):Te),ft=m.allowVerticalPlacement&&K.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let wt=0;wt<K.numGlyphs;wt++)p.addDynamicAttributes(Y,Ke,ft);O&&K.associatedIconIndex>=0&&(X[K.associatedIconIndex]={shiftedAnchor:Ke,angle:ft})}else Gr(K.numGlyphs,Y)}if(O){ee.clear();const ie=m.icon.placedSymbolArray;for(let K=0;K<ie.length;K++){const ne=ie.get(K);if(ne.hidden)Gr(ne.numGlyphs,ee);else{const se=X[K];if(se)for(let J=0;J<ne.numGlyphs;J++)p.addDynamicAttributes(ee,se.shiftedAnchor,se.angle);else Gr(ne.numGlyphs,ee)}}m.icon.dynamicLayoutVertexBuffer.updateData(ee)}m.text.dynamicLayoutVertexBuffer.updateData(Y)}function ef(m,s,d){return d.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Ja(m,s,d,_,b,x,E,I,P,F,O,B){const H=m.context,Y=H.gl,ee=m.transform,X="map"===I,ie="map"===P,K=X&&"point"!==d.layout.get("symbol-placement"),ne=X&&!ie&&!K,se=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let J=!1;const le=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),fe=[0,0],Se=d.layout.get("text-variable-anchor"),Me=[],Ne=[];m.terrain&&ie&&Ne.push("PITCH_WITH_MAP_TERRAIN"),K&&Ne.push("PROJECTED_POS_ON_VIEWPORT");for(const Re of _){const Ze=s.getTile(Re),Pe=Ze.getBucket(d);if(!Pe)continue;const Xe=b?Pe.text:Pe.icon;if(!Xe||!Xe.segments.get().length)continue;const Te=Xe.programConfigurations.get(d.id),Ke=b||Pe.sdfIcons,ft=b?Pe.textSizeData:Pe.iconSizeData,wt=ie||0!==ee.pitch,Dt=m.useProgram(ef(Ke,b,Pe),Te,Ne),Pt=p.evaluateSizeForZoom(ft,ee.zoom),St=[Re.canonical.x,Re.canonical.y,1<<Re.canonical.z];let xt,At,Ft,hi,si=[0,0],Ci=null;if(b){if(At=Ze.glyphAtlasTexture,Ft=Y.LINEAR,xt=Ze.glyphAtlasTexture.size,Pe.iconsInText){si=Ze.imageAtlasTexture.size,Ci=Ze.imageAtlasTexture;const kr="composite"===ft.kind||"camera"===ft.kind;hi=wt||m.options.rotating||m.options.zooming||kr?Y.LINEAR:Y.NEAREST}}else{const kr=1!==d.layout.get("icon-size").constantOr(0)||Pe.iconsNeedLinear;At=Ze.imageAtlasTexture,Ft=Ke||m.options.rotating||m.options.zooming||kr||wt?Y.LINEAR:Y.NEAREST,xt=Ze.imageAtlasTexture.size}const Ai=m.transform.calculatePixelsToTileUnitsMatrix(Ze),ni=It(Re.projMatrix,ie,X,m.transform,Ai),lo=m.terrain&&ie&&K?p.invert(new Float32Array(16),ni):Kl,Bo=_t(Re.projMatrix,ie,X,m.transform,Ai),Cn=Se&&Pe.hasTextData(),Di="none"!==d.layout.get("icon-text-fit")&&Cn&&Pe.hasIconData();if(K){const kr=ee.elevation;ct(Pe,Re.projMatrix,m,b,ni,Bo,ie,F,kr?al=>kr.getAtTileOffset(Re,al.x,al.y):null)}const _n=m.translatePosMatrix(Re.projMatrix,Ze,x,E),Kn=K||b&&Se||Di?Kl:ni,yr=m.translatePosMatrix(Bo,Ze,x,E,!0),Wn=Ke&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let bt;bt=Ke?Pe.iconsInText?am(ft.kind,Pt,ne,ie,m,_n,Kn,yr,xt,si,St,0,m.identityMat,fe):Ro(ft.kind,Pt,ne,ie,m,_n,Kn,yr,b,xt,!0,St,0,m.identityMat,fe):Rc(ft.kind,Pt,ne,ie,m,_n,Kn,yr,b,xt,St,0,m.identityMat,fe);const Gc={program:Dt,buffers:Xe,uniformValues:bt,atlasTexture:At,atlasTextureIcon:Ci,atlasInterpolation:Ft,atlasInterpolationIcon:hi,isSDF:Ke,hasHalo:Wn,tile:Ze,labelPlaneMatrixInv:lo};if(se&&Pe.canOverlap){J=!0;const kr=Xe.segments.get();for(const al of kr)Me.push({segments:new p.SegmentVector([al]),sortKey:al.sortKey,state:Gc})}else Me.push({segments:Xe.segments,sortKey:0,state:Gc})}J&&Me.sort((Re,Ze)=>Re.sortKey-Ze.sortKey);for(const Re of Me){const Ze=Re.state;if(m.terrain&&m.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}),H.activeTexture.set(Y.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,Y.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(H.activeTexture.set(Y.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),Ze.isSDF){const Pe=Ze.uniformValues;Ze.hasHalo&&(Pe.u_is_halo=1,tf(Ze.buffers,Re.segments,d,m,Ze.program,le,O,B,Pe)),Pe.u_is_halo=0}tf(Ze.buffers,Re.segments,d,m,Ze.program,le,O,B,Ze.uniformValues)}}function tf(m,s,d,_,b,x,E,I,P){const F=_.context;b.draw(F,F.gl.TRIANGLES,x,E,I,p.CullFaceMode.disabled,P,d.id,m.layoutVertexBuffer,m.indexBuffer,s,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Jl(m,s,d,_,b,x,E){const I=m.context.gl,P=d.paint.get("fill-pattern"),F=P&&P.constantOr(1),O=d.getCrossfadeParameters();let B,H,Y,ee,X;E?(H=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=I.LINES):(H=F?"fillPattern":"fill",B=I.TRIANGLES);for(const ie of _){const K=s.getTile(ie);if(F&&!K.patternsLoaded())continue;const ne=K.getBucket(d);if(!ne)continue;m.prepareDrawTile(ie);const se=ne.programConfigurations.get(d.id),J=m.useProgram(H,se);F&&(m.context.activeTexture.set(I.TEXTURE0),K.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),se.updatePaintBuffers(O));const le=P.constantOr(null);if(le&&K.imageAtlas){const Se=K.imageAtlas,Me=Se.patternPositions[le.to.toString()],Ne=Se.patternPositions[le.from.toString()];Me&&Ne&&se.setConstantPatternPositions(Me,Ne)}const fe=m.translatePosMatrix(ie.projMatrix,K,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(E){ee=ne.indexBuffer2,X=ne.segments2;const Se=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];Y="fillOutlinePattern"===H&&F?qn(fe,m,O,K,Se):Ir(fe,Se)}else ee=ne.indexBuffer,X=ne.segments,Y=F?is(fe,m,O,K):Xl(fe);m.prepareDrawProgram(m.context,J,ie.toUnwrapped()),J.draw(m.context,B,b,m.stencilModeForClipping(ie),x,p.CullFaceMode.disabled,Y,d.id,ne.layoutVertexBuffer,ee,X,d.paint,m.transform.zoom,se)}}function Qa(m,s,d,_,b,x,E){const I=m.context,P=I.gl,F=d.paint.get("fill-extrusion-pattern"),O=F.constantOr(1),B=d.getCrossfadeParameters(),H=d.paint.get("fill-extrusion-opacity");for(const Y of _){const ee=s.getTile(Y),X=ee.getBucket(d);if(!X)continue;const ie=X.programConfigurations.get(d.id),K=m.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ie);if(m.terrain){const fe=m.terrain;if(!X.enableTerrain)continue;if(fe.setupElevationDraw(ee,K,{useMeterToDem:!0}),hm(I,s,Y,X,d,fe),!X.centroidVertexBuffer){const Se=K.attributes.a_centroid_pos;void 0!==Se&&P.vertexAttrib2f(Se,0,0)}}O&&(m.context.activeTexture.set(P.TEXTURE0),ee.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ie.updatePaintBuffers(B));const ne=F.constantOr(null);if(ne&&ee.imageAtlas){const fe=ee.imageAtlas,Se=fe.patternPositions[ne.to.toString()],Me=fe.patternPositions[ne.from.toString()];Se&&Me&&ie.setConstantPatternPositions(Se,Me)}const se=m.translatePosMatrix(Y.projMatrix,ee,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),J=d.paint.get("fill-extrusion-vertical-gradient"),le=O?Mr(se,m,J,H,Y,B,ee):ga(se,m,J,H);m.prepareDrawProgram(I,K,Y.toUnwrapped()),K.draw(I,I.gl.TRIANGLES,b,x,E,p.CullFaceMode.backCCW,le,d.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,d.paint,m.transform.zoom,ie,m.terrain?X.centroidVertexBuffer:null)}}function hm(m,s,d,_,b,x){const E=[K=>{let ne=K.canonical.x-1,se=K.wrap;return ne<0&&(ne=(1<<K.canonical.z)-1,se--),new p.OverscaledTileID(K.overscaledZ,se,K.canonical.z,ne,K.canonical.y)},K=>{let ne=K.canonical.x+1,se=K.wrap;return ne===1<<K.canonical.z&&(ne=0,se++),new p.OverscaledTileID(K.overscaledZ,se,K.canonical.z,ne,K.canonical.y)},K=>new p.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,(0===K.canonical.y?1<<K.canonical.z:K.canonical.y)-1),K=>new p.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y===(1<<K.canonical.z)-1?0:K.canonical.y+1)],I=K=>{const ne=s.getSource().maxzoom,se=Se=>{const Me=s.getTileByID(Se);if(Me&&Me.hasData())return Me.getBucket(b)};let J,le,fe;return(K.overscaledZ===K.canonical.z||K.overscaledZ>=ne)&&(J=se(K.key)),K.overscaledZ>=ne&&(le=se(K.calculateScaledKey(K.overscaledZ+1))),K.overscaledZ>ne&&(fe=se(K.calculateScaledKey(K.overscaledZ-1))),J||le||fe},P=[0,0,0],F=(K,ne)=>(P[0]=Math.min(K.min.y,ne.min.y),P[1]=Math.max(K.max.y,ne.max.y),P[2]=p.EXTENT-ne.min.x>K.max.x?ne.min.x-p.EXTENT:K.max.x,P),O=(K,ne)=>(P[0]=Math.min(K.min.x,ne.min.x),P[1]=Math.max(K.max.x,ne.max.x),P[2]=p.EXTENT-ne.min.y>K.max.y?ne.min.y-p.EXTENT:K.max.y,P),B=[(K,ne)=>F(K,ne),(K,ne)=>F(ne,K),(K,ne)=>O(K,ne),(K,ne)=>O(ne,K)],H=new p.pointGeometry(0,0);let Y,ee,X;const ie=(K,ne,se,J,le)=>{const fe=[[J?se:K,J?K:se,0],[J?se:ne,J?ne:se,0]],Se=le<0?p.EXTENT+le:le,Me=[J?Se:(K+ne)/2,J?(K+ne)/2:Se,0];return 0===se&&le<0||0!==se&&le>0?x.getForTilePoints(X,[Me],!0,ee):fe.push(Me),x.getForTilePoints(d,fe,!0,Y),Math.max(fe[0][2],fe[1][2],Me[2])/x.exaggeration()};for(let K=0;K<4;K++){const ne=_.borders[K];if(0===ne.length&&(_.borderDone[K]=!0),_.borderDone[K])continue;const se=X=E[K](d),J=I(se);if(!(J&&J.enableTerrain&&(ee=x.findDEMTileFor(se),ee&&ee.dem)))continue;if(!Y){const Me=x.findDEMTileFor(d);if(!Me||!Me.dem)return;Y=Me}const le=(K<2?1:5)-K,fe=J.borders[le];let Se=0;for(let Me=0;Me<ne.length;Me++){const Ne=_.featuresOnBorder[ne[Me]],Re=Ne.borders[K];let Ze;for(;Se<fe.length&&(Ze=J.featuresOnBorder[fe[Se]],!(Ze.borders[le][1]>Re[0]+3));)J.borderDone[le]||J.encodeCentroid(void 0,Ze,!1),Se++;if(Ze&&Se<fe.length){const Pe=Se;let Xe=0;for(;!(Ze.borders[le][0]>Re[1]-3)&&(Xe++,++Se!==fe.length);)Ze=J.featuresOnBorder[fe[Se]];if(Ze=J.featuresOnBorder[fe[Pe]],Ne.intersectsCount()>1||Ze.intersectsCount()>1||1!==Xe){1!==Xe&&(Se=Pe),_.encodeCentroid(void 0,Ne,!1),J.borderDone[le]||J.encodeCentroid(void 0,Ze,!1);continue}const Te=B[K](Ne,Ze),Ke=K%2?p.EXTENT-1:0;H.x=ie(Te[0],Math.min(p.EXTENT-1,Te[1]),Ke,K<2,Te[2]),H.y=0,_.encodeCentroid(H,Ne,!1),J.borderDone[le]||J.encodeCentroid(H,Ze,!1)}else _.encodeCentroid(void 0,Ne,!1)}_.borderDone[K]=_.needsCentroidUpdate=!0,J.borderDone[le]||(J.borderDone[le]=J.needsCentroidUpdate=!0)}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const nf=new p.Color(1,0,0,1),wn=new p.Color(0,1,0,1),Od=new p.Color(0,0,1,1),rf=new p.Color(1,0,1,1),Mu=new p.Color(0,1,1,1);function Oc(m,s,d,_){Ld(m,0,s+d/2,m.transform.width,d,_)}function fm(m,s,d,_){Ld(m,s-d/2,0,d,m.transform.height,_)}function Ld(m,s,d,_,b,x){const E=m.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(s*p.exported.devicePixelRatio,d*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,b*p.exported.devicePixelRatio),E.clear({color:x}),I.disable(I.SCISSOR_TEST)}function _a(m,s,d){const _=m.context,b=_.gl,x=d.projMatrix,E=m.useProgram("debug"),I=s.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(I,E);const P=p.DepthMode.disabled,F=p.StencilMode.disabled,O=m.colorModeForRenderPass(),B="$debug";_.activeTexture.set(b.TEXTURE0),m.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),I._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const H=I._tileDebugBuffer||m.debugBuffer,Y=I._tileDebugIndexBuffer||m.debugIndexBuffer,ee=I._tileDebugSegments||m.debugSegments;E.draw(_,b.LINE_STRIP,P,F,O,p.CullFaceMode.disabled,Ya(x,p.Color.red),B,H,Y,ee);const X=I.latestRawTileData,ie=Math.floor((X&&X.byteLength||0)/1024),K=s.getTile(d).tileSize,ne=512/Math.min(K,512)*(d.overscaledZ/m.transform.zoom)*.5;let se=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(se+=` => ${d.overscaledZ}`),function(J,le){J.initDebugOverlayCanvas();const fe=J.debugOverlayCanvas,Se=J.context.gl,Me=J.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,fe.width,fe.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText(le,5,5),Me.strokeText(le,5,5),J.debugOverlayTexture.update(fe),J.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}(m,`${se} ${ie}kb`),E.draw(_,b.TRIANGLES,P,F,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Ya(x,p.Color.transparent,ne),B,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}const sf=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mn}=sf;function Fo(m,s,d,_){m.emplaceBack(s,d,_)}class Ql{constructor(s){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Fo(this.vertexArray,-1,-1,1),Fo(this.vertexArray,1,-1,1),Fo(this.vertexArray,-1,1,1),Fo(this.vertexArray,1,1,1),Fo(this.vertexArray,-1,-1,-1),Fo(this.vertexArray,1,-1,-1),Fo(this.vertexArray,-1,1,-1),Fo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Mn),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function ya(m,s,d,_,b,x){const E=m.gl,I=s.paint.get("sky-atmosphere-color"),P=s.paint.get("sky-atmosphere-halo-color"),F=s.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:p.fromMat4([],_),u_sun_direction:b,u_sun_intensity:F,u_color_tint_r:[(ee=I).r,ee.g,ee.b,ee.a],u_color_tint_m:[(X=P).r,X.g,X.b,X.a],u_luminance:5e-5};var ee,X;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),d.draw(m,E.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,O,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Lc={symbol:function(m,s,d,_,b){if("translucent"!==m.renderPass)return;const x=p.StencilMode.disabled,E=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(I,P,F,O,B,H,Y){const ee=P.transform,X="map"===B,ie="map"===H;for(const K of I){const ne=O.getTile(K),se=ne.getBucket(F);if(!se||!se.text||!se.text.segments.get().length)continue;const J=p.evaluateSizeForZoom(se.textSizeData,ee.zoom),le=P.transform.calculatePixelsToTileUnitsMatrix(ne),fe=It(K.projMatrix,ie,X,P.transform,le),Se="none"!==F.layout.get("icon-text-fit")&&se.hasIconData();if(J){const Me=Math.pow(2,ee.zoom-ne.tileID.overscaledZ),Ne=ee.elevation;dm(se,X,ie,Y,p.symbolSize,ee,fe,K.projMatrix,Me,J,Se,Ne?Re=>Ne.getAtTileOffset(K,Re.x,Re.y):Re=>0)}}}(_,m,d,s,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&Ja(m,s,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),x,E),0!==d.paint.get("text-opacity").constantOr(1)&&Ja(m,s,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),x,E),s.map.showCollisionBoxes&&(Fd(m,s,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Fd(m,s,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("circle-opacity"),x=d.paint.get("circle-stroke-width"),E=d.paint.get("circle-stroke-opacity"),I=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===x.constantOr(1)||0===E.constantOr(1)))return;const P=m.context,F=P.gl,O=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),B=p.StencilMode.disabled,H=m.colorModeForRenderPass(),Y=[];for(let ee=0;ee<_.length;ee++){const X=_[ee],ie=s.getTile(X),K=ie.getBucket(d);if(!K)continue;const ne=K.programConfigurations.get(d.id),se=Rd(d),J={programConfiguration:ne,program:m.useProgram("circle",ne,se),layoutVertexBuffer:K.layoutVertexBuffer,indexBuffer:K.indexBuffer,uniformValues:io(m,X,ie,d),tile:ie};if(I){const le=K.segments.get();for(const fe of le)Y.push({segments:new p.SegmentVector([fe]),sortKey:fe.sortKey,state:J})}else Y.push({segments:K.segments,sortKey:0,state:J})}I&&Y.sort((ee,X)=>ee.sortKey-X.sortKey);for(const ee of Y){const{programConfiguration:X,program:ie,layoutVertexBuffer:K,indexBuffer:ne,uniformValues:se,tile:J}=ee.state,le=ee.segments;m.terrain&&m.terrain.setupElevationDraw(J,ie,{useDepthForOcclusion:!0}),m.prepareDrawProgram(P,ie,J.tileID.toUnwrapped()),ie.draw(P,F.TRIANGLES,O,B,H,p.CullFaceMode.disabled,se,d.id,K,ne,le,d.paint,m.transform.zoom,X)}},heatmap:function(m,s,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const b=m.context,x=b.gl,E=p.StencilMode.disabled,I=new p.ColorMode([x.ONE,x.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(P,F,O){const B=P.gl;P.activeTexture.set(B.TEXTURE1),P.viewport.set([0,0,F.width/4,F.height/4]);let H=O.heatmapFbo;if(H)B.bindTexture(B.TEXTURE_2D,H.colorAttachment.get()),P.bindFramebuffer.set(H.framebuffer);else{const Y=B.createTexture();B.bindTexture(B.TEXTURE_2D,Y),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),H=O.heatmapFbo=P.createFramebuffer(F.width/4,F.height/4,!1),function(ee,X,ie,K){const ne=ee.gl;ne.texImage2D(ne.TEXTURE_2D,0,ne.RGBA,X.width/4,X.height/4,0,ne.RGBA,ee.extRenderToTextureHalfFloat?ee.extTextureHalfFloat.HALF_FLOAT_OES:ne.UNSIGNED_BYTE,null),K.colorAttachment.set(ie)}(P,F,Y,H)}})(b,m,d),b.clear({color:p.Color.transparent});for(let P=0;P<_.length;P++){const F=_[P];if(s.hasRenderableParent(F))continue;const O=s.getTile(F),B=O.getBucket(d);if(!B)continue;const H=B.programConfigurations.get(d.id),Y=m.useProgram("heatmap",H),{zoom:ee}=m.transform;m.terrain&&m.terrain.setupElevationDraw(O,Y),m.prepareDrawProgram(b,Y,F.toUnwrapped()),Y.draw(b,x.TRIANGLES,p.DepthMode.disabled,E,I,p.CullFaceMode.disabled,Ka(F.projMatrix,O,ee,d.paint.get("heatmap-intensity")),d.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,d.paint,m.transform.zoom,H)}b.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,x){const E=b.context,I=E.gl,P=x.heatmapFbo;if(!P)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),E.activeTexture.set(I.TEXTURE1);let F=x.colorRampTexture;F||(F=x.colorRampTexture=new p.Texture(E,x.colorRamp,I.RGBA)),F.bind(I.LINEAR,I.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(E,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,b.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,x.paint,b.transform.zoom)}(m,d))},line:function(m,s,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("line-opacity"),x=d.paint.get("line-width");if(0===b.constantOr(1)||0===x.constantOr(1))return;const E=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),P=d.paint.get("line-dasharray"),F=P.constantOr(1),O=d.layout.get("line-cap"),B=d.paint.get("line-pattern"),H=B.constantOr(1),Y=d.paint.get("line-gradient"),ee=d.getCrossfadeParameters(),X=H?"linePattern":"line",ie=m.context,K=ie.gl;for(const ne of _){const se=s.getTile(ne);if(H&&!se.patternsLoaded())continue;const J=se.getBucket(d);if(!J)continue;m.prepareDrawTile(ne);const le=J.programConfigurations.get(d.id),fe=ro(d),Se=m.useProgram(X,le,fe),Me=B.constantOr(null);if(Me&&se.imageAtlas){const Xe=se.imageAtlas,Te=Xe.patternPositions[Me.to.toString()],Ke=Xe.patternPositions[Me.from.toString()];Te&&Ke&&le.setConstantPatternPositions(Te,Ke)}const Ne=P.constantOr(null),Re=O.constantOr(null);if(!H&&Ne&&Re&&se.lineAtlas){const Xe=se.lineAtlas,Te=Xe.getDash(Ne.to,Re),Ke=Xe.getDash(Ne.from,Re);Te&&Ke&&le.setConstantPatternPositions(Te,Ke)}const Ze=m.terrain?ne.projMatrix:null,Pe=H?xs(m,se,d,ee,Ze):Yl(m,se,d,ee,Ze,J.lineClipsArray.length);if(Y){const Xe=J.gradients[d.id];let Te=Xe.texture;if(d.gradientVersion!==Xe.version){let Ke=256;if(d.stepInterpolant){const ft=s.getSource().maxzoom,wt=ne.canonical.z===ft?Math.ceil(1<<m.transform.maxZoom-ne.canonical.z):1;Ke=p.clamp(p.nextPowerOfTwo(J.maxLineLength/p.EXTENT*1024*wt),256,ie.maxTextureSize)}Xe.gradient=p.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Ke,image:Xe.gradient||void 0,clips:J.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new p.Texture(ie,Xe.gradient,K.RGBA),Xe.version=d.gradientVersion,Te=Xe.texture}ie.activeTexture.set(K.TEXTURE1),Te.bind(d.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}F&&(ie.activeTexture.set(K.TEXTURE0),se.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),le.updatePaintBuffers(ee)),H&&(ie.activeTexture.set(K.TEXTURE0),se.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),le.updatePaintBuffers(ee)),m.prepareDrawProgram(ie,Se,ne.toUnwrapped()),Se.draw(ie,K.TRIANGLES,E,m.stencilModeForClipping(ne),I,p.CullFaceMode.disabled,Pe,d.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,d.paint,m.transform.zoom,le,J.layoutVertexBuffer2)}},fill:function(m,s,d,_){const b=d.paint.get("fill-color"),x=d.paint.get("fill-opacity");if(0===x.constantOr(1))return;const E=m.colorModeForRenderPass(),I=d.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===b.constantOr(p.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(m.renderPass===P){const F=m.depthModeForSublayer(1,"opaque"===m.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Jl(m,s,d,_,F,E,!1)}if("translucent"===m.renderPass&&d.paint.get("fill-antialias")){const F=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Jl(m,s,d,_,F,E,!0)}},"fill-extrusion":function(m,s,d,_){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===m.renderPass){const x=new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Qa(m,s,d,_,x,p.StencilMode.disabled,p.ColorMode.disabled),Qa(m,s,d,_,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();Qa(m,s,d,_,x,p.StencilMode.disabled,E)}}},hillshade:function(m,s,d,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const b=m.context,x=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),E=m.colorModeForRenderPass(),I=m.terrain&&m.terrain.renderingToTexture,[P,F]="translucent"!==m.renderPass||I?[{},_]:m.stencilConfigForOverlap(_);for(const O of F){const B=s.getTile(O);if(B.needsHillshadePrepare&&"offscreen"===m.renderPass)ht(m,B,d,x,p.StencilMode.disabled,E);else if("translucent"===m.renderPass){const H=I&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):P[O.overscaledZ];Pd(m,O,B,d,x,H,E)}}b.viewport.set([0,0,m.width,m.height])},raster:function(m,s,d,_,b,x){if("translucent"!==m.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const E=m.context,I=E.gl,P=s.getSource(),F=m.useProgram("raster"),O=m.colorModeForRenderPass(),B=m.terrain&&m.terrain.renderingToTexture,[H,Y]=P instanceof G||B?[{},_]:m.stencilConfigForOverlap(_),ee=Y[Y.length-1].overscaledZ,X=!m.options.moving;for(const ie of Y){const K=B?p.DepthMode.disabled:m.depthModeForSublayer(ie.overscaledZ-ee,1===d.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,I.LESS),ne=ie.toUnwrapped(),se=s.getTile(ie);if(B&&(!se||!se.hasData()))continue;const J=B?ie.projMatrix:m.transform.calculateProjMatrix(ne,X),le=m.terrain&&B?m.terrain.stencilModeForRTTOverlap(ie):H[ie.overscaledZ],fe=x?0:d.paint.get("raster-fade-duration");se.registerFadeDuration(fe);const Se=s.findLoadedParent(ie,0),Me=li(se,Se,s,m.transform,fe);let Ne,Re;m.terrain&&m.terrain.prepareDrawTile(ie);const Ze="nearest"===d.paint.get("raster-resampling")?I.NEAREST:I.LINEAR;E.activeTexture.set(I.TEXTURE0),se.texture.bind(Ze,I.CLAMP_TO_EDGE),E.activeTexture.set(I.TEXTURE1),Se?(Se.texture.bind(Ze,I.CLAMP_TO_EDGE),Ne=Math.pow(2,Se.tileID.overscaledZ-se.tileID.overscaledZ),Re=[se.tileID.canonical.x*Ne%1,se.tileID.canonical.y*Ne%1]):se.texture.bind(Ze,I.CLAMP_TO_EDGE);const Pe=Tu(J,Re||[0,0],Ne||1,Me,d);if(m.prepareDrawProgram(E,F,ne),P instanceof G)F.draw(E,I.TRIANGLES,K,p.StencilMode.disabled,O,p.CullFaceMode.disabled,Pe,d.id,P.boundsBuffer,m.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Xe,tileBoundsIndexBuffer:Te,tileBoundsSegments:Ke}=m.getTileBoundsBuffers(se);F.draw(E,I.TRIANGLES,K,le,O,p.CullFaceMode.disabled,Pe,d.id,Xe,Te,Ke)}}},background:function(m,s,d,_){const b=d.paint.get("background-color"),x=d.paint.get("background-opacity");if(0===x)return;const E=m.context,I=E.gl,P=m.transform,F=P.tileSize,O=d.paint.get("background-pattern");if(m.isPatternMissing(O))return;const B=!O&&1===b.a&&1===x&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const H=p.StencilMode.disabled,Y=m.depthModeForSublayer(0,"opaque"===B?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),ee=m.colorModeForRenderPass(),X=m.useProgram(O?"backgroundPattern":"background");let ie,K=_;K||(ie=m.getBackgroundTiles(),K=Object.values(ie).map(se=>se.tileID)),O&&(E.activeTexture.set(I.TEXTURE0),m.imageManager.bind(m.context));const ne=d.getCrossfadeParameters();for(const se of K){const J=se.toUnwrapped(),le=_?se.projMatrix:m.transform.calculateProjMatrix(J);m.prepareDrawTile(se);const fe=s?s.getTile(se):ie?ie[se.key]:new p.Tile(se,F,P.zoom,m),Se=O?lm(le,x,m,O,{tileID:se,tileSize:F},ne):M_(le,x,b);m.prepareDrawProgram(E,X,J);const{tileBoundsBuffer:Me,tileBoundsIndexBuffer:Ne,tileBoundsSegments:Re}=m.getTileBoundsBuffers(fe);X.draw(E,I.TRIANGLES,Y,H,ee,p.CullFaceMode.disabled,Se,d.id,Me,Ne,Re)}},sky:function(m,s,d){const _=m.transform,b="mercator"===_.projection.name?1:p.smoothstep(7,8,_.zoom),x=d.paint.get("sky-opacity")*b;if(0===x)return;const E=m.context,I=d.paint.get("sky-type"),P=new p.DepthMode(E.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),F=m.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===m.renderPass?d.needsSkyboxCapture(m)&&(function(O,B,H,Y){const ee=O.context,X=ee.gl;let ie=B.skyboxFbo;if(!ie){ie=B.skyboxFbo=ee.createFramebuffer(32,32,!1),B.skyboxGeometry=new Ql(ee),B.skyboxTexture=ee.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,B.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let J=0;J<6;++J)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(ie.framebuffer),ee.viewport.set([0,0,32,32]);const K=B.getCenter(O,!0),ne=O.useProgram("skyboxCapture"),se=new Float64Array(16);p.identity(se),p.rotateY(se,se,.5*-Math.PI),ya(ee,B,ne,se,K,0),p.identity(se),p.rotateY(se,se,.5*Math.PI),ya(ee,B,ne,se,K,1),p.identity(se),p.rotateX(se,se,.5*-Math.PI),ya(ee,B,ne,se,K,2),p.identity(se),p.rotateX(se,se,.5*Math.PI),ya(ee,B,ne,se,K,3),p.identity(se),ya(ee,B,ne,se,K,4),p.identity(se),p.rotateY(se,se,Math.PI),ya(ee,B,ne,se,K,5),ee.viewport.set([0,0,O.width,O.height])}(m,d),d.markSkyboxValid(m)):"sky"===m.renderPass&&function(O,B,H,Y,ee){const X=O.context,ie=X.gl,K=O.transform,ne=O.useProgram("skybox");X.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,B.skyboxTexture);const se={u_matrix:K.skyboxMatrix,u_sun_direction:B.getCenter(O,!1),u_cubemap:0,u_opacity:Y,u_temporal_offset:ee};O.prepareDrawProgram(X,ne),ne.draw(X,ie.TRIANGLES,H,p.StencilMode.disabled,O.colorModeForRenderPass(),p.CullFaceMode.backCW,se,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,d,P,x,F):"gradient"===I&&"sky"===m.renderPass&&function(O,B,H,Y,ee){const X=O.context,ie=X.gl,K=O.transform,ne=O.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Ql(X)),X.activeTexture.set(ie.TEXTURE0);let se=B.colorRampTexture;se||(se=B.colorRampTexture=new p.Texture(X,B.colorRamp,ie.RGBA)),se.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const J=(le=K.skyboxMatrix,fe=B.getCenter(O,!1),Se=B.paint.get("sky-gradient-radius"),Me=Y,Ne=ee,{u_matrix:le,u_color_ramp:0,u_center_direction:fe,u_radius:p.degToRad(Se),u_opacity:Me,u_temporal_offset:Ne});var le,fe,Se,Me,Ne;O.prepareDrawProgram(X,ne),ne.draw(X,ie.TRIANGLES,H,p.StencilMode.disabled,O.colorModeForRenderPass(),p.CullFaceMode.backCW,J,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,d,P,x,F)},debug:function(m,s,d){for(let _=0;_<d.length;_++)_a(m,s,d[_])},custom:function(m,s,d){const _=m.context,b=d.implementation;if("mercator"===m.transform.projection.name){if("offscreen"===m.renderPass){const x=b.prerender;x&&(m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),x.call(b,_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),_.setStencilMode(p.StencilMode.disabled);const x="3d"===b.renderingMode?new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,p.DepthMode.ReadOnly);_.setDepthMode(x),b.render(_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState(),_.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class Bd{constructor(s,d){this.context=new Ha(s),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Po,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,d){const _=!!s&&!!s.terrain&&"mercator"===this.transform.projection.name;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zt(this,s));const b=this._terrain;this.transform.elevation=_?b:null,b.update(s,this.transform,d)}_updateFog(s){const d=s.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const x=_+.78*(b-_);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,d){if(this.width=s*p.exported.devicePixelRatio,this.height=d*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const s=this.context,d=new p.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(p.EXTENT,0),d.emplaceBack(0,p.EXTENT),d.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(d,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=s.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const b=new p.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const x=new p.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(p.EXTENT,0,p.EXTENT,0),x.emplaceBack(0,p.EXTENT,0,p.EXTENT),x.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(x,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const E=new p.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);const I=new p.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])I.emplaceBack(F);this.debugIndexBuffer=s.createIndexBuffer(I),this.emptyTexture=new p.Texture(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA),this.identityMat=p.create$1();const P=this.context.gl;this.stencilClearMode=new p.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(p.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,d=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(s,d.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,ns(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,d,_){if(!(d&&this.currentStencilSource!==d.id&&s.isTileClipped()&&_&&_.length))return;this.currentStencilSource=d.id;const b=this.context,x=b.gl;this.nextStencilID+_.length>256&&this.clearStencil(),b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of _){const P=d.getTile(I),F=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:B,tileBoundsSegments:H}=this.getTileBoundsBuffers(P);E.draw(b,x.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ns(I.projMatrix),"$clipping",O,B,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,d=this.context.gl;return new p.StencilMode({func:d.NOTEQUAL,mask:255},s,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const d=this.context.gl;return new p.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(s){const d=this.context.gl,_=s.sort((E,I)=>I.overscaledZ-E.overscaledZ),b=_[_.length-1].overscaledZ,x=_[0].overscaledZ-b+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let I=0;I<x;I++)E[I+b]=new p.StencilMode({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[E,_]}return[{[b]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const s=this.context.gl;if(this._showOverdrawInspector){const d=1/8;return new p.ColorMode([s.CONSTANT_COLOR,s.ONE],new p.Color(d,d,d,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(s,d,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,d){this.style=s,this.options=d,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const F in b){const O=b[F];O.used&&O.prepare(this.context)}const x={},E={},I={};for(const F in b){const O=b[F];x[F]=O.getVisibleCoordinates(),E[F]=x[F].slice().reverse(),I[F]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<_.length;F++)if(this.style._layers[_[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of _){const O=this.style._layers[F],B=s._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const H=B?E[B.id]:void 0;("custom"===O.type||O.isSky()||H&&H.length)&&this.renderLayer(this,B,O,H)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=p.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?p.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[_[this.currentLayer]],O=s._getLayerSourceCache(F);if(F.isSky())continue;const B=O?E[O.id]:void 0;this._renderTileClippingMasks(F,O,B),this.renderLayer(this,O,F,B)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const F=this.style._layers[_[this.currentLayer]],O=s._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,O,F,O?E[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const F=this.style._layers[_[this.currentLayer]],O=s._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=O?("symbol"===F.type?I:E)[O.id]:void 0;this._renderTileClippingMasks(F,O,O?x[O.id]:void 0),this.renderLayer(this,O,F,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let F=null;p.values(this.style._layers).forEach(O=>{const B=s._getLayerSourceCache(O);B&&!O.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<B.getSource().maxzoom)&&(F=B)}),F&&this.options.showTileBoundaries&&Lc.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const O=F.transform.padding;Oc(F,F.transform.height-(O.top||0),3,nf),Oc(F,O.bottom||0,3,wn),fm(F,O.left||0,3,Od),fm(F,F.transform.width-(O.right||0),3,rf);const B=F.transform.centerPoint;var H,Y,ee,X;Ld(H=F,(Y=B.x)-1,(ee=F.transform.height-B.y)-10,2,20,X=Mu),Ld(H,Y-10,ee-1,20,2,X)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%p.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,d,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),Lc[_.type](s,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[s.id];_||(_=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const d={};for(const _ in s){const b=s[_],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(b.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(b.query),d[_]=E}return d}translatePosMatrix(s,d,_,b,x){if(!_[0]&&!_[1])return s;const E=x?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(E){const F=Math.sin(E),O=Math.cos(E);_=[_[0]*O-_[1]*F,_[0]*F+_[1]*O]}const I=[x?_[0]:Bi(d,_[0],this.transform.zoom),x?_[1]:Bi(d,_[1],this.transform.zoom),0],P=new Float32Array(16);return p.translate(P,s,I),P}saveTileTexture(s){const d=this._tileTextures[s.size[0]];d?d.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const d=this._tileTextures[s];return d&&d.length>0?d.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const d=this.imageManager.getPattern(s.from.toString()),_=this.imageManager.getPattern(s.to.toString());return!d||!_}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),d&&!s&&0!==d.getOpacity(this.transform.pitch)&&_.push("FOG"),s&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(s,d,_){this.cache=this.cache||{};const b=_||[],x=this.currentGlobalDefines().concat(b),E=qs.cacheKey(s,x,d);return this.cache[E]||(this.cache[E]=new qs(this.context,s,tr[s],d,cm[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(s){this.terrain&&this.terrain.prepareDrawTile(s)}prepareDrawProgram(s,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const x=b.getOpacity(this.transform.pitch);0!==x&&d.setFogUniformValues(s,((E,I,P,F)=>{const O=I.properties.get("color"),B=E.frameCounter/1e3%1,H=[O.r/O.a,O.g/O.a,O.b/O.a,F];return{u_fog_matrix:P?E.transform.calculateFogTileMatrix(P):E.identityMat,u_fog_range:I.getFovAdjustedRange(E.transform._fov),u_fog_color:H,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,b,_,x))}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const s=this.context.gl,d=s.createTexture();return s.bindTexture(s.TEXTURE_2D,d),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}getBackgroundTiles(){const s=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)d[b.key]=s[b.key]||new p.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class ec{constructor(s=0,d=0,_=0,b=0){if(isNaN(s)||s<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=d,this.left=_,this.right=b}interpolate(s,d,_){return null!=d.top&&null!=s.top&&(this.top=p.number(s.top,d.top,_)),null!=d.bottom&&null!=s.bottom&&(this.bottom=p.number(s.bottom,d.bottom,_)),null!=d.left&&null!=s.left&&(this.left=p.number(s.left,d.left,_)),null!=d.right&&null!=s.right&&(this.right=p.number(s.right,d.right,_)),this}getCenter(s,d){const _=p.clamp((this.left+s-this.right)/2,0,s),b=p.clamp((this.top+d-this.bottom)/2,0,d);return new p.pointGeometry(_,b)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ec(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ws(m,s){return[m[4*s],m[4*s+1],m[4*s+2],m[4*s+3]]}function Oo(m,s,d){m[4*s+0]=d[0],m[4*s+1]=d[1],m[4*s+2]=d[2],m[4*s+3]=d[3]}function Sr(m,s){const d=ws(m,3);p.fromQuat(m,s),Oo(m,3,d)}function Iu(m,s){Oo(m,3,[s[0],s[1],s[2],1])}function Bc(m,s){const d=p.identity$1([]);return p.rotateZ$1(d,d,-s),p.rotateX$1(d,d,-m),d}function Cs(m,s){const d=[m[0],m[1],0],_=[s[0],s[1],0];if(p.length(d)>=1e-15){const E=p.normalize([],d);p.scale(_,E,p.dot(_,E)),s[0]=_[0],s[1]=_[1]}const b=p.cross([],s,m);if(p.len(b)<1e-15)return null;const x=Math.atan2(-b[1],b[0]);return Bc(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}class Vd{constructor(s,d){this.position=s,this.orientation=d}get position(){return this._position}set position(s){this._position=this._renderWorldCopies?function(d){if(!d)return;const _=Array.isArray(d)?new p.MercatorCoordinate(d[0],d[1],d[2]):d;return _.x=p.wrap(_.x,0,1),_}(s):s}lookAtPoint(s,d){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(s)):0,b=this.position,x=p.MercatorCoordinate.fromLngLat(s,_),E=[x.x-b.x,x.y-b.y,x.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Cs(E,d)}setPitchBearing(s,d){this.orientation=Bc(p.degToRad(s),p.degToRad(-d))}}class va{constructor(s,d){this._transform=p.identity([]),this._orientation=p.identity$1([]),d&&(this._orientation=d,Sr(this._transform,this._orientation)),s&&Iu(this._transform,s)}get mercatorPosition(){const s=this.position;return new p.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=ws(this._transform,3);return[s[0],s[1],s[2]]}set position(s){Iu(this._transform,s)}get orientation(){return this._orientation}set orientation(s){this._orientation=s,Sr(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,d){this._orientation=Bc(s,d),Sr(this._transform,this._orientation)}forward(){const s=ws(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=ws(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=ws(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,d){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(s,d)),_}getWorldToCameraPosition(s,d,_){const b=this.position;p.scale(b,b,-s);const x=new Float64Array(16);return p.fromScaling(x,[_,_,_]),p.translate(x,x,b),x[10]*=d,x}getWorldToCamera(s,d){const _=new Float64Array(16),b=new Float64Array(4),x=this.position;return p.conjugate(b,this._orientation),p.scale(x,x,-s),p.fromQuat(_,b),p.translate(_,_,x),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(s,d,_,b){const x=new Float64Array(16);return p.perspective(x,s,d,_,b),x}getDistanceToElevation(s){const d=0===s?0:p.mercatorZfromAltitude(s,this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new va([...this.position],[...this.orientation])}}function zd(m,s){const d=af(m),_=function(x,E,I,P,F){const O=new p.LngLat(I.lng-180*ba,I.lat),B=new p.LngLat(I.lng+180*ba,I.lat),H=x.project(O.lng,O.lat),Y=x.project(B.lng,B.lat),ee=-Math.atan2(Y.y-H.y,Y.x-H.x),X=p.MercatorCoordinate.fromLngLat(I);X.y=p.clamp(X.y,-.999975,.999975);const ie=X.toLngLat(),K=x.project(ie.lng,ie.lat),ne=p.MercatorCoordinate.fromLngLat(ie);ne.x+=ba;const se=ne.toLngLat(),J=x.project(se.lng,se.lat),le=xi(J.x-K.x,J.y-K.y,ee),fe=p.MercatorCoordinate.fromLngLat(ie);fe.y+=ba;const Se=fe.toLngLat(),Me=x.project(Se.lng,Se.lat),Ne=xi(Me.x-K.x,Me.y-K.y,ee),Re=Math.abs(le.x)/Math.abs(Ne.y),Ze=p.identity([]);p.rotateZ(Ze,Ze,-ee*(1-(F?0:P)));const Pe=p.identity([]);return p.scale$1(Pe,Pe,[1,1-(1-Re)*P,1]),Pe[4]=-Ne.x/Ne.y*P,p.rotateZ(Pe,Pe,ee),p.multiply(Pe,Ze,Pe),Pe}(m.projection,0,m.center,d,s),b=Yn(m);return p.scale$1(_,_,[b,b,1]),_}function Yn(m){const s=m.projection,d=af(m),_=el(s,m.center),b=el(s,p.LngLat.convert(s.center));return Math.pow(2,_*d+(1-d)*b)}function af(m){const s=m.projection.range;if(!s)return 0;const d=Math.max(m.width,m.height),_=Math.log(d/1024)/Math.LN2;return p.smoothstep(s[0]+_,s[1]+_,m.zoom)}const ba=1/4e4;function el(m,s){const d=p.clamp(s.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(s.lng-180*ba,d),b=new p.LngLat(s.lng+180*ba,d),x=m.project(_.lng,d),E=m.project(b.lng,d),I=p.MercatorCoordinate.fromLngLat(_),P=p.MercatorCoordinate.fromLngLat(b),F=E.x-x.x,O=E.y-x.y,B=P.x-I.x,H=P.y-I.y,Y=Math.sqrt((B*B+H*H)/(F*F+O*O));return Math.log(Y)/Math.LN2}function xi(m,s,d){const _=Math.cos(d),b=Math.sin(d);return{x:m*_-s*b,y:m*b+s*_}}class Ud{constructor(s,d,_,b,x){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=s||0,this._maxZoom=d||22,this._minPitch=null==_?0:_,this._maxPitch=null==b?60:b,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ec,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new va,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const s=new Ud(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s.tileSize=this.tileSize,s.setMaxBounds(this.getMaxBounds()),s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._cameraZoom=this._cameraZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.setProjection(this.getProjection()),s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,s?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(s){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),s&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(s){null==s&&(s={name:"mercator"}),this.projectionOptions=s;const d=this.projection?this.getProjection():void 0;return this.projection=p.getProjection(s),!$e(d,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const d=-s*Math.PI/180;var _,b,x,E,I,P,F,O,B,H;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,E=this.angle,I=(x=this.rotationMatrix)[0],P=x[1],F=x[2],O=x[3],B=Math.sin(E),H=Math.cos(E),b[0]=I*H+F*B,b[1]=P*H+O*B,b[2]=I*-B+F*H,b[3]=P*-B+O*H)}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const d=p.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(s){const d=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===s?(this._cameraZoom=null,!1):(this._centerAltitude=s,!0)}_updateCameraOnTerrain(){const s=this.cameraToCenterDistance/this.worldSize,d=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(d+s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,x=0;for(let E=0;E<d.length;E++){const I=new p.pointGeometry(d[E][0]*this.width,_+d[E][1]*(this.height-_)),P=s.pointCoordinate(I);if(!P)continue;const F=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);b+=P[3]*F,x+=F}return 0===x?NaN:b/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const s=this._cameraZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=p.mercatorZfromAltitude(d,this.center.lat),b=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(b-_,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let _;_=s.z<this._camera.position[2]?[d.x,d.y,d.z]:[s.x,s.y,s.z];const b=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let d=!1;if(s.orientation&&!p.exactEquals(s.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(s.orientation)),s.position){const _=[s.position.x,s.position.y,s.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,d=new Vd;return d.position=new p.MercatorCoordinate(s[0],s[1],s[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(s){if(!p.length$1(s))return!1;p.normalize$1(s,s);const d=p.transformQuat([],[0,0,-1],s),_=p.transformQuat([],[0,-1,0],s);if(_[2]<0)return!1;const b=Cs(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(s){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;s[2]=p.clamp(s[2],b/_,b/d),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,d,_){this._unmodified=!1,this._edgeInsets.interpolate(s,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const d=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(s){const d=[new p.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.pointGeometry(0,0)),b=this.pointCoordinate(new p.pointGeometry(this.width,0)),x=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new p.pointGeometry(0,this.height)),I=Math.floor(Math.min(_.x,b.x,x.x,E.x)),P=Math.floor(Math.max(_.x,b.x,x.x,E.x)),F=1;for(let O=I-F;O<=P+F;O++)0!==O&&d.push(new p.UnwrappedTileID(O,s))}return d}coveringTiles(s){let d=this.coveringZoomLevel(s);const _=d,b=this.elevation&&!s.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==s.minzoom&&d<s.minzoom)return[];void 0!==s.maxzoom&&d>s.maxzoom&&(d=s.maxzoom);const E=this.locationCoordinate(this.center),I=1<<d,P=[I*E.x,I*E.y,0],F=To.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),O=this.pointCoordinate(this.getCameraPoint()),B=I*p.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),Y=[I*O.x,I*O.y,H],ee=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),X=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&x?d:0,ie=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,K=s.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=Yn(this),se=Te=>{const Ke=1/4e4,ft=new p.MercatorCoordinate(Te.x+Ke,Te.y,Te.z),wt=new p.MercatorCoordinate(Te.x,Te.y+Ke,Te.z),Dt=Te.toLngLat(),Pt=ft.toLngLat(),St=wt.toLngLat(),xt=this.locationCoordinate(Dt),At=this.locationCoordinate(Pt),Ft=this.locationCoordinate(St),hi=Math.hypot(At.x-xt.x,At.y-xt.y),si=Math.hypot(Ft.x-xt.x,Ft.y-xt.y);return Math.sqrt(hi*si)*ne/Ke},J=(Te,Ke,ft,wt,Dt,Pt)=>{const St=p.tileTransform({z:Te,x:Ke,y:ft},this.projection);return new Mo([(wt+St.x/St.scale)*I,I*(St.y/St.scale),Dt],[(wt+St.x2/St.scale)*I,I*(St.y2/St.scale),Pt])},le=Te=>({aabb:J(0,0,0,Te,K,ie),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),fe=[];let Se=[];const Me=d,Ne=s.reparseOverscaled?_:d,Re=Te=>{if(!this._elevation||!Te.tileID)return;const Ke=this._elevation.getMinMaxForTile(Te.tileID),ft=Te.aabb;Ke?(ft.min[2]=Ke.min,ft.max[2]=Ke.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Te.shouldSplit=Xe(Te),Te.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},Ze=Te=>Te*Te,Pe=Ze((H-this._centerAltitude)*B),Xe=Te=>{if(Te.zoom<X)return!0;if(Te.zoom===Me)return!1;if(null!=Te.shouldSplit)return Te.shouldSplit;const Ke=Te.aabb.distanceX(Y),ft=Te.aabb.distanceY(Y);let wt=Pe;b&&(wt=Ze(Te.aabb.distanceZ(Y)*B));let Dt=1;if(!x&&_<=5){const St=Math.pow(2,Te.zoom),xt=se(new p.MercatorCoordinate((Te.x+.5)/St,(Te.y+.5)/St));Dt=xt>.85?1:xt}const Pt=Ke*Ke+ft*ft+wt;return Pt<Ze((1<<Me-Te.zoom)*ee*Dt*((St,xt)=>{if(xt*Ze(.707)<St)return 1;const At=Math.sqrt(xt/St);return At/(1.4144271570014144+(Math.pow(1.1,At-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(wt,Pe),Pt))};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)fe.push(le(-Te)),fe.push(le(Te));for(fe.push(le(0));fe.length>0;){const Te=fe.pop(),Ke=Te.x,ft=Te.y;let wt=Te.fullyVisible;if(!wt){const Dt=Te.aabb.intersects(F);if(0===Dt)continue;wt=2===Dt}if(Te.zoom!==Me&&Xe(Te))for(let Dt=0;Dt<4;Dt++){const Pt=(Ke<<1)+Dt%2,St=(ft<<1)+(Dt>>1),xt={aabb:"mercator"===this.projection.name?Te.aabb.quadrant(Dt):J(Te.zoom+1,Pt,St,Te.wrap,0,0),zoom:Te.zoom+1,x:Pt,y:St,wrap:Te.wrap,fullyVisible:wt,tileID:void 0,shouldSplit:void 0};b&&(xt.tileID=new p.OverscaledTileID(Te.zoom+1===Me?Ne:Te.zoom+1,Te.wrap,Te.zoom+1,Pt,St),Re(xt)),fe.push(xt)}else{const Dt=Te.zoom===Me?Ne:Te.zoom;if(s.minzoom&&s.minzoom>Dt)continue;const Pt=P[0]-(.5+Ke+(Te.wrap<<Te.zoom))*(1<<d-Te.zoom),St=P[1]-.5-ft,xt=Te.tileID?Te.tileID:new p.OverscaledTileID(Dt,Te.wrap,Te.zoom,Ke,ft);Se.push({tileID:xt,distanceSq:Pt*Pt+St*St})}}if(this.fogCullDistSq){const Te=this.fogCullDistSq,Ke=this.horizonLineFromTop();Se=Se.filter(ft=>{const wt=[0,0,0,1],Dt=[p.EXTENT,p.EXTENT,0,1],Pt=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());p.transformMat4(wt,wt,Pt),p.transformMat4(Dt,Dt,Pt);const St=p.getAABBPointSquareDist(wt,Dt);if(0===St)return!0;let xt=!1;const At=this._elevation;if(At&&St>Te&&0!==Ke){const Ft=this.calculateProjMatrix(ft.tileID.toUnwrapped());let hi;s.isTerrainDEM||(hi=At.getMinMaxForTile(ft.tileID)),hi||(hi={min:K,max:ie});const si=p.furthestTileCorner(this.rotation),Ci=[si[0]*p.EXTENT,si[1]*p.EXTENT,hi.max];p.transformMat4$1(Ci,Ci,Ft),xt=(1-Ci[1])*this.height*.5<Ke}return St<Te||xt})}return Se.sort((Te,Ke)=>Te.distanceSq-Ke.distanceSq).map(Te=>Te.tileID)}resize(s,d){this.width=s,this.height=d,this.pixelsToGLUnits=[2/s,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const d=p.clamp(s.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(s.lng,d);return new p.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(s,d){const _=this.pointCoordinate(d),b=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(s);this.setLocation(new p.MercatorCoordinate(x.x-(_.x-b.x),x.y-(_.y-b.y)))}setLocation(s){this.center=this.coordinateLocation(s),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s){return this._coordinatePoint(this.locationCoordinate(s),!1)}locationPoint3D(s){return this._coordinatePoint(this.locationCoordinate(s),!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,d){const _=d?p.mercatorZfromAltitude(d,s.lat):void 0,b=this.projection.project(s.lng,s.lat);return new p.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,d){const _=null!=d?d:this._centerAltitude,b=[s.x,s.y,0,1],x=[s.x,s.y,1,1];p.transformMat4(b,b,this.pixelMatrixInverse),p.transformMat4(x,x,this.pixelMatrixInverse);const E=x[3];p.scale$2(b,b,1/b[3]),p.scale$2(x,x,1/E);const I=b[2],P=x[2];return{p0:b,p1:x,t:I===P?0:(_-I)/(P-I)}}screenPointToMercatorRay(s){const d=[s.x,s.y,0,1],_=[s.x,s.y,1,1];return p.transformMat4(d,d,this.pixelMatrixInverse),p.transformMat4(_,_,this.pixelMatrixInverse),p.scale$2(d,d,1/d[3]),p.scale$2(_,_,1/_[3]),d[2]=p.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$2(d,d,1/this.worldSize),p.scale$2(_,_,1/this.worldSize),new Ol([d[0],d[1],d[2]],p.normalize([],p.sub([],_,d)))}rayIntersectionCoordinate(s){const{p0:d,p1:_,t:b}=s,x=p.mercatorZfromAltitude(d[2],this._center.lat),E=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(d[0],_[0],b)/this.worldSize,p.number(d[1],_[1],b)/this.worldSize,p.number(x,E,b))}pointCoordinate(s,d=this._centerAltitude){const _=this.horizonLineFromTop(!1),b=new p.pointGeometry(s.x,Math.max(_,s.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(b,d))}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);const d=this.elevation;let _=this.elevation.pointCoordinate(s);if(_)return new p.MercatorCoordinate(_[0],_[1],_[2]);let b=0,x=this.horizonLineFromTop();if(s.y>x)return this.pointCoordinate(s);const E=.02*x,I=s.clone();for(let P=0;P<10&&x-b>E;P++){I.y=p.number(b,x,.66);const F=d.pointCoordinate(I);F?(x=I.y,_=F):b=I.y}return _?new p.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){if(this.elevation)return!this.elevation.pointCoordinate(s);{const d=this.horizonLineFromTop();return s.y<d}}_coordinatePoint(s,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,b=[s.x*this.worldSize,s.y*this.worldSize,_+s.toAltitude(),1];return p.transformMat4(b,b,this.pixelMatrix),b[3]>0?new p.pointGeometry(b[0]/b[3],b[1]/b[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(s,d){const _=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let I=this.pointCoordinate(_,s),P=this.pointCoordinate(b,s);const F=this.pointCoordinate(x,d),O=this.pointCoordinate(E,d),B=(H,Y)=>(Y.y-H.y)/(Y.x-H.x);return I.y>1&&P.y>=0?I=new p.MercatorCoordinate((1-O.y)/B(O,I)+O.x,1):I.y<0&&P.y<=1&&(I=new p.MercatorCoordinate(-O.y/B(O,I)+O.x,0)),P.y>1&&I.y>=0?P=new p.MercatorCoordinate((1-F.y)/B(F,P)+F.x,1):P.y<0&&I.y<=1&&(P=new p.MercatorCoordinate(-F.y/B(F,P)+F.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(F))}_getBounds3D(){const s=this.elevation,d=s.visibleDemTiles.reduce((_,b)=>{if(b.dem){const x=b.dem.tree;_.min=Math.min(_.min,x.minimums[0]),_.max=Math.max(_.max,x.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*s.exaggeration(),d.max*s.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(s=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return s?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,d){let _,b,x;const E=s.canonical,I=p.identity(new Float64Array(16));if("mercator"===this.projection.name)_=d/this.zoomScale(E.z),b=(E.x+Math.pow(2,E.z)*s.wrap)*_,x=E.y*_;else{const P=p.tileTransform(E,this.projection);_=1,b=P.x+s.wrap*P.scale,x=P.y,p.scale$1(I,I,[_/P.scale,_/P.scale,this.pixelsPerMeter/this.worldSize])}return p.translate(I,I,[b,x,0]),p.scale$1(I,I,[_/p.EXTENT,_/p.EXTENT,1]),I}calculateDistanceTileData(s){const d=s.key,_=this._distanceTileDataCache;if(_[d])return _[d];const b=s.canonical,x=1/this.height,E=this.cameraWorldSize/this.zoomScale(b.z),I=(b.x+Math.pow(2,b.z)*s.wrap)*E,P=b.y*E,F=this.point,O=this.angle,B=Math.sin(-O),H=-Math.cos(-O);return _[d]={bearing:[B,H],center:[(F.x-I)*x,(F.y-P)*x],scale:E/p.EXTENT*x},_[d]}calculateFogTileMatrix(s){const d=s.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const b=this.calculatePosMatrix(s,this.cameraWorldSize);return p.multiply(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(s,d=!1){const _=s.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const x=this.calculatePosMatrix(s,this.worldSize);return p.multiply(x,"mercator"===this.projection.name?d?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,x),b[_]=new Float32Array(x),b[_]}calculatePixelsToTileUnitsMatrix(s){const d=s.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const b=function(x,E){const{scale:I}=x.tileTransform,P=I*p.EXTENT/(x.tileSize*Math.pow(2,E.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return F=new Float32Array(4),H=(O=E.inverseAdjustmentMatrix)[1],Y=O[2],ee=O[3],ie=(B=[P,P])[1],F[0]=O[0]*(X=B[0]),F[1]=H*X,F[2]=Y*ie,F[3]=ee*ie,F;var F,O,B,H,Y,ee,X,ie}(s,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const d=this._camera.position,_=this._camera.forward();if(d[2]<=0||_[2]>=0)return;const b=p.mercatorZfromAltitude(1,this._center.lat);d[2]/=b,_[2]/=b,p.normalize(_,_);const x=s.raycast(d,_,s.exaggeration());if(x){const E=p.scaleAndAdd([],d,_,x),I=new p.MercatorCoordinate(E[0],E[1],p.mercatorZfromAltitude(E[2],p.latFromMercatorY(E[1]))),P=this._camera.position,F=I.z+p.length([I.x-P[0],I.y-P[1],I.z-P[2]]);this._cameraZoom=this._zoomFromMercatorZ(F),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const d=s.getAtPointOrZero(this._camera.mercatorPosition),_=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),b=p.mercatorZfromAltitude(d,this._center.lat),x=this._camera.position[2]-b;if(x<_){const E=this.locationCoordinate(this._center,this._centerAltitude),I=this._camera.mercatorPosition,P=[E.x-I.x,E.y-I.y,E.z-I.z],F=p.length(P);P[2]-=_-x;const O=p.length(P);if(0===O)return;p.scale(P,P,F/O),this._camera.position=[E.x-P[0],E.y-P[1],E.z-P[2]],this._camera.orientation=Cs(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const B=this.center;return B.lat=p.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=p.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:d,y:_}=this.point;let b=0,x=d,E=_;const I=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-P<F&&(E=F+P),_+P>O&&(E=O-P),O-F<this.height&&(b=Math.max(b,this.height/(O-F)),E=(O+F)/2),this.maxBounds||!this.renderWorldCopies){const B=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,Y=this.worldSize/2-(B+H)/2;x=(d+Y+this.worldSize)%this.worldSize-Y,x-I<B&&(x=B+I),x+I>H&&(x=H-I),H-B<this.width&&(b=Math.max(b,this.width/(H-B)),x=(H+B)/2)}x===d&&E===_||(this.center=this.unproject(new p.pointGeometry(x,E))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const d=this.pixelsPerMeter;this._updateCameraState();const _=Math.PI/2+this._pitch,b=this.fovAboveCenter,x=this.elevation?this.elevation.getMinElevationBelowMSL()*d:0,E=(this._camera.position[2]*this.worldSize-x)/Math.cos(this._pitch),I=Math.sin(b)*E/Math.sin(p.clamp(Math.PI-_-b,.01,Math.PI-.01)),P=this.point,F=P.x,O=P.y,B=Math.cos(Math.PI/2-this._pitch)*I+E,H=Math.min(1.01*B,E*(1/this._horizonShift)),Y=this.height/50,ee=this._camera.getWorldToCamera(this.worldSize,d),X=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,Y,H);X[8]=2*-s.x/this.width,X[9]=2*s.y/this.height;let ie=p.mul$1([],X,ee);if("mercator"!==this.projection.name){const Ze=this.locationCoordinate(this.center),Pe=p.identity([]);p.translate(Pe,Pe,[Ze.x*this.worldSize,Ze.y*this.worldSize,0]),p.multiply(Pe,Pe,zd(this)),p.translate(Pe,Pe,[-Ze.x*this.worldSize,-Ze.y*this.worldSize,0]),p.multiply(ie,ie,Pe),this.inverseAdjustmentMatrix=function(Xe){const Te=zd(Xe,!0);return vu([],[Te[0],Te[1],Te[4],Te[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale$1([],ie,[this.worldSize,this.worldSize,this.worldSize/d]),this.projMatrix=ie,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const K=new Float32Array(16);p.identity(K),p.scale$1(K,K,[1,-1,1]),p.rotateX(K,K,this._pitch),p.rotateZ(K,K,this.angle);const ne=p.perspective(new Float32Array(16),this._fov,this.width/this.height,Y,H),se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ne[8]=2*-s.x/this.width,ne[9]=2*(s.y+se)/this.height,this.skyboxMatrix=p.multiply(K,ne,K);const J=this.width%2/2,le=this.height%2/2,fe=Math.cos(this.angle),Se=Math.sin(this.angle),Me=F-Math.round(F)+fe*J+Se*le,Ne=O-Math.round(O)+fe*le+Se*J,Re=new Float64Array(ie);if(p.translate(Re,Re,[Me>.5?Me-1:Me,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=Re,ie=p.create$1(),p.scale$1(ie,ie,[this.width/2,-this.height/2,1]),p.translate(ie,ie,[1,-1,0]),this.labelPlaneMatrix=ie,ie=p.create$1(),p.scale$1(ie,ie,[1,-1,1]),p.translate(ie,ie,[-1,-1,0]),p.scale$1(ie,ie,[2/this.width,2/this.height,1]),this.glCoordMatrix=ie,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},ie=p.invert(new Float64Array(16),this.pixelMatrix),!ie)throw new Error("failed to invert matrix");this.pixelMatrixInverse=ie,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSize,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height,x=[s,s,d];p.scale(x,x,b),p.scale(_,_,-1),p.multiply$1(_,_,x);const E=p.create$1();p.translate(E,E,_),p.scale$1(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,d,b)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const s=this._camera.forward(),d=this.cameraToCenterDistance,_=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-p.mercatorZfromAltitude(this._centerAltitude,this.center.lat),x=this.cameraToCenterDistance/b;this._camera.position=[_.x/this.worldSize-s[0]*d/x,_.y/this.worldSize-s[1]*d/x,p.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-s[2]*d/x]}_translateCameraConstrained(s){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=s[2];let b=1;_>0&&(b=Math.min((d-this._camera.position[2])/_,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,s,b),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),x=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat),E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),I=Math.max((s[2]-x)/Math.cos(_),E),P=this._zoomFromMercatorZ(I);p.scaleAndAdd(s,s,d,I),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(b,-Math.PI,Math.PI),this._setZoom(p.clamp(P,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new p.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(s,d){const _=Math.min(s.x,d.x),b=Math.max(s.x,d.x),x=Math.min(s.y,d.y),E=Math.max(s.y,d.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new p.pointGeometry(_,x),new p.pointGeometry(b,E),new p.pointGeometry(_,E),new p.pointGeometry(b,x)],P=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const O of I){const B=this.pointRayIntersection(O);if(B.t<0)return!0;const H=this.rayIntersectionCoordinate(B);if(H.x<P||H.y<0||H.x>F||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(s,d){const _=p.length(p.sub([],this._camera.position,s)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,s))}}function lf(m,s){let d=!1,_=null;const b=()=>{_=null,d&&(m(),_=setTimeout(b,s),d=!1)};return()=>(d=!0,_||b(),_)}class tl{constructor(s){this._hashName=s&&encodeURIComponent(s),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lf(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,b),E=Math.round(d.lng*x)/x,I=Math.round(d.lat*x)/x,P=this._map.getBearing(),F=this._map.getPitch();let O="";if(O+=s?`/${E}/${I}/${_}`:`${_}/${I}/${E}`,(P||F)&&(O+="/"+Math.round(10*P)/10),F&&(O+=`/${Math.round(F)}`),this._hashName){const B=this._hashName;let H=!1;const Y=p.window.location.hash.slice(1).split("&").map(ee=>{const X=ee.split("=")[0];return X===B?(H=!0,`${X}=${O}`):ee}).filter(ee=>ee);return H||Y.push(`${B}=${O}`),`#${Y.join("&")}`}return`#${O}`}_getCurrentHash(){const s=p.window.location.hash.replace("#","");if(this._hashName){let d;return s.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:d,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,s)}}const cr={linearity:.3,easing:p.bezier(0,0,.3,1)},cf=p.extend({deceleration:2500,maxSpeed:1400},cr),Su=p.extend({deceleration:20,maxSpeed:1400},cr),Zs=p.extend({deceleration:1e3,maxSpeed:360},cr),Ar=p.extend({deceleration:1e3,maxSpeed:90},cr);class jd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,d=p.exported.now();for(;s.length>0&&d-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const x=Vc(d.pan.mag(),_,p.extend({},cf,s||{}));b.offset=d.pan.mult(x.amount/d.pan.mag()),b.center=this._map.transform.center,nl(b,x)}if(d.zoom){const x=Vc(d.zoom,_,Su);b.zoom=this._map.transform.zoom+x.amount,nl(b,x)}if(d.bearing){const x=Vc(d.bearing,_,Zs);b.bearing=this._map.transform.bearing+p.clamp(x.amount,-179,179),nl(b,x)}if(d.pitch){const x=Vc(d.pitch,_,Ar);b.pitch=this._map.transform.pitch+x.amount,nl(b,x)}if(b.zoom||b.bearing){const x=void 0===d.pinchAround?d.around:d.pinchAround;b.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),p.extend(b,{noMoveStart:!0})}}function nl(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function Vc(m,s,d){const{maxSpeed:_,linearity:b,deceleration:x}=d,E=p.clamp(m*b/(s/1e3),-_,_),I=Math.abs(E)/(x*b);return{easing:d.easing,duration:1e3*I,amount:E*(I/2)}}class wi extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,_,b={}){const x=je.mousePos(d.getCanvasContainer(),_),E=d.unproject(x);super(s,p.extend({point:x,lngLat:E,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class tc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,_){const b="touchend"===s?_.changedTouches:_.touches,x=je.touchPos(d.getCanvasContainer(),b),E=x.map(P=>d.unproject(P)),I=x.reduce((P,F,O,B)=>P.add(F.div(B.length)),new p.pointGeometry(0,0));super(s,{points:x,point:I,lngLats:E,lngLat:d.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class xa extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,_){super(s,{originalEvent:_}),this._defaultPrevented=!1}}class Lt{constructor(s,d){this._map=s,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new xa(s.type,this._map,s))}mousedown(s,d){return this._mousedownPos=d,this._firePreventable(new wi(s.type,this._map,s))}mouseup(s){this._map.fire(new wi(s.type,this._map,s))}preclick(s){const d=p.extend({},s);d.type="preclick",this._map.fire(new wi(d.type,this._map,d))}click(s,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(s),this._map.fire(new wi(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new wi(s.type,this._map,s))}mouseover(s){this._map.fire(new wi(s.type,this._map,s))}mouseout(s){this._map.fire(new wi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new tc(s.type,this._map,s))}touchmove(s){this._map.fire(new tc(s.type,this._map,s))}touchend(s){this._map.fire(new tc(s.type,this._map,s))}touchcancel(s){this._map.fire(new tc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pm{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(s){this._map.fire(new wi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new wi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uf{constructor(s,d){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,d){this.isEnabled()&&s.shiftKey&&0===s.button&&(je.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(s,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=je.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const x=Math.min(b.x,_.x),E=Math.max(b.x,_.x),I=Math.min(b.y,_.y),P=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(je.setTransform(this._box,`translate(${x}px,${I}px)`),this._box.style.width=E-x+"px",this._box.style.height=P-I+"px")})}mouseupWindow(s,d){if(!this._active||0!==s.button)return;const _=this._startPos,b=d;if(this.reset(),je.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(je.remove(this._box),this._box=null),je.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,d){return this._map.fire(new p.Event(s,{originalEvent:d}))}}function Au(m,s){const d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=s[_];return d}class df{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const x=new p.pointGeometry(0,0);for(const E of b)x._add(E);return x.div(b.length)}(d),this.touches=Au(_,d)))}touchmove(s,d,_){if(this.aborted||!this.centroid)return;const b=Au(_,d);for(const x in this.touches){const E=this.touches[x],I=b[x];(!I||I.dist(E)>30)&&(this.aborted=!0)}}touchend(s,d,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class zc{constructor(s){this.singleTap=new df(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,d,_){this.singleTap.touchstart(s,d,_)}touchmove(s,d,_){this.singleTap.touchmove(s,d,_)}touchend(s,d,_){const b=this.singleTap.touchend(s,d,_);if(b){const x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class _r{constructor(){this._zoomIn=new zc({numTouches:1,numTaps:2}),this._zoomOut=new zc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,d,_){this._zoomIn.touchstart(s,d,_),this._zoomOut.touchstart(s,d,_)}touchmove(s,d,_){this._zoomIn.touchmove(s,d,_),this._zoomOut.touchmove(s,d,_)}touchend(s,d,_){const b=this._zoomIn.touchend(s,d,_),x=this._zoomOut.touchend(s,d,_);return b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(b)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const mm={0:1,2:2};class He{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,d){return!1}_move(s,d){return{}}mousedown(s,d){if(this._lastPoint)return;const _=je.mouseButton(s);this._correctButton(s,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(s,d){const _=this._lastPoint;if(_)if(s.preventDefault(),function(b,x){const E=mm[x];return void 0===b.buttons||(b.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(s){this._lastPoint&&je.mouseButton(s)===this._eventButton&&(this._moved&&je.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gn extends He{mousedown(s,d){super.mousedown(s,d),this._lastPoint&&(this._active=!0)}_correctButton(s,d){return 0===d&&!s.ctrlKey}_move(s,d){return{around:d,panDelta:d.sub(s)}}}class rn extends He{_correctButton(s,d){return 0===d&&s.ctrlKey||2===d}_move(s,d){const _=.8*(d.x-s.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(s){s.preventDefault()}}class ti extends He{_correctButton(s,d){return 0===d&&s.ctrlKey||2===d}_move(s,d){const _=-.5*(d.y-s.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(s){s.preventDefault()}}class hf{constructor(s,d){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(s,d,_){return this._calculateTransform(s,d,_)}touchmove(s,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.preventDefault(),this._calculateTransform(s,d,_)}}touchend(s,d,_){this._calculateTransform(s,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,d,_){_.length>0&&(this._active=!0);const b=Au(_,d),x=new p.pointGeometry(0,0),E=new p.pointGeometry(0,0);let I=0;for(const F in b){const O=b[F],B=this._touches[F];B&&(x._add(O),E._add(O.sub(B)),I++,b[F]=O)}if(this._touches=b,I<this._minTouches||!E.mag())return;const P=E.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=je.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class il{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,d,_){return{}}touchstart(s,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(s,d,_){if(!this._firstTwoTouches)return;s.preventDefault();const[b,x]=this._firstTwoTouches,E=so(_,d,b),I=so(_,d,x);if(!E||!I)return;const P=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],P,s)}touchend(s,d,_){if(!this._firstTwoTouches)return;const[b,x]=this._firstTwoTouches,E=so(_,d,b),I=so(_,d,x);E&&I||(this._active&&je.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function so(m,s,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return s[_]}function ku(m,s){return Math.log(m/s)/Math.LN2}class Nu extends il{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,d){const _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ku(this._distance,_),pinchAround:d}}}function Uc(m,s){return 180*m.angleWith(s)/Math.PI}class Ds extends il{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,d){const _=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Uc(this._vector,_),pinchAround:d}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const d=25/(Math.PI*this._minDiameter)*360,_=Uc(s,this._startVector);return Math.abs(_)<d}}function rl(m){return Math.abs(m.y)>Math.abs(m.x)}class jc extends il{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(s){this._lastPoints=s,rl(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,d,_){const b=s[0].sub(this._lastPoints[0]),x=s[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&_.touches.length<3)&&(this._valid=this.gestureBeginsVertically(b,x,_.timeStamp),this._valid))return this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+x.y)/2*-.5}}gestureBeginsVertically(s,d,_){if(void 0!==this._valid)return this._valid;const b=s.mag()>=2,x=d.mag()>=2;if(!b&&!x)return;if(!b||!x)return void 0===this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const E=s.y>0==d.y>0;return rl(s)&&rl(d)&&E}}const qi={panStep:100,bearingStep:15,pitchStep:10};class st{constructor(){const s=qi;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let d=0,_=0,b=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?b=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?b=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:I=>{const P=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:$d,zoom:d?Math.round(P)+d*(s.shiftKey?2:1):P,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+b*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $d(m){return m*(2-m)}const wa=4.000244140625;class ao{constructor(s,d){this._map=s,this._el=s.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=s.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const _=p.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%wa==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),s.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=s,this._delta-=d,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=je.mousePos(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform,d=()=>s._terrainEnabled()?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>wa?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==F&&(F=1/F);const O=d(),B=Math.pow(2,O),H="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(H*F))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,x=this._easing;let E,I=!1;if("wheel"===this._type&&b&&x){const P=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),F=x(P);E=p.number(b,_,F),P<1?this._frameId||(this._frameId=!0):I=!0}else E=_,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:E-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let d=p.ease;if(this._prevEase){const _=this._prevEase,b=(p.exported.now()-_.start)/_.duration,x=_.easing(b+.01)-_.easing(b),E=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-E*E);d=p.bezier(E,I,.25,1)}return this._prevEase={start:p.exported.now(),duration:s,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=je.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!p.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class $c{constructor(s,d){this._clickZoom=s,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,d){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(s.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ff{constructor(){this._tap=new zc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,d,_){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(s,d,_))}touchmove(s,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=d[0],x=b.y-this._swipePoint.y;return this._swipePoint=b,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,d,_)}touchend(s,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(s,d,_)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pf{constructor(s,d,_){this._el=s,this._mousePan=d,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pu{constructor(s,d,_){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ru{constructor(s,d,_,b){this._el=s,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nc=m=>m.zoom||m.drag||m.pitch||m.rotate;class Fu extends p.Event{}class Ou{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,d){const _=p.sub([],d,s);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(s){p.div(s,s,this.constants),p.normalize(s,s),p.mul$2(s,s,this.constants);const d=p.scale([],s,this.radius);if(d[2]>0){const _=p.scale([],[0,0,1],p.dot(d,[0,0,1])),b=p.scale([],p.normalize([],[d[0],d[1],0]),this.radius),x=p.add([],d,p.scale([],p.sub([],p.add([],b,_),d),2));d[0]=x[0],d[1]=x[1]}return d}}function ol(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class sl{constructor(s,d){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jd(s),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ou,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[b,x,E]of this._listeners)je.addEventListener(b,x,b===p.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,d,_]of this._listeners)je.removeEventListener(s,d,s===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(s){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Lt(d,s));const b=d.boxZoom=new uf(d,s);this._add("boxZoom",b);const x=new _r,E=new Hd;d.doubleClickZoom=new $c(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const I=new ff;this._add("tapDragZoom",I);const P=d.touchPitch=new jc(d);this._add("touchPitch",P);const F=new rn(s),O=new ti(s);d.dragRotate=new Pu(s,F,O),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const B=new gn(s),H=new hf(d,s);d.dragPan=new pf(_,B,H),this._add("mousePan",B),this._add("touchPan",H,["touchZoom","touchRotate"]);const Y=new Ds,ee=new Nu;d.touchZoomRotate=new Ru(_,ee,Y,I),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new pm(d));const X=d.scrollZoom=new ao(d,this);this._add("scrollZoom",X,["mousePan"]);const ie=d.keyboard=new st;this._add("keyboard",ie);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[K]&&d[K].enable(s[K])}_add(s,d,_){this._handlers.push({handlerName:s,handler:d,allowed:_}),this._handlersById[s]=d}stop(s){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(nc(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,d,_){for(const b in s)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const d=[];for(const _ of s)this._el.contains(_.target)&&d.push(_);return d}handleEvent(s,d){this._updatingCamera=!0;const _="renderFrame"===s.type,b=_?void 0:s,x={needsRenderFrame:!1},E={},I={},P=s.touches?this._getMapTouches(s.touches):void 0,F=P?je.touchPos(this._el,P):_?void 0:je.mousePos(this._el,s);for(const{handlerName:H,handler:Y,allowed:ee}of this._handlers){if(!Y.isEnabled())continue;let X;this._blockedByActive(I,ee,H)?Y.reset():Y[d||s.type]&&(X=Y[d||s.type](s,F,P),this.mergeHandlerResult(x,E,X,H,b),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||Y.isActive())&&(I[H]=Y)}const O={};for(const H in this._previousActiveHandlers)I[H]||(O[H]=b);this._previousActiveHandlers=I,(Object.keys(O).length||ol(x))&&(this._changes.push([x,E,O]),this._triggerRenderFrame()),(Object.keys(I).length||ol(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=x;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,d,_,b,x){if(!_)return;p.extend(s,_);const E={handlerName:b,originalEvent:_.originalEvent||x};void 0!==_.zoomDelta&&(d.zoom=E),void 0!==_.panDelta&&(d.drag=E),void 0!==_.pitchDelta&&(d.pitch=E),void 0!==_.bearingDelta&&(d.rotate=E)}_applyChanges(){const s={},d={},_={};for(const[b,x,E]of this._changes)b.panDelta&&(s.panDelta=(s.panDelta||new p.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(s.around=b.around),void 0!==b.aroundCoord&&(s.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(s.pinchAround=b.pinchAround),b.noInertia&&(s.noInertia=b.noInertia),p.extend(d,x),p.extend(_,E);this._updateMapTransform(s,d,_),this._changes=[]}_updateMapTransform(s,d,_){const b=this._map,x=b.transform,E=ne=>[ne.x,ne.y,ne.z];if((ne=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!ol(s)){const ne=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ne!==x.zoom&&this._map._update(!0)}if(!ol(s))return this._fireEvents(d,_,!0);let{panDelta:I,zoomDelta:P,bearingDelta:F,pitchDelta:O,around:B,aroundCoord:H,pinchAround:Y}=s;void 0!==Y&&(B=Y),(ne=>d.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=E(x.pointCoordinate3D(B)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",b._stop(!0),B=B||b.transform.centerPoint,F&&(x.bearing+=F),O&&(x.pitch+=O),x._updateCameraState();const ee=[0,0,0];if(I){const ne=x.screenPointToMercatorRay(B),se=x.screenPointToMercatorRay(B.sub(I)),J=this._trackingEllipsoid.projectRay(ne.dir),le=this._trackingEllipsoid.projectRay(se.dir);ee[0]=le[0]-J[0],ee[1]=le[1]-J[1]}const X=x.zoom,ie=[0,0,0];if(P){const ne=E(H||x.pointCoordinate3D(B)),se={dir:p.normalize([],p.sub([],ne,x._camera.position))},J=x.screenPointToMercatorRay(x.centerPoint);if(se.dir[2]<0){const le=p.altitudeFromMercatorZ(ne[2],ne[1]),fe=x.rayIntersectionCoordinate(x.pointRayIntersection(x.centerPoint,le)),Se=x.zoomDeltaToMovement(E(fe),P)*(J.dir[2]/se.dir[2]);p.scale(ie,se.dir,Se)}else if(x._terrainEnabled()){const le=x.zoomDeltaToMovement(ne,P);p.scale(ie,se.dir,le)}}const K=p.add(ee,ee,ie);x._translateCameraConstrained(K),P&&Math.abs(x.zoom-X)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(d,_,!0)}_fireEvents(s,d,_){const b=nc(this._eventsInProgress),x=nc(s),E={};for(const O in s){const{originalEvent:B}=s[O];this._eventsInProgress[O]||(E[`${O}start`]=B),this._eventsInProgress[O]=s[O]}!b&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in E)this._fireEvent(O,E[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in s){const{originalEvent:B}=s[O];this._fireEvent(O,B)}const I={};let P;for(const O in this._eventsInProgress){const{handlerName:B,originalEvent:H}=this._eventsInProgress[O];this._handlersById[B].isActive()||(delete this._eventsInProgress[O],P=d[B]||H,I[`${O}end`]=P)}for(const O in I)this._fireEvent(O,I[O]);const F=nc(this._eventsInProgress);if(_&&(b||x)&&!F){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=H=>0!==H&&-this._bearingSnap<H&&H<this._bearingSnap;O?(B(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:P})):(this._map.fire(new p.Event("moveend",{originalEvent:P})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,d){this._map.fire(new p.Event(s,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Fu("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Lu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gd extends p.Evented{constructor(s,d){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=d.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,d){return this.jumpTo({center:s},d)}panBy(s,d,_){return s=p.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,p.extend({offset:s},d),_)}panTo(s,d,_){return this.easeTo(p.extend({center:s},d),_)}getZoom(){return this.transform.zoom}setZoom(s,d){return this.jumpTo({zoom:s},d),this}zoomTo(s,d,_){return this.easeTo(p.extend({zoom:s},d),_)}zoomIn(s,d){return this.zoomTo(this.getZoom()+1,s,d),this}zoomOut(s,d){return this.zoomTo(this.getZoom()-1,s,d),this}getBearing(){return this.transform.bearing}setBearing(s,d){return this.jumpTo({bearing:s},d),this}getPadding(){return this.transform.padding}setPadding(s,d){return this.jumpTo({padding:s},d),this}rotateTo(s,d,_){return this.easeTo(p.extend({bearing:s},d),_)}resetNorth(s,d){return this.rotateTo(0,p.extend({duration:1e3},s),d),this}resetNorthPitch(s,d){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},s),d),this}snapToNorth(s,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,d):this}getPitch(){return this.transform.pitch}setPitch(s,d){return this.jumpTo({pitch:s},d),this}cameraForBounds(s,d){s=p.LngLatBounds.convert(s);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),_,d)}_extendCameraOptions(s){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(s=p.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding){const _=s.padding;s.padding={top:_,bottom:_,right:_,left:_}}return s.padding=p.extend(d,s.padding),s}_cameraForBoxAndBearing(s,d,_,b){const x=this._extendCameraOptions(b),E=this.transform,I=E.padding,P=E.project(p.LngLat.convert(s)),F=E.project(p.LngLat.convert(d)),O=P.rotate(-p.degToRad(_)),B=F.rotate(-p.degToRad(_)),H=new p.pointGeometry(Math.max(O.x,B.x),Math.max(O.y,B.y)),Y=new p.pointGeometry(Math.min(O.x,B.x),Math.min(O.y,B.y)),ee=H.sub(Y),X=(E.width-(I.left+I.right+x.padding.left+x.padding.right))/ee.x,ie=(E.height-(I.top+I.bottom+x.padding.top+x.padding.bottom))/ee.y;if(ie<0||X<0)return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const K=Math.min(E.scaleZoom(E.scale*Math.min(X,ie)),x.maxZoom),ne="number"==typeof x.offset.x?new p.pointGeometry(x.offset.x,x.offset.y):p.pointGeometry.convert(x.offset),se=new p.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(_*Math.PI/180),J=ne.add(se).mult(E.scale/E.zoomScale(K));return{center:E.unproject(P.add(F).div(2).sub(J)),zoom:K,bearing:_}}_cameraForBox(s,d,_,b,x){const E=this._extendCameraOptions(x);_=_||0,b=b||0,s=p.LngLat.convert(s),d=p.LngLat.convert(d);const I=this.transform.clone();I.padding=E.padding;const P=this.getFreeCameraOptions(),F=new p.LngLat(.5*(s.lng+d.lng),.5*(s.lat+d.lat)),O=.5*(_+b);if(I._camera.position[2]<p.mercatorZfromAltitude(O,F.lat))return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(F),I.setFreeCameraOptions(P);const B=p.MercatorCoordinate.fromLngLat(s),H=p.MercatorCoordinate.fromLngLat(d),Y=I.pointRayIntersection(I.centerPoint,O),ee=[(X=I.rayIntersectionCoordinate(Y)).x,X.y,X.z];var X;const ie=I.screenPointToMercatorRay(I.centerPoint);let K,ne=0;do{const se=Math.floor(I.zoom),J=1<<se,le=Math.min(J*B.x,J*H.x),fe=Math.min(J*B.y,J*H.y),Se=Math.max(J*B.x,J*H.x),Me=Math.max(J*B.y,J*H.y),Ne=new Mo([le,fe,_],[Se,Me,b]),Re=To.fromInvProjectionMatrix(I.invProjMatrix,I.worldSize,se);if(2!==Ne.intersects(Re)){K&&(I._camera.position=p.scaleAndAdd([],I._camera.position,ie.dir,-K),I._updateStateFromCamera());break}const Ze=p.sub([],I._camera.position,ee);K=.5*p.length(Ze),I._camera.position=p.scaleAndAdd([],I._camera.position,ie.dir,K);try{I._updateStateFromCamera()}catch(Pe){return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch}}fitBounds(s,d,_){return this._fitInternal(this.cameraForBounds(s,d),d,_)}_raycastElevationBox(s,d){const _=this.transform.elevation;if(!_)return;const b=new p.pointGeometry(s.x,d.y),x=new p.pointGeometry(d.x,s.y),E=_.pointCoordinate(s);if(!E)return;const I=_.pointCoordinate(d);if(!I)return;const P=_.pointCoordinate(b);if(!P)return;const F=_.pointCoordinate(x);if(!F)return;const O=new p.MercatorCoordinate(E[0],E[1]).toLngLat(),B=new p.MercatorCoordinate(I[0],I[1]).toLngLat(),H=new p.MercatorCoordinate(P[0],P[1]).toLngLat(),Y=new p.MercatorCoordinate(F[0],F[1]).toLngLat(),ee=Math.min(O.lng,Math.min(B.lng,Math.min(H.lng,Y.lng))),X=Math.min(O.lat,Math.min(B.lat,Math.min(H.lat,Y.lat))),ie=Math.max(O.lng,Math.max(B.lng,Math.max(H.lng,Y.lng))),K=Math.max(O.lat,Math.max(B.lat,Math.max(H.lat,Y.lat))),ne=Math.min(E[3],Math.min(I[3],Math.min(P[3],F[3]))),se=Math.max(E[3],Math.max(I[3],Math.max(P[3],F[3])));return{minLngLat:new p.LngLat(ee,X),maxLngLat:new p.LngLat(ie,K),minAltitude:ne,maxAltitude:se}}fitScreenCoordinates(s,d,_,b,x){let E,I,P,F;const O=p.pointGeometry.convert(s),B=p.pointGeometry.convert(d),H=this._raycastElevationBox(O,B);if(H)E=H.minLngLat,I=H.maxLngLat,P=H.minAltitude,F=H.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,B))return this;E=this.transform.pointLocation(O),I=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(p.pointGeometry.convert(s)),this.transform.pointLocation(p.pointGeometry.convert(d)),_,b):this._cameraForBox(E,I,P,F,b),b,x)}_fitInternal(s,d,_){return s?(delete(d=p.extend(s,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(s,d){this.stop();const _=this.transform;let b=!1,x=!1,E=!1;return"zoom"in s&&_.zoom!==+s.zoom&&(b=!0,_.zoom=+s.zoom),void 0!==s.center&&(_.center=p.LngLat.convert(s.center)),"bearing"in s&&_.bearing!==+s.bearing&&(x=!0,_.bearing=+s.bearing),"pitch"in s&&_.pitch!==+s.pitch&&(E=!0,_.pitch=+s.pitch),null==s.padding||_.isPaddingEqual(s.padding)||(_.padding=s.padding),this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),b&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),x&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),E&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&p.warnOnce(Lu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,d){const _=this.transform;if("mercator"!==_.projection.name)return void p.warnOnce(Lu);this.stop();const b=_.zoom,x=_.pitch,E=_.bearing;_.setFreeCameraOptions(s);const I=b!==_.zoom,P=x!==_.pitch,F=E!==_.bearing;return this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),I&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),F&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),P&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)),this}easeTo(s,d){this._stop(!1,s.easeId),(!1===(s=p.extend({offset:[0,0],duration:500,easing:p.ease},s)).animate||!s.essential&&p.exported.prefersReducedMotion)&&(s.duration=0);const _=this.transform,b=this.getZoom(),x=this.getBearing(),E=this.getPitch(),I=this.getPadding(),P="zoom"in s?+s.zoom:b,F="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:_.padding,H=p.pointGeometry.convert(s.offset);let Y=_.centerPoint.add(H);const ee=_.pointLocation(Y),X=p.LngLat.convert(s.center||ee);this._normalizeCenter(X);const ie=_.project(ee),K=_.project(X).sub(ie),ne=_.zoomScale(P-b);let se,J;s.around&&(se=p.LngLat.convert(s.around),J=_.locationPoint(se));const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||P!==b,this._rotating=this._rotating||x!==F,this._pitching=this._pitching||O!==E,this._padding=!_.isPaddingEqual(B),this._easeId=s.easeId,this._prepareEase(d,s.noMoveStart,le),this._ease(fe=>{if(this._zooming&&(_.zoom=p.number(b,P,fe)),this._rotating&&(_.bearing=p.number(x,F,fe)),this._pitching&&(_.pitch=p.number(E,O,fe)),this._padding&&(_.interpolatePadding(I,B,fe),Y=_.centerPoint.add(H)),se)_.setLocationAtPoint(se,J);else{const Se=_.zoomScale(_.zoom-b),Me=P>b?Math.min(2,ne):Math.max(.5,ne),Ne=Math.pow(Me,1-fe),Re=_.unproject(ie.add(K.mult(fe*Ne)).mult(Se));_.setLocationAtPoint(_.renderWorldCopies?Re.wrap():Re,Y)}this._fireMoveEvents(d)},fe=>{_.recenterOnTerrain(),this._afterEase(d,fe)},s),this}_prepareEase(s,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new p.Event("movestart",s)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new p.Event("move",s)),this._zooming&&this.fire(new p.Event("zoom",s)),this._rotating&&this.fire(new p.Event("rotate",s)),this._pitching&&this.fire(new p.Event("pitch",s))}_afterEase(s,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",s)),b&&this.fire(new p.Event("rotateend",s)),x&&this.fire(new p.Event("pitchend",s)),this.fire(new p.Event("moveend",s))}flyTo(s,d){if(!s.essential&&p.exported.prefersReducedMotion){const Ke=p.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ke,d)}this.stop(),s=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},s);const _=this.transform,b=this.getZoom(),x=this.getBearing(),E=this.getPitch(),I=this.getPadding(),P="zoom"in s?p.clamp(+s.zoom,_.minZoom,_.maxZoom):b,F="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:_.padding,H=_.zoomScale(P-b),Y=p.pointGeometry.convert(s.offset);let ee=_.centerPoint.add(Y);const X=_.pointLocation(ee),ie=p.LngLat.convert(s.center||X);this._normalizeCenter(ie);const K=_.project(X),ne=_.project(ie).sub(K);let se=s.curve;const J=Math.max(_.width,_.height),le=J/H,fe=ne.mag();if("minZoom"in s){const Ke=p.clamp(Math.min(s.minZoom,b,P),_.minZoom,_.maxZoom),ft=J/_.zoomScale(Ke-b);se=Math.sqrt(ft/fe*2)}const Se=se*se;function Me(Ke){const ft=(le*le-J*J+(Ke?-1:1)*Se*Se*fe*fe)/(2*(Ke?le:J)*Se*fe);return Math.log(Math.sqrt(ft*ft+1)-ft)}function Ne(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function Re(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Ze=Me(0);let Pe=function(Ke){return Re(Ze)/Re(Ze+se*Ke)},Xe=function(Ke){return J*((Re(Ze)*(Ne(ft=Ze+se*Ke)/Re(ft))-Ne(Ze))/Se)/fe;var ft},Te=(Me(1)-Ze)/se;if(Math.abs(fe)<1e-6||!isFinite(Te)){if(Math.abs(J-le)<1e-6)return this.easeTo(s,d);const Ke=le<J?-1:1;Te=Math.abs(Math.log(le/J))/se,Xe=function(){return 0},Pe=function(ft){return Math.exp(Ke*se*ft)}}return s.duration="duration"in s?+s.duration:1e3*Te/("screenSpeed"in s?+s.screenSpeed/se:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=x!==F,this._pitching=O!==E,this._padding=!_.isPaddingEqual(B),this._prepareEase(d,!1),this._ease(Ke=>{const ft=Ke*Te,wt=1/Pe(ft);_.zoom=1===Ke?P:b+_.scaleZoom(wt),this._rotating&&(_.bearing=p.number(x,F,Ke)),this._pitching&&(_.pitch=p.number(E,O,Ke)),this._padding&&(_.interpolatePadding(I,B,Ke),ee=_.centerPoint.add(Y));const Dt=1===Ke?ie:_.unproject(K.add(ne.mult(Xe(ft))).mult(wt));_.setLocationAtPoint(_.renderWorldCopies?Dt.wrap():Dt,ee),_._updateCenterElevation(),this._fireMoveEvents(d)},()=>this._afterEase(d),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,d)}if(!s){const _=this.handlers;_&&_.stop(!1)}return this}_ease(s,d,_){!1===_.animate||0===_.duration?(s(1),d()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,d){s=p.wrap(s,-180,180);const _=Math.abs(s-d);return Math.abs(s-360-d)<_&&(s-=360),Math.abs(s+360-d)<_&&(s+=360),s}_normalizeCenter(s){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=s.lng-d.center.lng;s.lng+=_>180?-360:_<-180?360:0}}class Bu{constructor(s={}){this.options=s,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const d=this.options&&this.options.compact;return this._map=s,this._container=je.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=je.create("button","mapboxgl-ctrl-attrib-button",this._container),je.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=je.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){je.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,d){const _=this._map._getUIString(`AttributionControl.${d}`);s.setAttribute("aria-label",_),s.firstElementChild&&s.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(s){const _=d.reduce((b,x,E)=>(x.value&&(b+=`${x.key}=${x.value}${E<d.length-1?"&":""}`),b),"?");s.href=`${p.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(b=>"string"!=typeof b?"":b)):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const x=d[b];if(x.used){const E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((b,x)=>b.length-x.length),s=s.filter((b,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(b)>=0)return!1;return!0});const _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vu{constructor(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)}onAdd(s){this._map=s,this._container=je.create("div","mapboxgl-ctrl");const d=je.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){je.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const d in s){const _=s[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const d=s[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class ic{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const d=++this._id;return this._queue.push({callback:s,id:d,cancelled:!1}),d}remove(s){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const b of _)if(b.id===s)return void(b.cancelled=!0)}run(s=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function qd(m,s,d){if(m=new p.LngLat(m.lng,m.lat),s){const _=new p.LngLat(m.lng-360,m.lat),b=new p.LngLat(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),E=d.locationPoint(m).distSqr(s),I=s.x<0||s.y<0||s.x>d.width||s.y>d.height;d.locationPoint(_).distSqr(s)<E&&(I||Math.abs(_.lng-d.center.lng)<x)?m=_:d.locationPoint(b).distSqr(s)<E&&(I||Math.abs(b.lng-d.center.lng)<x)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const zu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Wi extends p.Evented{constructor(s,d){if(super(),(s instanceof p.window.HTMLElement||d)&&(s=p.extend({element:s},d)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&"auto"!==s.pitchAlignment?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=p.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=je.create("div"),this._element.setAttribute("aria-label","Map marker");const b=je.createNS("http://www.w3.org/2000/svg","svg"),x=41,E=27;b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height",`${x}px`),b.setAttributeNS(null,"width",`${E}px`),b.setAttributeNS(null,"viewBox",`0 0 ${E} ${x}`);const I=je.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");const P=je.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const F=je.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of O){const J=je.createNS("http://www.w3.org/2000/svg","ellipse");J.setAttributeNS(null,"opacity","0.04"),J.setAttributeNS(null,"cx","10.5"),J.setAttributeNS(null,"cy","5.80029008"),J.setAttributeNS(null,"rx",se.rx),J.setAttributeNS(null,"ry",se.ry),F.appendChild(J)}const B=je.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const H=je.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(H);const Y=je.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");const ee=je.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(ee);const X=je.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const ie=je.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=je.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const ne=je.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#FFFFFF"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962"),ie.appendChild(K),ie.appendChild(ne),P.appendChild(F),P.appendChild(B),P.appendChild(Y),P.appendChild(X),P.appendChild(ie),b.appendChild(P),b.setAttributeNS(null,"height",x*this._scale+"px"),b.setAttributeNS(null,"width",E*this._scale+"px"),this._element.appendChild(b),this._offset=p.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in zu)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),je.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=p.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const d=38.1,_=13.5,b=Math.sqrt(Math.pow(_,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-d],"bottom-left":[b,-1*(d-_+b)],"bottom-right":[-b,-1*(d-_+b)],left:[_,-1*(d-_)],right:[-_,-1*(d-_)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const d=s.code,_=s.charCode||s.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(s){const d=s.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const s=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(s))return void this._clearFadeTimer();const d=this._map.unproject(s);let _=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const E=x.position.toLngLat();_=E.distanceTo(d)<.9*E.distanceTo(this._lngLat)}}const b=(1-this._map._queryFogOpacity(d))*(_?.2:1);this._element.style.opacity=`${b}`,this._popup&&this._popup._setOpacity(`${b}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(s){const d=this._map.transform;return!!s&&s.x>=0&&s.x<d.width&&s.y>=0&&s.y<d.height}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=qd(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let d="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?d=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?_="rotateX(0deg)":"map"===this._pitchAlignment&&(_=`rotateX(${this._map.getPitch()}deg)`),s&&"moveend"!==s.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&je.setTransform(this._element,`${zu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const s=this._map.transform,d=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&d._rotate(s.angle),"map"===this._pitchAlignment&&(d.y*=Math.cos(s._pitch)),d}getOffset(){return this._offset}setOffset(s){return this._offset=p.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&"auto"!==s?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Xs{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const d=p.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,d,_){this._start=this.getValue(d),this._end=s,this._startTime=d,this._endTime=d+_}}const ci={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Ys,HTMLElement:mf,ImageBitmap:Lo}=p.window,gf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Hc(m){m.parentNode&&m.parentNode.removeChild(m)}const _f={showCompass:!0,showZoom:!0,visualizePitch:!1};class rc{constructor(s,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new rn({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,_&&(this.mousePitch=new ti({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),je.addEventListener(d,"mousedown",this.mousedown),je.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),je.addEventListener(d,"touchmove",this.touchmove),je.addEventListener(d,"touchend",this.touchend),je.addEventListener(d,"touchcancel",this.reset)}down(s,d){this.mouseRotate.mousedown(s,d),this.mousePitch&&this.mousePitch.mousedown(s,d),je.disableDrag()}move(s,d){const _=this.map,b=this.mouseRotate.mousemoveWindow(s,d);if(b&&b.bearingDelta&&_.setBearing(_.getBearing()+b.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(s,d);x&&x.pitchDelta&&_.setPitch(_.getPitch()+x.pitchDelta)}}off(){const s=this.element;je.removeEventListener(s,"mousedown",this.mousedown),je.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),je.removeEventListener(s,"touchmove",this.touchmove),je.removeEventListener(s,"touchend",this.touchend),je.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){je.enableDrag(),je.removeEventListener(p.window,"mousemove",this.mousemove),je.removeEventListener(p.window,"mouseup",this.mouseup)}mousedown(s){this.down(p.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),je.mousePos(this.element,s)),je.addEventListener(p.window,"mousemove",this.mousemove),je.addEventListener(p.window,"mouseup",this.mouseup)}mousemove(s){this.move(s,je.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=je.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=je.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let rs,sc=0,ac=!1;const Wd={maxWidth:100,unit:"metric"};function Es(m,s,d){const _=d&&d.maxWidth||100,b=m._container.getBoundingClientRect().height/2,x=m.unproject([0,b]),E=m.unproject([_,b]),I=x.distanceTo(E);if(d&&"imperial"===d.unit){const P=3.2808*I;P>5280?Ts(s,_,P/5280,m._getUIString("ScaleControl.Miles"),m):Ts(s,_,P,m._getUIString("ScaleControl.Feet"),m)}else d&&"nautical"===d.unit?Ts(s,_,I/1852,m._getUIString("ScaleControl.NauticalMiles"),m):I>=1e3?Ts(s,_,I/1e3,m._getUIString("ScaleControl.Kilometers"),m):Ts(s,_,I,m._getUIString("ScaleControl.Meters"),m)}function Ts(m,s,d,_,b){const x=function(I){const P=Math.pow(10,`${Math.floor(I)}`.length-1);let F=I/P;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(O){const B=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*B)/B}(F),P*F}(d),E=x/d;b._requestDomTask(()=>{m.style.width=s*E+"px",m.innerHTML=`${x}&nbsp;${_}`})}const gm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_m=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ms={version:p.version,supported:$r,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Gd{constructor(m){if(null!=(m=p.extend({},gf,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ud(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new ic,this._domRenderTaskQueue=new ic,this._controls=[],this._markers=[],this._mapId=p.uniqueId(),this._locale=p.extend({},ci,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Xs(0),this._requestManager=new p.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=p.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof mf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new sl(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new tl("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,p.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Bu({customAttribution:m.customAttribution})),this._logoControl=new Vu,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update("style"===s.dataType),this.fire(new p.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new p.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(m,s){if(void 0===s&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[s];return-1!==s.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){const[s,d]=this._containerDimensions();if(s===this.transform.width&&d===this.transform.height)return this;this._resizeCanvas(s,d),this.transform.resize(s,d),this.painter.resize(Math.ceil(s),Math.ceil(d));const _=!this._moving;return _&&this.fire(new p.Event("movestart",m)).fire(new p.Event("move",m)),this.fire(new p.Event("resize",m)),_&&this.fire(new p.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(p.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=null==m?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null==m?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null==m?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null==m?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this.transform.getProjection()}setProjection(m){this._lazyInitEmptyStyle(),"string"==typeof m&&(m={name:m}),this._runtimeProjection=m,this.style.updateProjection()}project(m){return this.transform.locationPoint3D(p.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(p.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(m,s,d){if("mouseenter"===m||"mouseover"===m){let _=!1;const b=E=>{const I=s.filter(F=>this.getLayer(F)),P=I.length?this.queryRenderedFeatures(E.point,{layers:I}):[];P.length?_||(_=!0,d.call(this,new wi(m,this,E.originalEvent,{features:P}))):_=!1},x=()=>{_=!1};return{layers:new Set(s),listener:d,delegates:{mousemove:b,mouseout:x}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const b=E=>{const I=s.filter(P=>this.getLayer(P));(I.length?this.queryRenderedFeatures(E.point,{layers:I}):[]).length?_=!0:_&&(_=!1,d.call(this,new wi(m,this,E.originalEvent)))},x=E=>{_&&(_=!1,d.call(this,new wi(m,this,E.originalEvent)))};return{layers:new Set(s),listener:d,delegates:{mousemove:b,mouseout:x}}}{const _=b=>{const x=s.filter(I=>this.getLayer(I)),E=x.length?this.queryRenderedFeatures(b.point,{layers:x}):[];E.length&&(b.features=E,d.call(this,b),delete b.features)};return{layers:new Set(s),listener:d,delegates:{[m]:_}}}}on(m,s,d){if(void 0===d)return super.on(m,s);Array.isArray(s)||(s=[s]);const _=this._createDelegatedListener(m,s,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,s,d){if(void 0===d)return super.once(m,s);Array.isArray(s)||(s=[s]);const _=this._createDelegatedListener(m,s,d);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,s,d){if(void 0===d)return super.off(m,s);s=new Set(Array.isArray(s)?s:[s]);const _=(x,E)=>{if(x.size!==E.size)return!1;for(const I of x)if(!E.has(I))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(x=>{for(let E=0;E<x.length;E++){const I=x[E];if(I.listener===d&&_(I.layers,s)){for(const P in I.delegates)this.off(P,I.delegates[P]);return x.splice(E,1),this}}})(b),this}queryRenderedFeatures(m,s){return this.style?(void 0!==s||void 0===m||m instanceof p.pointGeometry||Array.isArray(m)||(s=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}queryTerrainElevation(m,s){const d=this.transform.elevation;return d?(s=p.extend({},{exaggerated:!0},s),d.getAtPoint(p.MercatorCoordinate.fromLngLat(m),null,s.exaggerated)):null}setStyle(m,s){return!1!==(s=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(null==s)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),m&&(this.style=new no(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new no(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if("string"==typeof m){const d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,p.ResourceType.Style);p.getJSON(_,(b,x)=>{b?this.fire(new p.ErrorEvent(b)):x&&this._updateDiff(x,s)})}else"object"==typeof m&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m)&&this._update(!0)}catch(d){p.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style._getSourceCaches(m);if(0!==s.length)return s.every(d=>d.loaded());this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const s in m){const d=m[s]._tiles;for(const _ in d){const b=d[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(m,s,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof Ys||Lo&&s instanceof Lo){const{width:I,height:P,data:F}=p.exported.getImageData(s);this.style.addImage(m,{data:new p.RGBAImage({width:I,height:P},F),pixelRatio:d,stretchX:b,stretchY:x,content:E,sdf:_,version:0})}else{if(void 0===s.width||void 0===s.height)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:P,data:F}=s,O=s;this.style.addImage(m,{data:new p.RGBAImage({width:I,height:P},new Uint8Array(F)),pixelRatio:d,stretchX:b,stretchY:x,content:E,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}}updateImage(m,s){const d=this.style.getImage(m);if(!d)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=s instanceof Ys||Lo&&s instanceof Lo?p.exported.getImageData(s):s,{width:b,height:x,data:E}=_;return void 0===b||void 0===x?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):b!==d.data.width||x!==d.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(d.data.replace(E,!(s instanceof Ys||Lo&&s instanceof Lo)),void this.style.updateImage(m,d))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){p.getImage(this._requestManager.transformRequest(m,p.ResourceType.Image),(d,_)=>{s(d,_ instanceof Ys?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,s,d){return this.style.setLayerZoomRange(m,s,d),this._update(!0)}setFilter(m,s,d={}){return this.style.setFilter(m,s,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,d,_={}){return this.style.setPaintProperty(m,s,d,_),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,d,_={}){return this.style.setLayoutProperty(m,s,d,_),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(m),this.transform):0}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300),[m,s]}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=je.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=je.create("div","mapboxgl-canvas-container",m);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=je.create("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions();this._resizeCanvas(d[0],d[1]);const _=this._controlContainer=je.create("div","mapboxgl-control-container",m),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{b[x]=je.create("div",`mapboxgl-ctrl-${x}`,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const d=p.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);-1!==s&&this._markers.splice(s,1)}_setupPainter(){const m=p.extend({},$r.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);s?(p.storeAuthState(s,!0),this.painter=new Bd(s,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(s)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;const d=this.painter.context.extTimerQuery,_=p.exported.now();this.listens("gpu-timing-frame")&&(s=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,s));let b=this._updateAverageElevation(_);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;let x=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,F=this.transform.pitch,O=p.exported.now();this.style.zoomHistory.update(P,O);const B=new p.EvaluationParameters(P,{now:O,fadeDuration:E,pitch:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=B.crossFadingFactor();1===H&&H===this._crossFadingFactor||(x=!0,this._crossFadingFactor=H),this.style.update(B)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=p.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,s),setTimeout(()=>{const F=d.getQueryObjectEXT(s,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(s),this.fire(new p.Event("gpu-timing-frame",{cpuTime:P,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(P);this.fire(new p.Event("gpu-timing-layer",{layerTimes:F}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(I||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(b=this._updateAverageElevation(_,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,s=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const x=Math.abs(_-b);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,m,300)}else if(x>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===p.AUTH_ERR_MSG||401===m.status)){const s=this.painter.context.gl;p.storeAuthState(s,!1),this._logoControl instanceof Vu&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function b(x){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,x,0);const E=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,E),E}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),s.canvasCopies.map(b),s.timeStamps)}_canvasPixelComparison(m,s,d){let _=d[1]-d[0];const b=m.length/4;for(let x=0;x<s.length;x++){const E=s[x];let I=0;for(let P=0;P<E.length;P+=4)E[P]===m[P]&&E[P+1]===m[P+1]&&E[P+2]===m[P+2]&&E[P+3]===m[P+3]&&(I+=1);_+=(d[x+2]-d[x+1])*(1-I/b)}return _}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),Hc(this._canvasContainer),Hc(this._controlContainer),Hc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=p.exported.frame(s=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(s)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,s){p.setCacheLimits(m,s)}get version(){return p.version}},NavigationControl:class{constructor(m){this.options=p.extend({},_f,m),this._container=je.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),je.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),je.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=je.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const m=this._map.getZoom(),s=m===this._map.getMaxZoom(),d=m===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=m)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){je.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const d=je.create("button",m,this._container);return d.type="button",d.addEventListener("click",s),d}_setButtonTitle(m,s){const d=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends p.Evented{constructor(m){super(),this.options=p.extend({},oc,m),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=lf(this._updateMarkerRotation,20)}onAdd(m){var s;return this._map=m,this._container=je.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,void 0!==rs?s(rs):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(d=>{rs="denied"!==d.state,s(rs)}):(rs=!!p.window.navigator.geolocation,s(rs)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),je.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,sc=0,ac=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),d=m.coords;return s&&(d.longitude<s.getWest()||d.longitude>s.getEast()||d.latitude<s.getSouth()||d.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",m)),this._finish()}}_updateCamera(m){const s=new p.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),b=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new p.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.getBoundingClientRect().height/2,s=this._map.unproject([0,m]),d=this._map.unproject([100,m]),_=s.distanceTo(d)/100,b=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&ac)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=je.create("button","mapboxgl-ctrl-geolocate",this._container),je.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===m){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=je.create("div","mapboxgl-user-location"),this._dotElement.appendChild(je.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(je.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=je.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":sc--,ac=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),sc++,sc>1?(m={maximumAge:6e5,timeout:0},ac=!0):(m=this.options.positionOptions,ac=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&m()}).catch(console.error):m()}_clearWatch(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bu,ScaleControl:class{constructor(m){this.options=p.extend({},Wd,m),p.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Es(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=je.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){je.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Es(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof p.window.HTMLElement?this._container=m.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=je.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){je.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=je.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);je.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(m){super(),this.options=p.extend(Object.create(gm),m),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&je.remove(this._content),this._container&&(je.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=p.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(p.window.document.createTextNode(m))}setHTML(m){const s=p.window.document.createDocumentFragment(),d=p.window.document.createElement("body");let _;for(d.innerHTML=m;_=d.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=je.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._container&&this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._container&&this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._container&&this._updateClassList(),s}_createCloseButton(){this.options.closeButton&&(this._closeButton=je.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._pos,d=this._container.offsetWidth,_=this._container.offsetHeight;let b;return b=s.y+m.bottom.y<_?["top"]:s.y>this._map.transform.height-_?["bottom"]:[],s.x<d/2?b.push("left"):s.x>this._map.transform.width-d/2&&b.push("right"),0===b.length?"bottom":b.join("-")}_updateClassList(){const m=[...this._classList];m.push("mapboxgl-popup"),this._anchor&&m.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&m.push("mapboxgl-popup-track-pointer"),this._container.className=m.join(" ")}_update(m){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=je.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=je.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qd(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||m){const s=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat),d=function(x){if(x||(x=new p.pointGeometry(0,0)),"number"==typeof x){const E=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new p.pointGeometry(0,0),top:new p.pointGeometry(0,x),"top-left":new p.pointGeometry(E,E),"top-right":new p.pointGeometry(-E,E),bottom:new p.pointGeometry(0,-x),"bottom-left":new p.pointGeometry(E,-E),"bottom-right":new p.pointGeometry(-E,-E),left:new p.pointGeometry(x,0),right:new p.pointGeometry(-x,0)}}if(x instanceof p.pointGeometry||Array.isArray(x)){const E=p.pointGeometry.convert(x);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:p.pointGeometry.convert(x.center||[0,0]),top:p.pointGeometry.convert(x.top||[0,0]),"top-left":p.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":p.pointGeometry.convert(x["top-right"]||[0,0]),bottom:p.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":p.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":p.pointGeometry.convert(x["bottom-right"]||[0,0]),left:p.pointGeometry.convert(x.left||[0,0]),right:p.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),_=this._anchor=this._getAnchor(d),b=s.add(d[_]).round();this._map._requestDomTask(()=>{this._container&&_&&je.setTransform(this._container,`${zu[_]} translate(${b.x}px,${b.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(_m);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:Wi,Style:no,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:Vd,Evented:p.Evented,config:p.config,prewarm:function(){Qe().acquire(pe)},clearPrewarmedResources:function(){const m=Ve;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(pe),Ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(m){p.config.ACCESS_TOKEN=m},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(m){p.config.API_URL=m},get workerCount(){return Ce.workerCount},set workerCount(m){Ce.workerCount=m},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){p.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){p.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Ms}),gs}()},755:(Yo,_i,Li)=>{"use strict";function gs(t){return"function"==typeof t}let Td=!1;const Us={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const n=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+n.stack)}else Td&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Td=t},get useDeprecatedSynchronousErrorHandling(){return Td}};function p(t){setTimeout(()=>{throw t},0)}const $r={closed:!0,next(t){},error(t){if(Us.useDeprecatedSynchronousErrorHandling)throw t;p(t)},complete(){}},Cr=Array.isArray||(t=>t&&"number"==typeof t.length);function Dr(t){return null!==t&&"object"==typeof t}const je=(()=>{function t(n){return Error.call(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((e,i)=>`${i+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n,this}return t.prototype=Object.create(Error.prototype),t})();class ut{constructor(n){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,n&&(this._ctorUnsubscribe=!0,this._unsubscribe=n)}unsubscribe(){let n;if(this.closed)return;let{_parentOrParents:e,_ctorUnsubscribe:i,_unsubscribe:o,_subscriptions:c}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof ut)e.remove(this);else if(null!==e)for(let f=0;f<e.length;++f)e[f].remove(this);if(gs(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(f){n=f instanceof je?Ko(f.errors):[f]}}if(Cr(c)){let f=-1,y=c.length;for(;++f<y;){const C=c[f];if(Dr(C))try{C.unsubscribe()}catch(M){n=n||[],M instanceof je?n=n.concat(Ko(M.errors)):n.push(M)}}}if(n)throw new je(n)}add(n){let e=n;if(!n)return ut.EMPTY;switch(typeof n){case"function":e=new ut(n);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof ut)){const c=e;e=new ut,e._subscriptions=[c]}break;default:throw new Error("unrecognized teardown "+n+" added to Subscription.")}let{_parentOrParents:i}=e;if(null===i)e._parentOrParents=this;else if(i instanceof ut){if(i===this)return e;e._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return e;i.push(this)}const o=this._subscriptions;return null===o?this._subscriptions=[e]:o.push(e),e}remove(n){const e=this._subscriptions;if(e){const i=e.indexOf(n);-1!==i&&e.splice(i,1)}}}var t;function Ko(t){return t.reduce((n,e)=>n.concat(e instanceof je?e.errors:e),[])}ut.EMPTY=((t=new ut).closed=!0,t);const aa="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Mt extends ut{constructor(n,e,i){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=$r;break;case 1:if(!n){this.destination=$r;break}if("object"==typeof n){n instanceof Mt?(this.syncErrorThrowable=n.syncErrorThrowable,this.destination=n,n.add(this)):(this.syncErrorThrowable=!0,this.destination=new Er(this,n));break}default:this.syncErrorThrowable=!0,this.destination=new Er(this,n,e,i)}}[aa](){return this}static create(n,e,i){const o=new Mt(n,e,i);return o.syncErrorThrowable=!1,o}next(n){this.isStopped||this._next(n)}error(n){this.isStopped||(this.isStopped=!0,this._error(n))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(n){this.destination.next(n)}_error(n){this.destination.error(n),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:n}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=n,this}}class Er extends Mt{constructor(n,e,i,o){super(),this._parentSubscriber=n;let c,f=this;gs(e)?c=e:e&&(c=e.next,i=e.error,o=e.complete,e!==$r&&(f=Object.create(e),gs(f.unsubscribe)&&this.add(f.unsubscribe.bind(f)),f.unsubscribe=this.unsubscribe.bind(this))),this._context=f,this._next=c,this._error=i,this._complete=o}next(n){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;Us.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,n)&&this.unsubscribe():this.__tryOrUnsub(this._next,n)}}error(n){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:i}=Us;if(this._error)i&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,n),this.unsubscribe()):(this.__tryOrUnsub(this._error,n),this.unsubscribe());else if(e.syncErrorThrowable)i?(e.syncErrorValue=n,e.syncErrorThrown=!0):p(n),this.unsubscribe();else{if(this.unsubscribe(),i)throw n;p(n)}}}complete(){if(!this.isStopped){const{_parentSubscriber:n}=this;if(this._complete){const e=()=>this._complete.call(this._context);Us.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?(this.__tryOrSetError(n,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(n,e){try{n.call(this._context,e)}catch(i){if(this.unsubscribe(),Us.useDeprecatedSynchronousErrorHandling)throw i;p(i)}}__tryOrSetError(n,e,i){if(!Us.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,i)}catch(o){return Us.useDeprecatedSynchronousErrorHandling?(n.syncErrorValue=o,n.syncErrorThrown=!0,!0):(p(o),!0)}return!1}_unsubscribe(){const{_parentSubscriber:n}=this;this._context=null,this._parentSubscriber=null,n.unsubscribe()}}const To="function"==typeof Symbol&&Symbol.observable||"@@observable";function Mo(t){return t}let dn=(()=>{class t{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(e){const i=new t;return i.source=this,i.operator=e,i}subscribe(e,i,o){const{operator:c}=this,f=function(t,n,e){if(t){if(t instanceof Mt)return t;if(t[aa])return t[aa]()}return t||n||e?new Mt(t,n,e):new Mt($r)}(e,i,o);if(f.add(c?c.call(f,this.source):this.source||Us.useDeprecatedSynchronousErrorHandling&&!f.syncErrorThrowable?this._subscribe(f):this._trySubscribe(f)),Us.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable&&(f.syncErrorThrowable=!1,f.syncErrorThrown))throw f.syncErrorValue;return f}_trySubscribe(e){try{return this._subscribe(e)}catch(i){Us.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=i),function(t){for(;t;){const{closed:n,destination:e,isStopped:i}=t;if(n||i)return!1;t=e&&e instanceof Mt?e:null}return!0}(e)?e.error(i):console.warn(i)}}forEach(e,i){return new(i=La(i))((o,c)=>{let f;f=this.subscribe(y=>{try{e(y)}catch(C){c(C),f&&f.unsubscribe()}},c,o)})}_subscribe(e){const{source:i}=this;return i&&i.subscribe(e)}[To](){return this}pipe(...e){return 0===e.length?this:function(t){return 0===t.length?Mo:1===t.length?t[0]:function(e){return t.reduce((i,o)=>o(i),e)}}(e)(this)}toPromise(e){return new(e=La(e))((i,o)=>{let c;this.subscribe(f=>c=f,f=>o(f),()=>i(c))})}}return t.create=n=>new t(n),t})();function La(t){if(t||(t=Us.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const ca=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class Ba extends ut{constructor(n,e){super(),this.subject=n,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const n=this.subject,e=n.observers;if(this.subject=null,!e||0===e.length||n.isStopped||n.closed)return;const i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}class Ll extends Mt{constructor(n){super(n),this.destination=n}}let Rn=(()=>{class t extends dn{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[aa](){return new Ll(this)}lift(e){const i=new Bl(this,this);return i.operator=e,i}next(e){if(this.closed)throw new ca;if(!this.isStopped){const{observers:i}=this,o=i.length,c=i.slice();for(let f=0;f<o;f++)c[f].next(e)}}error(e){if(this.closed)throw new ca;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:i}=this,o=i.length,c=i.slice();for(let f=0;f<o;f++)c[f].error(e);this.observers.length=0}complete(){if(this.closed)throw new ca;this.isStopped=!0;const{observers:e}=this,i=e.length,o=e.slice();for(let c=0;c<i;c++)o[c].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new ca;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new ca;return this.hasError?(e.error(this.thrownError),ut.EMPTY):this.isStopped?(e.complete(),ut.EMPTY):(this.observers.push(e),new Ba(this,e))}asObservable(){const e=new dn;return e.source=this,e}}return t.create=(n,e)=>new Bl(n,e),t})();class Bl extends Rn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){const{destination:e}=this;e&&e.next&&e.next(n)}error(n){const{destination:e}=this;e&&e.error&&this.destination.error(n)}complete(){const{destination:n}=this;n&&n.complete&&this.destination.complete()}_subscribe(n){const{source:e}=this;return e?this.source.subscribe(n):ut.EMPTY}}function Io(t){return t&&"function"==typeof t.schedule}function Ut(t,n){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new js(t,n))}}class js{constructor(n,e){this.project=n,this.thisArg=e}call(n,e){return e.subscribe(new _s(n,this.project,this.thisArg))}}class _s extends Mt{constructor(n,e,i){super(n),this.project=e,this.count=0,this.thisArg=i||this}_next(n){let e;try{e=this.project.call(this.thisArg,n,this.count++)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}const Bi=t=>n=>{for(let e=0,i=t.length;e<i&&!n.closed;e++)n.next(t[e]);n.complete()},Vi="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",za=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function sn(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const ua=t=>{if(t&&"function"==typeof t[To])return(t=>n=>{const e=t[To]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(n)})(t);if(za(t))return Bi(t);if(sn(t))return(t=>n=>(t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,p),n))(t);if(t&&"function"==typeof t[Vi])return(t=>n=>{const e=t[Vi]();for(;;){let i;try{i=e.next()}catch(o){return n.error(o),n}if(i.done){n.complete();break}if(n.next(i.value),n.closed)break}return"function"==typeof e.return&&n.add(()=>{e.return&&e.return()}),n})(t);{const e=`You provided ${Dr(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(e)}};function $s(t,n){return new dn(e=>{const i=new ut;let o=0;return i.add(n.schedule(function(){o!==t.length?(e.next(t[o++]),e.closed||i.add(this.schedule())):e.complete()})),i})}function oi(t,n){return n?function(t,n){if(null!=t){if(function(t){return t&&"function"==typeof t[To]}(t))return function(t,n){return new dn(e=>{const i=new ut;return i.add(n.schedule(()=>{const o=t[To]();i.add(o.subscribe({next(c){i.add(n.schedule(()=>e.next(c)))},error(c){i.add(n.schedule(()=>e.error(c)))},complete(){i.add(n.schedule(()=>e.complete()))}}))})),i})}(t,n);if(sn(t))return function(t,n){return new dn(e=>{const i=new ut;return i.add(n.schedule(()=>t.then(o=>{i.add(n.schedule(()=>{e.next(o),i.add(n.schedule(()=>e.complete()))}))},o=>{i.add(n.schedule(()=>e.error(o)))}))),i})}(t,n);if(za(t))return $s(t,n);if(function(t){return t&&"function"==typeof t[Vi]}(t)||"string"==typeof t)return function(t,n){if(!t)throw new Error("Iterable cannot be null");return new dn(e=>{const i=new ut;let o;return i.add(()=>{o&&"function"==typeof o.return&&o.return()}),i.add(n.schedule(()=>{o=t[Vi](),i.add(n.schedule(function(){if(e.closed)return;let c,f;try{const y=o.next();c=y.value,f=y.done}catch(y){return void e.error(y)}f?e.complete():(e.next(c),this.schedule())}))})),i})}(t,n)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,n):t instanceof dn?t:new dn(ua(t))}class Hr extends Mt{constructor(n){super(),this.parent=n}_next(n){this.parent.notifyNext(n)}_error(n){this.parent.notifyError(n),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class So extends Mt{notifyNext(n){this.destination.next(n)}notifyError(n){this.destination.error(n)}notifyComplete(){this.destination.complete()}}function ys(t,n){if(n.closed)return;if(t instanceof dn)return t.subscribe(n);let e;try{e=ua(t)(n)}catch(i){n.error(i)}return e}function ai(t,n,e=Number.POSITIVE_INFINITY){return"function"==typeof n?i=>i.pipe(ai((o,c)=>oi(t(o,c)).pipe(Ut((f,y)=>n(o,f,c,y))),e)):("number"==typeof n&&(e=n),i=>i.lift(new Ao(t,e)))}class Ao{constructor(n,e=Number.POSITIVE_INFINITY){this.project=n,this.concurrent=e}call(n,e){return e.subscribe(new da(n,this.project,this.concurrent))}}class da extends So{constructor(n,e,i=Number.POSITIVE_INFINITY){super(n),this.project=e,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(n){this.active<this.concurrent?this._tryNext(n):this.buffer.push(n)}_tryNext(n){let e;const i=this.index++;try{e=this.project(n,i)}catch(o){return void this.destination.error(o)}this.active++,this._innerSub(e)}_innerSub(n){const e=new Hr(this),i=this.destination;i.add(e);const o=ys(n,e);o!==e&&i.add(o)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(n){this.destination.next(n)}notifyComplete(){const n=this.buffer;this.active--,n.length>0?this._next(n.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function fr(t=Number.POSITIVE_INFINITY){return ai(Mo,t)}function zi(t,n){return n?$s(t,n):new dn(Bi(t))}function ha(){return function(n){return n.lift(new Ec(n))}}class Ec{constructor(n){this.connectable=n}call(n,e){const{connectable:i}=this;i._refCount++;const o=new Tc(n,i),c=e.subscribe(o);return o.closed||(o.connection=i.connect()),c}}class Tc extends Mt{constructor(n,e){super(n),this.connectable=e}_unsubscribe(){const{connectable:n}=this;if(!n)return void(this.connection=null);this.connectable=null;const e=n._refCount;if(e<=0)return void(this.connection=null);if(n._refCount=e-1,e>1)return void(this.connection=null);const{connection:i}=this,o=n._connection;this.connection=null,o&&(!i||o===i)&&o.unsubscribe()}}class ja extends dn{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let n=this._connection;return n||(this._isComplete=!1,n=this._connection=new ut,n.add(this.source.subscribe(new xu(this.getSubject(),this))),n.closed&&(this._connection=null,n=ut.EMPTY)),n}refCount(){return ha()(this)}}const Sd=(()=>{const t=ja.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class xu extends Ll{constructor(n,e){super(n),this.connectable=e}_error(n){this._unsubscribe(),super._error(n)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const n=this.connectable;if(n){this.connectable=null;const e=n._connection;n._refCount=0,n._subject=null,n._connection=null,e&&e.unsubscribe()}}}function $a(){return new Rn}function an(t){for(let n in t)if(t[n]===an)return n;throw Error("Could not find renamed property on target object.")}function jt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(jt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function Ha(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const Ga=an({__forward_ref__:an});function $t(t){return t.__forward_ref__=$t,t.toString=function(){return jt(this())},t}function G(t){return function(t){return"function"==typeof t&&t.hasOwnProperty(Ga)&&t.__forward_ref__===$t}(t)?t():t}class Q extends Error{constructor(n,e){super(function(t,n){return`${t?`NG0${t}: `:""}${n}`}(n,e)),this.code=n}}function de(t){return"string"==typeof t?t:null==t?"":String(t)}function _e(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():de(t)}function Qe(t,n){const e=n?` in ${n}`:"";throw new Q("201",`No provider for ${_e(t)} found${e}`)}function It(t,n){null==t&&function(t,n,e,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${e} ${i} ${n} <=Actual]`))}(n,t,null,"!=")}function ct(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function nn(t){return{providers:t.providers||[],imports:t.imports||[]}}function yi(t){return Xn(t,Gr)||Xn(t,No)}function Xn(t,n){return t.hasOwnProperty(n)?t[n]:null}function wu(t){return t&&(t.hasOwnProperty(Gl)||t.hasOwnProperty(mn))?t[Gl]:null}const Gr=an({\u0275prov:an}),Gl=an({\u0275inj:an}),No=an({ngInjectableDef:an}),mn=an({ngInjectorDef:an});var Tt=(()=>((Tt=Tt||{})[Tt.Default=0]="Default",Tt[Tt.Host=1]="Host",Tt[Tt.Self=2]="Self",Tt[Tt.SkipSelf=4]="SkipSelf",Tt[Tt.Optional=8]="Optional",Tt))();let Hs;function Ui(t){const n=Hs;return Hs=t,n}function kd(t,n,e){const i=yi(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Tt.Optional?null:void 0!==n?n:void Qe(jt(t),"Injector")}function Vn(t){return{toString:t}.toString()}var er=(()=>((er=er||{})[er.OnPush=0]="OnPush",er[er.Default=1]="Default",er))(),vi=(()=>((vi=vi||{})[vi.Emulated=0]="Emulated",vi[vi.None=2]="None",vi[vi.ShadowDom=3]="ShadowDom",vi))();const es="undefined"!=typeof globalThis&&globalThis,Ac="undefined"!=typeof window&&window,Cu="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ln=es||"undefined"!=typeof global&&global||Ac||Cu,bi={},An=[],ts=an({\u0275cmp:an}),kc=an({\u0275dir:an}),Wl=an({\u0275pipe:an}),Yh=an({\u0275mod:an}),sm=an({\u0275loc:an}),Po=an({\u0275fac:an}),ma=an({__NG_ELEMENT_ID__:an});let Kh=0;function kn(t){return Vn(()=>{const e={},i={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===er.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||An,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||vi.Emulated,id:"c",styles:t.styles||An,_:null,setInput:null,schemas:t.schemas||null,tView:null},o=t.directives,c=t.features,f=t.pipes;return i.id+=Kh++,i.inputs=qa(t.inputs,e),i.outputs=qa(t.outputs),c&&c.forEach(y=>y(i)),i.directiveDefs=o?()=>("function"==typeof o?o():o).map(Qh):null,i.pipeDefs=f?()=>("function"==typeof f?f():f).map(no):null,i})}function Qh(t){return tr(t)||function(t){return t[kc]||null}(t)}function no(t){return function(t){return t[Wl]||null}(t)}const Du={};function vn(t){return Vn(()=>{const n={type:t.type,bootstrap:t.bootstrap||An,declarations:t.declarations||An,imports:t.imports||An,exports:t.exports||An,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Du[t.id]=t.type),n})}function qa(t,n){if(null==t)return bi;const e={};for(const i in t)if(t.hasOwnProperty(i)){let o=t[i],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),e[o]=i,n&&(n[o]=c)}return e}const et=kn;function tr(t){return t[ts]||null}function Tr(t,n){const e=t[Yh]||null;if(!e&&!0===n)throw new Error(`Type ${jt(t)} does not have '\u0275mod' property.`);return e}function ro(t){return Array.isArray(t)&&"object"==typeof t[1]}function oo(t){return Array.isArray(t)&&!0===t[1]}function Tu(t){return 0!=(8&t.flags)}function Ws(t){return 2==(2&t.flags)}function Ro(t){return null!==t.template}function am(t){return 0!=(512&t[2])}function _a(t,n){return t.hasOwnProperty(Po)?t[Po]:null}class sf{constructor(n,e,i){this.previousValue=n,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function Fo(t){return t.type.prototype.ngOnChanges&&(t.setInput=ya),Ql}function Ql(){const t=Bd(this),n=null==t?void 0:t.current;if(n){const e=t.previous;if(e===bi)t.previous=n;else for(let i in n)e[i]=n[i];t.current=null,this.ngOnChanges(n)}}function ya(t,n,e,i){const o=Bd(t)||function(t,n){return t[Lc]=n}(t,{previous:bi,current:null}),c=o.current||(o.current={}),f=o.previous,y=this.declaredInputs[e],C=f[y];c[y]=new sf(C&&C.currentValue,n,f===bi),t[i]=n}const Lc="__ngSimpleChanges__";function Bd(t){return t[Lc]||null}const Iu="http://www.w3.org/2000/svg";let Cs;function Yn(t){return!!t.listen}const ba={createRenderer:(t,n)=>void 0!==Cs?Cs:"undefined"!=typeof document?document:void 0};function xi(t){for(;Array.isArray(t);)t=t[0];return t}function cr(t,n){return xi(n[t.index])}function Su(t,n){return t.data[n]}function Ar(t,n){const e=n[t];return ro(e)?e:e[0]}function jd(t){return 4==(4&t[2])}function nl(t){return 128==(128&t[2])}function wi(t,n){return null==n?null:t[n]}function tc(t){t[18]=0}function xa(t,n){t[5]+=n;let e=t,i=t[3];for(;null!==i&&(1===n&&1===e[5]||-1===n&&0===e[5]);)i[5]+=n,e=i,i=i[3]}const Lt={lFrame:Gd(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function zc(){return Lt.bindingsEnabled}function He(){return Lt.lFrame.lView}function gn(){return Lt.lFrame.tView}function ti(){let t=hf();for(;null!==t&&64===t.type;)t=t.parent;return t}function hf(){return Lt.lFrame.currentTNode}function so(t,n){const e=Lt.lFrame;e.currentTNode=t,e.isParent=n}function ku(){return Lt.lFrame.isParent}function Nu(){Lt.lFrame.isParent=!1}function rl(){return Lt.isInCheckNoChangesMode}function jc(t){Lt.isInCheckNoChangesMode=t}function ao(t){const n=Lt.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function ff(t,n){const e=Lt.lFrame;e.bindingIndex=e.bindingRootIndex=t,Pu(n)}function Pu(t){Lt.lFrame.currentDirectiveIndex=t}function nc(){return Lt.lFrame.currentQueryIndex}function Fu(t){Lt.lFrame.currentQueryIndex=t}function Ou(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function ol(t,n,e){if(e&Tt.SkipSelf){let o=n,c=t;for(;!(o=o.parent,null!==o||e&Tt.Host||(o=Ou(c),null===o||(c=c[15],10&o.type))););if(null===o)return!1;n=o,t=c}const i=Lt.lFrame=Lu();return i.currentTNode=n,i.lView=t,!0}function sl(t){const n=Lu(),e=t[1];Lt.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function Lu(){const t=Lt.lFrame,n=null===t?null:t.child;return null===n?Gd(t):n}function Gd(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function Bu(){const t=Lt.lFrame;return Lt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Vu=Bu;function ic(){const t=Bu();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Wi(){return Lt.lFrame.selectedIndex}function Xs(t){Lt.lFrame.selectedIndex=t}function Ys(){Lt.lFrame.currentNamespace=Iu}function Lo(){Lt.lFrame.currentNamespace=null}function rc(t,n){for(let e=n.directiveStart,i=n.directiveEnd;e<i;e++){const c=t.data[e].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:y,ngAfterViewInit:C,ngAfterViewChecked:M,ngOnDestroy:k}=c;f&&(t.contentHooks||(t.contentHooks=[])).push(-e,f),y&&((t.contentHooks||(t.contentHooks=[])).push(e,y),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(e,y)),C&&(t.viewHooks||(t.viewHooks=[])).push(-e,C),M&&((t.viewHooks||(t.viewHooks=[])).push(e,M),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(e,M)),null!=k&&(t.destroyHooks||(t.destroyHooks=[])).push(e,k)}}function oc(t,n,e){ac(t,n,3,e)}function rs(t,n,e,i){(3&t[2])===e&&ac(t,n,e,i)}function sc(t,n){let e=t[2];(3&e)===n&&(e&=2047,e+=1,t[2]=e)}function ac(t,n,e,i){const c=null!=i?i:-1,f=n.length-1;let y=0;for(let C=void 0!==i?65535&t[18]:0;C<f;C++)if("number"==typeof n[C+1]){if(y=n[C],null!=i&&y>=i)break}else n[C]<0&&(t[18]+=65536),(y<c||-1==c)&&(Wd(t,e,n,C),t[18]=(4294901760&t[18])+C+2),C++}function Wd(t,n,e,i){const o=e[i]<0,c=e[i+1],y=t[o?-e[i]:e[i]];if(o){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{c.call(y)}finally{}}}else try{c.call(y)}finally{}}class Ts{constructor(n,e,i){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function x(t,n,e){const i=Yn(t);let o=0;for(;o<e.length;){const c=e[o];if("number"==typeof c){if(0!==c)break;o++;const f=e[o++],y=e[o++],C=e[o++];i?t.setAttribute(n,y,C,f):n.setAttributeNS(f,y,C)}else{const f=c,y=e[++o];I(f)?i&&t.setProperty(n,f,y):i?t.setAttribute(n,f,y):n.setAttribute(f,y),o++}}return o}function E(t){return 3===t||4===t||6===t}function I(t){return 64===t.charCodeAt(0)}function P(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let i=0;i<n.length;i++){const o=n[i];"number"==typeof o?e=o:0===e||F(t,e,o,null,-1===e||2===e?n[++i]:null)}}return t}function F(t,n,e,i,o){let c=0,f=t.length;if(-1===n)f=-1;else for(;c<t.length;){const y=t[c++];if("number"==typeof y){if(y===n){f=-1;break}if(y>n){f=c-1;break}}}for(;c<t.length;){const y=t[c];if("number"==typeof y)break;if(y===e){if(null===i)return void(null!==o&&(t[c+1]=o));if(i===t[c+1])return void(t[c+2]=o)}c++,null!==i&&c++,null!==o&&c++}-1!==f&&(t.splice(f,0,n),c=f+1),t.splice(c++,0,e),null!==i&&t.splice(c++,0,i),null!==o&&t.splice(c++,0,o)}function O(t){return-1!==t}function B(t){return 32767&t}function Y(t,n){let e=function(t){return t>>16}(t),i=n;for(;e>0;)i=i[15],e--;return i}let ee=!0;function X(t){const n=ee;return ee=t,n}let se=0;function le(t,n){const e=Se(t,n);if(-1!==e)return e;const i=n[1];i.firstCreatePass&&(t.injectorIndex=n.length,fe(i.data,t),fe(n,null),fe(i.blueprint,null));const o=Me(t,n),c=t.injectorIndex;if(O(o)){const f=B(o),y=Y(o,n),C=y[1].data;for(let M=0;M<8;M++)n[c+M]=y[f+M]|C[f+M]}return n[c+8]=o,c}function fe(t,n){t.push(0,0,0,0,0,0,0,0,n)}function Se(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Me(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,i=null,o=n;for(;null!==o;){const c=o[1],f=c.type;if(i=2===f?c.declTNode:1===f?o[6]:null,null===i)return-1;if(e++,o=o[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function Ne(t,n,e){!function(t,n,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(ma)&&(i=e[ma]),null==i&&(i=e[ma]=se++);const o=255&i;n.data[t+(o>>5)]|=1<<o}(t,n,e)}function Ze(t,n,e){if(e&Tt.Optional)return t;Qe(n,"NodeInjector")}function Pe(t,n,e,i){if(e&Tt.Optional&&void 0===i&&(i=null),0==(e&(Tt.Self|Tt.Host))){const o=t[9],c=Ui(void 0);try{return o?o.get(n,i,e&Tt.Optional):kd(n,i,e&Tt.Optional)}finally{Ui(c)}}return Ze(i,n,e)}function Xe(t,n,e,i=Tt.Default,o){if(null!==t){const c=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(ma)?t[ma]:void 0;return"number"==typeof n?n>=0?255&n:Ke:n}(e);if("function"==typeof c){if(!ol(n,t,i))return i&Tt.Host?Ze(o,e,i):Pe(n,e,i,o);try{const f=c(i);if(null!=f||i&Tt.Optional)return f;Qe(e)}finally{Vu()}}else if("number"==typeof c){let f=null,y=Se(t,n),C=-1,M=i&Tt.Host?n[16][6]:null;for((-1===y||i&Tt.SkipSelf)&&(C=-1===y?Me(t,n):n[y+8],-1!==C&&xt(i,!1)?(f=n[1],y=B(C),n=Y(C,n)):y=-1);-1!==y;){const k=n[1];if(St(c,y,k.data)){const L=ft(y,n,e,f,i,M);if(L!==Te)return L}C=n[y+8],-1!==C&&xt(i,n[1].data[y+8]===M)&&St(c,y,n)?(f=k,y=B(C),n=Y(C,n)):y=-1}}}return Pe(n,e,i,o)}const Te={};function Ke(){return new At(ti(),He())}function ft(t,n,e,i,o,c){const f=n[1],y=f.data[t+8],k=wt(y,f,e,null==i?Ws(y)&&ee:i!=f&&0!=(3&y.type),o&Tt.Host&&c===y);return null!==k?Dt(n,f,k,y):Te}function wt(t,n,e,i,o){const c=t.providerIndexes,f=n.data,y=1048575&c,C=t.directiveStart,k=c>>20,U=o?y+k:t.directiveEnd;for(let q=i?y:y+k;q<U;q++){const ae=f[q];if(q<C&&e===ae||q>=C&&ae.type===e)return q}if(o){const q=f[C];if(q&&Ro(q)&&q.type===e)return C}return null}function Dt(t,n,e,i){let o=t[e];const c=n.data;if(function(t){return t instanceof Ts}(o)){const f=o;f.resolving&&function(t,n){throw new Q("200",`Circular dependency in DI detected for ${t}`)}(_e(c[e]));const y=X(f.canSeeViewProviders);f.resolving=!0;const C=f.injectImpl?Ui(f.injectImpl):null;ol(t,i,Tt.Default);try{o=t[e]=f.factory(void 0,c,t,i),n.firstCreatePass&&e>=i.directiveStart&&function(t,n,e){const{ngOnChanges:i,ngOnInit:o,ngDoCheck:c}=n.type.prototype;if(i){const f=Fo(n);(e.preOrderHooks||(e.preOrderHooks=[])).push(t,f),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,f)}o&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-t,o),c&&((e.preOrderHooks||(e.preOrderHooks=[])).push(t,c),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,c))}(e,c[e],n)}finally{null!==C&&Ui(C),X(y),f.resolving=!1,Vu()}}return o}function St(t,n,e){return!!(e[n+(t>>5)]&1<<t)}function xt(t,n){return!(t&Tt.Self||t&Tt.Host&&n)}class At{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,i){return Xe(this._tNode,this._lView,n,i,e)}}const Ai="__parameters__";function Cn(t,n,e){return Vn(()=>{const i=function(t){return function(...e){if(t){const i=t(...e);for(const o in i)this[o]=i[o]}}}(n);function o(...c){if(this instanceof o)return i.apply(this,c),this;const f=new o(...c);return y.annotation=f,y;function y(C,M,k){const L=C.hasOwnProperty(Ai)?C[Ai]:Object.defineProperty(C,Ai,{value:[]})[Ai];for(;L.length<=k;)L.push(null);return(L[k]=L[k]||[]).push(f),C}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}class bt{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=ct({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Gc=new bt("AnalyzeForEntryComponents"),Yd=Function;function co(t,n){void 0===n&&(n=t);for(let e=0;e<t.length;e++){let i=t[e];Array.isArray(i)?(n===t&&(n=t.slice(0,e)),co(i,n)):n!==t&&n.push(i)}return n}function Ks(t,n){t.forEach(e=>Array.isArray(e)?Ks(e,n):n(e))}function $u(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function Ca(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function qr(t,n){const e=[];for(let i=0;i<t;i++)e.push(n);return e}function uo(t,n,e){let i=Js(t,n);return i>=0?t[1|i]=e:(i=~i,function(t,n,e,i){let o=t.length;if(o==n)t.push(e,i);else if(1===o)t.push(i,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;)t[o]=t[o-2],o--;t[n]=e,t[n+1]=i}}(t,i,n,e)),i}function Wc(t,n){const e=Js(t,n);if(e>=0)return t[1|e]}function Js(t,n){return function(t,n,e){let i=0,o=t.length>>e;for(;o!==i;){const c=i+(o-i>>1),f=t[c<<e];if(n===f)return c<<e;f>n?o=c:i=c+1}return~(o<<e)}(t,n,1)}const ho={},wm="__NG_DI_FLAG__",Hu="ngTempTokenPath",fn=/\n/gm,bf="__source",xf=an({provide:String,useValue:an});let Gu;function uc(t){const n=Gu;return Gu=t,n}function Cm(t,n=Tt.Default){if(void 0===Gu)throw new Error("inject() must be called from an injection context");return null===Gu?kd(t,void 0,n):Gu.get(t,n&Tt.Optional?null:void 0,n)}function Be(t,n=Tt.Default){return(Hs||Cm)(G(t),n)}function cl(t){const n=[];for(let e=0;e<t.length;e++){const i=G(t[e]);if(Array.isArray(i)){if(0===i.length)throw new Error("Arguments array must have arguments.");let o,c=Tt.Default;for(let f=0;f<i.length;f++){const y=i[f],C=wf(y);"number"==typeof C?-1===C?o=y.token:c|=C:o=y}n.push(Be(o,c))}else n.push(Be(i))}return n}function Ss(t,n){return t[wm]=n,t.prototype[wm]=n,t}function wf(t){return t[wm]}function Cf(t,n,e,i){const o=t[Hu];throw n[bf]&&o.unshift(n[bf]),t.message=function(t,n,e,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let o=jt(n);if(Array.isArray(n))o=n.map(jt).join(" -> ");else if("object"==typeof n){let c=[];for(let f in n)if(n.hasOwnProperty(f)){let y=n[f];c.push(f+":"+("string"==typeof y?JSON.stringify(y):jt(y)))}o=`{${c.join(", ")}}`}return`${e}${i?"("+i+")":""}[${o}]: ${t.replace(fn,"\n  ")}`}("\n"+t.message,o,e,i),t.ngTokenPath=o,t[Hu]=null,t}const Yc=Ss(Cn("Inject",t=>({token:t})),-1),Vo=Ss(Cn("Optional"),8),zo=Ss(Cn("SkipSelf"),4);function os(t){return t instanceof class{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?t.changingThisBreaksApplicationSecurity:t}const Bf="__ngContext__";function Xr(t,n){t[Bf]=n}function ch(t){const n=function(t){return t[Bf]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function Uf(t){return t.ngOriginalError}function sy(t,...n){t.error(...n)}class ul{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n),i=this._findContext(n),o=function(t){return t&&t.ngErrorLogger||sy}(n);o(this._console,"ERROR",n),e&&o(this._console,"ORIGINAL ERROR",e),i&&o(this._console,"ERROR CONTEXT",i)}_findContext(n){return n?function(t){return t.ngDebugContext}(n)||this._findContext(Uf(n)):null}_findOriginalError(n){let e=n&&Uf(n);for(;e&&Uf(e);)e=Uf(e);return e||null}}const hh=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ln))();function Ea(t){return t instanceof Function?t():t}var ss=(()=>((ss=ss||{})[ss.Important=1]="Important",ss[ss.DashCase=2]="DashCase",ss))();function Ns(t,n){return undefined(t,n)}function Ta(t){const n=t[3];return oo(n)?n[3]:n}function ru(t){return gy(t[13])}function Bm(t){return gy(t[4])}function gy(t){for(;null!==t&&!oo(t);)t=t[4];return t}function ou(t,n,e,i,o){if(null!=i){let c,f=!1;oo(i)?c=i:ro(i)&&(f=!0,i=i[0]);const y=xi(i);0===t&&null!==e?null==o?jm(n,e,y):Ps(n,e,y,o||null,!0):1===t&&null!==e?Ps(n,e,y,o||null,!0):2===t?function(t,n,e){const i=Hf(t,n);i&&function(t,n,e,i){Yn(t)?t.removeChild(n,e,i):n.removeChild(e)}(t,i,n,e)}(n,y,f):3===t&&n.destroyNode(y),null!=c&&function(t,n,e,i,o){const c=e[7];c!==xi(e)&&ou(n,t,i,c,o);for(let y=10;y<e.length;y++){const C=e[y];nd(C[1],C,t,n,i,c)}}(n,t,c,e,o)}}function $f(t,n,e){return Yn(t)?t.createElement(n,e):null===e?t.createElement(n):t.createElementNS(e,n)}function vy(t,n){const e=t[9],i=e.indexOf(n),o=n[3];1024&n[2]&&(n[2]&=-1025,xa(o,-1)),e.splice(i,1)}function zm(t,n){if(t.length<=10)return;const e=10+n,i=t[e];if(i){const o=i[17];null!==o&&o!==t&&vy(o,i),n>0&&(t[e-1][4]=i[4]);const c=Ca(t,10+n);!function(t,n){nd(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(i[1],i);const f=c[19];null!==f&&f.detachView(c[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function by(t,n){if(!(256&n[2])){const e=n[11];Yn(e)&&e.destroyNode&&nd(t,n,e,3,null,null),function(t){let n=t[13];if(!n)return Um(t[1],t);for(;n;){let e=null;if(ro(n))e=n[13];else{const i=n[10];i&&(e=i)}if(!e){for(;n&&!n[4]&&n!==t;)ro(n)&&Um(n[1],n),n=n[3];null===n&&(n=t),ro(n)&&Um(n[1],n),e=n&&n[4]}n=e}}(n)}}function Um(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let i=0;i<e.length;i+=2){const o=n[e[i]];if(!(o instanceof Ts)){const c=e[i+1];if(Array.isArray(c))for(let f=0;f<c.length;f+=2){const y=o[c[f]],C=c[f+1];try{C.call(y)}finally{}}else try{c.call(o)}finally{}}}}(t,n),function(t,n){const e=t.cleanup,i=n[7];let o=-1;if(null!==e)for(let c=0;c<e.length-1;c+=2)if("string"==typeof e[c]){const f=e[c+1],y="function"==typeof f?f(n):xi(n[f]),C=i[o=e[c+2]],M=e[c+3];"boolean"==typeof M?y.removeEventListener(e[c],C,M):M>=0?i[o=M]():i[o=-M].unsubscribe(),c+=2}else{const f=i[o=e[c+1]];e[c].call(f)}if(null!==i){for(let c=o+1;c<i.length;c++)i[c]();n[7]=null}}(t,n),1===n[1].type&&Yn(n[11])&&n[11].destroy();const e=n[17];if(null!==e&&oo(n[3])){e!==n[3]&&vy(e,n);const i=n[19];null!==i&&i.detachView(t)}}}function xy(t,n,e){return function(t,n,e){let i=n;for(;null!==i&&40&i.type;)i=(n=i).parent;if(null===i)return e[0];if(2&i.flags){const o=t.data[i.directiveStart].encapsulation;if(o===vi.None||o===vi.Emulated)return null}return cr(i,e)}(t,n.parent,e)}function Ps(t,n,e,i,o){Yn(t)?t.insertBefore(n,e,i,o):n.insertBefore(e,i,o)}function jm(t,n,e){Yn(t)?t.appendChild(n,e):n.appendChild(e)}function wy(t,n,e,i,o){null!==i?Ps(t,n,e,i,o):jm(t,n,e)}function Hf(t,n){return Yn(t)?t.parentNode(n):n.parentNode}function Gf(t,n,e){return Uo(t,n,e)}let Uo=function(t,n,e){return 40&t.type?cr(t,e):null};function td(t,n,e,i){const o=xy(t,i,n),c=n[11],y=Gf(i.parent||n[6],i,n);if(null!=o)if(Array.isArray(e))for(let C=0;C<e.length;C++)wy(c,o,e[C],y,!1);else wy(c,o,e,y,!1)}function cu(t,n){if(null!==n){const e=n.type;if(3&e)return cr(n,t);if(4&e)return qf(-1,t[n.index]);if(8&e){const i=n.child;if(null!==i)return cu(t,i);{const o=t[n.index];return oo(o)?qf(-1,o):xi(o)}}if(32&e)return Ns(n,t)()||xi(t[n.index]);{const i=Cy(t,n);return null!==i?Array.isArray(i)?i[0]:cu(Ta(t[16]),i):cu(t,n.next)}}return null}function Cy(t,n){return null!==n?t[16][6].projection[n.projection]:null}function qf(t,n){const e=10+t+1;if(e<n.length){const i=n[e],o=i[1].firstChild;if(null!==o)return cu(i,o)}return n[7]}function qm(t,n,e,i,o,c,f){for(;null!=e;){const y=i[e.index],C=e.type;if(f&&0===n&&(y&&Xr(xi(y),i),e.flags|=4),64!=(64&e.flags))if(8&C)qm(t,n,e.child,i,o,c,!1),ou(n,t,o,y,c);else if(32&C){const M=Ns(e,i);let k;for(;k=M();)ou(n,t,o,k,c);ou(n,t,o,y,c)}else 16&C?Wf(t,n,i,e,o,c):ou(n,t,o,y,c);e=f?e.projectionNext:e.next}}function nd(t,n,e,i,o,c){qm(e,i,t.firstChild,n,o,c,!1)}function Wf(t,n,e,i,o,c){const f=e[16],C=f[6].projection[i.projection];if(Array.isArray(C))for(let M=0;M<C.length;M++)ou(n,t,o,C[M],c);else qm(t,n,C,f[3],o,c,!0)}function Ty(t,n,e){Yn(t)?t.setAttribute(n,"style",e):n.style.cssText=e}function Zf(t,n,e){Yn(t)?""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e):n.className=e}function hl(t,n,e){let i=t.length;for(;;){const o=t.indexOf(n,e);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const c=n.length;if(o+c===i||t.charCodeAt(o+c)<=32)return o}e=o+1}}const Zm="ng-template";function My(t,n,e){let i=0;for(;i<t.length;){let o=t[i++];if(e&&"class"===o){if(o=t[i],-1!==hl(o.toLowerCase(),n,0))return!0}else if(1===o){for(;i<t.length&&"string"==typeof(o=t[i++]);)if(o.toLowerCase()===n)return!0;return!1}}return!1}function Xm(t){return 4===t.type&&t.value!==Zm}function w1(t,n,e){return n===(4!==t.type||e?t.value:Zm)}function C1(t,n,e){let i=4;const o=t.attrs||[],c=function(t){for(let n=0;n<t.length;n++)if(E(t[n]))return n;return t.length}(o);let f=!1;for(let y=0;y<n.length;y++){const C=n[y];if("number"!=typeof C){if(!f)if(4&i){if(i=2|1&i,""!==C&&!w1(t,C,e)||""===C&&1===n.length){if(Rs(i))return!1;f=!0}}else{const M=8&i?C:n[++y];if(8&i&&null!==t.attrs){if(!My(t.attrs,M,e)){if(Rs(i))return!1;f=!0}continue}const L=Iy(8&i?"class":C,o,Xm(t),e);if(-1===L){if(Rs(i))return!1;f=!0;continue}if(""!==M){let U;U=L>c?"":o[L+1].toLowerCase();const q=8&i?U:null;if(q&&-1!==hl(q,M,0)||2&i&&M!==U){if(Rs(i))return!1;f=!0}}}}else{if(!f&&!Rs(i)&&!Rs(C))return!1;if(f&&Rs(C))continue;f=!1,i=C|1&i}}return Rs(i)||f}function Rs(t){return 0==(1&t)}function Iy(t,n,e,i){if(null===n)return-1;let o=0;if(i||!e){let c=!1;for(;o<n.length;){const f=n[o];if(f===t)return o;if(3===f||6===f)c=!0;else{if(1===f||2===f){let y=n[++o];for(;"string"==typeof y;)y=n[++o];continue}if(4===f)break;if(0===f){o+=4;continue}}o+=c?1:2}return-1}return function(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const i=t[e];if("number"==typeof i)return-1;if(i===n)return e;e++}return-1}(n,t)}function id(t,n,e=!1){for(let i=0;i<n.length;i++)if(C1(t,n[i],e))return!0;return!1}function rd(t,n){e:for(let e=0;e<n.length;e++){const i=n[e];if(t.length===i.length){for(let o=0;o<t.length;o++)if(t[o]!==i[o])continue e;return!0}}return!1}function Km(t,n){return t?":not("+n.trim()+")":n}function Xf(t){let n=t[0],e=1,i=2,o="",c=!1;for(;e<t.length;){let f=t[e];if("string"==typeof f)if(2&i){const y=t[++e];o+="["+f+(y.length>0?'="'+y+'"':"")+"]"}else 8&i?o+="."+f:4&i&&(o+=" "+f);else""!==o&&!Rs(f)&&(n+=Km(c,o),o=""),i=f,c=c||!Rs(i);e++}return""!==o&&(n+=Km(c,o)),n}const zt={};function Kf(t,n){return t<<17|n<<2}function ea(t){return t>>17&32767}function mh(t){return 2|t}function fl(t){return(131068&t)>>2}function Jf(t,n){return-131069&t|n<<2}function gh(t){return 1|t}function ig(t,n){const e=t.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const o=e[i],c=e[i+1];if(-1!==c){const f=t.data[c];Fu(o),f.contentQueries(2,n[c],c)}}}function Yr(t,n,e,i,o,c,f,y,C,M){const k=n.blueprint.slice();return k[0]=o,k[2]=140|i,tc(k),k[3]=k[15]=t,k[8]=e,k[10]=f||t&&t[10],k[11]=y||t&&t[11],k[12]=C||t&&t[12]||null,k[9]=M||t&&t[9]||null,k[6]=c,k[16]=2==n.type?t[16]:k,k}function fo(t,n,e,i,o){let c=t.data[n];if(null===c)c=function(t,n,e,i,o){const c=hf(),f=ku(),C=t.data[n]=function(t,n,e,i,o,c){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?c:c&&c.parent,e,n,i,o);return null===t.firstChild&&(t.firstChild=C),null!==c&&(f?null==c.child&&null!==C.parent&&(c.child=C):null===c.next&&(c.next=C)),C}(t,n,e,i,o),Lt.lFrame.inI18n&&(c.flags|=64);else if(64&c.type){c.type=e,c.value=i,c.attrs=o;const f=function(){const t=Lt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();c.injectorIndex=null===f?-1:f.injectorIndex}return so(c,!0),c}function po(t,n,e,i){if(0===e)return-1;const o=n.length;for(let c=0;c<e;c++)n.push(i),t.blueprint.push(i),t.data.push(null);return o}function Fs(t,n,e){sl(n);try{const i=t.viewQuery;null!==i&&v(1,i,e);const o=t.template;null!==o&&ip(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&ig(t,n),t.staticViewQueries&&v(2,t.viewQuery,e);const c=t.components;null!==c&&function(t,n){for(let e=0;e<n.length;e++)Ky(t,n[e])}(n,c)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{n[2]&=-5,ic()}}function _l(t,n,e,i){const o=n[2];if(256==(256&o))return;sl(n);const c=rl();try{tc(n),function(t){Lt.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&ip(t,n,e,2,i);const f=3==(3&o);if(!c)if(f){const M=t.preOrderCheckHooks;null!==M&&oc(n,M,null)}else{const M=t.preOrderHooks;null!==M&&rs(n,M,0,null),sc(n,0)}if(function(t){for(let n=ru(t);null!==n;n=Bm(n)){if(!n[2])continue;const e=n[9];for(let i=0;i<e.length;i++){const o=e[i],c=o[3];0==(1024&o[2])&&xa(c,1),o[2]|=1024}}}(n),function(t){for(let n=ru(t);null!==n;n=Bm(n))for(let e=10;e<n.length;e++){const i=n[e],o=i[1];nl(i)&&_l(o,i,o.template,i[8])}}(n),null!==t.contentQueries&&ig(t,n),!c)if(f){const M=t.contentCheckHooks;null!==M&&oc(n,M)}else{const M=t.contentHooks;null!==M&&rs(n,M,1),sc(n,1)}!function(t,n){const e=t.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const o=e[i];if(o<0)Xs(~o);else{const c=o,f=e[++i],y=e[++i];ff(f,c),y(2,n[c])}}}finally{Xs(-1)}}(t,n);const y=t.components;null!==y&&function(t,n){for(let e=0;e<n.length;e++)L1(t,n[e])}(n,y);const C=t.viewQuery;if(null!==C&&v(2,C,i),!c)if(f){const M=t.viewCheckHooks;null!==M&&oc(n,M)}else{const M=t.viewHooks;null!==M&&rs(n,M,2),sc(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),c||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,xa(n[3],-1))}finally{ic()}}function zy(t,n,e,i){const o=n[10],c=!rl(),f=jd(n);try{c&&!f&&o.begin&&o.begin(),f&&Fs(t,n,i),_l(t,n,e,i)}finally{c&&!f&&o.end&&o.end()}}function ip(t,n,e,i,o){const c=Wi(),f=2&i;try{Xs(-1),f&&n.length>20&&function(t,n,e,i){if(!i)if(3==(3&n[2])){const c=t.preOrderCheckHooks;null!==c&&oc(n,c,e)}else{const c=t.preOrderHooks;null!==c&&rs(n,c,0,e)}Xs(e)}(t,n,20,rl()),e(i,o)}finally{Xs(c)}}function sg(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=bh(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function bh(t,n,e,i,o,c,f,y,C,M){const k=20+i,L=k+o,U=function(t,n){const e=[];for(let i=0;i<n;i++)e.push(i<t?null:zt);return e}(k,L),q="function"==typeof M?M():M;return U[1]={type:t,blueprint:U,template:e,queries:null,viewQuery:y,declTNode:n,data:U.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:C,consts:q,incompleteFirstPass:!1}}function cg(t,n,e,i){const o=function(t){return t[7]||(t[7]=[])}(n);null===e?o.push(i):(o.push(e),t.firstCreatePass&&function(t){return t.cleanup||(t.cleanup=[])}(t).push(i,o.length-1))}function ug(t,n,e){for(let i in t)if(t.hasOwnProperty(i)){const o=t[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(n,o):e[i]=[n,o]}return e}function fg(t,n,e,i,o,c){const f=c.hostBindings;if(f){let y=t.hostBindingOpCodes;null===y&&(y=t.hostBindingOpCodes=[]);const C=~n.index;(function(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(y)!=C&&y.push(C),y.push(i,o,f)}}function Gy(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function Wy(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function Zy(t,n,e){if(e){if(n.exportAs)for(let i=0;i<n.exportAs.length;i++)e[n.exportAs[i]]=t;Ro(n)&&(e[""]=t)}}function mg(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function Xy(t,n,e,i,o){t.data[i]=o;const c=o.factory||(o.factory=_a(o.type)),f=new Ts(c,Ro(o),null);t.blueprint[i]=f,e[i]=f,fg(t,n,0,i,po(t,e,o.hostVars,zt),o)}function xh(t,n,e){const i=cr(n,t),o=sg(e),c=t[10],f=Ch(t,Yr(t,o,null,e.onPush?64:16,i,n,c,c.createRenderer(i,e),null,null));t[n.index]=f}function jo(t,n,e,i,o,c){const f=cr(t,n);!function(t,n,e,i,o,c,f){if(null==c)Yn(t)?t.removeAttribute(n,o,e):n.removeAttribute(o);else{const y=null==f?de(c):f(c,i||"",o);Yn(t)?t.setAttribute(n,o,y,e):e?n.setAttributeNS(e,o,y):n.setAttribute(o,y)}}(n[11],f,c,t.value,e,i,o)}function wh(t,n,e,i,o,c){const f=c[n];if(null!==f){const y=i.setInput;for(let C=0;C<f.length;){const M=f[C++],k=f[C++],L=f[C++];null!==y?i.setInput(e,L,M,k):e[k]=L}}}function cp(t,n){let e=null,i=0;for(;i<n.length;){const o=n[i];if(0!==o)if(5!==o){if("number"==typeof o)break;t.hasOwnProperty(o)&&(null===e&&(e=[]),e.push(o,t[o],n[i+1])),i+=2}else i+=2;else i+=4}return e}function L1(t,n){const e=Ar(n,t);if(nl(e)){const i=e[1];80&e[2]?_l(i,e,i.template,e[8]):e[5]>0&&gg(e)}}function gg(t){for(let i=ru(t);null!==i;i=Bm(i))for(let o=10;o<i.length;o++){const c=i[o];if(1024&c[2]){const f=c[1];_l(f,c,f.template,c[8])}else c[5]>0&&gg(c)}const e=t[1].components;if(null!==e)for(let i=0;i<e.length;i++){const o=Ar(e[i],t);nl(o)&&o[5]>0&&gg(o)}}function Ky(t,n){const e=Ar(n,t),i=e[1];(function(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])})(i,e),Fs(i,e,e[8])}function Ch(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function l(t,n,e){const i=n[10];i.begin&&i.begin();try{_l(t,n,t.template,e)}catch(o){throw function(t,n){const e=t[9],i=e?e.get(ul,null):null;i&&i.handleError(n)}(n,o),o}finally{i.end&&i.end()}}function u(t){!function(t){for(let n=0;n<t.components.length;n++){const e=t.components[n],i=ch(e),o=i[1];zy(o,i,o.template,e)}}(t[8])}function v(t,n,e){Fu(0),n(t,e)}const D=(()=>Promise.resolve(null))();function W(t,n,e){let i=e?t.styles:null,o=e?t.classes:null,c=0;if(null!==n)for(let f=0;f<n.length;f++){const y=n[f];"number"==typeof y?c=y:1==c?o=Ha(o,y):2==c&&(i=Ha(i,y+": "+n[++f]+";"))}e?t.styles=i:t.stylesWithoutHost=i,e?t.classes=o:t.classesWithoutHost=o}const me=new bt("INJECTOR",-1);class ve{get(n,e=ho){if(e===ho){const i=new Error(`NullInjectorError: No provider for ${jt(n)}!`);throw i.name="NullInjectorError",i}return e}}const ye=new bt("Set Injector scope."),we={},Fe={};let ke;function it(){return void 0===ke&&(ke=new ve),ke}function Oe(t,n=null,e=null,i){return new qe(t,e,n||it(),i)}class qe{constructor(n,e,i,o=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const c=[];e&&Ks(e,y=>this.processProvider(y,n,e)),Ks([n],y=>this.processInjectorType(y,[],c)),this.records.set(me,kt(void 0,this));const f=this.records.get(ye);this.scope=null!=f?f.value:null,this.source=o||("object"==typeof n?null:jt(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,e=ho,i=Tt.Default){this.assertNotDestroyed();const o=uc(this),c=Ui(void 0);try{if(!(i&Tt.SkipSelf)){let y=this.records.get(n);if(void 0===y){const C=function(t){return"function"==typeof t||"object"==typeof t&&t instanceof bt}(n)&&yi(n);y=C&&this.injectableDefInScope(C)?kt(We(n),we):null,this.records.set(n,y)}if(null!=y)return this.hydrate(n,y)}return(i&Tt.Self?it():this.parent).get(n,e=i&Tt.Optional&&e===ho?null:e)}catch(f){if("NullInjectorError"===f.name){if((f[Hu]=f[Hu]||[]).unshift(jt(n)),o)throw f;return Cf(f,n,"R3InjectorError",this.source)}throw f}finally{Ui(c),uc(o)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((i,o)=>n.push(jt(o))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(n,e,i){if(!(n=G(n)))return!1;let o=wu(n);const c=null==o&&n.ngModule||void 0,f=void 0===c?n:c,y=-1!==i.indexOf(f);if(void 0!==c&&(o=wu(c)),null==o)return!1;if(null!=o.imports&&!y){let k;i.push(f);try{Ks(o.imports,L=>{this.processInjectorType(L,e,i)&&(void 0===k&&(k=[]),k.push(L))})}finally{}if(void 0!==k)for(let L=0;L<k.length;L++){const{ngModule:U,providers:q}=k[L];Ks(q,ae=>this.processProvider(ae,U,q||An))}}this.injectorDefTypes.add(f);const C=_a(f)||(()=>new f);this.records.set(f,kt(C,we));const M=o.providers;if(null!=M&&!y){const k=n;Ks(M,L=>this.processProvider(L,k,M))}return void 0!==c&&void 0!==n.providers}processProvider(n,e,i){let o=tt(n=G(n))?n:G(n&&n.provide);const c=function(t,n,e){return Ln(t)?kt(void 0,t.useValue):kt(function(t,n,e){let i;if(tt(t)){const o=G(t);return _a(o)||We(o)}if(Ln(t))i=()=>G(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...cl(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))i=()=>Be(G(t.useExisting));else{const o=G(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return _a(o)||We(o);i=()=>new o(...cl(t.deps))}return i}(t),we)}(n);if(tt(n)||!0!==n.multi)this.records.get(o);else{let f=this.records.get(o);f||(f=kt(void 0,we,!0),f.factory=()=>cl(f.multi),this.records.set(o,f)),o=n,f.multi.push(n)}this.records.set(o,c)}hydrate(n,e){return e.value===we&&(e.value=Fe,e.value=e.factory()),"object"==typeof e.value&&e.value&&function(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this.onDestroy.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=G(n.providedIn);return"string"==typeof e?"any"===e||e===this.scope:this.injectorDefTypes.has(e)}}function We(t){const n=yi(t),e=null!==n?n.factory:_a(t);if(null!==e)return e;if(t instanceof bt)throw new Error(`Token ${jt(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const n=t.length;if(n>0){const i=qr(n,"?");throw new Error(`Can't resolve all parameters for ${jt(t)}: (${i.join(", ")}).`)}const e=function(t){const n=t&&(t[Gr]||t[No]);if(n){const e=function(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),n}return null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new Error("unreachable")}function kt(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function Ln(t){return null!==t&&"object"==typeof t&&xf in t}function tt(t){return"function"==typeof t}const Nn=function(t,n,e){return function(t,n=null,e=null,i){const o=Oe(t,n,e,i);return o._resolveInjectorDefTypes(),o}({name:e},n,t,e)};let yt=(()=>{class t{static create(e,i){return Array.isArray(e)?Nn(e,i,""):Nn(e.providers,e.parent,e.name||"")}}return t.THROW_IF_NOT_FOUND=ho,t.NULL=new ve,t.\u0275prov=ct({token:t,providedIn:"any",factory:()=>Be(me)}),t.__NG_ELEMENT_ID__=-1,t})();function N2(t,n){rc(ch(t)[1],ti())}let Qy=null;function pp(){if(!Qy){const t=ln.Symbol;if(t&&t.iterator)Qy=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<n.length;++e){const i=n[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Qy=i)}}}return Qy}function yg(t){return!!j1(t)&&(Array.isArray(t)||!(t instanceof Map)&&pp()in t)}function j1(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function qo(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function Pn(t,n,e,i){const o=He();return qo(o,Lt.lFrame.bindingIndex++,n)&&(gn(),jo(function(){const t=Lt.lFrame;return Su(t.tView,t.selectedIndex)}(),o,t,n,e,i)),Pn}function ue(t,n=Tt.Default){const e=He();return null===e?Be(t,n):Xe(ti(),e,G(t),n)}function W1(t,n,e,i,o){const f=o?"class":"style";!function(t,n,e,i,o){for(let c=0;c<e.length;){const f=e[c++],y=e[c++],C=n[f],M=t.data[f];null!==M.setInput?M.setInput(C,o,i,y):C[y]=o}}(t,e,n.inputs[f],f,i)}function De(t,n,e,i){const o=He(),c=gn(),f=20+t,y=o[11],C=o[f]=$f(y,n,Lt.lFrame.currentNamespace),M=c.firstCreatePass?function(t,n,e,i,o,c,f){const y=n.consts,M=fo(n,t,2,o,wi(y,c));return function(t,n,e,i){let o=!1;if(zc()){const c=function(t,n,e){const i=t.directiveRegistry;let o=null;if(i)for(let c=0;c<i.length;c++){const f=i[c];id(e,f.selectors,!1)&&(o||(o=[]),Ne(le(e,n),t,f.type),Ro(f)?(Wy(t,e),o.unshift(f)):o.push(f))}return o}(t,n,e),f=null===i?null:{"":-1};if(null!==c){o=!0,mg(e,t.data.length,c.length);for(let k=0;k<c.length;k++){const L=c[k];L.providersResolver&&L.providersResolver(L)}let y=!1,C=!1,M=po(t,n,c.length,null);for(let k=0;k<c.length;k++){const L=c[k];e.mergedAttrs=P(e.mergedAttrs,L.hostAttrs),Xy(t,e,n,M,L),Zy(M,L,f),null!==L.contentQueries&&(e.flags|=8),(null!==L.hostBindings||null!==L.hostAttrs||0!==L.hostVars)&&(e.flags|=128);const U=L.type.prototype;!y&&(U.ngOnChanges||U.ngOnInit||U.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(e.index),y=!0),!C&&(U.ngOnChanges||U.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(e.index),C=!0),M++}!function(t,n){const i=n.directiveEnd,o=t.data,c=n.attrs,f=[];let y=null,C=null;for(let M=n.directiveStart;M<i;M++){const k=o[M],L=k.inputs,U=null===c||Xm(n)?null:cp(L,c);f.push(U),y=ug(L,M,y),C=ug(k.outputs,M,C)}null!==y&&(y.hasOwnProperty("class")&&(n.flags|=16),y.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=f,n.inputs=y,n.outputs=C}(t,e)}f&&function(t,n,e){if(n){const i=t.localNames=[];for(let o=0;o<n.length;o+=2){const c=e[n[o+1]];if(null==c)throw new Q("301",`Export of name '${n[o+1]}' not found!`);i.push(n[o],c)}}}(e,i,f)}e.mergedAttrs=P(e.mergedAttrs,e.attrs)}(n,e,M,wi(y,f)),null!==M.attrs&&W(M,M.attrs,!1),null!==M.mergedAttrs&&W(M,M.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,M),M}(f,c,o,0,n,e,i):c.data[f];so(M,!0);const k=M.mergedAttrs;null!==k&&x(y,C,k);const L=M.classes;null!==L&&Zf(y,C,L);const U=M.styles;null!==U&&Ty(y,C,U),64!=(64&M.flags)&&td(c,o,C,M),0===Lt.lFrame.elementDepthCount&&Xr(C,o),Lt.lFrame.elementDepthCount++,function(t){return 1==(1&t.flags)}(M)&&(function(t,n,e){!zc()||(function(t,n,e,i){const o=e.directiveStart,c=e.directiveEnd;t.firstCreatePass||le(e,n),Xr(i,n);const f=e.initialInputs;for(let y=o;y<c;y++){const C=t.data[y],M=Ro(C);M&&xh(n,e,C);const k=Dt(n,t,y,e);Xr(k,n),null!==f&&wh(0,y-o,k,C,0,f),M&&(Ar(e.index,n)[8]=k)}}(t,n,e,cr(e,n)),128==(128&e.flags)&&function(t,n,e){const i=e.directiveStart,o=e.directiveEnd,f=e.index,y=Lt.lFrame.currentDirectiveIndex;try{Xs(f);for(let C=i;C<o;C++){const M=t.data[C],k=n[C];Pu(C),(null!==M.hostBindings||0!==M.hostVars||null!==M.hostAttrs)&&Gy(M,k)}}finally{Xs(-1),Pu(y)}}(t,n,e))}(c,o,M),function(t,n,e){if(Tu(n)){const o=n.directiveEnd;for(let c=n.directiveStart;c<o;c++){const f=t.data[c];f.contentQueries&&f.contentQueries(1,e[c],c)}}}(c,M,o)),null!==i&&function(t,n,e=cr){const i=n.localNames;if(null!==i){let o=n.index+1;for(let c=0;c<i.length;c+=2){const f=i[c+1],y=-1===f?e(n,t):t[f];t[o++]=y}}}(o,M)}function Ee(){let t=ti();ku()?Nu():(t=t.parent,so(t,!1));const n=t;Lt.lFrame.elementDepthCount--;const e=gn();e.firstCreatePass&&(rc(e,t),Tu(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(n)&&W1(e,n,He(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(n)&&W1(e,n,He(),n.stylesWithoutHost,!1)}function Bt(t,n,e,i){De(t,n,e,i),Ee()}function bg(t){return!!t&&"function"==typeof t.then}const n0=function(t){return!!t&&"function"==typeof t.subscribe};function _k(t,n){let e=null;const i=function(t){const n=t.attrs;if(null!=n){const e=n.indexOf(5);if(0==(1&e))return n[e+1]}return null}(t);for(let o=0;o<n.length;o++){const c=n[o];if("*"!==c){if(null===i?id(t,c,!0):rd(i,c))return o}else e=o}return e}function tD(t,n,e,i,o){const c=t[e+1],f=null===n;let y=i?ea(c):fl(c),C=!1;for(;0!==y&&(!1===C||f);){const k=t[y+1];bk(t[y],n)&&(C=!0,t[y+1]=i?gh(k):mh(k)),y=i?ea(k):fl(k)}C&&(t[e+1]=i?mh(c):gh(c))}function bk(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&Js(t,n)>=0}const Lr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function nD(t){return t.substring(Lr.key,Lr.keyEnd)}function iD(t,n){const e=Lr.textEnd;return e===n?-1:(n=Lr.keyEnd=function(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}(t,Lr.key=n,e),Ep(t,n,e))}function Ep(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function Qt(t,n){return function(t,n,e,i){const o=He(),c=gn(),f=ao(2);c.firstUpdatePass&&cD(c,t,f,i),n!==zt&&qo(o,f,n)&&dD(c,c.data[Wi()],o,o[11],t,o[f+1]=function(t,n){return null==t||("string"==typeof n?t+=n:"object"==typeof t&&(t=jt(os(t)))),t}(n,e),i,f)}(t,n,null,!0),Qt}function xl(t){!function(t,n,e,i){const o=gn(),c=ao(2);o.firstUpdatePass&&cD(o,null,c,i);const f=He();if(e!==zt&&qo(f,c,e)){const y=o.data[Wi()];if(fD(y,i)&&!lD(o,c)){let C=i?y.classesWithoutHost:y.stylesWithoutHost;null!==C&&(e=Ha(C,e||"")),W1(o,y,f,e,i)}else!function(t,n,e,i,o,c,f,y){o===zt&&(o=An);let C=0,M=0,k=0<o.length?o[0]:null,L=0<c.length?c[0]:null;for(;null!==k||null!==L;){const U=C<o.length?o[C+1]:void 0,q=M<c.length?c[M+1]:void 0;let xe,ae=null;k===L?(C+=2,M+=2,U!==q&&(ae=L,xe=q)):null===L||null!==k&&k<L?(C+=2,ae=k):(M+=2,ae=L,xe=q),null!==ae&&dD(t,n,e,i,ae,xe,f,y),k=C<o.length?o[C]:null,L=M<c.length?c[M]:null}}(o,y,f,f[11],f[c+1],f[c+1]=function(t,n,e){if(null==e||""===e)return An;const i=[],o=os(e);if(Array.isArray(o))for(let c=0;c<o.length;c++)t(i,o[c],!0);else if("object"==typeof o)for(const c in o)o.hasOwnProperty(c)&&t(i,c,o[c]);else"string"==typeof o&&n(i,o);return i}(t,n,e),i,c)}}(uo,_c,t,!0)}function _c(t,n){for(let e=function(t){return function(t){Lr.key=0,Lr.keyEnd=0,Lr.value=0,Lr.valueEnd=0,Lr.textEnd=t.length}(t),iD(t,Ep(t,0,Lr.textEnd))}(n);e>=0;e=iD(n,e))uo(t,nD(n),!0)}function lD(t,n){return n>=t.expandoStartIndex}function cD(t,n,e,i){const o=t.data;if(null===o[e+1]){const c=o[Wi()],f=lD(t,e);fD(c,i)&&null===n&&!f&&(n=!1),n=function(t,n,e,i){const o=function(t){const n=Lt.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let c=i?n.residualClasses:n.residualStyles;if(null===o)0===(i?n.classBindings:n.styleBindings)&&(e=xg(e=J1(null,t,n,e,i),n.attrs,i),c=null);else{const f=n.directiveStylingLast;if(-1===f||t[f]!==o)if(e=J1(o,t,n,e,i),null===c){let C=function(t,n,e){const i=e?n.classBindings:n.styleBindings;if(0!==fl(i))return t[ea(i)]}(t,n,i);void 0!==C&&Array.isArray(C)&&(C=J1(null,t,n,C[1],i),C=xg(C,n.attrs,i),function(t,n,e,i){t[ea(e?n.classBindings:n.styleBindings)]=i}(t,n,i,C))}else c=function(t,n,e){let i;const o=n.directiveEnd;for(let c=1+n.directiveStylingLast;c<o;c++)i=xg(i,t[c].hostAttrs,e);return xg(i,n.attrs,e)}(t,n,i)}return void 0!==c&&(i?n.residualClasses=c:n.residualStyles=c),e}(o,c,n,i),function(t,n,e,i,o,c){let f=c?n.classBindings:n.styleBindings,y=ea(f),C=fl(f);t[i]=e;let k,M=!1;if(Array.isArray(e)){const L=e;k=L[1],(null===k||Js(L,k)>0)&&(M=!0)}else k=e;if(o)if(0!==C){const U=ea(t[y+1]);t[i+1]=Kf(U,y),0!==U&&(t[U+1]=Jf(t[U+1],i)),t[y+1]=function(t,n){return 131071&t|n<<17}(t[y+1],i)}else t[i+1]=Kf(y,0),0!==y&&(t[y+1]=Jf(t[y+1],i)),y=i;else t[i+1]=Kf(C,0),0===y?y=i:t[C+1]=Jf(t[C+1],i),C=i;M&&(t[i+1]=mh(t[i+1])),tD(t,k,i,!0),tD(t,k,i,!1),function(t,n,e,i,o){const c=o?t.residualClasses:t.residualStyles;null!=c&&"string"==typeof n&&Js(c,n)>=0&&(e[i+1]=gh(e[i+1]))}(n,k,t,i,c),f=Kf(y,C),c?n.classBindings=f:n.styleBindings=f}(o,c,n,e,f,i)}}function J1(t,n,e,i,o){let c=null;const f=e.directiveEnd;let y=e.directiveStylingLast;for(-1===y?y=e.directiveStart:y++;y<f&&(c=n[y],i=xg(i,c.hostAttrs,o),c!==t);)y++;return null!==t&&(e.directiveStylingLast=y),i}function xg(t,n,e){const i=e?1:2;let o=-1;if(null!==n)for(let c=0;c<n.length;c++){const f=n[c];"number"==typeof f?o=f:o===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),uo(t,f,!!e||n[++c]))}return void 0===t?null:t}function dD(t,n,e,i,o,c,f,y){if(!(3&n.type))return;const C=t.data,M=C[y+1];o0(function(t){return 1==(1&t)}(M)?hD(C,n,e,o,fl(M),f):void 0)||(o0(c)||function(t){return 2==(2&t)}(M)&&(c=hD(C,null,e,o,y,f)),function(t,n,e,i,o){const c=Yn(t);if(n)o?c?t.addClass(e,i):e.classList.add(i):c?t.removeClass(e,i):e.classList.remove(i);else{let f=-1===i.indexOf("-")?void 0:ss.DashCase;if(null==o)c?t.removeStyle(e,i,f):e.style.removeProperty(i);else{const y="string"==typeof o&&o.endsWith("!important");y&&(o=o.slice(0,-10),f|=ss.Important),c?t.setStyle(e,i,o,f):e.style.setProperty(i,o,y?"important":"")}}}(i,f,function(t,n){return xi(n[t])}(Wi(),e),o,c))}function hD(t,n,e,i,o,c){const f=null===n;let y;for(;o>0;){const C=t[o],M=Array.isArray(C),k=M?C[1]:C,L=null===k;let U=e[o+1];U===zt&&(U=L?An:void 0);let q=L?Wc(U,i):k===i?U:void 0;if(M&&!o0(q)&&(q=Wc(C,i)),o0(q)&&(y=q,f))return y;const ae=t[o+1];o=f?ea(ae):fl(ae)}if(null!==n){let C=c?n.residualClasses:n.residualStyles;null!=C&&(y=Wc(C,i))}return y}function o0(t){return void 0!==t}function fD(t,n){return 0!=(t.flags&(n?16:32))}function Ht(t,n=""){const e=He(),i=gn(),o=t+20,c=i.firstCreatePass?fo(i,o,1,n,null):i.data[o],f=e[o]=function(t,n){return Yn(t)?t.createText(n):t.createTextNode(n)}(e[11],n);td(i,e,f,c),so(c,!1)}const Mh=void 0;var Qk=["en",[["a","p"],["AM","PM"],Mh],[["AM","PM"],Mh,Mh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Mh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Mh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Mh,"{1} 'at' {0}",Mh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const n=Math.floor(Math.abs(t)),e=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===e?1:5}];let Mp={};function RD(t){return t in Mp||(Mp[t]=ln.ng&&ln.ng.common&&ln.ng.common.locales&&ln.ng.common.locales[t]),Mp[t]}var gt=(()=>((gt=gt||{})[gt.LocaleId=0]="LocaleId",gt[gt.DayPeriodsFormat=1]="DayPeriodsFormat",gt[gt.DayPeriodsStandalone=2]="DayPeriodsStandalone",gt[gt.DaysFormat=3]="DaysFormat",gt[gt.DaysStandalone=4]="DaysStandalone",gt[gt.MonthsFormat=5]="MonthsFormat",gt[gt.MonthsStandalone=6]="MonthsStandalone",gt[gt.Eras=7]="Eras",gt[gt.FirstDayOfWeek=8]="FirstDayOfWeek",gt[gt.WeekendRange=9]="WeekendRange",gt[gt.DateFormat=10]="DateFormat",gt[gt.TimeFormat=11]="TimeFormat",gt[gt.DateTimeFormat=12]="DateTimeFormat",gt[gt.NumberSymbols=13]="NumberSymbols",gt[gt.NumberFormats=14]="NumberFormats",gt[gt.CurrencyCode=15]="CurrencyCode",gt[gt.CurrencySymbol=16]="CurrencySymbol",gt[gt.CurrencyName=17]="CurrencyName",gt[gt.Currencies=18]="Currencies",gt[gt.Directionality=19]="Directionality",gt[gt.PluralCase=20]="PluralCase",gt[gt.ExtraData=21]="ExtraData",gt))();const s0="en-US";let FD=s0;function Q1(t){It(t,"Expected localeId to be defined"),"string"==typeof t&&(FD=t.toLowerCase().replace(/_/g,"-"))}class oE{}const aE="ngComponent";class KN{resolveComponentFactory(n){throw function(t){const n=Error(`No component factory found for ${jt(t)}. Did you add it to @NgModule.entryComponents?`);return n[aE]=t,n}(n)}}let ra=(()=>{class t{}return t.NULL=new KN,t})();function d0(...t){}function Ap(t,n){return new cn(cr(t,n))}const eP=function(){return Ap(ti(),He())};let cn=(()=>{class t{constructor(e){this.nativeElement=e}}return t.__NG_ELEMENT_ID__=eP,t})();function lE(t){return t instanceof cn?t.nativeElement:t}class kp{}let ab=(()=>{class t{}return t.\u0275prov=ct({token:t,providedIn:"root",factory:()=>null}),t})();class pd{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const cE=new pd("12.2.13");class uE{constructor(){}supports(n){return yg(n)}create(n){return new sP(n)}}const oP=(t,n)=>n;class sP{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||oP}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,i=this._removalsHead,o=0,c=null;for(;e||i;){const f=!i||e&&e.currentIndex<hE(i,o,c)?e:i,y=hE(f,o,c),C=f.currentIndex;if(f===i)o--,i=i._nextRemoved;else if(e=e._next,null==f.previousIndex)o++;else{c||(c=[]);const M=y-o,k=C-o;if(M!=k){for(let U=0;U<M;U++){const q=U<c.length?c[U]:c[U]=0,ae=q+U;k<=ae&&ae<M&&(c[U]=q+1)}c[f.previousIndex]=k-M}}y!==C&&n(f,y,C)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!yg(n))throw new Error(`Error trying to diff '${jt(n)}'. Only arrays and iterables are allowed`);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o,c,f,e=this._itHead,i=!1;if(Array.isArray(n)){this.length=n.length;for(let y=0;y<this.length;y++)c=n[y],f=this._trackByFn(y,c),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,c,f,y)),Object.is(e.item,c)||this._addIdentityChange(e,c)):(e=this._mismatch(e,c,f,y),i=!0),e=e._next}else o=0,function(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[pp()]();let i;for(;!(i=e.next()).done;)n(i.value)}}(n,y=>{f=this._trackByFn(o,y),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,y,f,o)),Object.is(e.item,y)||this._addIdentityChange(e,y)):(e=this._mismatch(e,y,f,o),i=!0),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,i,o){let c;return null===n?c=this._itTail:(c=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,c,o)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(i,o))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,c,o)):n=this._addAfter(new aP(e,i),c,o),n}_verifyReinsertion(n,e,i,o){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==c?n=this._reinsertAfter(c,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const o=n._prevRemoved,c=n._nextRemoved;return null===o?this._removalsHead=c:o._nextRemoved=c,null===c?this._removalsTail=o:c._prevRemoved=o,this._insertAfter(n,e,i),this._addToMoves(n,i),n}_moveAfter(n,e,i){return this._unlink(n),this._insertAfter(n,e,i),this._addToMoves(n,i),n}_addAfter(n,e,i){return this._insertAfter(n,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,i){const o=null===e?this._itHead:e._next;return n._next=o,n._prev=e,null===o?this._itTail=n:o._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new dE),this._linkedRecords.put(n),n.currentIndex=i,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,i=n._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new dE),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class aP{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class lP{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,n))return i;return null}remove(n){const e=n._prevDup,i=n._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class dE{constructor(){this.map=new Map}put(n){const e=n.trackById;let i=this.map.get(e);i||(i=new lP,this.map.set(e,i)),i.add(n)}get(n,e){const o=this.map.get(n);return o?o.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hE(t,n,e){const i=t.previousIndex;if(null===i)return i;let o=0;return e&&i<e.length&&(o=e[i]),i+n+o}class fE{constructor(){}supports(n){return n instanceof Map||j1(n)}create(){return new cP}}class cP{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||j1(n)))throw new Error(`Error trying to diff '${jt(n)}'. Only maps and objects are allowed`)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(i,o)=>{if(e&&e.key===o)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const c=this._getOrCreateRecordForKey(o,i);e=this._insertBeforeOrAppend(e,c)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const i=n._prev;return e._next=n,e._prev=i,n._prev=e,i&&(i._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const o=this._records.get(n);this._maybeAddToChanges(o,e);const c=o._prev,f=o._next;return c&&(c._next=f),f&&(f._prev=c),o._next=null,o._prev=null,o}const i=new uP(n);return this._records.set(n,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(i=>e(n[i],i))}}class uP{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function pE(){return new Mg([new uE])}let Mg=(()=>{class t{constructor(e){this.factories=e}static create(e,i){if(null!=i){const o=i.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||pE()),deps:[[t,new zo,new Vo]]}}find(e){const i=this.factories.find(o=>o.supports(e));if(null!=i)return i;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(t){return t.name||typeof t}(e)}'`)}}return t.\u0275prov=ct({token:t,providedIn:"root",factory:pE}),t})();function mE(){return new Np([new fE])}let Np=(()=>{class t{constructor(e){this.factories=e}static create(e,i){if(i){const o=i.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||mE()),deps:[[t,new zo,new Vo]]}}find(e){const i=this.factories.find(o=>o.supports(e));if(i)return i;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return t.\u0275prov=ct({token:t,providedIn:"root",factory:mE}),t})();function h0(t,n,e,i,o=!1){for(;null!==e;){const c=n[e.index];if(null!==c&&i.push(xi(c)),oo(c))for(let y=10;y<c.length;y++){const C=c[y],M=C[1].firstChild;null!==M&&h0(C[1],C,M,i)}const f=e.type;if(8&f)h0(t,n,e.child,i);else if(32&f){const y=Ns(e,n);let C;for(;C=y();)i.push(C)}else if(16&f){const y=Cy(n,e);if(Array.isArray(y))i.push(...y);else{const C=Ta(n[16]);h0(C[1],C,y,i,!0)}}e=o?e.projectionNext:e.next}return i}class Ig{constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,e=n[1];return h0(e,n,e.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(oo(n)){const e=n[8],i=e?e.indexOf(this):-1;i>-1&&(zm(n,i),Ca(e,i))}this._attachedToViewContainer=!1}by(this._lView[1],this._lView)}onDestroy(n){cg(this._lView[1],this._lView,null,n)}markForCheck(){!function(t){for(;t;){t[2]|=64;const n=Ta(t);if(am(t)&&!n)return t;t=n}}(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){l(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,n,e){jc(!0);try{l(t,n,e)}finally{jc(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(t,n){nd(t,n,n[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=n}}class hP extends Ig{constructor(n){super(n),this._view=n}detectChanges(){u(this._view)}checkNoChanges(){!function(t){jc(!0);try{u(t)}finally{jc(!1)}}(this._view)}get context(){return null}}const pP=function(t){return function(t,n,e){if(Ws(t)&&!e){const i=Ar(t.index,n);return new Ig(i,i)}return 47&t.type?new Ig(n[16],n):null}(ti(),He(),16==(16&t))};let yo=(()=>{class t{}return t.__NG_ELEMENT_ID__=pP,t})();const _P=[new fE],vP=new Mg([new uE]),bP=new Np(_P),wP=function(){return f0(ti(),He())};let di=(()=>{class t{}return t.__NG_ELEMENT_ID__=wP,t})();const CP=di,DP=class extends CP{constructor(n,e,i){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(n){const e=this._declarationTContainer.tViews,i=Yr(this._declarationLView,e,n,16,null,e.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(i[19]=c.createEmbeddedView(e)),Fs(e,i,n),new Ig(i)}};function f0(t,n){return 4&t.type?new DP(n,t,Ap(t,n)):null}class yc{}class gE{}const MP=function(){return vE(ti(),He())};let us=(()=>{class t{}return t.__NG_ELEMENT_ID__=MP,t})();const SP=us,_E=class extends SP{constructor(n,e,i){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=i}get element(){return Ap(this._hostTNode,this._hostLView)}get injector(){return new At(this._hostTNode,this._hostLView)}get parentInjector(){const n=Me(this._hostTNode,this._hostLView);if(O(n)){const e=Y(n,this._hostLView),i=B(n);return new At(e[1].data[i+8],e)}return new At(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=yE(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,e,i){const o=n.createEmbeddedView(e||{});return this.insert(o,i),o}createComponent(n,e,i,o,c){const f=i||this.parentInjector;if(!c&&null==n.ngModule&&f){const C=f.get(yc,null);C&&(c=C)}const y=n.create(f,o,void 0,c);return this.insert(y.hostView,e),y}insert(n,e){const i=n._lView,o=i[1];if(function(t){return oo(t[3])}(i)){const k=this.indexOf(n);if(-1!==k)this.detach(k);else{const L=i[3],U=new _E(L,L[6],L[3]);U.detach(U.indexOf(n))}}const c=this._adjustIndex(e),f=this._lContainer;!function(t,n,e,i){const o=10+i,c=e.length;i>0&&(e[o-1][4]=n),i<c-10?(n[4]=e[o],$u(e,10+i,n)):(e.push(n),n[4]=null),n[3]=e;const f=n[17];null!==f&&e!==f&&function(t,n){const e=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===e?t[9]=[n]:e.push(n)}(f,n);const y=n[19];null!==y&&y.insertView(t),n[2]|=128}(o,i,f,c);const y=qf(c,f),C=i[11],M=Hf(C,f[7]);return null!==M&&function(t,n,e,i,o,c){i[0]=o,i[6]=n,nd(t,i,e,1,o,c)}(o,f[6],C,i,M,y),n.attachToViewContainerRef(),$u(lb(f),c,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=yE(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),i=zm(this._lContainer,e);i&&(Ca(lb(this._lContainer),e),by(i[1],i))}detach(n){const e=this._adjustIndex(n,-1),i=zm(this._lContainer,e);return i&&null!=Ca(lb(this._lContainer),e)?new Ig(i):null}_adjustIndex(n,e=0){return null==n?this.length+e:n}};function yE(t){return t[8]}function lb(t){return t[8]||(t[8]=[])}function vE(t,n){let e;const i=n[t.index];if(oo(i))e=i;else{let o;if(8&t.type)o=xi(i);else{const c=n[11];o=c.createComment("");const f=cr(t,n);Ps(c,Hf(c,f),o,function(t,n){return Yn(t)?t.nextSibling(n):n.nextSibling}(c,f),!1)}n[t.index]=e=function(t,n,e,i){return new Array(t,!0,!1,n,null,0,i,e,null,null)}(i,n,o,t),Ch(n,e)}return new _E(e,t,n)}const Op={};class VE extends ra{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=tr(n);return new UE(e,this.ngModule)}}function zE(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}const ER=new bt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>hh});class UE extends oE{constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function(t){return t.map(Xf).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return zE(this.componentDef.inputs)}get outputs(){return zE(this.componentDef.outputs)}create(n,e,i,o){const c=(o=o||this.ngModule)?function(t,n){return{get:(e,i,o)=>{const c=t.get(e,Op,o);return c!==Op||i===Op?c:n.get(e,i,o)}}}(n,o.injector):n,f=c.get(kp,ba),y=c.get(ab,null),C=f.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",k=i?function(t,n,e){if(Yn(t))return t.selectRootElement(n,e===vi.ShadowDom);let i="string"==typeof n?t.querySelector(n):n;return i.textContent="",i}(C,i,this.componentDef.encapsulation):$f(f.createRenderer(null,this.componentDef),M,function(t){const n=t.toLowerCase();return"svg"===n?Iu:"math"===n?"http://www.w3.org/1998/MathML/":null}(M)),L=this.componentDef.onPush?576:528,U=function(t,n){return{components:[],scheduler:t||hh,clean:D,playerHandler:n||null,flags:0}}(),q=bh(0,null,null,1,0,null,null,null,null,null),ae=Yr(null,q,U,L,null,null,f,C,y,c);let xe,ge;sl(ae);try{const Ue=function(t,n,e,i,o,c){const f=e[1];e[20]=t;const C=fo(f,20,2,"#host",null),M=C.mergedAttrs=n.hostAttrs;null!==M&&(W(C,M,!0),null!==t&&(x(o,t,M),null!==C.classes&&Zf(o,t,C.classes),null!==C.styles&&Ty(o,t,C.styles)));const k=i.createRenderer(t,n),L=Yr(e,sg(n),null,n.onPush?64:16,e[20],C,i,k,c||null,null);return f.firstCreatePass&&(Ne(le(C,e),f,n.type),Wy(f,C),mg(C,e.length,1)),Ch(e,L),e[20]=L}(k,this.componentDef,ae,f,C);if(k)if(i)x(C,k,["ng-version",cE.full]);else{const{attrs:Ie,classes:mt}=function(t){const n=[],e=[];let i=1,o=2;for(;i<t.length;){let c=t[i];if("string"==typeof c)2===o?""!==c&&n.push(c,t[++i]):8===o&&e.push(c);else{if(!Rs(o))break;o=c}i++}return{attrs:n,classes:e}}(this.componentDef.selectors[0]);Ie&&x(C,k,Ie),mt&&mt.length>0&&Zf(C,k,mt.join(" "))}if(ge=Su(q,20),void 0!==e){const Ie=ge.projection=[];for(let mt=0;mt<this.ngContentSelectors.length;mt++){const Et=e[mt];Ie.push(null!=Et?Array.from(Et):null)}}xe=function(t,n,e,i,o){const c=e[1],f=function(t,n,e){const i=ti();t.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Xy(t,i,n,po(t,n,1,null),e));const o=Dt(n,t,i.directiveStart,i);Xr(o,n);const c=cr(i,n);return c&&Xr(c,n),o}(c,e,n);if(i.components.push(f),t[8]=f,o&&o.forEach(C=>C(f,n)),n.contentQueries){const C=ti();n.contentQueries(1,f,C.directiveStart)}const y=ti();return!c.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(Xs(y.index),fg(e[1],y,0,y.directiveStart,y.directiveEnd,n),Gy(n,f)),f}(Ue,this.componentDef,ae,U,[N2]),Fs(q,ae,null)}finally{ic()}return new IR(this.componentType,xe,Ap(ge,ae),ae,ge)}}class IR extends class{}{constructor(n,e,i,o,c){super(),this.location=i,this._rootLView=o,this._tNode=c,this.instance=e,this.hostView=this.changeDetectorRef=new hP(o),this.componentType=n}get injector(){return new At(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}const Lp=new Map;class kR extends yc{constructor(n,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new VE(this);const i=Tr(n),o=function(t){return t[sm]||null}(n);o&&Q1(o),this._bootstrapComponents=Ea(i.bootstrap),this._r3Injector=Oe(n,e,[{provide:yc,useValue:this},{provide:ra,useValue:this.componentFactoryResolver}],jt(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,e=yt.THROW_IF_NOT_FOUND,i=Tt.Default){return n===yt||n===yc||n===me?this:this._r3Injector.get(n,e,i)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class xb extends gE{constructor(n){super(),this.moduleType=n,null!==Tr(n)&&function(t){const n=new Set;!function e(i){const o=Tr(i,!0),c=o.id;null!==c&&(function(t,n,e){if(n&&n!==e)throw new Error(`Duplicate module registered for ${t} - ${jt(n)} vs ${jt(n.name)}`)}(c,Lp.get(c),i),Lp.set(c,i));const f=Ea(o.imports);for(const y of f)n.has(y)||(n.add(y),e(y))}(t)}(n)}create(n){return new kR(this.moduleType,n)}}function wb(t){return n=>{setTimeout(t,void 0,n)}}const Ct=class extends Rn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,i){var o,c,f;let y=n,C=e||(()=>null),M=i;if(n&&"object"==typeof n){const L=n;y=null===(o=L.next)||void 0===o?void 0:o.bind(L),C=null===(c=L.error)||void 0===c?void 0:c.bind(L),M=null===(f=L.complete)||void 0===f?void 0:f.bind(L)}this.__isAsync&&(C=wb(C),y&&(y=wb(y)),M&&(M=wb(M)));const k=super.subscribe({next:y,error:C,complete:M});return n instanceof ut&&n.add(k),k}};function GR(){return this._results[pp()]()}class b0{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=pp(),i=b0.prototype;i[e]||(i[e]=GR)}get changes(){return this._changes||(this._changes=new Ct)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const i=this;i.dirty=!1;const o=co(n);(this._changesDetected=!function(t,n,e){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++){let o=t[i],c=n[i];if(e&&(o=e(o),c=e(c)),c!==o)return!1}return!0}(i._results,o,e))&&(i._results=o,i.length=o.length,i.last=o[this.length-1],i.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Cb{constructor(n){this.queryList=n,this.matches=null}clone(){return new Cb(this.queryList)}setDirty(){this.queryList.setDirty()}}class Db{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const i=null!==n.contentQueries?n.contentQueries[0]:e.length,o=[];for(let c=0;c<i;c++){const f=e.getByIndex(c);o.push(this.queries[f.indexInDeclarationView].clone())}return new Db(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==tT(n,e).matches&&this.queries[e].setDirty()}}class KE{constructor(n,e,i=null){this.predicate=n,this.flags=e,this.read=i}}class Eb{constructor(n=[]){this.queries=n}elementStart(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let i=0;i<this.length;i++){const o=null!==e?e.length:0,c=this.getByIndex(i).embeddedTView(n,o);c&&(c.indexInDeclarationView=i,null!==e?e.push(c):e=[c])}return null!==e?new Eb(e):null}template(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Tb{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new Tb(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=n.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let o=0;o<i.length;o++){const c=i[o];this.matchTNodeWithReadOption(n,e,ZR(e,c)),this.matchTNodeWithReadOption(n,e,wt(e,n,c,!1,!1))}else i===di?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,wt(e,n,i,!1,!1))}matchTNodeWithReadOption(n,e,i){if(null!==i){const o=this.metadata.read;if(null!==o)if(o===cn||o===us||o===di&&4&e.type)this.addMatch(e.index,-2);else{const c=wt(e,n,o,!1,!1);null!==c&&this.addMatch(e.index,c)}else this.addMatch(e.index,i)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function ZR(t,n){const e=t.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===n)return e[i+1];return null}function YR(t,n,e,i){return-1===e?function(t,n){return 11&t.type?Ap(t,n):4&t.type?f0(t,n):null}(n,t):-2===e?function(t,n,e){return e===cn?Ap(n,t):e===di?f0(n,t):e===us?vE(n,t):void 0}(t,n,i):Dt(t,t[1],e,n)}function JE(t,n,e,i){const o=n[19].queries[i];if(null===o.matches){const c=t.data,f=e.matches,y=[];for(let C=0;C<f.length;C+=2){const M=f[C];y.push(M<0?null:YR(n,c[M],f[C+1],e.metadata.read))}o.matches=y}return o.matches}function Mb(t,n,e,i){const o=t.queries.getByIndex(e),c=o.matches;if(null!==c){const f=JE(t,n,o,e);for(let y=0;y<c.length;y+=2){const C=c[y];if(C>0)i.push(f[y/2]);else{const M=c[y+1],k=n[-C];for(let L=10;L<k.length;L++){const U=k[L];U[17]===U[3]&&Mb(U[1],U,M,i)}if(null!==k[9]){const L=k[9];for(let U=0;U<L.length;U++){const q=L[U];Mb(q[1],q,M,i)}}}}}return i}function Qn(t){const n=He(),e=gn(),i=nc();Fu(i+1);const o=tT(e,i);if(t.dirty&&jd(n)===(2==(2&o.metadata.flags))){if(null===o.matches)t.reset([]);else{const c=o.crossesNgTemplate?Mb(e,n,i,[]):JE(e,n,o,i);t.reset(c,lE),t.notifyOnChanges()}return!0}return!1}function Ah(t,n,e){const i=gn();i.firstCreatePass&&(function(t,n,e){null===t.queries&&(t.queries=new Eb),t.queries.track(new Tb(n,e))}(i,new KE(t,n,e),-1),2==(2&n)&&(i.staticViewQueries=!0)),function(t,n,e){const i=new b0(4==(4&e));cg(t,n,i,i.destroy),null===n[19]&&(n[19]=new Db),n[19].queries.push(new Cb(i))}(i,He(),n)}function tT(t,n){return t.queries.getByIndex(n)}const Ug=new bt("Application Initializer");let Vp=(()=>{class t{constructor(e){this.appInits=e,this.resolve=d0,this.reject=d0,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,o)=>{this.resolve=i,this.reject=o})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const c=this.appInits[o]();if(bg(c))e.push(c);else if(n0(c)){const f=new Promise((y,C)=>{c.subscribe({complete:y,error:C})});e.push(f)}}Promise.all(e).then(()=>{i()}).catch(o=>{this.reject(o)}),0===e.length&&i(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(Be(Ug,8))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const jg=new bt("AppId"),TF={provide:jg,useFactory:function(){return`${Pb()}${Pb()}${Pb()}`},deps:[]};function Pb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const vT=new bt("Platform Initializer"),$g=new bt("Platform ID"),bT=new bt("appBootstrapListener");let C0=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const oa=new bt("LocaleId"),xT=new bt("DefaultCurrencyCode");class IF{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}const Rb=function(t){return new xb(t)},SF=Rb,AF=function(t){return Promise.resolve(Rb(t))},wT=function(t){const n=Rb(t),i=Ea(Tr(t).declarations).reduce((o,c)=>{const f=tr(c);return f&&o.push(new UE(f)),o},[]);return new IF(n,i)},kF=wT,NF=function(t){return Promise.resolve(wT(t))};let kh=(()=>{class t{constructor(){this.compileModuleSync=SF,this.compileModuleAsync=AF,this.compileModuleAndAllComponentsSync=kF,this.compileModuleAndAllComponentsAsync=NF}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const FF=(()=>Promise.resolve(0))();function Fb(t){"undefined"==typeof Zone?FF.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class En{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ct(!1),this.onMicrotaskEmpty=new Ct(!1),this.onStable=new Ct(!1),this.onError=new Ct(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&e,o.shouldCoalesceRunChangeDetection=i,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function(){let t=ln.requestAnimationFrame,n=ln.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const e=t[Zone.__symbol__("OriginalDelegate")];e&&(t=e);const i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function(t){const n=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(ln,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Lb(t),t.isCheckStableRunning=!0,Ob(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Lb(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,o,c,f,y)=>{try{return CT(t),e.invokeTask(o,c,f,y)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||t.shouldCoalesceRunChangeDetection)&&n(),DT(t)}},onInvoke:(e,i,o,c,f,y,C)=>{try{return CT(t),e.invoke(o,c,f,y,C)}finally{t.shouldCoalesceRunChangeDetection&&n(),DT(t)}},onHasTask:(e,i,o,c)=>{e.hasTask(o,c),i===o&&("microTask"==c.change?(t._hasPendingMicrotasks=c.microTask,Lb(t),Ob(t)):"macroTask"==c.change&&(t.hasPendingMacrotasks=c.macroTask))},onHandleError:(e,i,o,c)=>(e.handleError(o,c),t.runOutsideAngular(()=>t.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!En.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(En.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,e,i){return this._inner.run(n,e,i)}runTask(n,e,i,o){const c=this._inner,f=c.scheduleEventTask("NgZoneEvent: "+o,n,LF,d0,d0);try{return c.runTask(f,e,i)}finally{c.cancelTask(f)}}runGuarded(n,e,i){return this._inner.runGuarded(n,e,i)}runOutsideAngular(n){return this._outer.run(n)}}const LF={};function Ob(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Lb(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function CT(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function DT(t){t._nesting--,Ob(t)}class zF{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ct,this.onMicrotaskEmpty=new Ct,this.onStable=new Ct,this.onError=new Ct}run(n,e,i){return n.apply(e,i)}runGuarded(n,e,i){return n.apply(e,i)}runOutsideAngular(n){return n()}runTask(n,e,i,o){return n.apply(e,i)}}let Bb=(()=>{class t{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{En.assertNotInAngularZone(),Fb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Fb(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,o){let c=-1;i&&i>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==c),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:c,updateCb:o})}whenStable(e,i,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,i,o){return[]}}return t.\u0275fac=function(e){return new(e||t)(Be(En))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})(),ET=(()=>{class t{constructor(){this._applications=new Map,Vb.addToWindow(this)}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){return Vb.findTestabilityInTree(this,e,i)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();class UF{addToWindow(n){}findTestabilityInTree(n,e,i){return null}}let Vb=new UF,TT=!0,MT=!1;function zb(){return MT=!0,TT}let Tl;const IT=new bt("AllowMultipleToken");class Ub{constructor(n,e){this.name=n,this.token=e}}function ST(t,n,e=[]){const i=`Platform: ${n}`,o=new bt(i);return(c=[])=>{let f=AT();if(!f||f.injector.get(IT,!1))if(t)t(e.concat(c).concat({provide:o,useValue:!0}));else{const y=e.concat(c).concat({provide:o,useValue:!0},{provide:ye,useValue:"platform"});!function(t){if(Tl&&!Tl.destroyed&&!Tl.injector.get(IT,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Tl=t.get(kT);const n=t.get(vT,null);n&&n.forEach(e=>e())}(yt.create({providers:y,name:i}))}return function(t){const n=AT();if(!n)throw new Error("No platform exists!");if(!n.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return n}(o)}}function AT(){return Tl&&!Tl.destroyed?Tl:null}let kT=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const y=function(t,n){let e;return e="noop"===t?new zF:("zone.js"===t?void 0:t)||new En({enableLongStackTrace:zb(),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),e}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),C=[{provide:En,useValue:y}];return y.run(()=>{const M=yt.create({providers:C,parent:this.injector,name:e.moduleType.name}),k=e.create(M),L=k.injector.get(ul,null);if(!L)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return y.runOutsideAngular(()=>{const U=y.onError.subscribe({next:q=>{L.handleError(q)}});k.onDestroy(()=>{jb(this._modules,k),U.unsubscribe()})}),function(t,n,e){try{const i=e();return bg(i)?i.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):i}catch(i){throw n.runOutsideAngular(()=>t.handleError(i)),i}}(L,y,()=>{const U=k.injector.get(Vp);return U.runInitializers(),U.donePromise.then(()=>(Q1(k.injector.get(oa,s0)||s0),this._moduleDoBootstrap(k),k))})})}bootstrapModule(e,i=[]){const o=NT({},i);return function(t,n,e){const i=new xb(e);return Promise.resolve(i)}(0,0,e).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(e){const i=e.injector.get(Ml);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(o=>i.bootstrap(o));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${jt(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(Be(yt))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();function NT(t,n){return Array.isArray(n)?n.reduce(NT,t):Object.assign(Object.assign({},t),n)}let Ml=(()=>{class t{constructor(e,i,o,c,f){this._zone=e,this._injector=i,this._exceptionHandler=o,this._componentFactoryResolver=c,this._initStatus=f,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const y=new dn(M=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{M.next(this._stable),M.complete()})}),C=new dn(M=>{let k;this._zone.runOutsideAngular(()=>{k=this._zone.onStable.subscribe(()=>{En.assertNotInAngularZone(),Fb(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,M.next(!0))})})});const L=this._zone.onUnstable.subscribe(()=>{En.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{M.next(!1)}))});return()=>{k.unsubscribe(),L.unsubscribe()}});this.isStable=function(...t){let n=Number.POSITIVE_INFINITY,e=null,i=t[t.length-1];return Io(i)?(e=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof i&&(n=t.pop()),null===e&&1===t.length&&t[0]instanceof dn?t[0]:fr(n)(zi(t,e))}(y,C.pipe(t=>ha()(function(t,n){return function(i){let o;o="function"==typeof t?t:function(){return t};const c=Object.create(i,Sd);return c.source=i,c.subjectFactory=o,c}}($a)(t))))}bootstrap(e,i){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let o;o=e instanceof oE?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(o.componentType);const c=function(t){return t.isBoundToModule}(o)?void 0:this._injector.get(yc),y=o.create(yt.NULL,[],i||o.selector,c),C=y.location.nativeElement,M=y.injector.get(Bb,null),k=M&&y.injector.get(ET);return M&&k&&k.registerApplication(C,M),y.onDestroy(()=>{this.detachView(y.hostView),jb(this.components,y),k&&k.unregisterApplication(C)}),this._loadComponent(y),y}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;jb(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(bT,[]).concat(this._bootstrapListeners).forEach(o=>o(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(e){return new(e||t)(Be(En),Be(yt),Be(ul),Be(ra),Be(Vp))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();function jb(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}class E0{}class nO{}const iO={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let rO=(()=>{class t{constructor(e,i){this._compiler=e,this._config=i||iO}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[i,o]=e.split("#");return void 0===o&&(o="default"),Li(255)(i).then(c=>c[o]).then(c=>OT(c,i,o)).then(c=>this._compiler.compileModuleAsync(c))}loadFactory(e){let[i,o]=e.split("#"),c="NgFactory";return void 0===o&&(o="default",c=""),Li(255)(this._config.factoryPathPrefix+i+this._config.factoryPathSuffix).then(f=>f[o+c]).then(f=>OT(f,i,o))}}return t.\u0275fac=function(e){return new(e||t)(Be(kh),Be(nO,8))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();function OT(t,n,e){if(!t)throw new Error(`Cannot find '${e}' in '${n}'`);return t}const pO=ST(null,"core",[{provide:$g,useValue:"unknown"},{provide:kT,deps:[yt]},{provide:ET,deps:[]},{provide:C0,deps:[]}]),vO=[{provide:Ml,useClass:Ml,deps:[En,yt,ul,ra,Vp]},{provide:ER,deps:[En],useFactory:function(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(e){n.push(e)}}},{provide:Vp,useClass:Vp,deps:[[new Vo,Ug]]},{provide:kh,useClass:kh,deps:[]},TF,{provide:Mg,useFactory:function(){return vP},deps:[]},{provide:Np,useFactory:function(){return bP},deps:[]},{provide:oa,useFactory:function(t){return Q1(t=t||"undefined"!=typeof $localize&&$localize.locale||s0),t},deps:[[new Yc(oa),new Vo,new zo]]},{provide:xT,useValue:"USD"}];let xO=(()=>{class t{constructor(e){}}return t.\u0275fac=function(e){return new(e||t)(Be(Ml))},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({providers:vO}),t})(),F0=null;function vc(){return F0}const Bn=new bt("DocumentToken");let Rh=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({factory:bL,token:t,providedIn:"platform"}),t})();function bL(){return Be(sM)}const xL=new bt("Location Initialized");let sM=(()=>{class t extends Rh{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return vc().getBaseHref(this._doc)}onPopState(e){const i=vc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=vc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,o){aM()?this._history.pushState(e,i,o):this.location.hash=o}replaceState(e,i,o){aM()?this._history.replaceState(e,i,o):this.location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(Be(Bn))},t.\u0275prov=ct({factory:wL,token:t,providedIn:"platform"}),t})();function aM(){return!!window.history.pushState}function wL(){return new sM(Be(Bn))}function ix(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function lM(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function pu(t){return t&&"?"!==t[0]?"?"+t:t}let jp=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({factory:CL,token:t,providedIn:"root"}),t})();function CL(t){const n=Be(Bn).location;return new cM(Be(Rh),n&&n.origin||"")}const rx=new bt("appBaseHref");let cM=(()=>{class t extends jp{constructor(e,i){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return ix(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+pu(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${i}${o}`:i}pushState(e,i,o,c){const f=this.prepareExternalUrl(o+pu(c));this._platformLocation.pushState(e,i,f)}replaceState(e,i,o,c){const f=this.prepareExternalUrl(o+pu(c));this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var i,o;null===(o=(i=this._platformLocation).historyGo)||void 0===o||o.call(i,e)}}return t.\u0275fac=function(e){return new(e||t)(Be(Rh),Be(rx,8))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})(),DL=(()=>{class t extends jp{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=ix(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,o,c){let f=this.prepareExternalUrl(o+pu(c));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(e,i,f)}replaceState(e,i,o,c){let f=this.prepareExternalUrl(o+pu(c));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var i,o;null===(o=(i=this._platformLocation).historyGo)||void 0===o||o.call(i,e)}}return t.\u0275fac=function(e){return new(e||t)(Be(Rh),Be(rx,8))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})(),O0=(()=>{class t{constructor(e,i){this._subject=new Ct,this._urlChangeListeners=[],this._platformStrategy=e;const o=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=lM(uM(o)),this._platformStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+pu(i))}normalize(e){return t.stripTrailingSlash(function(t,n){return t&&n.startsWith(t)?n.substring(t.length):n}(this._baseHref,uM(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,i="",o=null){this._platformStrategy.pushState(o,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+pu(i)),o)}replaceState(e,i="",o=null){this._platformStrategy.replaceState(o,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+pu(i)),o)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var i,o;null===(o=(i=this._platformStrategy).historyGo)||void 0===o||o.call(i,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(o=>o(e,i))}subscribe(e,i,o){return this._subject.subscribe({next:e,error:i,complete:o})}}return t.\u0275fac=function(e){return new(e||t)(Be(jp),Be(Rh))},t.normalizeQueryParams=pu,t.joinWithSlash=ix,t.stripTrailingSlash=lM,t.\u0275prov=ct({factory:EL,token:t,providedIn:"root"}),t})();function EL(){return new O0(Be(jp),Be(Rh))}function uM(t){return t.replace(/\/index.html$/,"")}var xr=(()=>((xr=xr||{})[xr.Zero=0]="Zero",xr[xr.One=1]="One",xr[xr.Two=2]="Two",xr[xr.Few=3]="Few",xr[xr.Many=4]="Many",xr[xr.Other=5]="Other",xr))();const AL=function(t){return function(t){const n=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let e=RD(n);if(e)return e;const i=n.split("-")[0];if(e=RD(i),e)return e;if("en"===i)return Qk;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[gt.PluralCase]};class q0{}let o3=(()=>{class t extends q0{constructor(e){super(),this.locale=e}getPluralCategory(e,i){switch(AL(i||this.locale)(e)){case xr.Zero:return"zero";case xr.One:return"one";case xr.Two:return"two";case xr.Few:return"few";case xr.Many:return"many";default:return"other"}}}return t.\u0275fac=function(e){return new(e||t)(Be(oa))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})(),sa=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({providers:[{provide:q0,useClass:o3}]}),t})();const MM="browser";let SM=(()=>{class t{}return t.\u0275prov=ct({token:t,providedIn:"root",factory:()=>new B3(Be(Bn),window)}),t})();class B3{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const i=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=i.currentNode;for(;o;){const c=o.shadowRoot;if(c){const f=c.getElementById(n)||c.querySelector(`[name="${n}"]`);if(f)return f}o=i.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),this.attemptFocus(e))}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=n)}}scrollToElement(n){const e=n.getBoundingClientRect(),i=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(i-c[0],o-c[1])}attemptFocus(n){return n.focus(),this.document.activeElement===n}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=AM(this.window.history)||AM(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch(n){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(n){return!1}}}function AM(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class yx extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(t){F0||(F0=t)}(new yx)}onAndCancel(n,e,i){return n.addEventListener(e,i,!1),()=>{n.removeEventListener(e,i,!1)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=(Yg=Yg||document.querySelector("base"),Yg?Yg.getAttribute("href"):null);return null==e?null:function(t){W0=W0||document.createElement("a"),W0.setAttribute("href",t);const n=W0.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){Yg=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const i=e.indexOf("="),[o,c]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(o.trim()===n)return decodeURIComponent(c)}return null}(document.cookie,n)}}let W0,Yg=null;const kM=new bt("TRANSITION_ID"),G3=[{provide:Ug,useFactory:function(t,n,e){return()=>{e.get(Vp).donePromise.then(()=>{const i=vc(),o=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let c=0;c<o.length;c++)i.remove(o[c])})}},deps:[kM,Bn,yt],multi:!0}];class vx{static init(){!function(t){Vb=t}(new vx)}addToWindow(n){ln.getAngularTestability=(i,o=!0)=>{const c=n.findTestabilityInTree(i,o);if(null==c)throw new Error("Could not find testability for element.");return c},ln.getAllAngularTestabilities=()=>n.getAllTestabilities(),ln.getAllAngularRootElements=()=>n.getAllRootElements(),ln.frameworkStabilizers||(ln.frameworkStabilizers=[]),ln.frameworkStabilizers.push(i=>{const o=ln.getAllAngularTestabilities();let c=o.length,f=!1;const y=function(C){f=f||C,c--,0==c&&i(f)};o.forEach(function(C){C.whenStable(y)})})}findTestabilityInTree(n,e,i){if(null==e)return null;const o=n.getTestability(e);return null!=o?o:i?vc().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null}}let q3=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const Kg=new bt("EventManagerPlugins");let X0=(()=>{class t{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(o=>o.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,o){return this._findPluginFor(i).addEventListener(e,i,o)}addGlobalEventListener(e,i,o){return this._findPluginFor(i).addGlobalEventListener(e,i,o)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const o=this._plugins;for(let c=0;c<o.length;c++){const f=o[c];if(f.supports(e))return this._eventNameToPlugin.set(e,f),f}throw new Error(`No event manager plugin found for event ${e}`)}}return t.\u0275fac=function(e){return new(e||t)(Be(Kg),Be(En))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();class bx{constructor(n){this._doc=n}addGlobalEventListener(n,e,i){const o=vc().getGlobalEventTarget(this._doc,n);if(!o)throw new Error(`Unsupported event target ${o} for event ${e}`);return this.addEventListener(o,e,i)}}let PM=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),i.add(o))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})(),Jg=(()=>{class t extends PM{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,o){e.forEach(c=>{const f=this._doc.createElement("style");f.textContent=c,o.push(i.appendChild(f))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(RM),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,o)=>{this._addStylesToHost(e,o,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(RM))}}return t.\u0275fac=function(e){return new(e||t)(Be(Bn))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();function RM(t){vc().remove(t)}const xx={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},wx=/%COMP%/g;function Y0(t,n,e){for(let i=0;i<n.length;i++){let o=n[i];Array.isArray(o)?Y0(t,o,e):(o=o.replace(wx,t),e.push(o))}return e}function LM(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let Cx=(()=>{class t{constructor(e,i,o){this.eventManager=e,this.sharedStylesHost=i,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new Dx(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case vi.Emulated:{let o=this.rendererByCompId.get(i.id);return o||(o=new aB(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,o)),o.applyToHost(e),o}case 1:case vi.ShadowDom:return new lB(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const o=Y0(i.id,i.styles,[]);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(Be(X0),Be(Jg),Be(jg))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();class Dx{constructor(n){this.eventManager=n,this.data=Object.create(null)}destroy(){}createElement(n,e){return e?document.createElementNS(xx[e]||e,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,e){n.appendChild(e)}insertBefore(n,e,i){n&&n.insertBefore(e,i)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let i="string"==typeof n?document.querySelector(n):n;if(!i)throw new Error(`The selector "${n}" did not match any elements`);return e||(i.textContent=""),i}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,i,o){if(o){e=o+":"+e;const c=xx[o];c?n.setAttributeNS(c,e,i):n.setAttribute(e,i)}else n.setAttribute(e,i)}removeAttribute(n,e,i){if(i){const o=xx[i];o?n.removeAttributeNS(o,e):n.removeAttribute(`${i}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,i,o){o&(ss.DashCase|ss.Important)?n.style.setProperty(e,i,o&ss.Important?"important":""):n.style[e]=i}removeStyle(n,e,i){i&ss.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,i){n[e]=i}setValue(n,e){n.nodeValue=e}listen(n,e,i){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,e,LM(i)):this.eventManager.addEventListener(n,e,LM(i))}}class aB extends Dx{constructor(n,e,i,o){super(n),this.component=i;const c=Y0(o+"-"+i.id,i.styles,[]);e.addStyles(c),this.contentAttr=function(t){return"_ngcontent-%COMP%".replace(wx,t)}(o+"-"+i.id),this.hostAttr=function(t){return"_nghost-%COMP%".replace(wx,t)}(o+"-"+i.id)}applyToHost(n){super.setAttribute(n,this.hostAttr,"")}createElement(n,e){const i=super.createElement(n,e);return super.setAttribute(i,this.contentAttr,""),i}}class lB extends Dx{constructor(n,e,i,o){super(n),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=Y0(o.id,o.styles,[]);for(let f=0;f<c.length;f++){const y=document.createElement("style");y.textContent=c[f],this.shadowRoot.appendChild(y)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,i){return super.insertBefore(this.nodeOrShadowRoot(n),e,i)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}}let cB=(()=>{class t extends bx{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,o){return e.addEventListener(i,o,!1),()=>this.removeEventListener(e,i,o)}removeEventListener(e,i,o){return e.removeEventListener(i,o)}}return t.\u0275fac=function(e){return new(e||t)(Be(Bn))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const zM=["alt","control","meta","shift"],gB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},UM={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},_B={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let yB=(()=>{class t extends bx{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,i,o){const c=t.parseEventName(i),f=t.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>vc().onAndCancel(e,c.domEventName,f))}static parseEventName(e){const i=e.toLowerCase().split("."),o=i.shift();if(0===i.length||"keydown"!==o&&"keyup"!==o)return null;const c=t._normalizeKey(i.pop());let f="";if(zM.forEach(C=>{const M=i.indexOf(C);M>-1&&(i.splice(M,1),f+=C+".")}),f+=c,0!=i.length||0===c.length)return null;const y={};return y.domEventName=o,y.fullKey=f,y}static getEventFullKey(e){let i="",o=function(t){let n=t.key;if(null==n){if(n=t.keyIdentifier,null==n)return"Unidentified";n.startsWith("U+")&&(n=String.fromCharCode(parseInt(n.substring(2),16)),3===t.location&&UM.hasOwnProperty(n)&&(n=UM[n]))}return gB[n]||n}(e);return o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),zM.forEach(c=>{c!=o&&_B[c](e)&&(i+=c+".")}),i+=o,i}static eventCallback(e,i,o){return c=>{t.getEventFullKey(c)===e&&o.runGuarded(()=>i(c))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return t.\u0275fac=function(e){return new(e||t)(Be(Bn))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const TB=ST(pO,"browser",[{provide:$g,useValue:MM},{provide:vT,useValue:function(){yx.makeCurrent(),vx.init()},multi:!0},{provide:Bn,useFactory:function(){return function(t){Cs=t}(document),document},deps:[]}]),MB=[[],{provide:ye,useValue:"root"},{provide:ul,useFactory:function(){return new ul},deps:[]},{provide:Kg,useClass:cB,multi:!0,deps:[Bn,En,$g]},{provide:Kg,useClass:yB,multi:!0,deps:[Bn]},[],{provide:Cx,useClass:Cx,deps:[X0,Jg,jg]},{provide:kp,useExisting:Cx},{provide:PM,useExisting:Jg},{provide:Jg,useClass:Jg,deps:[Bn]},{provide:Bb,useClass:Bb,deps:[En]},{provide:X0,useClass:X0,deps:[Kg,En]},{provide:class{},useClass:q3,deps:[]},[]];let IB=(()=>{class t{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:jg,useValue:e.appId},{provide:kM,useExisting:jg},G3]}}}return t.\u0275fac=function(e){return new(e||t)(Be(t,12))},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({providers:MB,imports:[sa,xO]}),t})();function Wt(...t){let n=t[t.length-1];return Io(n)?(t.pop(),$s(t,n)):zi(t)}"undefined"!=typeof window&&window;class Vr extends Rn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return e&&!e.closed&&n.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ca;return this._value}next(n){super.next(this._value=n)}}class Sx extends Mt{notifyNext(n,e,i,o,c){this.destination.next(e)}notifyError(n,e){this.destination.error(n)}notifyComplete(n){this.destination.complete()}}class OB extends Mt{constructor(n,e,i){super(),this.parent=n,this.outerValue=e,this.outerIndex=i,this.index=0}_next(n){this.parent.notifyNext(this.outerValue,n,this.outerIndex,this.index++,this)}_error(n){this.parent.notifyError(n,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function Ax(t,n,e,i,o=new OB(t,e,i)){if(!o.closed)return n instanceof dn?n.subscribe(o):ua(n)(o)}const $M={};class LB{constructor(n){this.resultSelector=n}call(n,e){return e.subscribe(new BB(n,this.resultSelector))}}class BB extends Sx{constructor(n,e){super(n),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(n){this.values.push($M),this.observables.push(n)}_complete(){const n=this.observables,e=n.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let i=0;i<e;i++)this.add(Ax(this,n[i],void 0,i))}}notifyComplete(n){0==(this.active-=1)&&this.destination.complete()}notifyNext(n,e,i){const o=this.values,f=this.toRespond?o[i]===$M?--this.toRespond:this.toRespond:0;o[i]=e,0===f&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))}_tryResultSelector(n){let e;try{e=this.resultSelector.apply(this,n)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}const K0=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function J0(...t){return fr(1)(Wt(...t))}const Fh=new dn(t=>t.complete());function Q0(t){return t?function(t){return new dn(n=>t.schedule(()=>n.complete()))}(t):Fh}function HM(t){return new dn(n=>{let e;try{e=t()}catch(o){return void n.error(o)}return(e?oi(e):Q0()).subscribe(n)})}function Pl(t,n){return"function"==typeof n?e=>e.pipe(Pl((i,o)=>oi(t(i,o)).pipe(Ut((c,f)=>n(i,c,o,f))))):e=>e.lift(new UB(t))}class UB{constructor(n){this.project=n}call(n,e){return e.subscribe(new jB(n,this.project))}}class jB extends So{constructor(n,e){super(n),this.project=e,this.index=0}_next(n){let e;const i=this.index++;try{e=this.project(n,i)}catch(o){return void this.destination.error(o)}this._innerSub(e)}_innerSub(n){const e=this.innerSubscription;e&&e.unsubscribe();const i=new Hr(this),o=this.destination;o.add(i),this.innerSubscription=ys(n,i),this.innerSubscription!==i&&o.add(this.innerSubscription)}_complete(){const{innerSubscription:n}=this;(!n||n.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(n){this.destination.next(n)}}const GM=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function fs(t){return n=>0===t?Q0():n.lift(new $B(t))}class $B{constructor(n){if(this.total=n,this.total<0)throw new GM}call(n,e){return e.subscribe(new HB(n,this.total))}}class HB extends Mt{constructor(n,e){super(n),this.total=e,this.count=0}_next(n){const e=this.total,i=++this.count;i<=e&&(this.destination.next(n),i===e&&(this.destination.complete(),this.unsubscribe()))}}function qM(t,n){let e=!1;return arguments.length>=2&&(e=!0),function(o){return o.lift(new GB(t,n,e))}}class GB{constructor(n,e,i=!1){this.accumulator=n,this.seed=e,this.hasSeed=i}call(n,e){return e.subscribe(new qB(n,this.accumulator,this.seed,this.hasSeed))}}class qB extends Mt{constructor(n,e,i,o){super(n),this.accumulator=e,this._seed=i,this.hasSeed=o,this.index=0}get seed(){return this._seed}set seed(n){this.hasSeed=!0,this._seed=n}_next(n){if(this.hasSeed)return this._tryNext(n);this.seed=n,this.destination.next(n)}_tryNext(n){const e=this.index++;let i;try{i=this.accumulator(this.seed,n,e)}catch(o){this.destination.error(o)}this.seed=i,this.destination.next(i)}}function zr(t,n){return function(i){return i.lift(new WB(t,n))}}class WB{constructor(n,e){this.predicate=n,this.thisArg=e}call(n,e){return e.subscribe(new ZB(n,this.predicate,this.thisArg))}}class ZB extends Mt{constructor(n,e,i){super(n),this.predicate=e,this.thisArg=i,this.count=0}_next(n){let e;try{e=this.predicate.call(this.thisArg,n,this.count++)}catch(i){return void this.destination.error(i)}e&&this.destination.next(n)}}function Oh(t){return function(e){const i=new XB(t),o=e.lift(i);return i.caught=o}}class XB{constructor(n){this.selector=n}call(n,e){return e.subscribe(new YB(n,this.selector,this.caught))}}class YB extends So{constructor(n,e,i){super(n),this.selector=e,this.caught=i}error(n){if(!this.isStopped){let e;try{e=this.selector(n,this.caught)}catch(c){return void super.error(c)}this._unsubscribeAndRecycle();const i=new Hr(this);this.add(i);const o=ys(e,i);o!==i&&this.add(o)}}}function Qg(t,n){return ai(t,n,1)}function Nx(t){return function(e){return 0===t?Q0():e.lift(new KB(t))}}class KB{constructor(n){if(this.total=n,this.total<0)throw new GM}call(n,e){return e.subscribe(new JB(n,this.total))}}class JB extends Mt{constructor(n,e){super(n),this.total=e,this.ring=new Array,this.count=0}_next(n){const e=this.ring,i=this.total,o=this.count++;e.length<i?e.push(n):e[o%i]=n}_complete(){const n=this.destination;let e=this.count;if(e>0){const i=this.count>=this.total?this.total:this.count,o=this.ring;for(let c=0;c<i;c++){const f=e++%i;n.next(o[f])}}n.complete()}}function WM(t=tV){return n=>n.lift(new QB(t))}class QB{constructor(n){this.errorFactory=n}call(n,e){return e.subscribe(new eV(n,this.errorFactory))}}class eV extends Mt{constructor(n,e){super(n),this.errorFactory=e,this.hasValue=!1}_next(n){this.hasValue=!0,this.destination.next(n)}_complete(){if(this.hasValue)return this.destination.complete();{let n;try{n=this.errorFactory()}catch(e){n=e}this.destination.error(n)}}}function tV(){return new K0}function ZM(t=null){return n=>n.lift(new nV(t))}class nV{constructor(n){this.defaultValue=n}call(n,e){return e.subscribe(new iV(n,this.defaultValue))}}class iV extends Mt{constructor(n,e){super(n),this.defaultValue=e,this.isEmpty=!0}_next(n){this.isEmpty=!1,this.destination.next(n)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function $p(t,n){const e=arguments.length>=2;return i=>i.pipe(t?zr((o,c)=>t(o,c,i)):Mo,fs(1),e?ZM(n):WM(()=>new K0))}function gu(){}function bo(t,n,e){return function(o){return o.lift(new oV(t,n,e))}}class oV{constructor(n,e,i){this.nextOrObserver=n,this.error=e,this.complete=i}call(n,e){return e.subscribe(new sV(n,this.nextOrObserver,this.error,this.complete))}}class sV extends Mt{constructor(n,e,i,o){super(n),this._tapNext=gu,this._tapError=gu,this._tapComplete=gu,this._tapError=i||gu,this._tapComplete=o||gu,gs(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||gu,this._tapError=e.error||gu,this._tapComplete=e.complete||gu)}_next(n){try{this._tapNext.call(this._context,n)}catch(e){return void this.destination.error(e)}this.destination.next(n)}_error(n){try{this._tapError.call(this._context,n)}catch(e){return void this.destination.error(e)}this.destination.error(n)}_complete(){try{this._tapComplete.call(this._context)}catch(n){return void this.destination.error(n)}return this.destination.complete()}}class lV{constructor(n){this.callback=n}call(n,e){return e.subscribe(new cV(n,this.callback))}}class cV extends Mt{constructor(n,e){super(n),this.add(new ut(e))}}class _u{constructor(n,e){this.id=n,this.url=e}}class Px extends _u{constructor(n,e,i="imperative",o=null){super(n,e),this.navigationTrigger=i,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class e_ extends _u{constructor(n,e,i){super(n,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class XM extends _u{constructor(n,e,i){super(n,e),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class uV extends _u{constructor(n,e,i){super(n,e),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class dV extends _u{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class hV extends _u{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fV extends _u{constructor(n,e,i,o,c){super(n,e),this.urlAfterRedirects=i,this.state=o,this.shouldActivate=c}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class pV extends _u{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mV extends _u{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class YM{constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class KM{constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class gV{constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _V{constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class yV{constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vV{constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JM{constructor(n,e,i){this.routerEvent=n,this.position=e,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const xn="primary";class bV{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Hp(t){return new bV(t)}const QM="ngNavigationCancelingError";function Rx(t){const n=Error("NavigationCancelingError: "+t);return n[QM]=!0,n}function wV(t,n,e){const i=e.path.split("/");if(i.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||i.length<t.length))return null;const o={};for(let c=0;c<i.length;c++){const f=i[c],y=t[c];if(f.startsWith(":"))o[f.substring(1)]=y;else if(f!==y.path)return null}return{consumed:t.slice(0,i.length),posParams:o}}function bc(t,n){const e=t?Object.keys(t):void 0,i=n?Object.keys(n):void 0;if(!e||!i||e.length!=i.length)return!1;let o;for(let c=0;c<e.length;c++)if(o=e[c],!eI(t[o],n[o]))return!1;return!0}function eI(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),i=[...n].sort();return e.every((o,c)=>i[c]===o)}return t===n}function tI(t){return Array.prototype.concat.apply([],t)}function nI(t){return t.length>0?t[t.length-1]:null}function xo(t,n){for(const e in t)t.hasOwnProperty(e)&&n(t[e],e)}function xc(t){return n0(t)?t:bg(t)?oi(Promise.resolve(t)):Wt(t)}const EV={exact:function oI(t,n,e){if(!Bh(t.segments,n.segments)||!tv(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!oI(t.children[i],n.children[i],e))return!1;return!0},subset:sI},iI={exact:function(t,n){return bc(t,n)},subset:function(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>eI(t[e],n[e]))},ignored:()=>!0};function rI(t,n,e){return EV[e.paths](t.root,n.root,e.matrixParams)&&iI[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function sI(t,n,e){return aI(t,n,n.segments,e)}function aI(t,n,e,i){if(t.segments.length>e.length){const o=t.segments.slice(0,e.length);return!(!Bh(o,e)||n.hasChildren()||!tv(o,e,i))}if(t.segments.length===e.length){if(!Bh(t.segments,e)||!tv(t.segments,e,i))return!1;for(const o in n.children)if(!t.children[o]||!sI(t.children[o],n.children[o],i))return!1;return!0}{const o=e.slice(0,t.segments.length),c=e.slice(t.segments.length);return!!(Bh(t.segments,o)&&tv(t.segments,o,i)&&t.children[xn])&&aI(t.children[xn],n,c,i)}}function tv(t,n,e){return n.every((i,o)=>iI[e](t[o].parameters,i.parameters))}class Lh{constructor(n,e,i){this.root=n,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hp(this.queryParams)),this._queryParamMap}toString(){return AV.serialize(this)}}class In{constructor(n,e){this.segments=n,this.children=e,this.parent=null,xo(e,(i,o)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return nv(this)}}class t_{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Hp(this.parameters)),this._parameterMap}toString(){return dI(this)}}function Bh(t,n){return t.length===n.length&&t.every((e,i)=>e.path===n[i].path)}class Fx{}class lI{parse(n){const e=new VV(n);return new Lh(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){return`${`/${n_(n.root,!0)}`}${function(t){const n=Object.keys(t).map(e=>{const i=t[e];return Array.isArray(i)?i.map(o=>`${iv(e)}=${iv(o)}`).join("&"):`${iv(e)}=${iv(i)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams)}${"string"==typeof n.fragment?`#${function(t){return encodeURI(t)}(n.fragment)}`:""}`}}const AV=new lI;function nv(t){return t.segments.map(n=>dI(n)).join("/")}function n_(t,n){if(!t.hasChildren())return nv(t);if(n){const e=t.children[xn]?n_(t.children[xn],!1):"",i=[];return xo(t.children,(o,c)=>{c!==xn&&i.push(`${c}:${n_(o,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function(t,n){let e=[];return xo(t.children,(i,o)=>{o===xn&&(e=e.concat(n(i,o)))}),xo(t.children,(i,o)=>{o!==xn&&(e=e.concat(n(i,o)))}),e}(t,(i,o)=>o===xn?[n_(t.children[xn],!1)]:[`${o}:${n_(i,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[xn]?`${nv(t)}/${e[0]}`:`${nv(t)}/(${e.join("//")})`}}function cI(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function iv(t){return cI(t).replace(/%3B/gi,";")}function Ox(t){return cI(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function rv(t){return decodeURIComponent(t)}function uI(t){return rv(t.replace(/\+/g,"%20"))}function dI(t){return`${Ox(t.path)}${function(t){return Object.keys(t).map(n=>`;${Ox(n)}=${Ox(t[n])}`).join("")}(t.parameters)}`}const RV=/^[^\/()?;=#]+/;function ov(t){const n=t.match(RV);return n?n[0]:""}const FV=/^[^=?&#]+/,LV=/^[^?&#]+/;class VV{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new In([],{}):new In([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(i[xn]=new In(n,e)),i}parseSegment(){const n=ov(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(n),new t_(rv(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=ov(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const o=ov(this.remaining);o&&(i=o,this.capture(i))}n[rv(e)]=rv(i)}parseQueryParam(n){const e=function(t){const n=t.match(FV);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const f=function(t){const n=t.match(LV);return n?n[0]:""}(this.remaining);f&&(i=f,this.capture(i))}const o=uI(e),c=uI(i);if(n.hasOwnProperty(o)){let f=n[o];Array.isArray(f)||(f=[f],n[o]=f),f.push(c)}else n[o]=c}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=ov(this.remaining),o=this.remaining[i.length];if("/"!==o&&")"!==o&&";"!==o)throw new Error(`Cannot parse url '${this.url}'`);let c;i.indexOf(":")>-1?(c=i.substr(0,i.indexOf(":")),this.capture(c),this.capture(":")):n&&(c=xn);const f=this.parseChildren();e[c]=1===Object.keys(f).length?f[xn]:new In([],f),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Error(`Expected "${n}".`)}}class hI{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Lx(n,this._root);return e?e.children.map(i=>i.value):[]}firstChild(n){const e=Lx(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=Bx(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Bx(n,this._root).map(e=>e.value)}}function Lx(t,n){if(t===n.value)return n;for(const e of n.children){const i=Lx(t,e);if(i)return i}return null}function Bx(t,n){if(t===n.value)return[n];for(const e of n.children){const i=Bx(t,e);if(i.length)return i.unshift(n),i}return[]}class yu{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function i_(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class fI extends hI{constructor(n,e){super(n),this.snapshot=e,Vx(this,n)}toString(){return this.snapshot.toString()}}function pI(t,n){const e=function(t,n){const f=new sv([],{},{},"",{},xn,n,null,t.root,-1,{});return new gI("",new yu(f,[]))}(t,n),i=new Vr([new t_("",{})]),o=new Vr({}),c=new Vr({}),f=new Vr({}),y=new Vr(""),C=new Gp(i,o,f,y,c,xn,n,e.root);return C.snapshot=e.root,new fI(new yu(C,[]),e)}class Gp{constructor(n,e,i,o,c,f,y,C){this.url=n,this.params=e,this.queryParams=i,this.fragment=o,this.data=c,this.outlet=f,this.component=y,this._futureSnapshot=C}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Ut(n=>Hp(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Ut(n=>Hp(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function mI(t,n="emptyOnly"){const e=t.pathFromRoot;let i=0;if("always"!==n)for(i=e.length-1;i>=1;){const o=e[i],c=e[i-1];if(o.routeConfig&&""===o.routeConfig.path)i--;else{if(c.component)break;i--}}return function(t){return t.reduce((n,e)=>({params:Object.assign(Object.assign({},n.params),e.params),data:Object.assign(Object.assign({},n.data),e.data),resolve:Object.assign(Object.assign({},n.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(e.slice(i))}class sv{constructor(n,e,i,o,c,f,y,C,M,k,L){this.url=n,this.params=e,this.queryParams=i,this.fragment=o,this.data=c,this.outlet=f,this.component=y,this.routeConfig=C,this._urlSegment=M,this._lastPathIndex=k,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Hp(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hp(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class gI extends hI{constructor(n,e){super(e),this.url=n,Vx(this,e)}toString(){return _I(this._root)}}function Vx(t,n){n.value._routerState=t,n.children.forEach(e=>Vx(t,e))}function _I(t){const n=t.children.length>0?` { ${t.children.map(_I).join(", ")} } `:"";return`${t.value}${n}`}function zx(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,bc(n.queryParams,e.queryParams)||t.queryParams.next(e.queryParams),n.fragment!==e.fragment&&t.fragment.next(e.fragment),bc(n.params,e.params)||t.params.next(e.params),function(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!bc(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.url.next(e.url),bc(n.data,e.data)||t.data.next(e.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Ux(t,n){return bc(t.params,n.params)&&function(t,n){return Bh(t,n)&&t.every((e,i)=>bc(e.parameters,n[i].parameters))}(t.url,n.url)&&!(!t.parent!=!n.parent)&&(!t.parent||Ux(t.parent,n.parent))}function av(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=n.value;const o=function(t,n,e){return n.children.map(i=>{for(const o of e.children)if(t.shouldReuseRoute(i.value,o.value.snapshot))return av(t,i,o);return av(t,i)})}(t,n,e);return new yu(i,o)}{if(t.shouldAttach(n.value)){const c=t.retrieve(n.value);if(null!==c){const f=c.route;return yI(n,f),f}}const i=function(t){return new Gp(new Vr(t.url),new Vr(t.params),new Vr(t.queryParams),new Vr(t.fragment),new Vr(t.data),t.outlet,t.component,t)}(n.value),o=n.children.map(c=>av(t,c));return new yu(i,o)}}function yI(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(let e=0;e<t.children.length;++e)yI(t.children[e],n.children[e])}function lv(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function r_(t){return"object"==typeof t&&null!=t&&t.outlets}function jx(t,n,e,i,o){let c={};return i&&xo(i,(f,y)=>{c[y]=Array.isArray(f)?f.map(C=>`${C}`):`${f}`}),new Lh(e.root===t?n:vI(e.root,t,n),c,o)}function vI(t,n,e){const i={};return xo(t.children,(o,c)=>{i[c]=o===n?e:vI(o,n,e)}),new In(t.segments,i)}class bI{constructor(n,e,i){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=i,n&&i.length>0&&lv(i[0]))throw new Error("Root segment cannot have matrix parameters");const o=i.find(r_);if(o&&o!==nI(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class $x{constructor(n,e,i){this.segmentGroup=n,this.processChildren=e,this.index=i}}function xI(t,n,e){if(t||(t=new In([],{})),0===t.segments.length&&t.hasChildren())return cv(t,n,e);const i=function(t,n,e){let i=0,o=n;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(i>=e.length)return c;const f=t.segments[o],y=e[i];if(r_(y))break;const C=`${y}`,M=i<e.length-1?e[i+1]:null;if(o>0&&void 0===C)break;if(C&&M&&"object"==typeof M&&void 0===M.outlets){if(!CI(C,M,f))return c;i+=2}else{if(!CI(C,{},f))return c;i++}o++}return{match:!0,pathIndex:o,commandIndex:i}}(t,n,e),o=e.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const c=new In(t.segments.slice(0,i.pathIndex),{});return c.children[xn]=new In(t.segments.slice(i.pathIndex),t.children),cv(c,0,o)}return i.match&&0===o.length?new In(t.segments,{}):i.match&&!t.hasChildren()?Hx(t,n,e):i.match?cv(t,0,o):Hx(t,n,e)}function cv(t,n,e){if(0===e.length)return new In(t.segments,{});{const i=function(t){return r_(t[0])?t[0].outlets:{[xn]:t}}(e),o={};return xo(i,(c,f)=>{"string"==typeof c&&(c=[c]),null!==c&&(o[f]=xI(t.children[f],n,c))}),xo(t.children,(c,f)=>{void 0===i[f]&&(o[f]=c)}),new In(t.segments,o)}}function Hx(t,n,e){const i=t.segments.slice(0,n);let o=0;for(;o<e.length;){const c=e[o];if(r_(c)){const C=KV(c.outlets);return new In(i,C)}if(0===o&&lv(e[0])){i.push(new t_(t.segments[n].path,wI(e[0]))),o++;continue}const f=r_(c)?c.outlets[xn]:`${c}`,y=o<e.length-1?e[o+1]:null;f&&y&&lv(y)?(i.push(new t_(f,wI(y))),o+=2):(i.push(new t_(f,{})),o++)}return new In(i,{})}function KV(t){const n={};return xo(t,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(n[i]=Hx(new In([],{}),0,e))}),n}function wI(t){const n={};return xo(t,(e,i)=>n[i]=`${e}`),n}function CI(t,n,e){return t==e.path&&bc(n,e.parameters)}class QV{constructor(n,e,i,o){this.routeReuseStrategy=n,this.futureState=e,this.currState=i,this.forwardEvent=o}activate(n){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,n),zx(this.futureState.root),this.activateChildRoutes(e,i,n)}deactivateChildRoutes(n,e,i){const o=i_(e);n.children.forEach(c=>{const f=c.value.outlet;this.deactivateRoutes(c,o[f],i),delete o[f]}),xo(o,(c,f)=>{this.deactivateRouteAndItsChildren(c,i)})}deactivateRoutes(n,e,i){const o=n.value,c=e?e.value:null;if(o===c)if(o.component){const f=i.getContext(o.outlet);f&&this.deactivateChildRoutes(n,e,f.children)}else this.deactivateChildRoutes(n,e,i);else c&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(n,e){this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const i=e.getContext(n.value.outlet);if(i&&i.outlet){const o=i.outlet.detach(),c=i.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:o,route:n,contexts:c})}}deactivateRouteAndOutlet(n,e){const i=e.getContext(n.value.outlet),o=i&&n.value.component?i.children:e,c=i_(n);for(const f of Object.keys(c))this.deactivateRouteAndItsChildren(c[f],o);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(n,e,i){const o=i_(e);n.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],i),this.forwardEvent(new vV(c.value.snapshot))}),n.children.length&&this.forwardEvent(new _V(n.value.snapshot))}activateRoutes(n,e,i){const o=n.value,c=e?e.value:null;if(zx(o),o===c)if(o.component){const f=i.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,f.children)}else this.activateChildRoutes(n,e,i);else if(o.component){const f=i.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const y=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),f.children.onOutletReAttached(y.contexts),f.attachRef=y.componentRef,f.route=y.route.value,f.outlet&&f.outlet.attach(y.componentRef,y.route.value),DI(y.route)}else{const y=function(t){for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(o.snapshot),C=y?y.module.componentFactoryResolver:null;f.attachRef=null,f.route=o,f.resolver=C,f.outlet&&f.outlet.activateWith(o,C),this.activateChildRoutes(n,null,f.children)}}else this.activateChildRoutes(n,null,i)}}function DI(t){zx(t.value),t.children.forEach(DI)}class Gx{constructor(n,e){this.routes=n,this.module=e}}function yd(t){return"function"==typeof t}function Vh(t){return t instanceof Lh}const o_=Symbol("INITIAL_VALUE");function s_(){return Pl(t=>function(...t){let n,e;return Io(t[t.length-1])&&(e=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Cr(t[0])&&(t=t[0]),zi(t,e).lift(new LB(n))}(t.map(n=>n.pipe(fs(1),function(...t){const n=t[t.length-1];return Io(n)?(t.pop(),e=>J0(t,e,n)):e=>J0(t,e)}(o_)))).pipe(qM((n,e)=>{let i=!1;return e.reduce((o,c,f)=>o!==o_?o:(c===o_&&(i=!0),i||!1!==c&&f!==e.length-1&&!Vh(c)?o:c),n)},o_),zr(n=>n!==o_),Ut(n=>Vh(n)?n:!0===n),fs(1)))}let EI=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,i){1&e&&Bt(0,"router-outlet")},directives:function(){return[Jx]},encapsulation:2}),t})();function TI(t,n=""){for(let e=0;e<t.length;e++){const i=t[e];sz(i,az(n,i))}}function sz(t,n){t.children&&TI(t.children,n)}function az(t,n){return n?t||n.path?t&&!n.path?`${t}/`:!t&&n.path?n.path:`${t}/${n.path}`:"":t}function qx(t){const n=t.children&&t.children.map(qx),e=n?Object.assign(Object.assign({},t),{children:n}):Object.assign({},t);return!e.component&&(n||e.loadChildren)&&e.outlet&&e.outlet!==xn&&(e.component=EI),e}function Oa(t){return t.outlet||xn}function MI(t,n){const e=t.filter(i=>Oa(i)===n);return e.push(...t.filter(i=>Oa(i)!==n)),e}const II={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function uv(t,n,e){var i;if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?Object.assign({},II):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const c=(n.matcher||wV)(e,t,n);if(!c)return Object.assign({},II);const f={};xo(c.posParams,(C,M)=>{f[M]=C.path});const y=c.consumed.length>0?Object.assign(Object.assign({},f),c.consumed[c.consumed.length-1].parameters):f;return{matched:!0,consumedSegments:c.consumed,lastChild:c.consumed.length,parameters:y,positionalParamSegments:null!==(i=c.posParams)&&void 0!==i?i:{}}}function dv(t,n,e,i,o="corrected"){if(e.length>0&&function(t,n,e){return e.some(i=>hv(t,n,i)&&Oa(i)!==xn)}(t,e,i)){const f=new In(n,function(t,n,e,i){const o={};o[xn]=i,i._sourceSegment=t,i._segmentIndexShift=n.length;for(const c of e)if(""===c.path&&Oa(c)!==xn){const f=new In([],{});f._sourceSegment=t,f._segmentIndexShift=n.length,o[Oa(c)]=f}return o}(t,n,i,new In(e,t.children)));return f._sourceSegment=t,f._segmentIndexShift=n.length,{segmentGroup:f,slicedSegments:[]}}if(0===e.length&&function(t,n,e){return e.some(i=>hv(t,n,i))}(t,e,i)){const f=new In(t.segments,function(t,n,e,i,o,c){const f={};for(const y of i)if(hv(t,e,y)&&!o[Oa(y)]){const C=new In([],{});C._sourceSegment=t,C._segmentIndexShift="legacy"===c?t.segments.length:n.length,f[Oa(y)]=C}return Object.assign(Object.assign({},o),f)}(t,n,e,i,t.children,o));return f._sourceSegment=t,f._segmentIndexShift=n.length,{segmentGroup:f,slicedSegments:e}}const c=new In(t.segments,t.children);return c._sourceSegment=t,c._segmentIndexShift=n.length,{segmentGroup:c,slicedSegments:e}}function hv(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}function SI(t,n,e,i){return!!(Oa(t)===i||i!==xn&&hv(n,e,t))&&("**"===t.path||uv(n,t,e).matched)}function AI(t,n,e){return 0===n.length&&!t.children[e]}class a_{constructor(n){this.segmentGroup=n||null}}class kI{constructor(n){this.urlTree=n}}function fv(t){return new dn(n=>n.error(new a_(t)))}function NI(t){return new dn(n=>n.error(new kI(t)))}function hz(t){return new dn(n=>n.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class mz{constructor(n,e,i,o,c){this.configLoader=e,this.urlSerializer=i,this.urlTree=o,this.config=c,this.allowRedirects=!0,this.ngModule=n.get(yc)}apply(){const n=dv(this.urlTree.root,[],[],this.config).segmentGroup,e=new In(n.segments,n.children);return this.expandSegmentGroup(this.ngModule,this.config,e,xn).pipe(Ut(c=>this.createUrlTree(Wx(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Oh(c=>{if(c instanceof kI)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof a_?this.noMatchError(c):c}))}match(n){return this.expandSegmentGroup(this.ngModule,this.config,n.root,xn).pipe(Ut(o=>this.createUrlTree(Wx(o),n.queryParams,n.fragment))).pipe(Oh(o=>{throw o instanceof a_?this.noMatchError(o):o}))}noMatchError(n){return new Error(`Cannot match any routes. URL Segment: '${n.segmentGroup}'`)}createUrlTree(n,e,i){const o=n.segments.length>0?new In([],{[xn]:n}):n;return new Lh(o,e,i)}expandSegmentGroup(n,e,i,o){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(n,e,i).pipe(Ut(c=>new In([],c))):this.expandSegment(n,i,e,i.segments,o,!0)}expandChildren(n,e,i){const o=[];for(const c of Object.keys(i.children))"primary"===c?o.unshift(c):o.push(c);return oi(o).pipe(Qg(c=>{const f=i.children[c],y=MI(e,c);return this.expandSegmentGroup(n,y,f,c).pipe(Ut(C=>({segment:C,outlet:c})))}),qM((c,f)=>(c[f.outlet]=f.segment,c),{}),function(t,n){const e=arguments.length>=2;return i=>i.pipe(t?zr((o,c)=>t(o,c,i)):Mo,Nx(1),e?ZM(n):WM(()=>new K0))}())}expandSegment(n,e,i,o,c,f){return oi(i).pipe(Qg(y=>this.expandSegmentAgainstRoute(n,e,i,y,o,c,f).pipe(Oh(M=>{if(M instanceof a_)return Wt(null);throw M}))),$p(y=>!!y),Oh((y,C)=>{if(y instanceof K0||"EmptyError"===y.name){if(AI(e,o,c))return Wt(new In([],{}));throw new a_(e)}throw y}))}expandSegmentAgainstRoute(n,e,i,o,c,f,y){return SI(o,e,c,f)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,e,o,c,f):y&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f):fv(e):fv(e)}expandSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,i,o,f):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,i,o){const c=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?NI(c):this.lineralizeSegments(i,c).pipe(ai(f=>{const y=new In(f,{});return this.expandSegment(n,y,e,f,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f){const{matched:y,consumedSegments:C,lastChild:M,positionalParamSegments:k}=uv(e,o,c);if(!y)return fv(e);const L=this.applyRedirectCommands(C,o.redirectTo,k);return o.redirectTo.startsWith("/")?NI(L):this.lineralizeSegments(o,L).pipe(ai(U=>this.expandSegment(n,e,i,U.concat(c.slice(M)),f,!1)))}matchSegmentAgainstRoute(n,e,i,o,c){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Wt(i._loadedConfig):this.configLoader.load(n.injector,i)).pipe(Ut(U=>(i._loadedConfig=U,new In(o,{})))):Wt(new In(o,{}));const{matched:f,consumedSegments:y,lastChild:C}=uv(e,i,o);if(!f)return fv(e);const M=o.slice(C);return this.getChildConfig(n,i,o).pipe(ai(L=>{const U=L.module,q=L.routes,{segmentGroup:ae,slicedSegments:xe}=dv(e,y,M,q),ge=new In(ae.segments,ae.children);if(0===xe.length&&ge.hasChildren())return this.expandChildren(U,q,ge).pipe(Ut(Et=>new In(y,Et)));if(0===q.length&&0===xe.length)return Wt(new In(y,{}));const Ue=Oa(i)===c;return this.expandSegment(U,ge,q,xe,Ue?xn:c,!0).pipe(Ut(mt=>new In(y.concat(mt.segments),mt.children)))}))}getChildConfig(n,e,i){return e.children?Wt(new Gx(e.children,n)):e.loadChildren?void 0!==e._loadedConfig?Wt(e._loadedConfig):this.runCanLoadGuards(n.injector,e,i).pipe(ai(o=>o?this.configLoader.load(n.injector,e).pipe(Ut(c=>(e._loadedConfig=c,c))):function(t){return new dn(n=>n.error(Rx(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e))):Wt(new Gx([],n))}runCanLoadGuards(n,e,i){const o=e.canLoad;return o&&0!==o.length?Wt(o.map(f=>{const y=n.get(f);let C;if(function(t){return t&&yd(t.canLoad)}(y))C=y.canLoad(e,i);else{if(!yd(y))throw new Error("Invalid CanLoad guard");C=y(e,i)}return xc(C)})).pipe(s_(),bo(f=>{if(!Vh(f))return;const y=Rx(`Redirecting to "${this.urlSerializer.serialize(f)}"`);throw y.url=f,y}),Ut(f=>!0===f)):Wt(!0)}lineralizeSegments(n,e){let i=[],o=e.root;for(;;){if(i=i.concat(o.segments),0===o.numberOfChildren)return Wt(i);if(o.numberOfChildren>1||!o.children[xn])return hz(n.redirectTo);o=o.children[xn]}}applyRedirectCommands(n,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),n,i)}applyRedirectCreatreUrlTree(n,e,i,o){const c=this.createSegmentGroup(n,e.root,i,o);return new Lh(c,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const i={};return xo(n,(o,c)=>{if("string"==typeof o&&o.startsWith(":")){const y=o.substring(1);i[c]=e[y]}else i[c]=o}),i}createSegmentGroup(n,e,i,o){const c=this.createSegments(n,e.segments,i,o);let f={};return xo(e.children,(y,C)=>{f[C]=this.createSegmentGroup(n,y,i,o)}),new In(c,f)}createSegments(n,e,i,o){return e.map(c=>c.path.startsWith(":")?this.findPosParam(n,c,o):this.findOrReturn(c,i))}findPosParam(n,e,i){const o=i[e.path.substring(1)];if(!o)throw new Error(`Cannot redirect to '${n}'. Cannot find '${e.path}'.`);return o}findOrReturn(n,e){let i=0;for(const o of e){if(o.path===n.path)return e.splice(i),o;i++}return n}}function Wx(t){const n={};for(const i of Object.keys(t.children)){const c=Wx(t.children[i]);(c.segments.length>0||c.hasChildren())&&(n[i]=c)}return function(t){if(1===t.numberOfChildren&&t.children[xn]){const n=t.children[xn];return new In(t.segments.concat(n.segments),n.children)}return t}(new In(t.segments,n))}class PI{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class pv{constructor(n,e){this.component=n,this.route=e}}function yz(t,n,e){const i=t._root;return l_(i,n?n._root:null,e,[i.value])}function mv(t,n,e){const i=function(t){if(!t)return null;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(n);return(i?i.module.injector:e).get(t)}function l_(t,n,e,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=i_(n);return t.children.forEach(f=>{(function(t,n,e,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=t.value,f=n?n.value:null,y=e?e.getContext(t.value.outlet):null;if(f&&c.routeConfig===f.routeConfig){const C=function(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!Bh(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Bh(t.url,n.url)||!bc(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ux(t,n)||!bc(t.queryParams,n.queryParams);case"paramsChange":default:return!Ux(t,n)}}(f,c,c.routeConfig.runGuardsAndResolvers);C?o.canActivateChecks.push(new PI(i)):(c.data=f.data,c._resolvedData=f._resolvedData),l_(t,n,c.component?y?y.children:null:e,i,o),C&&y&&y.outlet&&y.outlet.isActivated&&o.canDeactivateChecks.push(new pv(y.outlet.component,f))}else f&&c_(n,y,o),o.canActivateChecks.push(new PI(i)),l_(t,null,c.component?y?y.children:null:e,i,o)})(f,c[f.value.outlet],e,i.concat([f.value]),o),delete c[f.value.outlet]}),xo(c,(f,y)=>c_(f,e.getContext(y),o)),o}function c_(t,n,e){const i=i_(t),o=t.value;xo(i,(c,f)=>{c_(c,o.component?n?n.children.getContext(f):null:n,e)}),e.canDeactivateChecks.push(new pv(o.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,o))}class kz{}function RI(t){return new dn(n=>n.error(t))}class Pz{constructor(n,e,i,o,c,f){this.rootComponentType=n,this.config=e,this.urlTree=i,this.url=o,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=f}recognize(){const n=dv(this.urlTree.root,[],[],this.config.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,n,xn);if(null===e)return null;const i=new sv([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},xn,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new yu(i,e),c=new gI(this.url,o);return this.inheritParamsAndData(c._root),c}inheritParamsAndData(n){const e=n.value,i=mI(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),n.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(n,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(n,e):this.processSegment(n,e,e.segments,i)}processChildren(n,e){const i=[];for(const c of Object.keys(e.children)){const f=e.children[c],y=MI(n,c),C=this.processSegmentGroup(y,f,c);if(null===C)return null;i.push(...C)}const o=FI(i);return function(t){t.sort((n,e)=>n.value.outlet===xn?-1:e.value.outlet===xn?1:n.value.outlet.localeCompare(e.value.outlet))}(o),o}processSegment(n,e,i,o){for(const c of n){const f=this.processSegmentAgainstRoute(c,e,i,o);if(null!==f)return f}return AI(e,i,o)?[]:null}processSegmentAgainstRoute(n,e,i,o){if(n.redirectTo||!SI(n,e,i,o))return null;let c,f=[],y=[];if("**"===n.path){const q=i.length>0?nI(i).parameters:{};c=new sv(i,q,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,BI(n),Oa(n),n.component,n,OI(e),LI(e)+i.length,VI(n))}else{const q=uv(e,n,i);if(!q.matched)return null;f=q.consumedSegments,y=i.slice(q.lastChild),c=new sv(f,q.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,BI(n),Oa(n),n.component,n,OI(e),LI(e)+f.length,VI(n))}const C=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(n),{segmentGroup:M,slicedSegments:k}=dv(e,f,y,C.filter(q=>void 0===q.redirectTo),this.relativeLinkResolution);if(0===k.length&&M.hasChildren()){const q=this.processChildren(C,M);return null===q?null:[new yu(c,q)]}if(0===C.length&&0===k.length)return[new yu(c,[])];const L=Oa(n)===o,U=this.processSegment(C,M,k,L?xn:o);return null===U?null:[new yu(c,U)]}}function Oz(t){const n=t.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function FI(t){const n=[],e=new Set;for(const i of t){if(!Oz(i)){n.push(i);continue}const o=n.find(c=>i.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...i.children),e.add(o)):n.push(i)}for(const i of e){const o=FI(i.children);n.push(new yu(i.value,o))}return n.filter(i=>!e.has(i))}function OI(t){let n=t;for(;n._sourceSegment;)n=n._sourceSegment;return n}function LI(t){let n=t,e=n._segmentIndexShift?n._segmentIndexShift:0;for(;n._sourceSegment;)n=n._sourceSegment,e+=n._segmentIndexShift?n._segmentIndexShift:0;return e-1}function BI(t){return t.data||{}}function VI(t){return t.resolve||{}}function Zx(t){return Pl(n=>{const e=t(n);return e?oi(e).pipe(Ut(()=>n)):Wt(n)})}class Hz extends class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}{}const Xx=new bt("ROUTES");class zI{constructor(n,e,i,o){this.loader=n,this.compiler=e,this.onLoadStartListener=i,this.onLoadEndListener=o}load(n,e){if(e._loader$)return e._loader$;this.onLoadStartListener&&this.onLoadStartListener(e);const o=this.loadModuleFactory(e.loadChildren).pipe(Ut(c=>{this.onLoadEndListener&&this.onLoadEndListener(e);const f=c.create(n);return new Gx(tI(f.injector.get(Xx,void 0,Tt.Self|Tt.Optional)).map(qx),f)}),Oh(c=>{throw e._loader$=void 0,c}));return e._loader$=new ja(o,()=>new Rn).pipe(ha()),e._loader$}loadModuleFactory(n){return"string"==typeof n?oi(this.loader.load(n)):xc(n()).pipe(ai(e=>e instanceof gE?Wt(e):oi(this.compiler.compileModuleAsync(e))))}}class Gz{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new qp,this.attachRef=null}}class qp{constructor(){this.contexts=new Map}onChildOutletCreated(n,e){const i=this.getOrCreateContext(n);i.outlet=e,this.contexts.set(n,i)}onChildOutletDestroyed(n){const e=this.getContext(n);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let e=this.getContext(n);return e||(e=new Gz,this.contexts.set(n,e)),e}getContext(n){return this.contexts.get(n)||null}}class Wz{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,e){return n}}function Zz(t){throw t}function Xz(t,n,e){return n.parse("/")}function UI(t,n){return Wt(null)}const Yz={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Kz={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Vs=(()=>{class t{constructor(e,i,o,c,f,y,C,M){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=o,this.location=c,this.config=M,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Rn,this.errorHandler=Zz,this.malformedUriErrorHandler=Xz,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:UI,afterPreactivation:UI},this.urlHandlingStrategy=new Wz,this.routeReuseStrategy=new Hz,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=f.get(yc),this.console=f.get(C0);const U=f.get(En);this.isNgZoneEnabled=U instanceof En&&En.isInAngularZone(),this.resetConfig(M),this.currentUrlTree=new Lh(new In([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new zI(y,C,q=>this.triggerEvent(new YM(q)),q=>this.triggerEvent(new KM(q))),this.routerState=pI(this.currentUrlTree,this.rootComponentType),this.transitions=new Vr({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(zr(o=>0!==o.id),Ut(o=>Object.assign(Object.assign({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Pl(o=>{let c=!1,f=!1;return Wt(o).pipe(bo(y=>{this.currentNavigation={id:y.id,initialUrl:y.currentRawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Pl(y=>{const C=this.browserUrlTree.toString(),M=!this.navigated||y.extractedUrl.toString()!==C||C!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||M)&&this.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return gv(y.source)&&(this.browserUrlTree=y.extractedUrl),Wt(y).pipe(Pl(L=>{const U=this.transitions.getValue();return i.next(new Px(L.id,this.serializeUrl(L.extractedUrl),L.source,L.restoredState)),U!==this.transitions.getValue()?Fh:Promise.resolve(L)}),function(t,n,e,i){return Pl(o=>function(t,n,e,i,o){return new mz(t,n,e,i,o).apply()}(t,n,e,o.extractedUrl,i).pipe(Ut(c=>Object.assign(Object.assign({},o),{urlAfterRedirects:c}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),bo(L=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:L.urlAfterRedirects})}),function(t,n,e,i,o){return ai(c=>function(t,n,e,i,o="emptyOnly",c="legacy"){try{const f=new Pz(t,n,e,i,o,c).recognize();return null===f?RI(new kz):Wt(f)}catch(f){return RI(f)}}(t,n,c.urlAfterRedirects,e(c.urlAfterRedirects),i,o).pipe(Ut(f=>Object.assign(Object.assign({},c),{targetSnapshot:f}))))}(this.rootComponentType,this.config,L=>this.serializeUrl(L),this.paramsInheritanceStrategy,this.relativeLinkResolution),bo(L=>{"eager"===this.urlUpdateStrategy&&(L.extras.skipLocationChange||this.setBrowserUrl(L.urlAfterRedirects,L),this.browserUrlTree=L.urlAfterRedirects);const U=new dV(L.id,this.serializeUrl(L.extractedUrl),this.serializeUrl(L.urlAfterRedirects),L.targetSnapshot);i.next(U)}));if(M&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:U,extractedUrl:q,source:ae,restoredState:xe,extras:ge}=y,Ue=new Px(U,this.serializeUrl(q),ae,xe);i.next(Ue);const Ie=pI(q,this.rootComponentType).snapshot;return Wt(Object.assign(Object.assign({},y),{targetSnapshot:Ie,urlAfterRedirects:q,extras:Object.assign(Object.assign({},ge),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=y.rawUrl,this.browserUrlTree=y.urlAfterRedirects,y.resolve(null),Fh}),Zx(y=>{const{targetSnapshot:C,id:M,extractedUrl:k,rawUrl:L,extras:{skipLocationChange:U,replaceUrl:q}}=y;return this.hooks.beforePreactivation(C,{navigationId:M,appliedUrlTree:k,rawUrlTree:L,skipLocationChange:!!U,replaceUrl:!!q})}),bo(y=>{const C=new hV(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(C)}),Ut(y=>Object.assign(Object.assign({},y),{guards:yz(y.targetSnapshot,y.currentSnapshot,this.rootContexts)})),function(t,n){return ai(e=>{const{targetSnapshot:i,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:f}}=e;return 0===f.length&&0===c.length?Wt(Object.assign(Object.assign({},e),{guardsResult:!0})):function(t,n,e,i){return oi(t).pipe(ai(o=>function(t,n,e,i,o){const c=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return c&&0!==c.length?Wt(c.map(y=>{const C=mv(y,n,o);let M;if(function(t){return t&&yd(t.canDeactivate)}(C))M=xc(C.canDeactivate(t,n,e,i));else{if(!yd(C))throw new Error("Invalid CanDeactivate guard");M=xc(C(t,n,e,i))}return M.pipe($p())})).pipe(s_()):Wt(!0)}(o.component,o.route,e,n,i)),$p(o=>!0!==o,!0))}(f,i,o,t).pipe(ai(y=>y&&function(t){return"boolean"==typeof t}(y)?function(t,n,e,i){return oi(n).pipe(Qg(o=>J0(function(t,n){return null!==t&&n&&n(new gV(t)),Wt(!0)}(o.route.parent,i),function(t,n){return null!==t&&n&&n(new yV(t)),Wt(!0)}(o.route,i),function(t,n,e){const i=n[n.length-1],c=n.slice(0,n.length-1).reverse().map(f=>function(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(f)).filter(f=>null!==f).map(f=>HM(()=>Wt(f.guards.map(C=>{const M=mv(C,f.node,e);let k;if(function(t){return t&&yd(t.canActivateChild)}(M))k=xc(M.canActivateChild(i,t));else{if(!yd(M))throw new Error("Invalid CanActivateChild guard");k=xc(M(i,t))}return k.pipe($p())})).pipe(s_())));return Wt(c).pipe(s_())}(t,o.path,e),function(t,n,e){const i=n.routeConfig?n.routeConfig.canActivate:null;return i&&0!==i.length?Wt(i.map(c=>HM(()=>{const f=mv(c,n,e);let y;if(function(t){return t&&yd(t.canActivate)}(f))y=xc(f.canActivate(n,t));else{if(!yd(f))throw new Error("Invalid CanActivate guard");y=xc(f(n,t))}return y.pipe($p())}))).pipe(s_()):Wt(!0)}(t,o.route,e))),$p(o=>!0!==o,!0))}(i,c,t,n):Wt(y)),Ut(y=>Object.assign(Object.assign({},e),{guardsResult:y})))})}(this.ngModule.injector,y=>this.triggerEvent(y)),bo(y=>{if(Vh(y.guardsResult)){const M=Rx(`Redirecting to "${this.serializeUrl(y.guardsResult)}"`);throw M.url=y.guardsResult,M}const C=new fV(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.triggerEvent(C)}),zr(y=>!!y.guardsResult||(this.restoreHistory(y),this.cancelNavigationTransition(y,""),!1)),Zx(y=>{if(y.guards.canActivateChecks.length)return Wt(y).pipe(bo(C=>{const M=new pV(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(M)}),Pl(C=>{let M=!1;return Wt(C).pipe(function(t,n){return ai(e=>{const{targetSnapshot:i,guards:{canActivateChecks:o}}=e;if(!o.length)return Wt(e);let c=0;return oi(o).pipe(Qg(f=>function(t,n,e,i){return function(t,n,e,i){const o=Object.keys(t);if(0===o.length)return Wt({});const c={};return oi(o).pipe(ai(f=>function(t,n,e,i){const o=mv(t,n,i);return xc(o.resolve?o.resolve(n,e):o(n,e))}(t[f],n,e,i).pipe(bo(y=>{c[f]=y}))),Nx(1),ai(()=>Object.keys(c).length===o.length?Wt(c):Fh))}(t._resolve,t,n,i).pipe(Ut(c=>(t._resolvedData=c,t.data=Object.assign(Object.assign({},t.data),mI(t,e).resolve),null)))}(f.route,i,t,n)),bo(()=>c++),Nx(1),ai(f=>c===o.length?Wt(e):Fh))})}(this.paramsInheritanceStrategy,this.ngModule.injector),bo({next:()=>M=!0,complete:()=>{M||(this.restoreHistory(C),this.cancelNavigationTransition(C,"At least one route resolver didn't emit any value."))}}))}),bo(C=>{const M=new mV(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(M)}))}),Zx(y=>{const{targetSnapshot:C,id:M,extractedUrl:k,rawUrl:L,extras:{skipLocationChange:U,replaceUrl:q}}=y;return this.hooks.afterPreactivation(C,{navigationId:M,appliedUrlTree:k,rawUrlTree:L,skipLocationChange:!!U,replaceUrl:!!q})}),Ut(y=>{const C=function(t,n,e){const i=av(t,n._root,e?e._root:void 0);return new fI(i,n)}(this.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return Object.assign(Object.assign({},y),{targetRouterState:C})}),bo(y=>{this.currentUrlTree=y.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(y.urlAfterRedirects,y.rawUrl),this.routerState=y.targetRouterState,"deferred"===this.urlUpdateStrategy&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y),this.browserUrlTree=y.urlAfterRedirects)}),((t,n,e)=>Ut(i=>(new QV(n,i.targetRouterState,i.currentRouterState,e).activate(t),i)))(this.rootContexts,this.routeReuseStrategy,y=>this.triggerEvent(y)),bo({next(){c=!0},complete(){c=!0}}),function(t){return n=>n.lift(new lV(t))}(()=>{var y;if(!c&&!f){const C=`Navigation ID ${o.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(o),this.cancelNavigationTransition(o,C)):this.cancelNavigationTransition(o,C)}(null===(y=this.currentNavigation)||void 0===y?void 0:y.id)===o.id&&(this.currentNavigation=null)}),Oh(y=>{if(f=!0,function(t){return t&&t[QM]}(y)){const C=Vh(y.url);C||(this.navigated=!0,this.restoreHistory(o,!0));const M=new XM(o.id,this.serializeUrl(o.extractedUrl),y.message);i.next(M),C?setTimeout(()=>{const k=this.urlHandlingStrategy.merge(y.url,this.rawUrlTree),L={skipLocationChange:o.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||gv(o.source)};this.scheduleNavigation(k,"imperative",null,L,{resolve:o.resolve,reject:o.reject,promise:o.promise})},0):o.resolve(!1)}else{this.restoreHistory(o,!0);const C=new uV(o.id,this.serializeUrl(o.extractedUrl),y);i.next(C);try{o.resolve(this.errorHandler(y))}catch(M){o.reject(M)}}return Fh}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,i)&&setTimeout(()=>{const{source:o,state:c,urlTree:f}=i,y={replaceUrl:!0};if(c){const C=Object.assign({},c);delete C.navigationId,delete C.\u0275routerPageId,0!==Object.keys(C).length&&(y.state=C)}this.scheduleNavigation(f,o,c,y)},0),this.lastLocationChangeInfo=i}))}extractLocationChangeInfoFromEvent(e){var i;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(i=e.state)||void 0===i?void 0:i.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,i){if(!e)return!0;const o=i.urlTree.toString()===e.urlTree.toString();return i.transitionId!==e.transitionId||!o||!("hashchange"===i.source&&"popstate"===e.source||"popstate"===i.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){TI(e),this.config=e.map(qx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:o,queryParams:c,fragment:f,queryParamsHandling:y,preserveFragment:C}=i,M=o||this.routerState.root,k=C?this.currentUrlTree.fragment:f;let L=null;switch(y){case"merge":L=Object.assign(Object.assign({},this.currentUrlTree.queryParams),c);break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=c||null}return null!==L&&(L=this.removeEmptyProps(L)),function(t,n,e,i,o){if(0===e.length)return jx(n.root,n.root,n,i,o);const c=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new bI(!0,0,t);let n=0,e=!1;const i=t.reduce((o,c,f)=>{if("object"==typeof c&&null!=c){if(c.outlets){const y={};return xo(c.outlets,(C,M)=>{y[M]="string"==typeof C?C.split("/"):C}),[...o,{outlets:y}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===f?(c.split("/").forEach((y,C)=>{0==C&&"."===y||(0==C&&""===y?e=!0:".."===y?n++:""!=y&&o.push(y))}),o):[...o,c]},[]);return new bI(e,n,i)}(e);if(c.toRoot())return jx(n.root,new In([],{}),n,i,o);const f=function(t,n,e){if(t.isAbsolute)return new $x(n.root,!0,0);if(-1===e.snapshot._lastPathIndex){const c=e.snapshot._urlSegment;return new $x(c,c===n.root,0)}const i=lv(t.commands[0])?0:1;return function(t,n,e){let i=t,o=n,c=e;for(;c>o;){if(c-=o,i=i.parent,!i)throw new Error("Invalid number of '../'");o=i.segments.length}return new $x(i,!1,o-c)}(e.snapshot._urlSegment,e.snapshot._lastPathIndex+i,t.numberOfDoubleDots)}(c,n,t),y=f.processChildren?cv(f.segmentGroup,f.index,c.commands):xI(f.segmentGroup,f.index,c.commands);return jx(f.segmentGroup,y,n,i,o)}(M,this.currentUrlTree,e,L,null!=k?k:null)}navigateByUrl(e,i={skipLocationChange:!1}){const o=Vh(e)?e:this.parseUrl(e),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function(t){for(let n=0;n<t.length;n++){const e=t[n];if(null==e)throw new Error(`The requested path contains ${e} segment at index ${n}`)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(o){i=this.malformedUriErrorHandler(o,this.urlSerializer,e)}return i}isActive(e,i){let o;if(o=!0===i?Object.assign({},Yz):!1===i?Object.assign({},Kz):i,Vh(e))return rI(this.currentUrlTree,e,o);const c=this.parseUrl(e);return rI(this.currentUrlTree,c,o)}removeEmptyProps(e){return Object.keys(e).reduce((i,o)=>{const c=e[o];return null!=c&&(i[o]=c),i},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new e_(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,o,c,f){var y,C;if(this.disposed)return Promise.resolve(!1);const M=this.getTransition(),k=gv(i)&&M&&!gv(M.source),q=(this.lastSuccessfulId===M.id||this.currentNavigation?M.rawUrl:M.urlAfterRedirects).toString()===e.toString();if(k&&q)return Promise.resolve(!0);let ae,xe,ge;f?(ae=f.resolve,xe=f.reject,ge=f.promise):ge=new Promise((mt,Et)=>{ae=mt,xe=Et});const Ue=++this.navigationId;let Ie;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(o=this.location.getState()),Ie=o&&o.\u0275routerPageId?o.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?null!==(y=this.browserPageId)&&void 0!==y?y:0:(null!==(C=this.browserPageId)&&void 0!==C?C:0)+1):Ie=0,this.setTransition({id:Ue,targetPageId:Ie,source:i,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:c,resolve:ae,reject:xe,promise:ge,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ge.catch(mt=>Promise.reject(mt))}setBrowserUrl(e,i){const o=this.urlSerializer.serialize(e),c=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(o)||i.extras.replaceUrl?this.location.replaceState(o,"",c):this.location.go(o,"",c)}restoreHistory(e,i=!1){var o,c;if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)||0===f?this.currentUrlTree===(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)&&0===f&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(f)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i){const o=new XM(e.id,this.serializeUrl(e.extractedUrl),i);this.triggerEvent(o),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return t.\u0275fac=function(e){return new(e||t)(Be(Yd),Be(Fx),Be(qp),Be(O0),Be(yt),Be(E0),Be(kh),Be(void 0))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();function gv(t){return"imperative"!==t}let Jx=(()=>{class t{constructor(e,i,o,c,f){this.parentContexts=e,this.location=i,this.resolver=o,this.changeDetector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new Ct,this.deactivateEvents=new Ct,this.name=c||xn,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const f=(i=i||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),y=this.parentContexts.getOrCreateContext(this.name).children,C=new t5(e,y,this.location.injector);this.activated=this.location.createComponent(f,this.location.length,C),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)(ue(qp),ue(us),ue(ra),function(t){return function(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const i=e.length;let o=0;for(;o<i;){const c=e[o];if(E(c))break;if(0===c)o+=2;else if("number"==typeof c)for(o++;o<i&&"string"==typeof e[o];)o++;else{if(c===n)return e[o+1];o+=2}}}return null}(ti(),t)}("name"),ue(yo))},t.\u0275dir=et({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),t})();class t5{constructor(n,e,i){this.route=n,this.childContexts=e,this.parent=i}get(n,e){return n===Gp?this.route:n===qp?this.childContexts:this.parent.get(n,e)}}class jI{}class $I{preload(n,e){return Wt(null)}}let HI=(()=>{class t{constructor(e,i,o,c,f){this.router=e,this.injector=c,this.preloadingStrategy=f,this.loader=new zI(i,o,M=>e.triggerEvent(new YM(M)),M=>e.triggerEvent(new KM(M)))}setUpPreloading(){this.subscription=this.router.events.pipe(zr(e=>e instanceof e_),Qg(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(yc);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){const o=[];for(const c of i)if(c.loadChildren&&!c.canLoad&&c._loadedConfig){const f=c._loadedConfig;o.push(this.processRoutes(f.module,f.routes))}else c.loadChildren&&!c.canLoad?o.push(this.preloadConfig(e,c)):c.children&&o.push(this.processRoutes(e,c.children));return oi(o).pipe(fr(),Ut(c=>{}))}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Wt(i._loadedConfig):this.loader.load(e.injector,i)).pipe(ai(c=>(i._loadedConfig=c,this.processRoutes(c.module,c.routes)))))}}return t.\u0275fac=function(e){return new(e||t)(Be(Vs),Be(E0),Be(kh),Be(yt),Be(jI))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})(),Qx=(()=>{class t{constructor(e,i,o={}){this.router=e,this.viewportScroller=i,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Px?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof e_&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof JM&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new JM(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(Be(Vs),Be(SM),Be(void 0))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();const zh=new bt("ROUTER_CONFIGURATION"),GI=new bt("ROUTER_FORROOT_GUARD"),i5=[O0,{provide:Fx,useClass:lI},{provide:Vs,useFactory:function(t,n,e,i,o,c,f,y={},C,M){const k=new Vs(null,t,n,e,i,o,c,tI(f));return C&&(k.urlHandlingStrategy=C),M&&(k.routeReuseStrategy=M),function(t,n){t.errorHandler&&(n.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(n.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(n.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(n.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(n.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(n.urlUpdateStrategy=t.urlUpdateStrategy)}(y,k),y.enableTracing&&k.events.subscribe(L=>{var U,q;null===(U=console.group)||void 0===U||U.call(console,`Router Event: ${L.constructor.name}`),console.log(L.toString()),console.log(L),null===(q=console.groupEnd)||void 0===q||q.call(console)}),k},deps:[Fx,qp,O0,yt,E0,kh,Xx,zh,[class{},new Vo],[class{},new Vo]]},qp,{provide:Gp,useFactory:function(t){return t.routerState.root},deps:[Vs]},{provide:E0,useClass:rO},HI,$I,class{preload(n,e){return e().pipe(Oh(()=>Wt(null)))}},{provide:zh,useValue:{enableTracing:!1}}];function r5(){return new Ub("Router",Vs)}let qI=(()=>{class t{constructor(e,i){}static forRoot(e,i){return{ngModule:t,providers:[i5,WI(e),{provide:GI,useFactory:a5,deps:[[Vs,new Vo,new zo]]},{provide:zh,useValue:i||{}},{provide:jp,useFactory:s5,deps:[Rh,[new Yc(rx),new Vo],zh]},{provide:Qx,useFactory:o5,deps:[Vs,SM,zh]},{provide:jI,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:$I},{provide:Ub,multi:!0,useFactory:r5},[ew,{provide:Ug,multi:!0,useFactory:d5,deps:[ew]},{provide:ZI,useFactory:h5,deps:[ew]},{provide:bT,multi:!0,useExisting:ZI}]]}}static forChild(e){return{ngModule:t,providers:[WI(e)]}}}return t.\u0275fac=function(e){return new(e||t)(Be(GI,8),Be(Vs,8))},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})();function o5(t,n,e){return e.scrollOffset&&n.setOffset(e.scrollOffset),new Qx(t,n,e)}function s5(t,n,e={}){return e.useHash?new DL(t,n):new cM(t,n)}function a5(t){return"guarded"}function WI(t){return[{provide:Gc,multi:!0,useValue:t},{provide:Xx,multi:!0,useValue:t}]}let ew=(()=>{class t{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Rn}appInitializer(){return this.injector.get(xL,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const o=new Promise(y=>i=y),c=this.injector.get(Vs),f=this.injector.get(zh);return"disabled"===f.initialNavigation?(c.setUpLocationChangeListener(),i(!0)):"enabled"===f.initialNavigation||"enabledBlocking"===f.initialNavigation?(c.hooks.afterPreactivation=()=>this.initNavigation?Wt(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),c.initialNavigation()):i(!0),o})}bootstrapListener(e){const i=this.injector.get(zh),o=this.injector.get(HI),c=this.injector.get(Qx),f=this.injector.get(Vs),y=this.injector.get(Ml);e===y.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&f.initialNavigation(),o.setUpPreloading(),c.init(),f.resetRootComponentType(y.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(e){return new(e||t)(Be(yt))},t.\u0275prov=ct({token:t,factory:t.\u0275fac}),t})();function d5(t){return t.appInitializer.bind(t)}function h5(t){return t.bootstrapListener.bind(t)}const ZI=new bt("Router Initializer"),p5=[];let m5=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[qI.forRoot(p5)],qI]}),t})();var u_=Li(958);const tw_maptokenkey="pk.eyJ1IjoiZmV0b3JvMjEiLCJhIjoiY2t2em91eGM3MWVoNzJvbzFoMndoYjdsciJ9.64V4m5ZcR0EFbotU_ncDXA";function wo(t,n,e,i){return gs(e)&&(i=e,e=void 0),i?wo(t,n,e).pipe(Ut(o=>Cr(o)?i(...o):i(o))):new dn(o=>{XI(t,n,function(f){o.next(arguments.length>1?Array.prototype.slice.call(arguments):f)},o,e)})}function XI(t,n,e,i,o){let c;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const f=t;t.addEventListener(n,e,o),c=()=>f.removeEventListener(n,e,o)}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const f=t;t.on(n,e),c=()=>f.off(n,e)}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const f=t;t.addListener(n,e),c=()=>f.removeListener(n,e)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let f=0,y=t.length;f<y;f++)XI(t[f],n,e,i,o)}i.add(c)}class v5 extends ut{constructor(n,e){super()}schedule(n,e=0){return this}}let YI=(()=>{class t{constructor(e,i=t.now){this.SchedulerAction=e,this.now=i}schedule(e,i=0,o){return new this.SchedulerAction(this,e).schedule(o,i)}}return t.now=()=>Date.now(),t})();class vd extends YI{constructor(n,e=YI.now){super(n,()=>vd.delegate&&vd.delegate!==this?vd.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(n,e=0,i){return vd.delegate&&vd.delegate!==this?vd.delegate.schedule(n,e,i):super.schedule(n,e,i)}flush(n){const{actions:e}=this;if(this.active)return void e.push(n);let i;this.active=!0;do{if(i=n.execute(n.state,n.delay))break}while(n=e.shift());if(this.active=!1,i){for(;n=e.shift();)n.unsubscribe();throw i}}}const KI=new vd(class extends v5{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){if(this.closed)return this;this.state=n;const i=this.id,o=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(o,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(o,this.id,e),this}requestAsyncId(n,e,i=0){return setInterval(n.flush.bind(n,this),i)}recycleAsyncId(n,e,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(n,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let o,i=!1;try{this.work(n)}catch(c){i=!0,o=!!c&&c||new Error(c)}if(i)return this.unsubscribe(),o}_unsubscribe(){const n=this.id,e=this.scheduler,i=e.actions,o=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==o&&i.splice(o,1),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null}});function JI(t){return!Cr(t)&&t-parseFloat(t)+1>=0}function x5(t){const{index:n,period:e,subscriber:i}=t;if(i.next(n),!i.closed){if(-1===e)return i.complete();t.index=n+1,this.schedule(t,e)}}class w5{call(n,e){return e.subscribe(new C5(n))}}class C5 extends Sx{constructor(n){super(n),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(n){this.observables.push(n)}_complete(){const n=this.observables,e=n.length;if(0===e)this.destination.complete();else{for(let i=0;i<e&&!this.hasFirst;i++){const c=Ax(this,n[i],void 0,i);this.subscriptions&&this.subscriptions.push(c),this.add(c)}this.observables=null}}notifyNext(n,e,i){if(!this.hasFirst){this.hasFirst=!0;for(let o=0;o<this.subscriptions.length;o++)if(o!==i){let c=this.subscriptions[o];c.unsubscribe(),this.remove(c)}this.subscriptions=null}this.destination.next(e)}}function _v(...t){const n=t[t.length-1];return"function"==typeof n&&t.pop(),zi(t,void 0).lift(new D5(n))}new dn(gu);class D5{constructor(n){this.resultSelector=n}call(n,e){return e.subscribe(new E5(n,this.resultSelector))}}class E5 extends Mt{constructor(n,e,i=Object.create(null)){super(n),this.resultSelector=e,this.iterators=[],this.active=0,this.resultSelector="function"==typeof e?e:void 0}_next(n){const e=this.iterators;Cr(n)?e.push(new M5(n)):e.push("function"==typeof n[Vi]?new T5(n[Vi]()):new I5(this.destination,this,n))}_complete(){const n=this.iterators,e=n.length;if(this.unsubscribe(),0!==e){this.active=e;for(let i=0;i<e;i++){let o=n[i];o.stillUnsubscribed?this.destination.add(o.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const n=this.iterators,e=n.length,i=this.destination;for(let f=0;f<e;f++){let y=n[f];if("function"==typeof y.hasValue&&!y.hasValue())return}let o=!1;const c=[];for(let f=0;f<e;f++){let y=n[f],C=y.next();if(y.hasCompleted()&&(o=!0),C.done)return void i.complete();c.push(C.value)}this.resultSelector?this._tryresultSelector(c):i.next(c),o&&i.complete()}_tryresultSelector(n){let e;try{e=this.resultSelector.apply(this,n)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class T5{constructor(n){this.iterator=n,this.nextResult=n.next()}hasValue(){return!0}next(){const n=this.nextResult;return this.nextResult=this.iterator.next(),n}hasCompleted(){const n=this.nextResult;return Boolean(n&&n.done)}}class M5{constructor(n){this.array=n,this.index=0,this.length=0,this.length=n.length}[Vi](){return this}next(n){const e=this.index++;return e<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class I5 extends So{constructor(n,e,i){super(n),this.parent=e,this.observable=i,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[Vi](){return this}next(){const n=this.buffer;return 0===n.length&&this.isComplete?{value:null,done:!0}:{value:n.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(n){this.buffer.push(n),this.parent.checkIterators()}subscribe(){return ys(this.observable,new Hr(this))}}function sr(t){return n=>n.lift(new A5(t))}class A5{constructor(n){this.notifier=n}call(n,e){const i=new k5(n),o=ys(this.notifier,new Hr(i));return o&&!i.seenValue?(i.add(o),e.subscribe(i)):i}}class k5 extends So{constructor(n){super(n),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function iw(...t){return n=>{let e;return"function"==typeof t[t.length-1]&&(e=t.pop()),n.lift(new R5(t,e))}}class R5{constructor(n,e){this.observables=n,this.project=e}call(n,e){return e.subscribe(new F5(n,this.observables,this.project))}}class F5 extends Sx{constructor(n,e,i){super(n),this.observables=e,this.project=i,this.toRespond=[];const o=e.length;this.values=new Array(o);for(let c=0;c<o;c++)this.toRespond.push(c);for(let c=0;c<o;c++)this.add(Ax(this,e[c],void 0,c))}notifyNext(n,e,i){this.values[i]=e;const o=this.toRespond;if(o.length>0){const c=o.indexOf(i);-1!==c&&o.splice(c,1)}}notifyComplete(){}_next(n){if(0===this.toRespond.length){const e=[n,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(n){let e;try{e=this.project.apply(this,n)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class Rl{constructor(n,e,i){this.kind=n,this.value=e,this.error=i,this.hasValue="N"===n}observe(n){switch(this.kind){case"N":return n.next&&n.next(this.value);case"E":return n.error&&n.error(this.error);case"C":return n.complete&&n.complete()}}do(n,e,i){switch(this.kind){case"N":return n&&n(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}}accept(n,e,i){return n&&"function"==typeof n.next?this.observe(n):this.do(n,e,i)}toObservable(){switch(this.kind){case"N":return Wt(this.value);case"E":return function(t,n){return new dn(e=>e.error(t))}(this.error);case"C":return Q0()}throw new Error("unexpected notification kind value")}static createNext(n){return void 0!==n?new Rl("N",n):Rl.undefinedValueNotification}static createError(n){return new Rl("E",void 0,n)}static createComplete(){return Rl.completeNotification}}Rl.completeNotification=new Rl("C"),Rl.undefinedValueNotification=new Rl("N",void 0);let BS=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})(),iA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[BS]]}),t})(),O4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[iA]}),t})();const Xp=["*"],D8=["dialog"];function Dd(t){return null!=t}function Kp(t){return(t||document.body).getBoundingClientRect()}"undefined"!=typeof Element&&!Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(t){let n=this;if(!document.documentElement.contains(n))return null;do{if(n.matches(t))return n;n=n.parentElement||n.parentNode}while(null!==n&&1===n.nodeType);return null});const sA={animation:!0,transitionTimerDelayMs:5};let eo=(()=>{class t{constructor(){this.animation=sA.animation}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ct({factory:function(){return new t},token:t,providedIn:"root"}),t})();const O6=()=>{},{transitionTimerDelayMs:L6}=sA,g_=new Map,Ur=(t,n,e,i)=>{let o=i.context||{};const c=g_.get(n);if(c)switch(i.runningTransition){case"continue":return Fh;case"stop":t.run(()=>c.transition$.complete()),o=Object.assign(c.context,o),g_.delete(n)}const f=e(n,i.animation,o)||O6;if(!i.animation||"none"===window.getComputedStyle(n).transitionProperty)return t.run(()=>f()),Wt(void 0).pipe(function(t){return n=>new dn(e=>n.subscribe(f=>t.run(()=>e.next(f)),f=>t.run(()=>e.error(f)),()=>t.run(()=>e.complete())))}(t));const y=new Rn,C=new Rn,M=y.pipe(function(...t){return n=>J0(n,Wt(...t))}(!0));g_.set(n,{transition$:y,complete:()=>{C.next(),C.complete()},context:o});const k=function(t){const{transitionDelay:n,transitionDuration:e}=window.getComputedStyle(t);return 1e3*(parseFloat(n)+parseFloat(e))}(n);return t.runOutsideAngular(()=>{const L=wo(n,"transitionend").pipe(sr(M),zr(({target:q})=>q===n));(function(...t){if(1===t.length){if(!Cr(t[0]))return t[0];t=t[0]}return zi(t,void 0).lift(new w5)})(function(t=0,n,e){let i=-1;return JI(n)?i=Number(n)<1?1:Number(n):Io(n)&&(e=n),Io(e)||(e=KI),new dn(o=>{const c=JI(t)?t:+t-e.now();return e.schedule(x5,c,{index:0,period:i,subscriber:o})})}(k+L6).pipe(sr(M)),L,C).pipe(sr(M)).subscribe(()=>{g_.delete(n),t.run(()=>{f(),y.next(),y.complete()})})}),y.asObservable()};let dA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),hA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),pA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})(),_A=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),yA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})();var yn=(()=>(function(t){t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.ArrowLeft=37]="ArrowLeft",t[t.ArrowUp=38]="ArrowUp",t[t.ArrowRight=39]="ArrowRight",t[t.ArrowDown=40]="ArrowDown"}(yn||(yn={})),yn))();"undefined"!=typeof navigator&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const CA=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function DA(t){const n=Array.from(t.querySelectorAll(CA)).filter(e=>-1!==e.tabIndex);return[n[0],n[n.length-1]]}new class{getAllStyles(n){return window.getComputedStyle(n)}getStyle(n,e){return this.getAllStyles(n)[e]}isStaticPositioned(n){return"static"===(this.getStyle(n,"position")||"static")}offsetParent(n){let e=n.offsetParent||document.documentElement;for(;e&&e!==document.documentElement&&this.isStaticPositioned(e);)e=e.offsetParent;return e||document.documentElement}position(n,e=!0){let i,o={width:0,height:0,top:0,bottom:0,left:0,right:0};if("fixed"===this.getStyle(n,"position"))i=n.getBoundingClientRect(),i={top:i.top,bottom:i.bottom,left:i.left,right:i.right,height:i.height,width:i.width};else{const c=this.offsetParent(n);i=this.offset(n,!1),c!==document.documentElement&&(o=this.offset(c,!1)),o.top+=c.clientTop,o.left+=c.clientLeft}return i.top-=o.top,i.bottom-=o.top,i.left-=o.left,i.right-=o.left,e&&(i.top=Math.round(i.top),i.bottom=Math.round(i.bottom),i.left=Math.round(i.left),i.right=Math.round(i.right)),i}offset(n,e=!0){const i=n.getBoundingClientRect(),o_top=window.pageYOffset-document.documentElement.clientTop,o_left=window.pageXOffset-document.documentElement.clientLeft;let c={height:i.height||n.offsetHeight,width:i.width||n.offsetWidth,top:i.top+o_top,bottom:i.bottom+o_top,left:i.left+o_left,right:i.right+o_left};return e&&(c.height=Math.round(c.height),c.width=Math.round(c.width),c.top=Math.round(c.top),c.bottom=Math.round(c.bottom),c.left=Math.round(c.left),c.right=Math.round(c.right)),c}positionElements(n,e,i,o){const[c="top",f="center"]=i.split("-"),y=o?this.offset(n,!1):this.position(n,!1),C=this.getAllStyles(e),M=parseFloat(C.marginTop),k=parseFloat(C.marginBottom),L=parseFloat(C.marginLeft),U=parseFloat(C.marginRight);let q=0,ae=0;switch(c){case"top":q=y.top-(e.offsetHeight+M+k);break;case"bottom":q=y.top+y.height;break;case"left":ae=y.left-(e.offsetWidth+L+U);break;case"right":ae=y.left+y.width}switch(f){case"top":q=y.top;break;case"bottom":q=y.top+y.height-e.offsetHeight;break;case"left":ae=y.left;break;case"right":ae=y.left+y.width-e.offsetWidth;break;case"center":"top"===c||"bottom"===c?ae=y.left+y.width/2-e.offsetWidth/2:q=y.top+y.height/2-e.offsetHeight/2}e.style.transform=`translate(${Math.round(ae)}px, ${Math.round(q)}px)`;const xe=e.getBoundingClientRect(),ge=document.documentElement,Ue=window.innerHeight||ge.clientHeight,Ie=window.innerWidth||ge.clientWidth;return xe.left>=0&&xe.top>=0&&xe.right<=Ie&&xe.bottom<=Ue}},new Date(1882,10,12),new Date(2174,10,25);let RA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa,O4]]}),t})(),Vw=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=et({type:t,selectors:[["",8,"navbar"]]}),t})(),LA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})(),BA=(()=>{class t{constructor(e){this._ngbConfig=e,this.backdrop=!0,this.keyboard=!0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(e){this._animation=e}}return t.\u0275fac=function(e){return new(e||t)(Be(eo))},t.\u0275prov=ct({factory:function(){return new t(Be(eo))},token:t,providedIn:"root"}),t})();class qh{constructor(n,e,i){this.nodes=n,this.viewRef=e,this.componentRef=i}}const RU=()=>{};let VA=(()=>{class t{constructor(e){this._document=e}compensate(){const e=this._getWidth();return this._isPresent(e)?this._adjustBody(e):RU}_adjustBody(e){const i=this._document.body,o=i.style.paddingRight,c=parseFloat(window.getComputedStyle(i)["padding-right"]);return i.style["padding-right"]=`${c+e}px`,()=>i.style["padding-right"]=o}_isPresent(e){const i=this._document.body.getBoundingClientRect();return window.innerWidth-(i.left+i.right)>=e-.1*e}_getWidth(){const e=this._document.createElement("div");e.className="modal-scrollbar-measure";const i=this._document.body;i.appendChild(e);const o=e.getBoundingClientRect().width-e.clientWidth;return i.removeChild(e),o}}return t.\u0275fac=function(e){return new(e||t)(Be(Bn))},t.\u0275prov=ct({factory:function(){return new t(Be(Bn))},token:t,providedIn:"root"}),t})(),FU=(()=>{class t{constructor(e,i){this._el=e,this._zone=i}ngOnInit(){this._zone.onStable.asObservable().pipe(fs(1)).subscribe(()=>{Ur(this._zone,this._el.nativeElement,(e,i)=>{i&&Kp(e),e.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return Ur(this._zone,this._el.nativeElement,({classList:e})=>e.remove("show"),{animation:this.animation,runningTransition:"stop"})}}return t.\u0275fac=function(e){return new(e||t)(ue(cn),ue(En))},t.\u0275cmp=kn({type:t,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1050"],hostVars:6,hostBindings:function(e,i){2&e&&(xl("modal-backdrop"+(i.backdropClass?" "+i.backdropClass:"")),Qt("show",!i.animation)("fade",i.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},decls:0,vars:0,template:function(e,i){},encapsulation:2}),t})();class zA{close(n){}dismiss(n){}}class OU{constructor(n,e,i,o){this._windowCmptRef=n,this._contentRef=e,this._backdropCmptRef=i,this._beforeDismiss=o,this._closed=new Rn,this._dismissed=new Rn,this._hidden=new Rn,n.instance.dismissEvent.subscribe(c=>{this.dismiss(c)}),this.result=new Promise((c,f)=>{this._resolve=c,this._reject=f}),this.result.then(null,()=>{})}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(sr(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(sr(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(this._beforeDismiss){const e=this._beforeDismiss();e&&e.then?e.then(i=>{!1!==i&&this._dismiss(n)},()=>{}):!1!==e&&this._dismiss(n)}else this._dismiss(n)}_removeModalElements(){const n=this._windowCmptRef.instance.hide(),e=this._backdropCmptRef?this._backdropCmptRef.instance.hide():Wt(void 0);n.subscribe(()=>{const{nativeElement:i}=this._windowCmptRef.location;i.parentNode.removeChild(i),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),e.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:i}=this._backdropCmptRef.location;i.parentNode.removeChild(i),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),_v(n,e).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var w_=(()=>(function(t){t[t.BACKDROP_CLICK=0]="BACKDROP_CLICK",t[t.ESC=1]="ESC"}(w_||(w_={})),w_))();let LU=(()=>{class t{constructor(e,i,o){this._document=e,this._elRef=i,this._zone=o,this._closed$=new Rn,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new Ct,this.shown=new Rn,this.hidden=new Rn}dismiss(e){this.dismissEvent.emit(e)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(fs(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:e}=this._elRef,i={animation:this.animation,runningTransition:"stop"},f=_v(Ur(this._zone,e,()=>e.classList.remove("show"),i),Ur(this._zone,this._dialogEl.nativeElement,()=>{},i));return f.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),f}_show(){const e={animation:this.animation,runningTransition:"continue"};_v(Ur(this._zone,this._elRef.nativeElement,(c,f)=>{f&&Kp(c),c.classList.add("show")},e),Ur(this._zone,this._dialogEl.nativeElement,()=>{},e)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:e}=this._elRef;this._zone.runOutsideAngular(()=>{wo(e,"keydown").pipe(sr(this._closed$),zr(o=>o.which===yn.Escape)).subscribe(o=>{this.keyboard?requestAnimationFrame(()=>{o.defaultPrevented||this._zone.run(()=>this.dismiss(w_.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let i=!1;wo(this._dialogEl.nativeElement,"mousedown").pipe(sr(this._closed$),bo(()=>i=!1),Pl(()=>wo(e,"mouseup").pipe(sr(this._closed$),fs(1))),zr(({target:o})=>e===o)).subscribe(()=>{i=!0}),wo(e,"click").pipe(sr(this._closed$)).subscribe(({target:o})=>{e===o&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!i&&this._zone.run(()=>this.dismiss(w_.BACKDROP_CLICK))),i=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:e}=this._elRef;if(!e.contains(document.activeElement)){const i=e.querySelector("[ngbAutofocus]"),o=DA(e)[0];(i||o||e).focus()}}_restoreFocus(){const e=this._document.body,i=this._elWithFocus;let o;o=i&&i.focus&&e.contains(i)?i:e,this._zone.runOutsideAngular(()=>{setTimeout(()=>o.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&Ur(this._zone,this._elRef.nativeElement,({classList:e})=>(e.add("modal-static"),()=>e.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}}return t.\u0275fac=function(e){return new(e||t)(ue(Bn),ue(cn),ue(En))},t.\u0275cmp=kn({type:t,selectors:[["ngb-modal-window"]],viewQuery:function(e,i){if(1&e&&Ah(D8,7),2&e){let o;Qn(o=function(t,n){return t[19].queries[n].queryList}(He(),nc()))&&(i._dialogEl=o.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(e,i){2&e&&(Pn("aria-modal",!0)("aria-labelledby",i.ariaLabelledBy)("aria-describedby",i.ariaDescribedBy),xl("modal d-block"+(i.windowClass?" "+i.windowClass:"")),Qt("fade",i.animation))},inputs:{backdrop:"backdrop",keyboard:"keyboard",animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",centered:"centered",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},ngContentSelectors:Xp,decls:4,vars:2,consts:[["role","document"],["dialog",""],[1,"modal-content"]],template:function(e,i){1&e&&(function(t){const n=He()[16][6];if(!n.projection){const i=n.projection=qr(t?t.length:1,null),o=i.slice();let c=n.child;for(;null!==c;){const f=t?_k(c,t):0;null!==f&&(o[f]?o[f].projectionNext=c:i[f]=c,o[f]=c),c=c.next}}}(),De(0,"div",0,1),De(2,"div",2),function(t,n=0,e){const i=He(),o=gn(),c=fo(o,20+t,16,null,e||null);null===c.projection&&(c.projection=n),Nu(),64!=(64&c.flags)&&function(t,n,e){Wf(n[11],0,n,e,xy(t,e,n),Gf(e.parent||n[6],e,n))}(o,i,c)}(3),Ee(),Ee()),2&e&&xl("modal-dialog"+(i.size?" modal-"+i.size:"")+(i.centered?" modal-dialog-centered":"")+(i.scrollable?" modal-dialog-scrollable":"")+(i.modalDialogClass?" "+i.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}"],encapsulation:2}),t})(),UA=(()=>{class t{constructor(e,i,o,c,f,y){this._applicationRef=e,this._injector=i,this._document=o,this._scrollBar=c,this._rendererFactory=f,this._ngZone=y,this._activeWindowCmptHasChanged=new Rn,this._ariaHiddenValues=new Map,this._backdropAttributes=["animation","backdropClass"],this._modalRefs=[],this._windowAttributes=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","keyboard","scrollable","size","windowClass","modalDialogClass"],this._windowCmpts=[],this._activeInstances=new Ct,this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const C=this._windowCmpts[this._windowCmpts.length-1];((t,n,e,i=!1)=>{t.runOutsideAngular(()=>{const o=wo(n,"focusin").pipe(sr(e),Ut(c=>c.target));wo(n,"keydown").pipe(sr(e),zr(c=>c.which===yn.Tab),iw(o)).subscribe(([c,f])=>{const[y,C]=DA(n);(f===y||f===n)&&c.shiftKey&&(C.focus(),c.preventDefault()),f===C&&!c.shiftKey&&(y.focus(),c.preventDefault())}),i&&wo(n,"click").pipe(sr(e),iw(o),Ut(c=>c[1])).subscribe(c=>c.focus())})})(this._ngZone,C.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(C.location.nativeElement)}})}open(e,i,o,c){const f=c.container instanceof HTMLElement?c.container:Dd(c.container)?this._document.querySelector(c.container):this._document.body,y=this._rendererFactory.createRenderer(null,null),C=this._scrollBar.compensate(),M=()=>{this._modalRefs.length||(y.removeClass(this._document.body,"modal-open"),this._revertAriaHidden())};if(!f)throw new Error(`The specified modal container "${c.container||"body"}" was not found in the DOM.`);const k=new zA,L=this._getContentRef(e,c.injector||i,o,k,c);let U=!1!==c.backdrop?this._attachBackdrop(e,f):void 0,q=this._attachWindowComponent(e,f,L),ae=new OU(q,L,U,c.beforeDismiss);return this._registerModalRef(ae),this._registerWindowCmpt(q),ae.result.then(C,C),ae.result.then(M,M),k.close=xe=>{ae.close(xe)},k.dismiss=xe=>{ae.dismiss(xe)},this._applyWindowOptions(q.instance,c),1===this._modalRefs.length&&y.addClass(this._document.body,"modal-open"),U&&U.instance&&(this._applyBackdropOptions(U.instance,c),U.changeDetectorRef.detectChanges()),q.changeDetectorRef.detectChanges(),ae}get activeInstances(){return this._activeInstances}dismissAll(e){this._modalRefs.forEach(i=>i.dismiss(e))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(e,i){let c=e.resolveComponentFactory(FU).create(this._injector);return this._applicationRef.attachView(c.hostView),i.appendChild(c.location.nativeElement),c}_attachWindowComponent(e,i,o){let f=e.resolveComponentFactory(LU).create(this._injector,o.nodes);return this._applicationRef.attachView(f.hostView),i.appendChild(f.location.nativeElement),f}_applyWindowOptions(e,i){this._windowAttributes.forEach(o=>{Dd(i[o])&&(e[o]=i[o])})}_applyBackdropOptions(e,i){this._backdropAttributes.forEach(o=>{Dd(i[o])&&(e[o]=i[o])})}_getContentRef(e,i,o,c,f){return o?o instanceof di?this._createFromTemplateRef(o,c):function(t){return"string"==typeof t}(o)?this._createFromString(o):this._createFromComponent(e,i,o,c,f):new qh([])}_createFromTemplateRef(e,i){const c=e.createEmbeddedView({$implicit:i,close(f){i.close(f)},dismiss(f){i.dismiss(f)}});return this._applicationRef.attachView(c),new qh([c.rootNodes],c)}_createFromString(e){const i=this._document.createTextNode(`${e}`);return new qh([[i]])}_createFromComponent(e,i,o,c,f){const y=e.resolveComponentFactory(o),C=yt.create({providers:[{provide:zA,useValue:c}],parent:i}),M=y.create(C),k=M.location.nativeElement;return f.scrollable&&k.classList.add("component-host-scrollable"),this._applicationRef.attachView(M.hostView),new qh([[k]],M.hostView,M)}_setAriaHidden(e){const i=e.parentElement;i&&e!==this._document.body&&(Array.from(i.children).forEach(o=>{o!==e&&"SCRIPT"!==o.nodeName&&(this._ariaHiddenValues.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}),this._setAriaHidden(i))}_revertAriaHidden(){this._ariaHiddenValues.forEach((e,i)=>{e?i.setAttribute("aria-hidden",e):i.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(e){const i=()=>{const o=this._modalRefs.indexOf(e);o>-1&&(this._modalRefs.splice(o,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(e),this._activeInstances.emit(this._modalRefs),e.result.then(i,i)}_registerWindowCmpt(e){this._windowCmpts.push(e),this._activeWindowCmptHasChanged.next(),e.onDestroy(()=>{const i=this._windowCmpts.indexOf(e);i>-1&&(this._windowCmpts.splice(i,1),this._activeWindowCmptHasChanged.next())})}}return t.\u0275fac=function(e){return new(e||t)(Be(Ml),Be(yt),Be(Bn),Be(VA),Be(kp),Be(En))},t.\u0275prov=ct({factory:function(){return new t(Be(Ml),Be(me),Be(Bn),Be(VA),Be(kp),Be(En))},token:t,providedIn:"root"}),t})(),BU=(()=>{class t{constructor(e,i,o,c){this._moduleCFR=e,this._injector=i,this._modalStack=o,this._config=c}open(e,i={}){const o=Object.assign(Object.assign(Object.assign({},this._config),{animation:this._config.animation}),i);return this._modalStack.open(this._moduleCFR,this._injector,e,o)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(e){this._modalStack.dismissAll(e)}hasOpenModals(){return this._modalStack.hasOpenModals()}}return t.\u0275fac=function(e){return new(e||t)(Be(ra),Be(yt),Be(UA),Be(BA))},t.\u0275prov=ct({factory:function(){return new t(Be(ra),Be(me),Be(UA),Be(BA))},token:t,providedIn:"root"}),t})(),jA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({providers:[BU]}),t})(),qA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),e2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),i2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),r2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),o2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),c2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),u2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})(),d2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})();new bt("live announcer delay",{providedIn:"root",factory:function(){return 100}});let p2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[sa]]}),t})();const xj=[dA,hA,pA,_A,yA,RA,LA,jA,qA,e2,i2,r2,o2,c2,u2,d2,p2];let wj=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[xj,dA,hA,pA,_A,yA,RA,LA,jA,qA,e2,i2,r2,o2,c2,u2,d2,p2]}),t})(),Cj=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-header"]],decls:32,vars:0,consts:[[1,"navbar","fixed-top","navbar-expand-lg","navbar-light"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["src","assets/pintura.png","alt","","height","65px"],["type","button","data-toggle","collapse","data-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse","w-100","order-1","order-md-0","dual-collapse2"],[1,"navbar-nav","mr-auto"],[1,"nav-item","active"],["id","home","href","#",1,"nav-link"],[1,"nav-item"],["id","artists","href","#",1,"nav-link"],["id","news","href","#",1,"nav-link"],[1,"navbar-collapse","collapse","w-100","order-3","dual-collapse2"],[1,"navbar-nav","ml-auto"],["id","signup","href","#",1,"nav-link"],["id","register","href","#",1,"nav-link"]],template:function(e,i){1&e&&(De(0,"header"),De(1,"nav",0),De(2,"div",1),De(3,"a",2),Bt(4,"img",3),Ee(),De(5,"button",4),Bt(6,"span",5),Ee(),De(7,"div",6),De(8,"ul",7),De(9,"li",8),De(10,"a",9),Ht(11,"Home"),Ee(),Ee(),De(12,"li",10),De(13,"a",11),Ht(14,"Artists"),Ee(),Ee(),De(15,"li",10),De(16,"a",12),Ht(17,"News"),Ee(),Ee(),De(18,"li",10),De(19,"a",12),Ht(20,"Team"),Ee(),Ee(),De(21,"li",10),De(22,"a",12),Ht(23,"About"),Ee(),Ee(),Ee(),Ee(),Ee(),De(24,"div",13),De(25,"ul",14),De(26,"li",10),De(27,"a",15),Ht(28,"Sign Up"),Ee(),Ee(),De(29,"li",10),De(30,"a",16),Ht(31,"Register"),Ee(),Ee(),Ee(),Ee(),Ee(),Ee())},directives:[Vw],styles:['li.nav-item[_ngcontent-%COMP%]{font-size:x-large;padding-right:10%;width:auto}li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:max-content}li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   a#home[_ngcontent-%COMP%], li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   a#artist[_ngcontent-%COMP%], li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   a#news[_ngcontent-%COMP%]{padding-left:20%;padding-right:80%}li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   #signup[_ngcontent-%COMP%], li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   #register[_ngcontent-%COMP%]{padding-right:none}a.nav-link[_ngcontent-%COMP%]{margin-right:30%}li.nav-item[_ngcontent-%COMP%]:after{content:"";width:0;height:3px;background-color:#20b2aa;margin:auto;display:block}li.nav-item[_ngcontent-%COMP%]:hover:after{width:100%;transition:width .3s linear}li.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#20b2aa}']}),t})();function m2(t){return null!=t&&"false"!=`${t}`}let g2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({}),t})();const _2=new pd("13.0.1");let Hw;try{Hw="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(t){Hw=!1}let Tj=(()=>{class t{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function(t){return t===MM}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Hw)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return t.\u0275fac=function(e){return new(e||t)(Be($g))},t.\u0275prov=ct({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const w2="cdk-high-contrast-black-on-white",C2="cdk-high-contrast-white-on-black",Ww="cdk-high-contrast-active";let $j=(()=>{class t{constructor(e,i){this._platform=e,this._document=i}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,o=i&&i.getComputedStyle?i.getComputedStyle(e):null,c=(o&&o.backgroundColor||"").replace(/ /g,"");switch(e.remove(),c){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(Ww),e.remove(w2),e.remove(C2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?(e.add(Ww),e.add(w2)):2===i&&(e.add(Ww),e.add(C2))}}}return t.\u0275fac=function(e){return new(e||t)(Be(Tj),Be(Bn))},t.\u0275prov=ct({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const D2=new pd("13.0.1"),Gj=new bt("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}});let E2=(()=>{class t{constructor(e,i,o){this._hasDoneGlobalChecks=!1,this._document=o,e._applyBodyHighContrastModeCssClasses(),this._sanityChecks=i,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!(!zb()||"undefined"!=typeof __karma__&&__karma__||"undefined"!=typeof jasmine&&jasmine||"undefined"!=typeof jest&&jest||"undefined"!=typeof Mocha&&Mocha)&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const e=this._document.createElement("div");e.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(e);const i=getComputedStyle(e);i&&"none"!==i.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),e.remove()}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&D2.full!==_2.full&&console.warn("The Angular Material version ("+D2.full+") does not match the Angular CDK version ("+_2.full+").\nPlease ensure the versions of these two packages exactly match.")}}return t.\u0275fac=function(e){return new(e||t)(Be($j),Be(Gj,8),Be(Bn))},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[g2],g2]}),t})(),Kj=(()=>{class t{constructor(){this._vertical=!1,this._inset=!1}get vertical(){return this._vertical}set vertical(e){this._vertical=m2(e)}get inset(){return this._inset}set inset(e){this._inset=m2(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(e,i){2&e&&(Pn("aria-orientation",i.vertical?"vertical":"horizontal"),Qt("mat-divider-vertical",i.vertical)("mat-divider-horizontal",!i.vertical)("mat-divider-inset",i.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(e,i){},styles:[".mat-divider{display:block;margin:0;border-top-width:1px;border-top-style:solid}.mat-divider.mat-divider-vertical{border-top:0;border-right-width:1px;border-right-style:solid}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}\n"],encapsulation:2,changeDetection:0}),t})(),Jj=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t}),t.\u0275inj=nn({imports:[[E2],E2]}),t})(),Qj=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-principal-i"]],decls:25,vars:0,consts:[[1,"container-fluid"],[1,"btn-group-vertical"],["type","button",1,"btn","btn-outline-secondary"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-facebook"],["d","M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-instagram"],["d","M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-twitter"],["d","M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"],["src","../../assets/Imagen10.jpg","alt","artistaxxx",2,"width","45%","height","auto"],[1,"quoteysearch",2,"width","40%","text-align","center"],[1,"searchbar"],["href","#",1,"search_icon"],["xmlns","http://www.w3.org/2000/svg","width","16px","height","16px","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-search"],["d","M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"],["type","text","name","","placeholder","",1,"search_input"],[2,"width","50%","color","yellow"]],template:function(e,i){1&e&&(De(0,"div",0),De(1,"div",1),De(2,"button",2),Ys(),De(3,"svg",3),Bt(4,"path",4),Ee(),Ee(),Lo(),De(5,"button",2),Ys(),De(6,"svg",5),Bt(7,"path",6),Ee(),Ee(),Lo(),De(8,"button",2),Ys(),De(9,"svg",7),Bt(10,"path",8),Ee(),Ee(),Ee(),Lo(),Bt(11,"img",9),De(12,"div",10),De(13,"p"),Ht(14,"\u201cLos artistas conceptuales son m\xe1s "),De(15,"strong"),Ht(16,"m\xedsticos"),Ee(),Ht(17," que racionalistas. Llegan a conclusiones a las que no llega la l\xf3gica\u201d \u2013 Sol LeWitt"),Ee(),De(18,"div",11),De(19,"a",12),Ys(),De(20,"svg",13),Bt(21,"path",14),Ee(),Ee(),Lo(),Bt(22,"input",15),Ee(),Ee(),Ee(),De(23,"div",16),Bt(24,"mat-divider"),Ee())},directives:[Kj],styles:['.container-fluid[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;padding:0;width:100%;height:100vh}.searchbar[_ngcontent-%COMP%]{margin-bottom:auto;margin-top:auto;width:80%;margin-left:10%;background-color:#565b67a8;border-radius:30px;padding:10px}.search_input[_ngcontent-%COMP%]{width:92%;color:#fff;border:0;outline:0;background:none}.container-fluid[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Poppins",sans-serif;font-weight:lighter;color:#a9a9a9;font-size:156%;padding-bottom:10%}.input-group[_ngcontent-%COMP%]{margin-top:100px;margin-left:100px}.btn-group-vertical[_ngcontent-%COMP%]{padding-left:10px}#buscarinput[_ngcontent-%COMP%]{background-color:#e9ecef}#trazo[_ngcontent-%COMP%]{height:220px;width:100%;position:relative;bottom:-570px;margin-bottom:0}']}),t})(),e$=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-artistas-ii"]],decls:1,vars:0,consts:[[1,"container-fluid"]],template:function(e,i){1&e&&Bt(0,"div",0)},styles:[".container-fluid[_ngcontent-%COMP%]{width:100%;height:100vh;background-color:#6e6e6e}"]}),t})(),t$=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-noticias-iii"]],decls:1,vars:0,consts:[[1,"container-fluid"]],template:function(e,i){1&e&&Bt(0,"div",0)},styles:[".container-fluid[_ngcontent-%COMP%]{width:100%;height:100vh;background-color:#6495ed}"]}),t})(),n$=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-team-iv"]],decls:22,vars:0,consts:[[1,"container-fluid"],[1,"containerteam"],[1,"teamwork1"],["src","../../assets/Imagen4.jpg","alt","teamwork1"],[1,"teamwork2"],["src","../../assets/Imagen5.jpg","alt","teamwork1"],[1,"teamwork3"],["src","../../assets/Imagen6.jpg","alt","teamwork1"]],template:function(e,i){1&e&&(De(0,"div",0),De(1,"h1"),Ht(2,"Teamwork"),Ee(),De(3,"div",1),De(4,"div",2),Bt(5,"img",3),De(6,"h2"),Ht(7,"Ford Scavo"),Ee(),De(8,"p"),Ht(9,"dise\xf1ador"),Ee(),Ee(),De(10,"div",4),Bt(11,"img",5),De(12,"h2"),Ht(13,"Oliver Stucks"),Ee(),De(14,"p"),Ht(15,"artista"),Ee(),Ee(),De(16,"div",6),Bt(17,"img",7),De(18,"h2"),Ht(19,"Oliver Stucks"),Ee(),De(20,"p"),Ht(21,"dise\xf1ador"),Ee(),Ee(),Ee(),Ee())},styles:['.container-fluid[_ngcontent-%COMP%]{width:100%;height:100vh;max-height:max-content;background-color:#696969}img[_ngcontent-%COMP%]{width:300px;height:300px}.containerteam[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;padding:10px;margin-left:30px;margin-right:30px}.containerteam[_ngcontent-%COMP%]   .containerteam[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Poppins",sans-serif;margin-top:-10px}h1[_ngcontent-%COMP%]{font-family:"Poppins",sans-serif;font-size:20px;color:#a9a9a9;margin-left:200px}h2[_ngcontent-%COMP%]{font-weight:900;font-family:"Poppins",sans-serif;font-size:25px;margin-top:20px}.teamwork1[_ngcontent-%COMP%], .teamwork2[_ngcontent-%COMP%], .teamwork3[_ngcontent-%COMP%]{padding:20px}']}),t})(),i$=(()=>{class t{constructor(){this.title="mapboxgl"}ngOnInit(){function e(y){o.flyTo({center:y.geometry.coordinates,zoom:15})}function i(y){const C=document.getElementsByClassName("mapboxgl-popup");C[0]&&C[0].remove(),new u_.Popup({closeOnClick:!1}).setLngLat(y.geometry.coordinates).setHTML(`<h3>${y.properties.title}</h3><h4>${y.properties.description}</h4>`).addTo(o).on("close",function(k){o.flyTo({center:[-76.51972,3.44],zoom:11.5})})}u_.accessToken=tw_maptokenkey;const o=new u_.Map({container:"map",style:"mapbox://styles/fetoro21/ckw03obox54lq14qapznf09sc",attributionControl:!1,center:[-76.51972,3.44],zoom:11.5}),c={type:"FeatureCollection",features:[{type:"Feature",properties:{id:1,title:"Parque del Ingenio",event:"Exposici\xf3n de Arte",address:"Parque del Ingenio",date:"18 de Nov. a las 7 PM",description:"Parque arbolado, con zonas para hacer ejercicio, pistas para correr y puestos de comida y bebida."},geometry:{coordinates:[-76.531016,3.385696],type:"Point"}},{type:"Feature",properties:{id:2,title:"Parque la Flora",event:"Galeria de Fotos",address:"Parque la Flora",date:"22 de Nov. a las 11 AM",description:"Peque\xf1o parque urbano, con m\xe1quinas para hacer ejercicio, zonas de juego y c\xe9sped donde los ni\xf1os pueden practicar deportes."},geometry:{coordinates:[-76.522277,3.485272],type:"Point"}},{type:"Feature",properties:{id:3,title:"Parque de los Poetas",event:"Esculturas interactivas",address:"Parque de los Poetas",date:"25 de Dic. a las 5 PM",name:"parque",description:"En este bello lugar se realizan espect\xe1culos art\xedsticos de todos los g\xe9neros como muestra de la vocaci\xf3n cultural presente en la zona"},geometry:{coordinates:[-76.532145,3.45337],type:"Point"}}]};c.features.forEach(function(y,C){y.properties.id=C}),o.on("load",()=>{var y;o.addLayer({id:"locations",type:"symbol",layout:{"icon-image":"kr-natl-hwy-2"},source:{type:"geojson",data:c}}),function(y){for(const C of y.features){const M=document.getElementById("listings");if(M&&M.appendChild){const k=M.appendChild(document.createElement("div"));k.id=`listing-${C.properties.id}`,k.className="item",k.style.borderBottom="1px solid #909090",k.style.padding="10px",k.style.textDecoration="none",k.style.color="#404040";const L=k.appendChild(document.createElement("a"));L.href="#",L.className="title",L.id=`link-${C.properties.id}`,L.innerHTML=`${C.properties.event}`,L.style.textDecoration="none",L.style.fontSize="20px",L.style.display="block",L.style.fontWeight="700";const U=k.appendChild(document.createElement("div"));U.align="justify",U.innerHTML=`<svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall css-1k33q06" height="20px" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="LocationOnIcon"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg>\n       ${C.properties.address}<br>\n       <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall css-1k33q06" height="20px" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="DateRangeIcon"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path></svg>\n       ${C.properties.date}`,L.addEventListener("click",function(){for(const ae of y.features)this.id===`link-${ae.properties.id}`&&(e(ae),i(ae));const q=document.getElementsByClassName("active");q[0]&&q[0].classList.remove("active"),this.parentElement&&this.parentElement.classList.add("active")})}}}(c),o.on("click",M=>{const k=o.queryRenderedFeatures(M.point,{layers:["locations"]});if(!k.length)return;const L=k[0];e(L),i(L);const U=document.getElementsByClassName("active");U[0]&&U[0].classList.remove("active"),document.getElementById(`listing-${L.properties.id}`).classList.add("active")}),(null===(y=document.getElementById("listings"))||void 0===y?void 0:y.lastChild).style.borderBottom="none"})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-footer"]],decls:44,vars:0,consts:[[1,"text-center","text-lg-start","bg-light","text-muted",2,"background-color","rgb(0, 0, 0)"],[1,"d-flex","justify-content-center","justify-content-lg-between","p-md-4",2,"background-color","rgb(0, 0, 0)"],[1,"me-5","d-none","d-lg-block"],["href","",1,"me-4","text-reset"],["src","assets/facebook.png","height","25px"],["src","assets/twitter.png","height","23px"],["src","assets/google.png","height","23px"],["src","assets/instagram.png","height","24px"],["src","assets/pinterest.png","height","25px"],[1,"",2,"background-color","rgb(0, 0, 0)"],[1,"container","text-center","text-md-start","mw-100"],[1,"row"],[1,"col-xl-9"],[1,"sidebar"],[1,"heading"],["id","listings",1,"listings"],[1,"col-xl-3"],[1,"text-uppercase","fw-bold","mb-4"],[1,"bi","bi-geo-alt",2,"color","gray"],[1,"bi","bi-envelope"],[1,"bi","bi-telephone"],[1,"bi","bi-printer"],[1,"text-center","p-4",2,"background-color","rgb(0, 0, 0)"],["href","https://mdbootstrap.com/",1,"text-reset","fw-bold"]],template:function(e,i){1&e&&(De(0,"footer",0),De(1,"section",1),De(2,"div",2),De(3,"span"),Ht(4,"S\xedguenos en nuestras redes sociales:"),Ee(),Ee(),De(5,"div"),De(6,"a",3),Bt(7,"img",4),Ee(),De(8,"a",3),Bt(9,"img",5),Ee(),De(10,"a",3),Bt(11,"img",6),Ee(),De(12,"a",3),Bt(13,"img",7),Ee(),De(14,"a",3),Bt(15,"img",8),Ee(),Ee(),Ee(),De(16,"section",9),De(17,"div",10),De(18,"div",11),De(19,"div",12),De(20,"div",13),De(21,"div",14),De(22,"h1"),Ht(23,"Eventos"),Ee(),Ee(),Bt(24,"div",15),Ee(),Ee(),De(25,"div",16),De(26,"h6",17),Ht(27," Contact "),Ee(),De(28,"p"),Bt(29,"i",18),Ht(30," New York, NY 10012, US"),Ee(),De(31,"p"),Bt(32,"i",19),Ht(33," info@example.com"),Ee(),De(34,"p"),Bt(35,"i",20),Ht(36," + 01 234 567 88"),Ee(),De(37,"p"),Bt(38,"i",21),Ht(39," + 01 234 567 89"),Ee(),Ee(),Ee(),Ee(),Ee(),De(40,"div",22),Ht(41," \xa9 2021 Copyright: "),De(42,"a",23),Ht(43,"EspaciosPublicos.com"),Ee(),Ee(),Ee())},styles:[".col-xl-3[_ngcontent-%COMP%]{text-align:justify}.row[_ngcontent-%COMP%]{height:100%}section.d-flex.justify-content-center.justify-content-lg-between.p-md-4[_ngcontent-%COMP%]{font-size:larger;border-bottom-style:solid;border-width:1px;border-color:#313131}.container.text-center.text-md-start.mw-100[_ngcontent-%COMP%]{height:545px;min-height:250px;padding:2% 2% 0%}.container.text-center.text-md-start.mw-100[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:100%;height:100%}.col-xl-9[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{background:rgba(255,255,255,.555);border-bottom:1px solid rgba(238,238,238,.753);-webkit-text-decoration-color:#464545;text-decoration-color:#464545;height:60px;line-height:60px;padding:0 5px}.col-xl-9[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{background-color:#f4f6f27c;position:absolute;width:25%;height:100%;border-right:1px solid rgba(0,0,0,.25);z-index:1001}.col-xl-9[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   #listings[_ngcontent-%COMP%]{height:100%;overflow:auto;padding:10px;text-decoration:none}.col-xl-9[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   .listing[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:last-child{border-bottom:none}.col-xl-9[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:3px;height:3px;border-left:0;background:rgba(0,0,0,.1)}.col-xl-9[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:none}.col-xl-9[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:darkcyan;border-radius:0}"]}),t})(),r$=(()=>{class t{constructor(){this.title="EspaciosPublicos"}ngOnInit(){u_.accessToken=tw_maptokenkey,new u_.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",attributionControl:!1,center:[-74.5,40],zoom:9})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=kn({type:t,selectors:[["app-root"]],decls:7,vars:0,template:function(e,i){1&e&&(Bt(0,"app-header"),Bt(1,"router-outlet"),Bt(2,"app-principal-i"),Bt(3,"app-artistas-ii"),Bt(4,"app-noticias-iii"),Bt(5,"app-team-iv"),Bt(6,"app-footer"))},directives:[Cj,Jx,Qj,e$,t$,n$,i$],styles:[""]}),t})(),o$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=vn({type:t,bootstrap:[r$]}),t.\u0275inj=nn({providers:[],imports:[[IB,Jj,m5,wj]]}),t})();(function(){if(MT)throw new Error("Cannot enable prod mode after platform setup.");TT=!1})(),TB().bootstrapModule(o$).catch(t=>console.error(t))}},Yo=>{Yo(Yo.s=755)}]);